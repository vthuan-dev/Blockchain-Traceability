(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Ipfs = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Ipfs=(()=>{var uue=Object.create;var dm=Object.defineProperty;var fue=Object.getOwnPropertyDescriptor;var hue=Object.getOwnPropertyNames;var due=Object.getPrototypeOf,pue=Object.prototype.hasOwnProperty;var mue=(r,e,t)=>e in r?dm(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var op=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var gue=(r,e)=>()=>(r&&(e=r(r=0)),e);var P=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),jt=(r,e)=>{for(var t in e)dm(r,t,{get:e[t],enumerable:!0})},jk=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of hue(e))!pue.call(r,i)&&i!==t&&dm(r,i,{get:()=>e[i],enumerable:!(n=fue(e,i))||n.enumerable});return r};var S=(r,e,t)=>(t=r!=null?uue(due(r)):{},jk(e||!r||!r.__esModule?dm(t,"default",{value:r,enumerable:!0}):t,r)),yue=r=>jk(dm({},"__esModule",{value:!0}),r);var Q7=(r,e,t)=>(mue(r,typeof e!="symbol"?e+"":e,t),t);var Qk=P(L3=>{"use strict";l();L3.byteLength=bue;L3.toByteArray=_ue;L3.fromByteArray=xue;var aa=[],Bs=[],wue=typeof Uint8Array<"u"?Uint8Array:Array,X7="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Wf=0,Wk=X7.length;Wf<Wk;++Wf)aa[Wf]=X7[Wf],Bs[X7.charCodeAt(Wf)]=Wf;var Wf,Wk;Bs["-".charCodeAt(0)]=62;Bs["_".charCodeAt(0)]=63;function Yk(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function bue(r){var e=Yk(r),t=e[0],n=e[1];return(t+n)*3/4-n}function Eue(r,e,t){return(e+t)*3/4-t}function _ue(r){var e,t=Yk(r),n=t[0],i=t[1],s=new wue(Eue(r,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=Bs[r.charCodeAt(c)]<<18|Bs[r.charCodeAt(c+1)]<<12|Bs[r.charCodeAt(c+2)]<<6|Bs[r.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Bs[r.charCodeAt(c)]<<2|Bs[r.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=Bs[r.charCodeAt(c)]<<10|Bs[r.charCodeAt(c+1)]<<4|Bs[r.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function vue(r){return aa[r>>18&63]+aa[r>>12&63]+aa[r>>6&63]+aa[r&63]}function Sue(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(vue(n));return i.join("")}function xue(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(Sue(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(aa[e>>2]+aa[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(aa[e>>10]+aa[e>>4&63]+aa[e<<2&63]+"=")),i.join("")}});var Xk=P(Z7=>{l();Z7.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,u=c>>1,f=-7,h=t?i-1:0,p=t?-1:1,d=r[e+h];for(h+=p,s=d&(1<<-f)-1,d>>=-f,f+=a;f>0;s=s*256+r[e+h],h+=p,f-=8);for(o=s&(1<<-f)-1,s>>=-f,f+=n;f>0;o=o*256+r[e+h],h+=p,f-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-u}return(d?-1:1)*o*Math.pow(2,s-n)};Z7.write=function(r,e,t,n,i,s){var o,a,c,u=s*8-i-1,f=(1<<u)-1,h=f>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,m=n?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=f):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=p/c:e+=p*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=f?(a=0,o=f):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;r[t+d]=a&255,d+=m,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;r[t+d]=o&255,d+=m,o/=256,u-=8);r[t+d-m]|=g*128}});var fp=P(up=>{"use strict";l();var J7=Qk(),cp=Xk(),Zk=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;up.Buffer=G;up.SlowBuffer=Pue;up.INSPECT_MAX_BYTES=50;var B3=2147483647;up.kMaxLength=B3;G.TYPED_ARRAY_SUPPORT=Aue();!G.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function Aue(){try{let r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch{return!1}}Object.defineProperty(G.prototype,"parent",{enumerable:!0,get:function(){if(G.isBuffer(this))return this.buffer}});Object.defineProperty(G.prototype,"offset",{enumerable:!0,get:function(){if(G.isBuffer(this))return this.byteOffset}});function _c(r){if(r>B3)throw new RangeError('The value "'+r+'" is invalid for option "size"');let e=new Uint8Array(r);return Object.setPrototypeOf(e,G.prototype),e}function G(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return n_(r)}return rO(r,e,t)}G.poolSize=8192;function rO(r,e,t){if(typeof r=="string")return Iue(r,e);if(ArrayBuffer.isView(r))return Rue(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(ca(r,ArrayBuffer)||r&&ca(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ca(r,SharedArrayBuffer)||r&&ca(r.buffer,SharedArrayBuffer)))return t_(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let n=r.valueOf&&r.valueOf();if(n!=null&&n!==r)return G.from(n,e,t);let i=Cue(r);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return G.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}G.from=function(r,e,t){return rO(r,e,t)};Object.setPrototypeOf(G.prototype,Uint8Array.prototype);Object.setPrototypeOf(G,Uint8Array);function nO(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function Tue(r,e,t){return nO(r),r<=0?_c(r):e!==void 0?typeof t=="string"?_c(r).fill(e,t):_c(r).fill(e):_c(r)}G.alloc=function(r,e,t){return Tue(r,e,t)};function n_(r){return nO(r),_c(r<0?0:i_(r)|0)}G.allocUnsafe=function(r){return n_(r)};G.allocUnsafeSlow=function(r){return n_(r)};function Iue(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!G.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=iO(r,e)|0,n=_c(t),i=n.write(r,e);return i!==t&&(n=n.slice(0,i)),n}function e_(r){let e=r.length<0?0:i_(r.length)|0,t=_c(e);for(let n=0;n<e;n+=1)t[n]=r[n]&255;return t}function Rue(r){if(ca(r,Uint8Array)){let e=new Uint8Array(r);return t_(e.buffer,e.byteOffset,e.byteLength)}return e_(r)}function t_(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let n;return e===void 0&&t===void 0?n=new Uint8Array(r):t===void 0?n=new Uint8Array(r,e):n=new Uint8Array(r,e,t),Object.setPrototypeOf(n,G.prototype),n}function Cue(r){if(G.isBuffer(r)){let e=i_(r.length)|0,t=_c(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||o_(r.length)?_c(0):e_(r);if(r.type==="Buffer"&&Array.isArray(r.data))return e_(r.data)}function i_(r){if(r>=B3)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+B3.toString(16)+" bytes");return r|0}function Pue(r){return+r!=r&&(r=0),G.alloc(+r)}G.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==G.prototype};G.compare=function(e,t){if(ca(e,Uint8Array)&&(e=G.from(e,e.offset,e.byteLength)),ca(t,Uint8Array)&&(t=G.from(t,t.offset,t.byteLength)),!G.isBuffer(e)||!G.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let s=0,o=Math.min(n,i);s<o;++s)if(e[s]!==t[s]){n=e[s],i=t[s];break}return n<i?-1:i<n?1:0};G.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};G.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return G.alloc(0);let n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;let i=G.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){let o=e[n];if(ca(o,Uint8Array))s+o.length>i.length?(G.isBuffer(o)||(o=G.from(o)),o.copy(i,s)):Uint8Array.prototype.set.call(i,o,s);else if(G.isBuffer(o))o.copy(i,s);else throw new TypeError('"list" argument must be an Array of Buffers');s+=o.length}return i};function iO(r,e){if(G.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||ca(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);let t=r.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&t===0)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return r_(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return dO(r).length;default:if(i)return n?-1:r_(r).length;e=(""+e).toLowerCase(),i=!0}}G.byteLength=iO;function kue(r,e,t){let n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return zue(this,e,t);case"utf8":case"utf-8":return oO(this,e,t);case"ascii":return Fue(this,e,t);case"latin1":case"binary":return Vue(this,e,t);case"base64":return Uue(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Kue(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}G.prototype._isBuffer=!0;function Yf(r,e,t){let n=r[e];r[e]=r[t],r[t]=n}G.prototype.swap16=function(){let e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)Yf(this,t,t+1);return this};G.prototype.swap32=function(){let e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)Yf(this,t,t+3),Yf(this,t+1,t+2);return this};G.prototype.swap64=function(){let e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)Yf(this,t,t+7),Yf(this,t+1,t+6),Yf(this,t+2,t+5),Yf(this,t+3,t+4);return this};G.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?oO(this,0,e):kue.apply(this,arguments)};G.prototype.toLocaleString=G.prototype.toString;G.prototype.equals=function(e){if(!G.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:G.compare(this,e)===0};G.prototype.inspect=function(){let e="",t=up.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};Zk&&(G.prototype[Zk]=G.prototype.inspect);G.prototype.compare=function(e,t,n,i,s){if(ca(e,Uint8Array)&&(e=G.from(e,e.offset,e.byteLength)),!G.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),s===void 0&&(s=this.length),t<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&t>=n)return 0;if(i>=s)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,s>>>=0,this===e)return 0;let o=s-i,a=n-t,c=Math.min(o,a),u=this.slice(i,s),f=e.slice(t,n);for(let h=0;h<c;++h)if(u[h]!==f[h]){o=u[h],a=f[h];break}return o<a?-1:a<o?1:0};function sO(r,e,t,n,i){if(r.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,o_(t)&&(t=i?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(i)return-1;t=r.length-1}else if(t<0)if(i)t=0;else return-1;if(typeof e=="string"&&(e=G.from(e,n)),G.isBuffer(e))return e.length===0?-1:Jk(r,e,t,n,i);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):Jk(r,[e],t,n,i);throw new TypeError("val must be string, number or Buffer")}function Jk(r,e,t,n,i){let s=1,o=r.length,a=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||e.length<2)return-1;s=2,o/=2,a/=2,t/=2}function c(f,h){return s===1?f[h]:f.readUInt16BE(h*s)}let u;if(i){let f=-1;for(u=t;u<o;u++)if(c(r,u)===c(e,f===-1?0:u-f)){if(f===-1&&(f=u),u-f+1===a)return f*s}else f!==-1&&(u-=u-f),f=-1}else for(t+a>o&&(t=o-a),u=t;u>=0;u--){let f=!0;for(let h=0;h<a;h++)if(c(r,u+h)!==c(e,h)){f=!1;break}if(f)return u}return-1}G.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};G.prototype.indexOf=function(e,t,n){return sO(this,e,t,n,!0)};G.prototype.lastIndexOf=function(e,t,n){return sO(this,e,t,n,!1)};function Oue(r,e,t,n){t=Number(t)||0;let i=r.length-t;n?(n=Number(n),n>i&&(n=i)):n=i;let s=e.length;n>s/2&&(n=s/2);let o;for(o=0;o<n;++o){let a=parseInt(e.substr(o*2,2),16);if(o_(a))return o;r[t+o]=a}return o}function Nue(r,e,t,n){return U3(r_(e,r.length-t),r,t,n)}function Due(r,e,t,n){return U3(Gue(e),r,t,n)}function Lue(r,e,t,n){return U3(dO(e),r,t,n)}function Bue(r,e,t,n){return U3(jue(e,r.length-t),r,t,n)}G.prototype.write=function(e,t,n,i){if(t===void 0)i="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")i=t,n=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(n)?(n=n>>>0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let s=this.length-t;if((n===void 0||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let o=!1;for(;;)switch(i){case"hex":return Oue(this,e,t,n);case"utf8":case"utf-8":return Nue(this,e,t,n);case"ascii":case"latin1":case"binary":return Due(this,e,t,n);case"base64":return Lue(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Bue(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}};G.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Uue(r,e,t){return e===0&&t===r.length?J7.fromByteArray(r):J7.fromByteArray(r.slice(e,t))}function oO(r,e,t){t=Math.min(r.length,t);let n=[],i=e;for(;i<t;){let s=r[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a<=t){let c,u,f,h;switch(a){case 1:s<128&&(o=s);break;case 2:c=r[i+1],(c&192)===128&&(h=(s&31)<<6|c&63,h>127&&(o=h));break;case 3:c=r[i+1],u=r[i+2],(c&192)===128&&(u&192)===128&&(h=(s&15)<<12|(c&63)<<6|u&63,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:c=r[i+1],u=r[i+2],f=r[i+3],(c&192)===128&&(u&192)===128&&(f&192)===128&&(h=(s&15)<<18|(c&63)<<12|(u&63)<<6|f&63,h>65535&&h<1114112&&(o=h))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),i+=a}return Mue(n)}var eO=4096;function Mue(r){let e=r.length;if(e<=eO)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=eO));return t}function Fue(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]&127);return n}function Vue(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]);return n}function zue(r,e,t){let n=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);let i="";for(let s=e;s<t;++s)i+=Wue[r[s]];return i}function Kue(r,e,t){let n=r.slice(e,t),i="";for(let s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+n[s+1]*256);return i}G.prototype.slice=function(e,t){let n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);let i=this.subarray(e,t);return Object.setPrototypeOf(i,G.prototype),i};function Rn(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}G.prototype.readUintLE=G.prototype.readUIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||Rn(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return i};G.prototype.readUintBE=G.prototype.readUIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||Rn(e,t,this.length);let i=this[e+--t],s=1;for(;t>0&&(s*=256);)i+=this[e+--t]*s;return i};G.prototype.readUint8=G.prototype.readUInt8=function(e,t){return e=e>>>0,t||Rn(e,1,this.length),this[e]};G.prototype.readUint16LE=G.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||Rn(e,2,this.length),this[e]|this[e+1]<<8};G.prototype.readUint16BE=G.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||Rn(e,2,this.length),this[e]<<8|this[e+1]};G.prototype.readUint32LE=G.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||Rn(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};G.prototype.readUint32BE=G.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||Rn(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};G.prototype.readBigUInt64LE=Wl(function(e){e=e>>>0,lp(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&pm(e,this.length-8);let i=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,s=this[++e]+this[++e]*2**8+this[++e]*2**16+n*2**24;return BigInt(i)+(BigInt(s)<<BigInt(32))});G.prototype.readBigUInt64BE=Wl(function(e){e=e>>>0,lp(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&pm(e,this.length-8);let i=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],s=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n;return(BigInt(i)<<BigInt(32))+BigInt(s)});G.prototype.readIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||Rn(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i};G.prototype.readIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||Rn(e,t,this.length);let i=t,s=1,o=this[e+--i];for(;i>0&&(s*=256);)o+=this[e+--i]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o};G.prototype.readInt8=function(e,t){return e=e>>>0,t||Rn(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};G.prototype.readInt16LE=function(e,t){e=e>>>0,t||Rn(e,2,this.length);let n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};G.prototype.readInt16BE=function(e,t){e=e>>>0,t||Rn(e,2,this.length);let n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};G.prototype.readInt32LE=function(e,t){return e=e>>>0,t||Rn(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};G.prototype.readInt32BE=function(e,t){return e=e>>>0,t||Rn(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};G.prototype.readBigInt64LE=Wl(function(e){e=e>>>0,lp(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&pm(e,this.length-8);let i=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});G.prototype.readBigInt64BE=Wl(function(e){e=e>>>0,lp(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&pm(e,this.length-8);let i=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n)});G.prototype.readFloatLE=function(e,t){return e=e>>>0,t||Rn(e,4,this.length),cp.read(this,e,!0,23,4)};G.prototype.readFloatBE=function(e,t){return e=e>>>0,t||Rn(e,4,this.length),cp.read(this,e,!1,23,4)};G.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||Rn(e,8,this.length),cp.read(this,e,!0,52,8)};G.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||Rn(e,8,this.length),cp.read(this,e,!1,52,8)};function Fi(r,e,t,n,i,s){if(!G.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(t+n>r.length)throw new RangeError("Index out of range")}G.prototype.writeUintLE=G.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;Fi(this,e,t,n,a,0)}let s=1,o=0;for(this[t]=e&255;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n};G.prototype.writeUintBE=G.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;Fi(this,e,t,n,a,0)}let s=n-1,o=1;for(this[t+s]=e&255;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n};G.prototype.writeUint8=G.prototype.writeUInt8=function(e,t,n){return e=+e,t=t>>>0,n||Fi(this,e,t,1,255,0),this[t]=e&255,t+1};G.prototype.writeUint16LE=G.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||Fi(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};G.prototype.writeUint16BE=G.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||Fi(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};G.prototype.writeUint32LE=G.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||Fi(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};G.prototype.writeUint32BE=G.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||Fi(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function aO(r,e,t,n,i){hO(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,t}function cO(r,e,t,n,i){hO(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t+7]=s,s=s>>8,r[t+6]=s,s=s>>8,r[t+5]=s,s=s>>8,r[t+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=o,o=o>>8,r[t+2]=o,o=o>>8,r[t+1]=o,o=o>>8,r[t]=o,t+8}G.prototype.writeBigUInt64LE=Wl(function(e,t=0){return aO(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});G.prototype.writeBigUInt64BE=Wl(function(e,t=0){return cO(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});G.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let c=Math.pow(2,8*n-1);Fi(this,e,t,n,c-1,-c)}let s=0,o=1,a=0;for(this[t]=e&255;++s<n&&(o*=256);)e<0&&a===0&&this[t+s-1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};G.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let c=Math.pow(2,8*n-1);Fi(this,e,t,n,c-1,-c)}let s=n-1,o=1,a=0;for(this[t+s]=e&255;--s>=0&&(o*=256);)e<0&&a===0&&this[t+s+1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};G.prototype.writeInt8=function(e,t,n){return e=+e,t=t>>>0,n||Fi(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};G.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||Fi(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};G.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||Fi(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};G.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||Fi(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};G.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||Fi(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};G.prototype.writeBigInt64LE=Wl(function(e,t=0){return aO(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});G.prototype.writeBigInt64BE=Wl(function(e,t=0){return cO(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function lO(r,e,t,n,i,s){if(t+n>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function uO(r,e,t,n,i){return e=+e,t=t>>>0,i||lO(r,e,t,4,34028234663852886e22,-34028234663852886e22),cp.write(r,e,t,n,23,4),t+4}G.prototype.writeFloatLE=function(e,t,n){return uO(this,e,t,!0,n)};G.prototype.writeFloatBE=function(e,t,n){return uO(this,e,t,!1,n)};function fO(r,e,t,n,i){return e=+e,t=t>>>0,i||lO(r,e,t,8,17976931348623157e292,-17976931348623157e292),cp.write(r,e,t,n,52,8),t+8}G.prototype.writeDoubleLE=function(e,t,n){return fO(this,e,t,!0,n)};G.prototype.writeDoubleBE=function(e,t,n){return fO(this,e,t,!1,n)};G.prototype.copy=function(e,t,n,i){if(!G.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!i&&i!==0&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);let s=i-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),s};G.prototype.fill=function(e,t,n,i){if(typeof e=="string"){if(typeof t=="string"?(i=t,t=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!G.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(e.length===1){let o=e.charCodeAt(0);(i==="utf8"&&o<128||i==="latin1")&&(e=o)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);let s;if(typeof e=="number")for(s=t;s<n;++s)this[s]=e;else{let o=G.isBuffer(e)?e:G.from(e,i),a=o.length;if(a===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-t;++s)this[s+t]=o[s%a]}return this};var ap={};function s_(r,e,t){ap[r]=class extends t{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(i){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:i,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}s_("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);s_("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError);s_("ERR_OUT_OF_RANGE",function(r,e,t){let n=`The value of "${r}" is out of range.`,i=t;return Number.isInteger(t)&&Math.abs(t)>2**32?i=tO(String(t)):typeof t=="bigint"&&(i=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(i=tO(i)),i+="n"),n+=` It must be ${e}. Received ${i}`,n},RangeError);function tO(r){let e="",t=r.length,n=r[0]==="-"?1:0;for(;t>=n+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function que(r,e,t){lp(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&pm(e,r.length-(t+1))}function hO(r,e,t,n,i,s){if(r>t||r<e){let o=typeof e=="bigint"?"n":"",a;throw s>3?e===0||e===BigInt(0)?a=`>= 0${o} and < 2${o} ** ${(s+1)*8}${o}`:a=`>= -(2${o} ** ${(s+1)*8-1}${o}) and < 2 ** ${(s+1)*8-1}${o}`:a=`>= ${e}${o} and <= ${t}${o}`,new ap.ERR_OUT_OF_RANGE("value",a,r)}que(n,i,s)}function lp(r,e){if(typeof r!="number")throw new ap.ERR_INVALID_ARG_TYPE(e,"number",r)}function pm(r,e,t){throw Math.floor(r)!==r?(lp(r,t),new ap.ERR_OUT_OF_RANGE(t||"offset","an integer",r)):e<0?new ap.ERR_BUFFER_OUT_OF_BOUNDS:new ap.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,r)}var $ue=/[^+/0-9A-Za-z-_]/g;function Hue(r){if(r=r.split("=")[0],r=r.trim().replace($ue,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function r_(r,e){e=e||1/0;let t,n=r.length,i=null,s=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function Gue(r){let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function jue(r,e){let t,n,i,s=[];for(let o=0;o<r.length&&!((e-=2)<0);++o)t=r.charCodeAt(o),n=t>>8,i=t%256,s.push(i),s.push(n);return s}function dO(r){return J7.toByteArray(Hue(r))}function U3(r,e,t,n){let i;for(i=0;i<n&&!(i+t>=e.length||i>=r.length);++i)e[i+t]=r[i];return i}function ca(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function o_(r){return r!==r}var Wue=function(){let r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let n=t*16;for(let i=0;i<16;++i)e[n+i]=r[t]+r[i]}return e}();function Wl(r){return typeof BigInt>"u"?Yue:r}function Yue(){throw new Error("BigInt not supported")}});var wO=P((OCe,yO)=>{l();var Yr=yO.exports={},la,ua;function a_(){throw new Error("setTimeout has not been defined")}function c_(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?la=setTimeout:la=a_}catch{la=a_}try{typeof clearTimeout=="function"?ua=clearTimeout:ua=c_}catch{ua=c_}})();function pO(r){if(la===setTimeout)return setTimeout(r,0);if((la===a_||!la)&&setTimeout)return la=setTimeout,setTimeout(r,0);try{return la(r,0)}catch{try{return la.call(null,r,0)}catch{return la.call(this,r,0)}}}function Que(r){if(ua===clearTimeout)return clearTimeout(r);if((ua===c_||!ua)&&clearTimeout)return ua=clearTimeout,clearTimeout(r);try{return ua(r)}catch{try{return ua.call(null,r)}catch{return ua.call(this,r)}}}var vc=[],hp=!1,Qf,M3=-1;function Xue(){!hp||!Qf||(hp=!1,Qf.length?vc=Qf.concat(vc):M3=-1,vc.length&&mO())}function mO(){if(!hp){var r=pO(Xue);hp=!0;for(var e=vc.length;e;){for(Qf=vc,vc=[];++M3<e;)Qf&&Qf[M3].run();M3=-1,e=vc.length}Qf=null,hp=!1,Que(r)}}Yr.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];vc.push(new gO(r,e)),vc.length===1&&!hp&&pO(mO)};function gO(r,e){this.fun=r,this.array=e}gO.prototype.run=function(){this.fun.apply(null,this.array)};Yr.title="browser";Yr.browser=!0;Yr.env={};Yr.argv=[];Yr.version="";Yr.versions={};function Sc(){}Yr.on=Sc;Yr.addListener=Sc;Yr.once=Sc;Yr.off=Sc;Yr.removeListener=Sc;Yr.removeAllListeners=Sc;Yr.emit=Sc;Yr.prependListener=Sc;Yr.prependOnceListener=Sc;Yr.listeners=function(r){return[]};Yr.binding=function(r){throw new Error("process.binding is not supported")};Yr.cwd=function(){return"/"};Yr.chdir=function(r){throw new Error("process.chdir is not supported")};Yr.umask=function(){return 0}});var Buffer,process,l=gue(()=>{({Buffer}=fp()),process=wO()});var EO=P((LCe,bO)=>{"use strict";l();bO.exports=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;let e=Object.getPrototypeOf(r);return e===null||e===Object.prototype}});var u_=P((xO,AO)=>{"use strict";l();var F3=EO(),{hasOwnProperty:vO}=Object.prototype,{propertyIsEnumerable:Zue}=Object,dp=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),Jue=xO,_O={concatArrays:!1,ignoreUndefined:!1},V3=r=>{let e=[];for(let t in r)vO.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){let t=Object.getOwnPropertySymbols(r);for(let n of t)Zue.call(r,n)&&e.push(n)}return e};function pp(r){return Array.isArray(r)?efe(r):F3(r)?tfe(r):r}function efe(r){let e=r.slice(0,0);return V3(r).forEach(t=>{dp(e,t,pp(r[t]))}),e}function tfe(r){let e=Object.getPrototypeOf(r)===null?Object.create(null):{};return V3(r).forEach(t=>{dp(e,t,pp(r[t]))}),e}var SO=(r,e,t,n)=>(t.forEach(i=>{typeof e[i]>"u"&&n.ignoreUndefined||(i in r&&r[i]!==Object.getPrototypeOf(r)?dp(r,i,l_(r[i],e[i],n)):dp(r,i,pp(e[i])))}),r),rfe=(r,e,t)=>{let n=r.slice(0,0),i=0;return[r,e].forEach(s=>{let o=[];for(let a=0;a<s.length;a++)vO.call(s,a)&&(o.push(String(a)),s===r?dp(n,i++,s[a]):dp(n,i++,pp(s[a])));n=SO(n,s,V3(s).filter(a=>!o.includes(a)),t)}),n};function l_(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?rfe(r,e,t):!F3(e)||!F3(r)?pp(e):SO(r,e,V3(e),t)}AO.exports=function(...r){let e=l_(pp(_O),this!==Jue&&this||{},_O),t={_:{}};for(let n of r)if(n!==void 0){if(!F3(n))throw new TypeError("`"+n+"` is not an Option Object");t=l_(t,{_:n},e)}return t._}});var f_=P((VCe,IO)=>{l();function nfe(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}IO.exports=nfe});var K3=P((KCe,RO)=>{"use strict";l();var ife=f_(),z3=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,mm=ife(),sfe=z3&&!mm,ofe=mm&&!z3,afe=mm&&z3,cfe=typeof op=="function"&&typeof process<"u"&&typeof process.release<"u"&&process.release.name==="node"&&!mm,lfe=typeof importScripts=="function"&&typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,ufe=typeof process<"u"&&typeof process.env<"u"&&!1,ffe=typeof navigator<"u"&&navigator.product==="ReactNative";RO.exports={isTest:ufe,isElectron:mm,isElectronMain:ofe,isElectronRenderer:afe,isNode:cfe,isBrowser:sfe,isWebWorker:lfe,isEnvWithDom:z3,isReactNative:ffe}});var h_=P((HCe,CO)=>{l();var mp=1e3,gp=mp*60,yp=gp*60,Xf=yp*24,hfe=Xf*7,dfe=Xf*365.25;CO.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return pfe(r);if(t==="number"&&isFinite(r))return e.long?gfe(r):mfe(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function pfe(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*dfe;case"weeks":case"week":case"w":return t*hfe;case"days":case"day":case"d":return t*Xf;case"hours":case"hour":case"hrs":case"hr":case"h":return t*yp;case"minutes":case"minute":case"mins":case"min":case"m":return t*gp;case"seconds":case"second":case"secs":case"sec":case"s":return t*mp;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function mfe(r){var e=Math.abs(r);return e>=Xf?Math.round(r/Xf)+"d":e>=yp?Math.round(r/yp)+"h":e>=gp?Math.round(r/gp)+"m":e>=mp?Math.round(r/mp)+"s":r+"ms"}function gfe(r){var e=Math.abs(r);return e>=Xf?q3(r,e,Xf,"day"):e>=yp?q3(r,e,yp,"hour"):e>=gp?q3(r,e,gp,"minute"):e>=mp?q3(r,e,mp,"second"):r+" ms"}function q3(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var kO=P((jCe,PO)=>{l();function yfe(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=h_(),t.destroy=u,Object.keys(r).forEach(f=>{t[f]=r[f]}),t.names=[],t.skips=[],t.formatters={};function e(f){let h=0;for(let p=0;p<f.length;p++)h=(h<<5)-h+f.charCodeAt(p),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(f){let h,p=null,d,m;function g(...y){if(!g.enabled)return;let w=g,b=Number(new Date),_=b-(h||b);w.diff=_,w.prev=h,w.curr=b,h=b,y[0]=t.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let v=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(x,A)=>{if(x==="%%")return"%";v++;let R=t.formatters[A];if(typeof R=="function"){let O=y[v];x=R.call(w,O),y.splice(v,1),v--}return x}),t.formatArgs.call(w,y),(w.log||t.log).apply(w,y)}return g.namespace=f,g.useColors=t.useColors(),g.color=t.selectColor(f),g.extend=n,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(d!==t.namespaces&&(d=t.namespaces,m=t.enabled(f)),m),set:y=>{p=y}}),typeof t.init=="function"&&t.init(g),g}function n(f,h){let p=t(this.namespace+(typeof h>"u"?":":h)+f);return p.log=this.log,p}function i(f){t.save(f),t.namespaces=f,t.names=[],t.skips=[];let h,p=(typeof f=="string"?f:"").split(/[\s,]+/),d=p.length;for(h=0;h<d;h++)p[h]&&(f=p[h].replace(/\*/g,".*?"),f[0]==="-"?t.skips.push(new RegExp("^"+f.slice(1)+"$")):t.names.push(new RegExp("^"+f+"$")))}function s(){let f=[...t.names.map(a),...t.skips.map(a).map(h=>"-"+h)].join(",");return t.enable(""),f}function o(f){if(f[f.length-1]==="*")return!0;let h,p;for(h=0,p=t.skips.length;h<p;h++)if(t.skips[h].test(f))return!1;for(h=0,p=t.names.length;h<p;h++)if(t.names[h].test(f))return!0;return!1}function a(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function c(f){return f instanceof Error?f.stack||f.message:f}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}PO.exports=yfe});var Us=P((ns,$3)=>{l();ns.formatArgs=bfe;ns.save=Efe;ns.load=_fe;ns.useColors=wfe;ns.storage=vfe();ns.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();ns.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function wfe(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function bfe(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+$3.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}ns.log=console.debug||console.log||(()=>{});function Efe(r){try{r?ns.storage.setItem("debug",r):ns.storage.removeItem("debug")}catch{}}function _fe(){let r;try{r=ns.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function vfe(){try{return localStorage}catch{}}$3.exports=kO()(ns);var{formatters:Sfe}=$3.exports;Sfe.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var W=P((gPe,BO)=>{"use strict";l();function LO(r,e){for(let t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function Kfe(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return LO(r,t)}catch{t.message=r.message,t.stack=r.stack;let i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(r)),LO(new i,t)}}BO.exports=Kfe});var Xl=P((wPe,UO)=>{"use strict";l();UO.exports=qfe;function qfe(r,e){for(var t=new Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)t[n++]=arguments[i++];return new Promise(function(a,c){t[n]=function(f){if(s)if(s=!1,f)c(f);else{for(var h=new Array(arguments.length-1),p=0;p<h.length;)h[p++]=arguments[p];a.apply(null,h)}};try{r.apply(e||null,t)}catch(u){s&&(s=!1,c(u))}})}});var Zl=P(VO=>{"use strict";l();var H3=VO;H3.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&e.charAt(t)==="=";)++n;return Math.ceil(e.length*3)/4-n};var bp=new Array(64),FO=new Array(123);for(vo=0;vo<64;)FO[bp[vo]=vo<26?vo+65:vo<52?vo+71:vo<62?vo-4:vo-59|43]=vo++;var vo;H3.encode=function(e,t,n){for(var i=null,s=[],o=0,a=0,c;t<n;){var u=e[t++];switch(a){case 0:s[o++]=bp[u>>2],c=(u&3)<<4,a=1;break;case 1:s[o++]=bp[c|u>>4],c=(u&15)<<2,a=2;break;case 2:s[o++]=bp[c|u>>6],s[o++]=bp[u&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=bp[c],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var MO="invalid encoding";H3.decode=function(e,t,n){for(var i=n,s=0,o,a=0;a<e.length;){var c=e.charCodeAt(a++);if(c===61&&s>1)break;if((c=FO[c])===void 0)throw Error(MO);switch(s){case 0:o=c,s=1;break;case 1:t[n++]=o<<2|(c&48)>>4,o=c,s=2;break;case 2:t[n++]=(o&15)<<4|(c&60)>>2,o=c,s=3;break;case 3:t[n++]=(o&3)<<6|c,s=0;break}}if(s===1)throw Error(MO);return n-i};H3.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var Jl=P((vPe,zO)=>{"use strict";l();zO.exports=G3;function G3(){this._listeners={}}G3.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this};G3.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this};G3.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this}});var eu=P((xPe,jO)=>{"use strict";l();jO.exports=KO(KO);function KO(r){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),n=t[3]===128;function i(c,u,f){e[0]=c,u[f]=t[0],u[f+1]=t[1],u[f+2]=t[2],u[f+3]=t[3]}function s(c,u,f){e[0]=c,u[f]=t[3],u[f+1]=t[2],u[f+2]=t[1],u[f+3]=t[0]}r.writeFloatLE=n?i:s,r.writeFloatBE=n?s:i;function o(c,u){return t[0]=c[u],t[1]=c[u+1],t[2]=c[u+2],t[3]=c[u+3],e[0]}function a(c,u){return t[3]=c[u],t[2]=c[u+1],t[1]=c[u+2],t[0]=c[u+3],e[0]}r.readFloatLE=n?o:a,r.readFloatBE=n?a:o}():function(){function e(n,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)n(1/i>0?0:2147483648,s,o);else if(isNaN(i))n(2143289344,s,o);else if(i>34028234663852886e22)n((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)n((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var c=Math.floor(Math.log(i)/Math.LN2),u=Math.round(i*Math.pow(2,-c)*8388608)&8388607;n((a<<31|c+127<<23|u)>>>0,s,o)}}r.writeFloatLE=e.bind(null,qO),r.writeFloatBE=e.bind(null,$O);function t(n,i,s){var o=n(i,s),a=(o>>31)*2+1,c=o>>>23&255,u=o&8388607;return c===255?u?NaN:a*(1/0):c===0?a*1401298464324817e-60*u:a*Math.pow(2,c-150)*(u+8388608)}r.readFloatLE=t.bind(null,HO),r.readFloatBE=t.bind(null,GO)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),n=t[7]===128;function i(c,u,f){e[0]=c,u[f]=t[0],u[f+1]=t[1],u[f+2]=t[2],u[f+3]=t[3],u[f+4]=t[4],u[f+5]=t[5],u[f+6]=t[6],u[f+7]=t[7]}function s(c,u,f){e[0]=c,u[f]=t[7],u[f+1]=t[6],u[f+2]=t[5],u[f+3]=t[4],u[f+4]=t[3],u[f+5]=t[2],u[f+6]=t[1],u[f+7]=t[0]}r.writeDoubleLE=n?i:s,r.writeDoubleBE=n?s:i;function o(c,u){return t[0]=c[u],t[1]=c[u+1],t[2]=c[u+2],t[3]=c[u+3],t[4]=c[u+4],t[5]=c[u+5],t[6]=c[u+6],t[7]=c[u+7],e[0]}function a(c,u){return t[7]=c[u],t[6]=c[u+1],t[5]=c[u+2],t[4]=c[u+3],t[3]=c[u+4],t[2]=c[u+5],t[1]=c[u+6],t[0]=c[u+7],e[0]}r.readDoubleLE=n?o:a,r.readDoubleBE=n?a:o}():function(){function e(n,i,s,o,a,c){var u=o<0?1:0;if(u&&(o=-o),o===0)n(0,a,c+i),n(1/o>0?0:2147483648,a,c+s);else if(isNaN(o))n(0,a,c+i),n(2146959360,a,c+s);else if(o>17976931348623157e292)n(0,a,c+i),n((u<<31|2146435072)>>>0,a,c+s);else{var f;if(o<22250738585072014e-324)f=o/5e-324,n(f>>>0,a,c+i),n((u<<31|f/4294967296)>>>0,a,c+s);else{var h=Math.floor(Math.log(o)/Math.LN2);h===1024&&(h=1023),f=o*Math.pow(2,-h),n(f*4503599627370496>>>0,a,c+i),n((u<<31|h+1023<<20|f*1048576&1048575)>>>0,a,c+s)}}}r.writeDoubleLE=e.bind(null,qO,0,4),r.writeDoubleBE=e.bind(null,$O,4,0);function t(n,i,s,o,a){var c=n(o,a+i),u=n(o,a+s),f=(u>>31)*2+1,h=u>>>20&2047,p=4294967296*(u&1048575)+c;return h===2047?p?NaN:f*(1/0):h===0?f*5e-324*p:f*Math.pow(2,h-1075)*(p+4503599627370496)}r.readDoubleLE=t.bind(null,HO,0,4),r.readDoubleBE=t.bind(null,GO,4,0)}(),r}function qO(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function $O(r,e,t){e[t]=r>>>24,e[t+1]=r>>>16&255,e[t+2]=r>>>8&255,e[t+3]=r&255}function HO(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0}function GO(r,e){return(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}});var tu=P((exports,module)=>{"use strict";l();module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}});var ru=P(WO=>{"use strict";l();var A_=WO;A_.length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)n=e.charCodeAt(i),n<128?t+=1:n<2048?t+=2:(n&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};A_.read=function(e,t,n){var i=n-t;if(i<1)return"";for(var s=null,o=[],a=0,c;t<n;)c=e[t++],c<128?o[a++]=c:c>191&&c<224?o[a++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(c>>10),o[a++]=56320+(c&1023)):o[a++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};A_.write=function(e,t,n){for(var i=n,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=s&63|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=s&63|128);return n-i}});var nu=P((CPe,YO)=>{"use strict";l();YO.exports=$fe;function $fe(r,e,t){var n=t||8192,i=n>>>1,s=null,o=n;return function(c){if(c<1||c>i)return r(c);o+c>n&&(s=r(n),o=0);var u=e.call(s,o,o+=c);return o&7&&(o=(o|7)+1),u}}});var XO=P((kPe,QO)=>{"use strict";l();QO.exports=Cn;var gm=su();function Cn(r,e){this.lo=r>>>0,this.hi=e>>>0}var Jf=Cn.zero=new Cn(0,0);Jf.toNumber=function(){return 0};Jf.zzEncode=Jf.zzDecode=function(){return this};Jf.length=function(){return 1};var Hfe=Cn.zeroHash="\0\0\0\0\0\0\0\0";Cn.fromNumber=function(e){if(e===0)return Jf;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Cn(n,i)};Cn.from=function(e){if(typeof e=="number")return Cn.fromNumber(e);if(gm.isString(e))if(gm.Long)e=gm.Long.fromString(e);else return Cn.fromNumber(parseInt(e,10));return e.low||e.high?new Cn(e.low>>>0,e.high>>>0):Jf};Cn.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};Cn.prototype.toLong=function(e){return gm.Long?new gm.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var iu=String.prototype.charCodeAt;Cn.fromHash=function(e){return e===Hfe?Jf:new Cn((iu.call(e,0)|iu.call(e,1)<<8|iu.call(e,2)<<16|iu.call(e,3)<<24)>>>0,(iu.call(e,4)|iu.call(e,5)<<8|iu.call(e,6)<<16|iu.call(e,7)<<24)>>>0)};Cn.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Cn.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Cn.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Cn.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var su=P(T_=>{"use strict";l();var Se=T_;Se.asPromise=Xl();Se.base64=Zl();Se.EventEmitter=Jl();Se.float=eu();Se.inquire=tu();Se.utf8=ru();Se.pool=nu();Se.LongBits=XO();Se.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);Se.global=Se.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||T_;Se.emptyArray=Object.freeze?Object.freeze([]):[];Se.emptyObject=Object.freeze?Object.freeze({}):{};Se.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Se.isString=function(e){return typeof e=="string"||e instanceof String};Se.isObject=function(e){return e&&typeof e=="object"};Se.isset=Se.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};Se.Buffer=function(){try{var r=Se.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();Se._Buffer_from=null;Se._Buffer_allocUnsafe=null;Se.newBuffer=function(e){return typeof e=="number"?Se.Buffer?Se._Buffer_allocUnsafe(e):new Se.Array(e):Se.Buffer?Se._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Se.Array=typeof Uint8Array<"u"?Uint8Array:Array;Se.Long=Se.global.dcodeIO&&Se.global.dcodeIO.Long||Se.global.Long||Se.inquire("long");Se.key2Re=/^true|false|0|1$/;Se.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Se.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Se.longToHash=function(e){return e?Se.LongBits.from(e).toHash():Se.LongBits.zeroHash};Se.longFromHash=function(e,t){var n=Se.LongBits.fromHash(e);return Se.Long?Se.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function ZO(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}Se.merge=ZO;Se.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function JO(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&ZO(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Se.newError=JO;Se.ProtocolError=JO("ProtocolError");Se.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Se.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};Se.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Se._configure=function(){var r=Se.Buffer;if(!r){Se._Buffer_from=Se._Buffer_allocUnsafe=null;return}Se._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},Se._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var N_=P((LPe,nN)=>{"use strict";l();nN.exports=xt;var Vs=su(),I_,j3=Vs.LongBits,eN=Vs.base64,tN=Vs.utf8;function ym(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function C_(){}function Gfe(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function xt(){this.len=0,this.head=new ym(C_,0,0),this.tail=this.head,this.states=null}var rN=function(){return Vs.Buffer?function(){return(xt.create=function(){return new I_})()}:function(){return new xt}};xt.create=rN();xt.alloc=function(e){return new Vs.Array(e)};Vs.Array!==Array&&(xt.alloc=Vs.pool(xt.alloc,Vs.Array.prototype.subarray));xt.prototype._push=function(e,t,n){return this.tail=this.tail.next=new ym(e,t,n),this.len+=t,this};function P_(r,e,t){e[t]=r&255}function jfe(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function k_(r,e){this.len=r,this.next=void 0,this.val=e}k_.prototype=Object.create(ym.prototype);k_.prototype.fn=jfe;xt.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new k_((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};xt.prototype.int32=function(e){return e<0?this._push(O_,10,j3.fromNumber(e)):this.uint32(e)};xt.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function O_(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}xt.prototype.uint64=function(e){var t=j3.from(e);return this._push(O_,t.length(),t)};xt.prototype.int64=xt.prototype.uint64;xt.prototype.sint64=function(e){var t=j3.from(e).zzEncode();return this._push(O_,t.length(),t)};xt.prototype.bool=function(e){return this._push(P_,1,e?1:0)};function R_(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}xt.prototype.fixed32=function(e){return this._push(R_,4,e>>>0)};xt.prototype.sfixed32=xt.prototype.fixed32;xt.prototype.fixed64=function(e){var t=j3.from(e);return this._push(R_,4,t.lo)._push(R_,4,t.hi)};xt.prototype.sfixed64=xt.prototype.fixed64;xt.prototype.float=function(e){return this._push(Vs.float.writeFloatLE,4,e)};xt.prototype.double=function(e){return this._push(Vs.float.writeDoubleLE,8,e)};var Wfe=Vs.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};xt.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(P_,1,0);if(Vs.isString(e)){var n=xt.alloc(t=eN.length(e));eN.decode(e,n,0),e=n}return this.uint32(t)._push(Wfe,t,e)};xt.prototype.string=function(e){var t=tN.length(e);return t?this.uint32(t)._push(tN.write,t,e):this._push(P_,1,0)};xt.prototype.fork=function(){return this.states=new Gfe(this),this.head=this.tail=new ym(C_,0,0),this.len=0,this};xt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ym(C_,0,0),this.len=0),this};xt.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};xt.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};xt._configure=function(r){I_=r,xt.create=rN(),I_._configure()}});var oN=P((UPe,sN)=>{"use strict";l();sN.exports=ha;var iN=N_();(ha.prototype=Object.create(iN.prototype)).constructor=ha;var ou=su();function ha(){iN.call(this)}ha._configure=function(){ha.alloc=ou._Buffer_allocUnsafe,ha.writeBytesBuffer=ou.Buffer&&ou.Buffer.prototype instanceof Uint8Array&&ou.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};ha.prototype.bytes=function(e){ou.isString(e)&&(e=ou._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(ha.writeBytesBuffer,t,e),this};function Yfe(r,e,t){r.length<40?ou.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}ha.prototype.string=function(e){var t=ou.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Yfe,t,e),this};ha._configure()});var B_=P((FPe,fN)=>{"use strict";l();fN.exports=Qr;var da=su(),L_,lN=da.LongBits,Qfe=da.utf8;function So(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function Qr(r){this.buf=r,this.pos=0,this.len=r.length}var aN=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Qr(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Qr(e);throw Error("illegal buffer")},uN=function(){return da.Buffer?function(t){return(Qr.create=function(i){return da.Buffer.isBuffer(i)?new L_(i):aN(i)})(t)}:aN};Qr.create=uN();Qr.prototype._slice=da.Array.prototype.subarray||da.Array.prototype.slice;Qr.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,So(this,10);return e}}();Qr.prototype.int32=function(){return this.uint32()|0};Qr.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function D_(){var r=new lN(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw So(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw So(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}Qr.prototype.bool=function(){return this.uint32()!==0};function W3(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}Qr.prototype.fixed32=function(){if(this.pos+4>this.len)throw So(this,4);return W3(this.buf,this.pos+=4)};Qr.prototype.sfixed32=function(){if(this.pos+4>this.len)throw So(this,4);return W3(this.buf,this.pos+=4)|0};function cN(){if(this.pos+8>this.len)throw So(this,8);return new lN(W3(this.buf,this.pos+=4),W3(this.buf,this.pos+=4))}Qr.prototype.float=function(){if(this.pos+4>this.len)throw So(this,4);var e=da.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Qr.prototype.double=function(){if(this.pos+8>this.len)throw So(this,4);var e=da.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Qr.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw So(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};Qr.prototype.string=function(){var e=this.bytes();return Qfe.read(e,0,e.length)};Qr.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw So(this,e);this.pos+=e}else do if(this.pos>=this.len)throw So(this);while(this.buf[this.pos++]&128);return this};Qr.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};Qr._configure=function(r){L_=r,Qr.create=uN(),L_._configure();var e=da.Long?"toLong":"toNumber";da.merge(Qr.prototype,{int64:function(){return D_.call(this)[e](!1)},uint64:function(){return D_.call(this)[e](!0)},sint64:function(){return D_.call(this).zzDecode()[e](!1)},fixed64:function(){return cN.call(this)[e](!0)},sfixed64:function(){return cN.call(this)[e](!1)}})}});var mN=P((zPe,pN)=>{"use strict";l();pN.exports=eh;var dN=B_();(eh.prototype=Object.create(dN.prototype)).constructor=eh;var hN=su();function eh(r){dN.call(this,r)}eh._configure=function(){hN.Buffer&&(eh.prototype._slice=hN.Buffer.prototype.slice)};eh.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};eh._configure()});var yN=P((qPe,gN)=>{"use strict";l();gN.exports=wm;var U_=su();(wm.prototype=Object.create(U_.EventEmitter.prototype)).constructor=wm;function wm(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");U_.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(t)}wm.prototype.rpcCall=function r(e,t,n,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return U_.asPromise(r,o,e,t,n,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(c,u){if(c)return o.emit("error",c,e),s(c);if(u===null){o.end(!0);return}if(!(u instanceof n))try{u=n[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(f){return o.emit("error",f,e),s(f)}return o.emit("data",u,e),s(null,u)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};wm.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var bN=P(wN=>{"use strict";l();var Xfe=wN;Xfe.Service=yN()});var _N=P((jPe,EN)=>{"use strict";l();EN.exports={}});var xN=P(SN=>{"use strict";l();var Vi=SN;Vi.build="minimal";Vi.Writer=N_();Vi.BufferWriter=oN();Vi.Reader=B_();Vi.BufferReader=mN();Vi.util=su();Vi.rpc=bN();Vi.roots=_N();Vi.configure=vN;function vN(){Vi.util._configure(),Vi.Writer._configure(Vi.BufferWriter),Vi.Reader._configure(Vi.BufferReader)}vN()});var TN=P((XPe,AN)=>{"use strict";l();AN.exports=xN()});var wL=P((pDe,yL)=>{"use strict";l();yL.exports=function(){return Date.now()}});var w9=P((gDe,bL)=>{"use strict";l();var m4=wL(),y9=class{constructor(e,t,n){let i=this;this._started=m4(),this._rescheduled=0,this._scheduled=t,this._args=n,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-(m4()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,e.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);let t=m4();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=m4(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}};function cpe(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");let r;if(arguments.length>0){r=new Array(arguments.length-2);for(var e=0;e<r.length;e++)r[e]=arguments[e+2]}return new y9(arguments[0],arguments[1],r)}bL.exports=cpe});var _n=P((wDe,_L)=>{"use strict";l();var{AbortController:lpe}=globalThis,EL=w9(),Nm=class extends lpe{constructor(e){super(),this._ms=e,this._timer=EL(()=>this.abort(),e),Object.setPrototypeOf(this,Nm.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=EL(()=>this.abort(),this._ms)}};_L.exports={TimeoutController:Nm}});var IL=P((UDe,TL)=>{l();TL.exports=S9;var AL=128,mpe=127,gpe=~mpe,ype=Math.pow(2,31);function S9(r,e,t){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw S9.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;r>=ype;)e[t++]=r&255|AL,r/=128;for(;r&gpe;)e[t++]=r&255|AL,r>>>=7;return e[t]=r|0,S9.bytes=t-n+1,e}});var PL=P((FDe,CL)=>{l();CL.exports=x9;var wpe=128,RL=127;function x9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a||i>49)throw x9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&RL)<<i:(o&RL)*Math.pow(2,i),i+=7}while(o>=wpe);return x9.bytes=s-n,t}});var OL=P((zDe,kL)=>{l();var bpe=Math.pow(2,7),Epe=Math.pow(2,14),_pe=Math.pow(2,21),vpe=Math.pow(2,28),Spe=Math.pow(2,35),xpe=Math.pow(2,42),Ape=Math.pow(2,49),Tpe=Math.pow(2,56),Ipe=Math.pow(2,63);kL.exports=function(r){return r<bpe?1:r<Epe?2:r<_pe?3:r<vpe?4:r<Spe?5:r<xpe?6:r<Ape?7:r<Tpe?8:r<Ipe?9:10}});var ur=P((qDe,NL)=>{l();NL.exports={encode:IL(),decode:PL(),encodingLength:OL()}});var Q9=P((GBe,gB)=>{"use strict";l();var _0e=typeof navigator<"u"&&navigator.product==="ReactNative";function v0e(){return _0e?"http://localhost":self.location?self.location.protocol+"//"+self.location.host:""}var Km=self.URL,mB=v0e(),Y9=class{constructor(e="",t=mB){this.super=new Km(e,t),this.path=this.pathname+this.search,this.auth=this.username&&this.password?this.username+":"+this.password:null,this.query=this.search&&this.search.startsWith("?")?this.search.slice(1):null}get hash(){return this.super.hash}get host(){return this.super.host}get hostname(){return this.super.hostname}get href(){return this.super.href}get origin(){return this.super.origin}get password(){return this.super.password}get pathname(){return this.super.pathname}get port(){return this.super.port}get protocol(){return this.super.protocol}get search(){return this.super.search}get searchParams(){return this.super.searchParams}get username(){return this.super.username}set hash(e){this.super.hash=e}set host(e){this.super.host=e}set hostname(e){this.super.hostname=e}set href(e){this.super.href=e}set password(e){this.super.password=e}set pathname(e){this.super.pathname=e}set port(e){this.super.port=e}set protocol(e){this.super.protocol=e}set search(e){this.super.search=e}set username(e){this.super.username=e}static createObjectURL(e){return Km.createObjectURL(e)}static revokeObjectURL(e){Km.revokeObjectURL(e)}toJSON(){return this.super.toJSON()}toString(){return this.super.toString()}format(){return this.toString()}};function S0e(r){if(typeof r=="string")return new Km(r).toString();if(!(r instanceof Km)){let e=r.username&&r.password?`${r.username}:${r.password}@`:"",t=r.auth?r.auth+"@":"",n=r.port?":"+r.port:"",i=r.protocol?r.protocol+"//":"",s=r.host||"",o=r.hostname||"",a=r.search||(r.query?"?"+r.query:""),c=r.hash||"",u=r.pathname||"",f=r.path||u+a;return`${i}${e||t}${s||o+n}${f}${c}`}}gB.exports={URLWithLegacySupport:Y9,URLSearchParams:self.URLSearchParams,defaultBase:mB,format:S0e}});var bB=P((WBe,wB)=>{"use strict";l();var{URLWithLegacySupport:yB,format:x0e}=Q9();wB.exports=(r,e={},t={},n)=>{let i=e.protocol?e.protocol.replace(":",""):"http";i=(t[i]||n||i)+":";let s;try{s=new yB(r)}catch{s={}}let o=Object.assign({},e,{protocol:i||s.protocol,host:e.host||s.host});return new yB(r,x0e(o)).toString()}});var R4=P((QBe,EB)=>{"use strict";l();var{URLWithLegacySupport:A0e,format:T0e,URLSearchParams:I0e,defaultBase:R0e}=Q9(),C0e=bB();EB.exports={URL:A0e,URLSearchParams:I0e,format:T0e,relative:C0e,defaultBase:R0e}});var us=P((fUe,X9)=>{l();function kB(r){let e=new globalThis.AbortController;function t(){e.abort();for(let n of r)!n||!n.removeEventListener||n.removeEventListener("abort",t)}for(let n of r)if(!(!n||!n.addEventListener)){if(n.aborted){t();break}n.addEventListener("abort",t)}return e.signal}X9.exports=kB;X9.exports.anySignal=kB});var $m=P((VUe,zB)=>{l();zB.exports=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function i(s,o){t[s]=o,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(s){return t[s]!==void 0||n[s]!==void 0},remove:function(s){t[s]!==void 0&&(t[s]=void 0),n[s]!==void 0&&(n[s]=void 0)},get:function(s){var o=t[s];if(o!==void 0)return o;if((o=n[s])!==void 0)return i(s,o),o},set:function(s,o){t[s]!==void 0?t[s]=o:i(s,o)},clear:function(){t=Object.create(null),n=Object.create(null)}}}});var $B=P(($Ue,ev)=>{"use strict";l();var B0e=Object.prototype.hasOwnProperty,Ci="~";function Hm(){}Object.create&&(Hm.prototype=Object.create(null),new Hm().__proto__||(Ci=!1));function U0e(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function qB(r,e,t,n,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new U0e(t,n||r,i),o=Ci?Ci+e:e;return r._events[o]?r._events[o].fn?r._events[o]=[r._events[o],s]:r._events[o].push(s):(r._events[o]=s,r._eventsCount++),r}function M4(r,e){--r._eventsCount===0?r._events=new Hm:delete r._events[e]}function gi(){this._events=new Hm,this._eventsCount=0}gi.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)B0e.call(t,n)&&e.push(Ci?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};gi.prototype.listeners=function(e){var t=Ci?Ci+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o};gi.prototype.listenerCount=function(e){var t=Ci?Ci+e:e,n=this._events[t];return n?n.fn?1:n.length:0};gi.prototype.emit=function(e,t,n,i,s,o){var a=Ci?Ci+e:e;if(!this._events[a])return!1;var c=this._events[a],u=arguments.length,f,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,s),!0;case 6:return c.fn.call(c.context,t,n,i,s,o),!0}for(h=1,f=new Array(u-1);h<u;h++)f[h-1]=arguments[h];c.fn.apply(c.context,f)}else{var p=c.length,d;for(h=0;h<p;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),u){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,n);break;case 4:c[h].fn.call(c[h].context,t,n,i);break;default:if(!f)for(d=1,f=new Array(u-1);d<u;d++)f[d-1]=arguments[d];c[h].fn.apply(c[h].context,f)}}return!0};gi.prototype.on=function(e,t,n){return qB(this,e,t,n,!1)};gi.prototype.once=function(e,t,n){return qB(this,e,t,n,!0)};gi.prototype.removeListener=function(e,t,n,i){var s=Ci?Ci+e:e;if(!this._events[s])return this;if(!t)return M4(this,s),this;var o=this._events[s];if(o.fn)o.fn===t&&(!i||o.once)&&(!n||o.context===n)&&M4(this,s);else{for(var a=0,c=[],u=o.length;a<u;a++)(o[a].fn!==t||i&&!o[a].once||n&&o[a].context!==n)&&c.push(o[a]);c.length?this._events[s]=c.length===1?c[0]:c:M4(this,s)}return this};gi.prototype.removeAllListeners=function(e){var t;return e?(t=Ci?Ci+e:e,this._events[t]&&M4(this,t)):(this._events=new Hm,this._eventsCount=0),this};gi.prototype.off=gi.prototype.removeListener;gi.prototype.addListener=gi.prototype.on;gi.prefixed=Ci;gi.EventEmitter=gi;typeof ev<"u"&&(ev.exports=gi)});var lv=P(j4=>{"use strict";l();var ov=class extends Error{constructor(e="Request timed out"){super(e),this.name="TimeoutError"}};j4.TimeoutError=ov;var av=class extends Error{constructor(e="The operation was aborted."){super(e),this.name="AbortError"}};j4.AbortError=av;var cv=class extends Error{constructor(e){super(e.statusText),this.name="HTTPError",this.response=e}};j4.HTTPError=cv});var Jm=P(()=>{l()});var eU=P((cMe,uv)=>{"use strict";l();globalThis.fetch&&globalThis.Headers&&globalThis.Request&&globalThis.Response?uv.exports={default:globalThis.fetch,Headers:globalThis.Headers,Request:globalThis.Request,Response:globalThis.Response}:uv.exports={default:Jm().default,Headers:Jm().Headers,Request:Jm().Request,Response:Jm().Response}});var rU=P((uMe,tU)=>{"use strict";l();tU.exports=eU()});var sU=P((hMe,iU)=>{"use strict";l();var{TimeoutError:M0e,AbortError:F0e}=lv(),{Response:nU,Request:V0e,Headers:hv,default:z0e}=rU(),K0e=(r,e={})=>{let t=new XMLHttpRequest;t.open(e.method||"GET",r.toString(),!0);let{timeout:n,headers:i}=e;if(n&&n>0&&n<1/0&&(t.timeout=n),e.overrideMimeType!=null&&t.overrideMimeType(e.overrideMimeType),i)for(let[s,o]of new hv(i))t.setRequestHeader(s,o);return e.signal&&(e.signal.onabort=()=>t.abort()),e.onUploadProgress&&(t.upload.onprogress=e.onUploadProgress),t.responseType="arraybuffer",new Promise((s,o)=>{let a=c=>{switch(c.type){case"error":{s(nU.error());break}case"load":{s(new fv(t.responseURL,t.response,{status:t.status,statusText:t.statusText,headers:H0e(t.getAllResponseHeaders())}));break}case"timeout":{o(new M0e);break}case"abort":{o(new F0e);break}default:break}};t.onerror=a,t.onload=a,t.ontimeout=a,t.onabort=a,t.send(e.body)})},q0e=z0e,$0e=(r,e={})=>e.onUploadProgress!=null?K0e(r,e):q0e(r,e),H0e=r=>{let e=new hv;for(let t of r.trim().split(/[\r\n]+/)){let n=t.indexOf(": ");n>0&&e.set(t.slice(0,n),t.slice(n+1))}return e},fv=class extends nU{constructor(e,t,n){super(t,n),Object.defineProperty(this,"url",{value:e})}};iU.exports={fetch:$0e,Request:V0e,Headers:hv}});var aU=P((pMe,oU)=>{"use strict";l();async function*G0e(r,e={}){let t=r.getReader();try{for(;;){let n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&t.cancel(),t.releaseLock()}}oU.exports=G0e});var lU=P((gMe,cU)=>{"use strict";l();var j0e=async r=>{let e=[];for await(let t of r)e.push(t);return e};cU.exports=j0e});var Vp=P((wMe,mU)=>{"use strict";l();var{fetch:W0e,Request:Y0e,Headers:Q0e}=sU(),{TimeoutError:dv,HTTPError:dU}=lv(),uU=u_().bind({ignoreUndefined:!0}),{URL:fU,URLSearchParams:hU}=R4(),X0e=us(),Z0e=aU(),{isBrowser:J0e,isWebWorker:e1e}=K3(),t1e=lU(),r1e=(r,e,t)=>{if(e===void 0)return r;let n=Date.now(),i=()=>Date.now()-n>=e;return new Promise((s,o)=>{let a=setTimeout(()=>{i()&&(o(new dv),t.abort())},e),c=u=>h=>{if(clearTimeout(a),i()){o(new dv);return}u(h)};r.then(c(s),c(o))})},n1e={throwHttpErrors:!0,credentials:"same-origin"},yi=class{constructor(e={}){this.opts=uU(n1e,e)}async fetch(e,t={}){let n=uU(this.opts,t),i=new Q0e(n.headers);if(typeof e!="string"&&!(e instanceof fU||e instanceof Y0e))throw new TypeError("`resource` must be a string, URL, or Request");let s=new fU(e.toString(),n.base),{searchParams:o,transformSearchParams:a,json:c}=n;o&&(typeof a=="function"?s.search=a(new hU(n.searchParams)):s.search=new hU(n.searchParams)),c&&(n.body=JSON.stringify(n.json),i.set("content-type","application/json"));let u=new AbortController,f=X0e([u.signal,n.signal]);globalThis.ReadableStream!=null&&n.body instanceof globalThis.ReadableStream&&(J0e||e1e)&&(n.body=new Blob(await t1e(Z0e(n.body))));let h=await r1e(W0e(s.toString(),{...n,signal:f,timeout:void 0,headers:i,duplex:"half"}),n.timeout,u);if(!h.ok&&n.throwHttpErrors)throw n.handleError&&await n.handleError(h),new dU(h);return h.iterator=async function*(){yield*pU(h.body)},h.ndjson=async function*(){for await(let p of i1e(h.iterator()))t.transform?yield t.transform(p):yield p},h}post(e,t={}){return this.fetch(e,{...t,method:"POST"})}get(e,t={}){return this.fetch(e,{...t,method:"GET"})}put(e,t={}){return this.fetch(e,{...t,method:"PUT"})}delete(e,t={}){return this.fetch(e,{...t,method:"DELETE"})}options(e,t={}){return this.fetch(e,{...t,method:"OPTIONS"})}},i1e=async function*(r){let e=new TextDecoder,t="";for await(let n of r){t+=e.decode(n,{stream:!0});let i=t.split(/\r?\n/);for(let s=0;s<i.length-1;s++){let o=i[s].trim();o.length>0&&(yield JSON.parse(o))}t=i[i.length-1]}t+=e.decode(),t=t.trim(),t.length!==0&&(yield JSON.parse(t))},pU=r=>{if(s1e(r))return r;if(a1e(r)){let e=r[Symbol.asyncIterator]();return{[Symbol.asyncIterator](){return{next:e.next.bind(e),return(t){return r.destroy(),typeof e.return=="function"?e.return():Promise.resolve({done:!0,value:t})}}}}}if(o1e(r)){let e=r.getReader();return async function*(){try{for(;;){let{done:t,value:n}=await e.read();if(t)return;n&&(yield n)}}finally{e.releaseLock()}}()}throw new TypeError("Body can't be converted to AsyncIterable")},s1e=r=>typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function",o1e=r=>r&&typeof r.getReader=="function",a1e=r=>Object.prototype.hasOwnProperty.call(r,"readable")&&Object.prototype.hasOwnProperty.call(r,"writable");yi.HTTPError=dU;yi.TimeoutError=dv;yi.streamToAsyncIterator=pU;yi.post=(r,e)=>new yi(e).post(r,e);yi.get=(r,e)=>new yi(e).get(r,e);yi.put=(r,e)=>new yi(e).put(r,e);yi.delete=(r,e)=>new yi(e).delete(r,e);yi.options=(r,e)=>new yi(e).options(r,e);mU.exports=yi});var PU=P((LFe,bv)=>{l();var DFe=function(){typeof bv<"u"&&(bv.exports=g);var r=86400,e=3200,t=146097*e/400,n=r*t,i=1e3*n,s=864e13,o=4294967296,a=1e6,c="000000000",u=Math.trunc||function(R){var O=R-R%1;return O==0&&(R<0||R===0&&1/R!=1/0)?-0:O},f=g.prototype,h=(g.fromDate=function(R){return new g(+R)},g.fromInt64BE=v(0,1,2,3,0,4),g.fromInt64LE=v(3,2,1,0,4,0),g.fromString=function($){var O,V=new g,$=($+="").replace(/^\s*[+\-]?\d+/,function(Q){var Q=+Q,pe=1970+(Q-1970)%400;return V.year=Q-pe,pe}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(Y,Q,pe){return Q<0&&(pe*=-1),O=6e4*(60*+Q+ +pe),""}).replace(/\.\d+$/,function(Y){return V.nano=+(Y+c).substr(1,9),""}).split(/\D+/);if(1<$.length?$[1]--:$[1]=0,V.time=O=Date.UTC.apply(Date,$)-(O||0),isNaN(O))throw new TypeError("Invalid Date");return y(V)},g.fromTimeT=function(R){return b(R,0)},f.year=0,f.time=0,f.nano=0,f.addNano=function(R){return this.nano+=+R||0,this},f.getNano=function(){var R=y(this);return(R.time%1e3*a+ +R.nano+1e9)%1e9},f.getTimeT=function(){var O=y(this),R=Math.floor(O.time/1e3),O=O.year;return O&&(R+=O*t*r/e),R},f.getYear=function(){return this.toDate().getUTCFullYear()+this.year},f.toDate=function(){return w(y(this).time)},f.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},f.toString=function(R){var O=this,V=O.toDate(),$={H:function(){return x(V.getUTCHours())},L:function(){return A(V.getUTCMilliseconds(),3)},M:function(){return x(V.getUTCMinutes())},N:function(){return A(O.getNano(),9)},S:function(){return x(V.getUTCSeconds())},Y:function(){var Y=O.getYear();return 999999<Y?"+"+Y:9999<Y?"+"+A(Y,6):0<=Y?A(Y,4):-999999<=Y?"-"+A(-Y,6):Y},a:function(){return d[V.getUTCDay()]},b:function(){return p[V.getUTCMonth()]},d:function(){return x(V.getUTCDate())},e:function(){return function(Y){return(9<Y?"":" ")+(0|Y)}(V.getUTCDate())},m:function(){return x(V.getUTCMonth()+1)}};return function Y(Q){return Q.replace(/%./g,function(pe){var he=pe[1],re=m[he],he=$[he];return re?Y(re):he?he():pe})}(R||h)},f.writeInt64BE=_(0,1,2,3,0,4),f.writeInt64LE=_(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),p=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],m={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return g;function g(R,O,V){var $=this;if(!($ instanceof g))return new g(R,O,V);$.time=+R||0,$.nano=+O||0,$.year=+V||0,y($)}function y(R){var O,V,$,Y=R.year,Q=R.time,pe=R.nano,re=((pe<0||a<=pe)&&(pe-=(V=Math.floor(pe/a))*a,Q+=V,V=1),Y%e);return(Q<-s||s<Q||re)&&((O=u(Q/i))&&(Y+=O*e,Q-=O*i),($=w(Q)).setUTCFullYear(re+$.getUTCFullYear()),$=(Q=+$)+(O=u((Y-=re)/e))*i,O&&-s<=$&&$<=s&&(Y-=O*e,Q=$),V=1),V&&(R.year=Y,R.time=Q,R.nano=pe),R}function w(R){var O=new Date(0);return O.setTime(R),O}function b(Y,$){Y=+Y||0;var V=u(($=($|0)*o)/n)+u(Y/n),$=$%n+Y%n,Y=u($/n);return Y&&(V+=Y,$-=Y*n),new g(1e3*$,0,V*e)}function _(R,O,V,$,Y,Q){return function(re,he){var ve=y(this);re=re||new Array(8),I(re,he|=0);var St=Math.floor(ve.time/1e3),ve=ve.year*(t*r/e),H=u(ve/o)+u(St/o),ve=ve%o+St%o,St=Math.floor(ve/o);return St&&(H+=St,ve-=St*o),pe(re,he+Y,H),pe(re,he+Q,ve),re};function pe(re,he,H){re[he+R]=H>>24&255,re[he+O]=H>>16&255,re[he+V]=H>>8&255,re[he+$]=255&H}}function v(R,O,V,$,Y,Q){return function(re,he){I(re,he|=0);var H=pe(re,he+Y);return b(pe(re,he+Q),H)};function pe(re,he){return 16777216*re[he+R]+(re[he+O]<<16|re[he+V]<<8|re[he+$])}}function I(R,O){if(R=R&&R.length,R==null)throw new TypeError("Invalid Buffer");if(R<O+8)throw new RangeError("Out of range")}function x(R){return(9<R?"":"0")+(0|R)}function A(R,O){return(c+(0|R)).substr(-O)}}()});var Je=P((KFe,OU)=>{l();OU.exports={options:{usePureJavaScript:!1}}});var LU=P(($Fe,DU)=>{l();var Ev={};DU.exports=Ev;var NU={};Ev.encode=function(r,e,t){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(t!==void 0&&typeof t!="number")throw new TypeError('"maxline" must be a number.');var n="";if(!(r instanceof Uint8Array))n=_1e(r,e);else{var i=0,s=e.length,o=e.charAt(0),a=[0];for(i=0;i<r.length;++i){for(var c=0,u=r[i];c<a.length;++c)u+=a[c]<<8,a[c]=u%s,u=u/s|0;for(;u>0;)a.push(u%s),u=u/s|0}for(i=0;r[i]===0&&i<r.length-1;++i)n+=o;for(i=a.length-1;i>=0;--i)n+=e[a[i]]}if(t){var f=new RegExp(".{1,"+t+"}","g");n=n.match(f).join(`\r
`)}return n};Ev.decode=function(r,e){if(typeof r!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var t=NU[e];if(!t){t=NU[e]=[];for(var n=0;n<e.length;++n)t[e.charCodeAt(n)]=n}r=r.replace(/\s/g,"");for(var i=e.length,s=e.charAt(0),o=[0],n=0;n<r.length;n++){var a=t[r.charCodeAt(n)];if(a===void 0)return;for(var c=0,u=a;c<o.length;++c)u+=o[c]*i,o[c]=u&255,u>>=8;for(;u>0;)o.push(u&255),u>>=8}for(var f=0;r[f]===s&&f<r.length-1;++f)o.push(0);return typeof Buffer<"u"?Buffer.from(o.reverse()):new Uint8Array(o.reverse())};function _1e(r,e){var t=0,n=e.length,i=e.charAt(0),s=[0];for(t=0;t<r.length();++t){for(var o=0,a=r.at(t);o<s.length;++o)a+=s[o]<<8,s[o]=a%n,a=a/n|0;for(;a>0;)s.push(a%n),a=a/n|0}var c="";for(t=0;r.at(t)===0&&t<r.length()-1;++t)c+=i;for(t=s.length-1;t>=0;--t)c+=e[s[t]];return c}});var hr=P((GFe,FU)=>{l();var BU=Je(),UU=LU(),B=FU.exports=BU.util=BU.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){B.nextTick=process.nextTick,typeof setImmediate=="function"?B.setImmediate=setImmediate:B.setImmediate=B.nextTick;return}if(typeof setImmediate=="function"){B.setImmediate=function(){return setImmediate.apply(void 0,arguments)},B.nextTick=function(a){return setImmediate(a)};return}if(B.setImmediate=function(a){setTimeout(a,0)},typeof window<"u"&&typeof window.postMessage=="function"){let a=function(c){if(c.source===window&&c.data===r){c.stopPropagation();var u=e.slice();e.length=0,u.forEach(function(f){f()})}};var o=a,r="forge.setImmediate",e=[];B.setImmediate=function(c){e.push(c),e.length===1&&window.postMessage(r,"*")},window.addEventListener("message",a,!0)}if(typeof MutationObserver<"u"){var t=Date.now(),n=!0,i=document.createElement("div"),e=[];new MutationObserver(function(){var c=e.slice();e.length=0,c.forEach(function(u){u()})}).observe(i,{attributes:!0});var s=B.setImmediate;B.setImmediate=function(c){Date.now()-t>15?(t=Date.now(),s(c)):(e.push(c),e.length===1&&i.setAttribute("a",n=!n))}}B.nextTick=B.setImmediate})();B.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;B.globalScope=function(){return B.isNodejs?globalThis:typeof self>"u"?window:self}();B.isArray=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};B.isArrayBuffer=function(r){return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer};B.isArrayBufferView=function(r){return r&&B.isArrayBuffer(r.buffer)&&r.byteLength!==void 0};function r2(r){if(!(r===8||r===16||r===24||r===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+r)}B.ByteBuffer=_v;function _v(r){if(this.data="",this.read=0,typeof r=="string")this.data=r;else if(B.isArrayBuffer(r)||B.isArrayBufferView(r))if(typeof Buffer<"u"&&r instanceof Buffer)this.data=r.toString("binary");else{var e=new Uint8Array(r);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var t=0;t<e.length;++t)this.putByte(e[t])}}else(r instanceof _v||typeof r=="object"&&typeof r.data=="string"&&typeof r.read=="number")&&(this.data=r.data,this.read=r.read);this._constructedStringLength=0}B.ByteStringBuffer=_v;var v1e=4096;B.ByteStringBuffer.prototype._optimizeConstructedString=function(r){this._constructedStringLength+=r,this._constructedStringLength>v1e&&(this.data.substr(0,1),this._constructedStringLength=0)};B.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};B.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};B.ByteStringBuffer.prototype.putByte=function(r){return this.putBytes(String.fromCharCode(r))};B.ByteStringBuffer.prototype.fillWithByte=function(r,e){r=String.fromCharCode(r);for(var t=this.data;e>0;)e&1&&(t+=r),e>>>=1,e>0&&(r+=r);return this.data=t,this._optimizeConstructedString(e),this};B.ByteStringBuffer.prototype.putBytes=function(r){return this.data+=r,this._optimizeConstructedString(r.length),this};B.ByteStringBuffer.prototype.putString=function(r){return this.putBytes(B.encodeUtf8(r))};B.ByteStringBuffer.prototype.putInt16=function(r){return this.putBytes(String.fromCharCode(r>>8&255)+String.fromCharCode(r&255))};B.ByteStringBuffer.prototype.putInt24=function(r){return this.putBytes(String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r&255))};B.ByteStringBuffer.prototype.putInt32=function(r){return this.putBytes(String.fromCharCode(r>>24&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r&255))};B.ByteStringBuffer.prototype.putInt16Le=function(r){return this.putBytes(String.fromCharCode(r&255)+String.fromCharCode(r>>8&255))};B.ByteStringBuffer.prototype.putInt24Le=function(r){return this.putBytes(String.fromCharCode(r&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r>>16&255))};B.ByteStringBuffer.prototype.putInt32Le=function(r){return this.putBytes(String.fromCharCode(r&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>24&255))};B.ByteStringBuffer.prototype.putInt=function(r,e){r2(e);var t="";do e-=8,t+=String.fromCharCode(r>>e&255);while(e>0);return this.putBytes(t)};B.ByteStringBuffer.prototype.putSignedInt=function(r,e){return r<0&&(r+=2<<e-1),this.putInt(r,e)};B.ByteStringBuffer.prototype.putBuffer=function(r){return this.putBytes(r.getBytes())};B.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};B.ByteStringBuffer.prototype.getInt16=function(){var r=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,r};B.ByteStringBuffer.prototype.getInt24=function(){var r=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,r};B.ByteStringBuffer.prototype.getInt32=function(){var r=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,r};B.ByteStringBuffer.prototype.getInt16Le=function(){var r=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,r};B.ByteStringBuffer.prototype.getInt24Le=function(){var r=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,r};B.ByteStringBuffer.prototype.getInt32Le=function(){var r=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,r};B.ByteStringBuffer.prototype.getInt=function(r){r2(r);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),r-=8;while(r>0);return e};B.ByteStringBuffer.prototype.getSignedInt=function(r){var e=this.getInt(r),t=2<<r-2;return e>=t&&(e-=t<<1),e};B.ByteStringBuffer.prototype.getBytes=function(r){var e;return r?(r=Math.min(this.length(),r),e=this.data.slice(this.read,this.read+r),this.read+=r):r===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};B.ByteStringBuffer.prototype.bytes=function(r){return typeof r>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+r)};B.ByteStringBuffer.prototype.at=function(r){return this.data.charCodeAt(this.read+r)};B.ByteStringBuffer.prototype.setAt=function(r,e){return this.data=this.data.substr(0,this.read+r)+String.fromCharCode(e)+this.data.substr(this.read+r+1),this};B.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};B.ByteStringBuffer.prototype.copy=function(){var r=B.createBuffer(this.data);return r.read=this.read,r};B.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};B.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};B.ByteStringBuffer.prototype.truncate=function(r){var e=Math.max(0,this.length()-r);return this.data=this.data.substr(this.read,e),this.read=0,this};B.ByteStringBuffer.prototype.toHex=function(){for(var r="",e=this.read;e<this.data.length;++e){var t=this.data.charCodeAt(e);t<16&&(r+="0"),r+=t.toString(16)}return r};B.ByteStringBuffer.prototype.toString=function(){return B.decodeUtf8(this.bytes())};function S1e(r,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var t=B.isArrayBuffer(r),n=B.isArrayBufferView(r);if(t||n){t?this.data=new DataView(r):this.data=new DataView(r.buffer,r.byteOffset,r.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,r!=null&&this.putBytes(r),"writeOffset"in e&&(this.write=e.writeOffset)}B.DataBuffer=S1e;B.DataBuffer.prototype.length=function(){return this.write-this.read};B.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};B.DataBuffer.prototype.accommodate=function(r,e){if(this.length()>=r)return this;e=Math.max(e||this.growSize,r);var t=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+e);return n.set(t),this.data=new DataView(n.buffer),this};B.DataBuffer.prototype.putByte=function(r){return this.accommodate(1),this.data.setUint8(this.write++,r),this};B.DataBuffer.prototype.fillWithByte=function(r,e){this.accommodate(e);for(var t=0;t<e;++t)this.data.setUint8(r);return this};B.DataBuffer.prototype.putBytes=function(r,e){if(B.isArrayBufferView(r)){var t=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),n=t.byteLength-t.byteOffset;this.accommodate(n);var i=new Uint8Array(this.data.buffer,this.write);return i.set(t),this.write+=n,this}if(B.isArrayBuffer(r)){var t=new Uint8Array(r);this.accommodate(t.byteLength);var i=new Uint8Array(this.data.buffer);return i.set(t,this.write),this.write+=t.byteLength,this}if(r instanceof B.DataBuffer||typeof r=="object"&&typeof r.read=="number"&&typeof r.write=="number"&&B.isArrayBufferView(r.data)){var t=new Uint8Array(r.data.byteLength,r.read,r.length());this.accommodate(t.byteLength);var i=new Uint8Array(r.data.byteLength,this.write);return i.set(t),this.write+=t.byteLength,this}if(r instanceof B.ByteStringBuffer&&(r=r.data,e="binary"),e=e||"binary",typeof r=="string"){var s;if(e==="hex")return this.accommodate(Math.ceil(r.length/2)),s=new Uint8Array(this.data.buffer,this.write),this.write+=B.binary.hex.decode(r,s,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(r.length/4)*3),s=new Uint8Array(this.data.buffer,this.write),this.write+=B.binary.base64.decode(r,s,this.write),this;if(e==="utf8"&&(r=B.encodeUtf8(r),e="binary"),e==="binary"||e==="raw")return this.accommodate(r.length),s=new Uint8Array(this.data.buffer,this.write),this.write+=B.binary.raw.decode(s),this;if(e==="utf16")return this.accommodate(r.length*2),s=new Uint16Array(this.data.buffer,this.write),this.write+=B.text.utf16.encode(s),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+r)};B.DataBuffer.prototype.putBuffer=function(r){return this.putBytes(r),r.clear(),this};B.DataBuffer.prototype.putString=function(r){return this.putBytes(r,"utf16")};B.DataBuffer.prototype.putInt16=function(r){return this.accommodate(2),this.data.setInt16(this.write,r),this.write+=2,this};B.DataBuffer.prototype.putInt24=function(r){return this.accommodate(3),this.data.setInt16(this.write,r>>8&65535),this.data.setInt8(this.write,r>>16&255),this.write+=3,this};B.DataBuffer.prototype.putInt32=function(r){return this.accommodate(4),this.data.setInt32(this.write,r),this.write+=4,this};B.DataBuffer.prototype.putInt16Le=function(r){return this.accommodate(2),this.data.setInt16(this.write,r,!0),this.write+=2,this};B.DataBuffer.prototype.putInt24Le=function(r){return this.accommodate(3),this.data.setInt8(this.write,r>>16&255),this.data.setInt16(this.write,r>>8&65535,!0),this.write+=3,this};B.DataBuffer.prototype.putInt32Le=function(r){return this.accommodate(4),this.data.setInt32(this.write,r,!0),this.write+=4,this};B.DataBuffer.prototype.putInt=function(r,e){r2(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,r>>e&255);while(e>0);return this};B.DataBuffer.prototype.putSignedInt=function(r,e){return r2(e),this.accommodate(e/8),r<0&&(r+=2<<e-1),this.putInt(r,e)};B.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};B.DataBuffer.prototype.getInt16=function(){var r=this.data.getInt16(this.read);return this.read+=2,r};B.DataBuffer.prototype.getInt24=function(){var r=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,r};B.DataBuffer.prototype.getInt32=function(){var r=this.data.getInt32(this.read);return this.read+=4,r};B.DataBuffer.prototype.getInt16Le=function(){var r=this.data.getInt16(this.read,!0);return this.read+=2,r};B.DataBuffer.prototype.getInt24Le=function(){var r=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,r};B.DataBuffer.prototype.getInt32Le=function(){var r=this.data.getInt32(this.read,!0);return this.read+=4,r};B.DataBuffer.prototype.getInt=function(r){r2(r);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),r-=8;while(r>0);return e};B.DataBuffer.prototype.getSignedInt=function(r){var e=this.getInt(r),t=2<<r-2;return e>=t&&(e-=t<<1),e};B.DataBuffer.prototype.getBytes=function(r){var e;return r?(r=Math.min(this.length(),r),e=this.data.slice(this.read,this.read+r),this.read+=r):r===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};B.DataBuffer.prototype.bytes=function(r){return typeof r>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+r)};B.DataBuffer.prototype.at=function(r){return this.data.getUint8(this.read+r)};B.DataBuffer.prototype.setAt=function(r,e){return this.data.setUint8(r,e),this};B.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};B.DataBuffer.prototype.copy=function(){return new B.DataBuffer(this)};B.DataBuffer.prototype.compact=function(){if(this.read>0){var r=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(r.byteLength);e.set(r),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};B.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};B.DataBuffer.prototype.truncate=function(r){return this.write=Math.max(0,this.length()-r),this.read=Math.min(this.read,this.write),this};B.DataBuffer.prototype.toHex=function(){for(var r="",e=this.read;e<this.data.byteLength;++e){var t=this.data.getUint8(e);t<16&&(r+="0"),r+=t.toString(16)}return r};B.DataBuffer.prototype.toString=function(r){var e=new Uint8Array(this.data,this.read,this.length());if(r=r||"utf8",r==="binary"||r==="raw")return B.binary.raw.encode(e);if(r==="hex")return B.binary.hex.encode(e);if(r==="base64")return B.binary.base64.encode(e);if(r==="utf8")return B.text.utf8.decode(e);if(r==="utf16")return B.text.utf16.decode(e);throw new Error("Invalid encoding: "+r)};B.createBuffer=function(r,e){return e=e||"raw",r!==void 0&&e==="utf8"&&(r=B.encodeUtf8(r)),new B.ByteBuffer(r)};B.fillString=function(r,e){for(var t="";e>0;)e&1&&(t+=r),e>>>=1,e>0&&(r+=r);return t};B.xorBytes=function(r,e,t){for(var n="",i="",s="",o=0,a=0;t>0;--t,++o)i=r.charCodeAt(o)^e.charCodeAt(o),a>=10&&(n+=s,s="",a=0),s+=String.fromCharCode(i),++a;return n+=s,n};B.hexToBytes=function(r){var e="",t=0;for(r.length&!0&&(t=1,e+=String.fromCharCode(parseInt(r[0],16)));t<r.length;t+=2)e+=String.fromCharCode(parseInt(r.substr(t,2),16));return e};B.bytesToHex=function(r){return B.createBuffer(r).toHex()};B.int32ToBytes=function(r){return String.fromCharCode(r>>24&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r&255)};var gu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",yu=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],MU="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";B.encode64=function(r,e){for(var t="",n="",i,s,o,a=0;a<r.length;)i=r.charCodeAt(a++),s=r.charCodeAt(a++),o=r.charCodeAt(a++),t+=gu.charAt(i>>2),t+=gu.charAt((i&3)<<4|s>>4),isNaN(s)?t+="==":(t+=gu.charAt((s&15)<<2|o>>6),t+=isNaN(o)?"=":gu.charAt(o&63)),e&&t.length>e&&(n+=t.substr(0,e)+`\r
`,t=t.substr(e));return n+=t,n};B.decode64=function(r){r=r.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",t,n,i,s,o=0;o<r.length;)t=yu[r.charCodeAt(o++)-43],n=yu[r.charCodeAt(o++)-43],i=yu[r.charCodeAt(o++)-43],s=yu[r.charCodeAt(o++)-43],e+=String.fromCharCode(t<<2|n>>4),i!==64&&(e+=String.fromCharCode((n&15)<<4|i>>2),s!==64&&(e+=String.fromCharCode((i&3)<<6|s)));return e};B.encodeUtf8=function(r){return unescape(encodeURIComponent(r))};B.decodeUtf8=function(r){return decodeURIComponent(escape(r))};B.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:UU.encode,decode:UU.decode}};B.binary.raw.encode=function(r){return String.fromCharCode.apply(null,r)};B.binary.raw.decode=function(r,e,t){var n=e;n||(n=new Uint8Array(r.length)),t=t||0;for(var i=t,s=0;s<r.length;++s)n[i++]=r.charCodeAt(s);return e?i-t:n};B.binary.hex.encode=B.bytesToHex;B.binary.hex.decode=function(r,e,t){var n=e;n||(n=new Uint8Array(Math.ceil(r.length/2))),t=t||0;var i=0,s=t;for(r.length&1&&(i=1,n[s++]=parseInt(r[0],16));i<r.length;i+=2)n[s++]=parseInt(r.substr(i,2),16);return e?s-t:n};B.binary.base64.encode=function(r,e){for(var t="",n="",i,s,o,a=0;a<r.byteLength;)i=r[a++],s=r[a++],o=r[a++],t+=gu.charAt(i>>2),t+=gu.charAt((i&3)<<4|s>>4),isNaN(s)?t+="==":(t+=gu.charAt((s&15)<<2|o>>6),t+=isNaN(o)?"=":gu.charAt(o&63)),e&&t.length>e&&(n+=t.substr(0,e)+`\r
`,t=t.substr(e));return n+=t,n};B.binary.base64.decode=function(r,e,t){var n=e;n||(n=new Uint8Array(Math.ceil(r.length/4)*3)),r=r.replace(/[^A-Za-z0-9\+\/\=]/g,""),t=t||0;for(var i,s,o,a,c=0,u=t;c<r.length;)i=yu[r.charCodeAt(c++)-43],s=yu[r.charCodeAt(c++)-43],o=yu[r.charCodeAt(c++)-43],a=yu[r.charCodeAt(c++)-43],n[u++]=i<<2|s>>4,o!==64&&(n[u++]=(s&15)<<4|o>>2,a!==64&&(n[u++]=(o&3)<<6|a));return e?u-t:n.subarray(0,u)};B.binary.base58.encode=function(r,e){return B.binary.baseN.encode(r,MU,e)};B.binary.base58.decode=function(r,e){return B.binary.baseN.decode(r,MU,e)};B.text={utf8:{},utf16:{}};B.text.utf8.encode=function(r,e,t){r=B.encodeUtf8(r);var n=e;n||(n=new Uint8Array(r.length)),t=t||0;for(var i=t,s=0;s<r.length;++s)n[i++]=r.charCodeAt(s);return e?i-t:n};B.text.utf8.decode=function(r){return B.decodeUtf8(String.fromCharCode.apply(null,r))};B.text.utf16.encode=function(r,e,t){var n=e;n||(n=new Uint8Array(r.length*2));var i=new Uint16Array(n.buffer);t=t||0;for(var s=t,o=t,a=0;a<r.length;++a)i[o++]=r.charCodeAt(a),s+=2;return e?s-t:n};B.text.utf16.decode=function(r){return String.fromCharCode.apply(null,new Uint16Array(r.buffer))};B.deflate=function(r,e,t){if(e=B.decode64(r.deflate(B.encode64(e)).rval),t){var n=2,i=e.charCodeAt(1);i&32&&(n=6),e=e.substring(n,e.length-4)}return e};B.inflate=function(r,e,t){var n=r.inflate(B.encode64(e)).rval;return n===null?null:B.decode64(n)};var vv=function(r,e,t){if(!r)throw new Error("WebStorage not available.");var n;if(t===null?n=r.removeItem(e):(t=B.encode64(JSON.stringify(t)),n=r.setItem(e,t)),typeof n<"u"&&n.rval!==!0){var i=new Error(n.error.message);throw i.id=n.error.id,i.name=n.error.name,i}},Sv=function(r,e){if(!r)throw new Error("WebStorage not available.");var t=r.getItem(e);if(r.init)if(t.rval===null){if(t.error){var n=new Error(t.error.message);throw n.id=t.error.id,n.name=t.error.name,n}t=null}else t=t.rval;return t!==null&&(t=JSON.parse(B.decode64(t))),t},x1e=function(r,e,t,n){var i=Sv(r,e);i===null&&(i={}),i[t]=n,vv(r,e,i)},A1e=function(r,e,t){var n=Sv(r,e);return n!==null&&(n=t in n?n[t]:null),n},T1e=function(r,e,t){var n=Sv(r,e);if(n!==null&&t in n){delete n[t];var i=!0;for(var s in n){i=!1;break}i&&(n=null),vv(r,e,n)}},I1e=function(r,e){vv(r,e,null)},J4=function(r,e,t){var n=null;typeof t>"u"&&(t=["web","flash"]);var i,s=!1,o=null;for(var a in t){i=t[a];try{if(i==="flash"||i==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");n=r.apply(this,e),s=i==="flash"}(i==="web"||i==="both")&&(e[0]=localStorage,n=r.apply(this,e),s=!0)}catch(c){o=c}if(s)break}if(!s)throw o;return n};B.setItem=function(r,e,t,n,i){J4(x1e,arguments,i)};B.getItem=function(r,e,t,n){return J4(A1e,arguments,n)};B.removeItem=function(r,e,t,n){J4(T1e,arguments,n)};B.clearItems=function(r,e,t){J4(I1e,arguments,t)};B.isEmpty=function(r){for(var e in r)if(r.hasOwnProperty(e))return!1;return!0};B.format=function(r){for(var e=/%./g,t,n,i=0,s=[],o=0;t=e.exec(r);){n=r.substring(o,e.lastIndex-2),n.length>0&&s.push(n),o=e.lastIndex;var a=t[0][1];switch(a){case"s":case"o":i<arguments.length?s.push(arguments[i+++1]):s.push("<?>");break;case"%":s.push("%");break;default:s.push("<%"+a+"?>")}}return s.push(r.substring(o)),s.join("")};B.formatNumber=function(r,e,t,n){var i=r,s=isNaN(e=Math.abs(e))?2:e,o=t===void 0?",":t,a=n===void 0?".":n,c=i<0?"-":"",u=parseInt(i=Math.abs(+i||0).toFixed(s),10)+"",f=u.length>3?u.length%3:0;return c+(f?u.substr(0,f)+a:"")+u.substr(f).replace(/(\d{3})(?=\d)/g,"$1"+a)+(s?o+Math.abs(i-u).toFixed(s).slice(2):"")};B.formatSize=function(r){return r>=1073741824?r=B.formatNumber(r/1073741824,2,".","")+" GiB":r>=1048576?r=B.formatNumber(r/1048576,2,".","")+" MiB":r>=1024?r=B.formatNumber(r/1024,0)+" KiB":r=B.formatNumber(r,0)+" bytes",r};B.bytesFromIP=function(r){return r.indexOf(".")!==-1?B.bytesFromIPv4(r):r.indexOf(":")!==-1?B.bytesFromIPv6(r):null};B.bytesFromIPv4=function(r){if(r=r.split("."),r.length!==4)return null;for(var e=B.createBuffer(),t=0;t<r.length;++t){var n=parseInt(r[t],10);if(isNaN(n))return null;e.putByte(n)}return e.getBytes()};B.bytesFromIPv6=function(r){var e=0;r=r.split(":").filter(function(o){return o.length===0&&++e,!0});for(var t=(8-r.length+e)*2,n=B.createBuffer(),i=0;i<8;++i){if(!r[i]||r[i].length===0){n.fillWithByte(0,t),t=0;continue}var s=B.hexToBytes(r[i]);s.length<2&&n.putByte(0),n.putBytes(s)}return n.getBytes()};B.bytesToIP=function(r){return r.length===4?B.bytesToIPv4(r):r.length===16?B.bytesToIPv6(r):null};B.bytesToIPv4=function(r){if(r.length!==4)return null;for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e.join(".")};B.bytesToIPv6=function(r){if(r.length!==16)return null;for(var e=[],t=[],n=0,i=0;i<r.length;i+=2){for(var s=B.bytesToHex(r[i]+r[i+1]);s[0]==="0"&&s!=="0";)s=s.substr(1);if(s==="0"){var o=t[t.length-1],a=e.length;!o||a!==o.end+1?t.push({start:a,end:a}):(o.end=a,o.end-o.start>t[n].end-t[n].start&&(n=t.length-1))}e.push(s)}if(t.length>0){var c=t[n];c.end-c.start>0&&(e.splice(c.start,c.end-c.start+1,""),c.start===0&&e.unshift(""),c.end===7&&e.push(""))}return e.join(":")};B.estimateCores=function(r,e){if(typeof r=="function"&&(e=r,r={}),r=r||{},"cores"in B&&!r.update)return e(null,B.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return B.cores=navigator.hardwareConcurrency,e(null,B.cores);if(typeof Worker>"u")return B.cores=1,e(null,B.cores);if(typeof Blob>"u")return B.cores=2,e(null,B.cores);var t=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(o){for(var a=Date.now(),c=a+4;Date.now()<c;);self.postMessage({st:a,et:c})})}.toString(),")()"],{type:"application/javascript"}));n([],5,16);function n(o,a,c){if(a===0){var u=Math.floor(o.reduce(function(f,h){return f+h},0)/o.length);return B.cores=Math.max(1,u),URL.revokeObjectURL(t),e(null,B.cores)}i(c,function(f,h){o.push(s(c,h)),n(o,a-1,c)})}function i(o,a){for(var c=[],u=[],f=0;f<o;++f){var h=new Worker(t);h.addEventListener("message",function(p){if(u.push(p.data),u.length===o){for(var d=0;d<o;++d)c[d].terminate();a(null,u)}}),c.push(h)}for(var f=0;f<o;++f)c[f].postMessage(f)}function s(o,a){for(var c=[],u=0;u<o;++u)for(var f=a[u],h=c[u]=[],p=0;p<o;++p)if(u!==p){var d=a[p];(f.st>d.st&&f.st<d.et||d.st>f.st&&d.st<f.et)&&h.push(p)}return c.reduce(function(m,g){return Math.max(m,g.length)},0)}}});var qp=P((WFe,VU)=>{l();var n2=Je();n2.pki=n2.pki||{};var xv=VU.exports=n2.pki.oids=n2.oids=n2.oids||{};function te(r,e){xv[r]=e,xv[e]=r}function Wt(r,e){xv[r]=e}te("1.2.840.113549.1.1.1","rsaEncryption");te("1.2.840.113549.1.1.4","md5WithRSAEncryption");te("1.2.840.113549.1.1.5","sha1WithRSAEncryption");te("1.2.840.113549.1.1.7","RSAES-OAEP");te("1.2.840.113549.1.1.8","mgf1");te("1.2.840.113549.1.1.9","pSpecified");te("1.2.840.113549.1.1.10","RSASSA-PSS");te("1.2.840.113549.1.1.11","sha256WithRSAEncryption");te("1.2.840.113549.1.1.12","sha384WithRSAEncryption");te("1.2.840.113549.1.1.13","sha512WithRSAEncryption");te("1.3.101.112","EdDSA25519");te("1.2.840.10040.4.3","dsa-with-sha1");te("1.3.14.3.2.7","desCBC");te("1.3.14.3.2.26","sha1");te("1.3.14.3.2.29","sha1WithRSASignature");te("2.16.840.1.101.3.4.2.1","sha256");te("2.16.840.1.101.3.4.2.2","sha384");te("2.16.840.1.101.3.4.2.3","sha512");te("2.16.840.1.101.3.4.2.4","sha224");te("2.16.840.1.101.3.4.2.5","sha512-224");te("2.16.840.1.101.3.4.2.6","sha512-256");te("1.2.840.113549.2.2","md2");te("1.2.840.113549.2.5","md5");te("1.2.840.113549.1.7.1","data");te("1.2.840.113549.1.7.2","signedData");te("1.2.840.113549.1.7.3","envelopedData");te("1.2.840.113549.1.7.4","signedAndEnvelopedData");te("1.2.840.113549.1.7.5","digestedData");te("1.2.840.113549.1.7.6","encryptedData");te("1.2.840.113549.1.9.1","emailAddress");te("1.2.840.113549.1.9.2","unstructuredName");te("1.2.840.113549.1.9.3","contentType");te("1.2.840.113549.1.9.4","messageDigest");te("1.2.840.113549.1.9.5","signingTime");te("1.2.840.113549.1.9.6","counterSignature");te("1.2.840.113549.1.9.7","challengePassword");te("1.2.840.113549.1.9.8","unstructuredAddress");te("1.2.840.113549.1.9.14","extensionRequest");te("1.2.840.113549.1.9.20","friendlyName");te("1.2.840.113549.1.9.21","localKeyId");te("1.2.840.113549.1.9.22.1","x509Certificate");te("1.2.840.113549.1.12.10.1.1","keyBag");te("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");te("1.2.840.113549.1.12.10.1.3","certBag");te("1.2.840.113549.1.12.10.1.4","crlBag");te("1.2.840.113549.1.12.10.1.5","secretBag");te("1.2.840.113549.1.12.10.1.6","safeContentsBag");te("1.2.840.113549.1.5.13","pkcs5PBES2");te("1.2.840.113549.1.5.12","pkcs5PBKDF2");te("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");te("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");te("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");te("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");te("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");te("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");te("1.2.840.113549.2.7","hmacWithSHA1");te("1.2.840.113549.2.8","hmacWithSHA224");te("1.2.840.113549.2.9","hmacWithSHA256");te("1.2.840.113549.2.10","hmacWithSHA384");te("1.2.840.113549.2.11","hmacWithSHA512");te("1.2.840.113549.3.7","des-EDE3-CBC");te("2.16.840.1.101.3.4.1.2","aes128-CBC");te("2.16.840.1.101.3.4.1.22","aes192-CBC");te("2.16.840.1.101.3.4.1.42","aes256-CBC");te("2.5.4.3","commonName");te("2.5.4.4","surname");te("2.5.4.5","serialNumber");te("2.5.4.6","countryName");te("2.5.4.7","localityName");te("2.5.4.8","stateOrProvinceName");te("2.5.4.9","streetAddress");te("2.5.4.10","organizationName");te("2.5.4.11","organizationalUnitName");te("2.5.4.12","title");te("2.5.4.13","description");te("2.5.4.15","businessCategory");te("2.5.4.17","postalCode");te("2.5.4.42","givenName");te("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");te("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");te("2.16.840.1.113730.1.1","nsCertType");te("2.16.840.1.113730.1.13","nsComment");Wt("2.5.29.1","authorityKeyIdentifier");Wt("2.5.29.2","keyAttributes");Wt("2.5.29.3","certificatePolicies");Wt("2.5.29.4","keyUsageRestriction");Wt("2.5.29.5","policyMapping");Wt("2.5.29.6","subtreesConstraint");Wt("2.5.29.7","subjectAltName");Wt("2.5.29.8","issuerAltName");Wt("2.5.29.9","subjectDirectoryAttributes");Wt("2.5.29.10","basicConstraints");Wt("2.5.29.11","nameConstraints");Wt("2.5.29.12","policyConstraints");Wt("2.5.29.13","basicConstraints");te("2.5.29.14","subjectKeyIdentifier");te("2.5.29.15","keyUsage");Wt("2.5.29.16","privateKeyUsagePeriod");te("2.5.29.17","subjectAltName");te("2.5.29.18","issuerAltName");te("2.5.29.19","basicConstraints");Wt("2.5.29.20","cRLNumber");Wt("2.5.29.21","cRLReason");Wt("2.5.29.22","expirationDate");Wt("2.5.29.23","instructionCode");Wt("2.5.29.24","invalidityDate");Wt("2.5.29.25","cRLDistributionPoints");Wt("2.5.29.26","issuingDistributionPoint");Wt("2.5.29.27","deltaCRLIndicator");Wt("2.5.29.28","issuingDistributionPoint");Wt("2.5.29.29","certificateIssuer");Wt("2.5.29.30","nameConstraints");te("2.5.29.31","cRLDistributionPoints");te("2.5.29.32","certificatePolicies");Wt("2.5.29.33","policyMappings");Wt("2.5.29.34","policyConstraints");te("2.5.29.35","authorityKeyIdentifier");Wt("2.5.29.36","policyConstraints");te("2.5.29.37","extKeyUsage");Wt("2.5.29.46","freshestCRL");Wt("2.5.29.54","inhibitAnyPolicy");te("1.3.6.1.4.1.11129.2.4.2","timestampList");te("1.3.6.1.5.5.7.1.1","authorityInfoAccess");te("1.3.6.1.5.5.7.3.1","serverAuth");te("1.3.6.1.5.5.7.3.2","clientAuth");te("1.3.6.1.5.5.7.3.3","codeSigning");te("1.3.6.1.5.5.7.3.4","emailProtection");te("1.3.6.1.5.5.7.3.8","timeStamping")});var wu=P((QFe,KU)=>{l();var br=Je();hr();qp();var ue=KU.exports=br.asn1=br.asn1||{};ue.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};ue.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};ue.create=function(r,e,t,n,i){if(br.util.isArray(n)){for(var s=[],o=0;o<n.length;++o)n[o]!==void 0&&s.push(n[o]);n=s}var a={tagClass:r,type:e,constructed:t,composed:t||br.util.isArray(n),value:n};return i&&"bitStringContents"in i&&(a.bitStringContents=i.bitStringContents,a.original=ue.copy(a)),a};ue.copy=function(r,e){var t;if(br.util.isArray(r)){t=[];for(var n=0;n<r.length;++n)t.push(ue.copy(r[n],e));return t}return typeof r=="string"?r:(t={tagClass:r.tagClass,type:r.type,constructed:r.constructed,composed:r.composed,value:ue.copy(r.value,e)},e&&!e.excludeBitStringContents&&(t.bitStringContents=r.bitStringContents),t)};ue.equals=function(r,e,t){if(br.util.isArray(r)){if(!br.util.isArray(e)||r.length!==e.length)return!1;for(var n=0;n<r.length;++n)if(!ue.equals(r[n],e[n]))return!1;return!0}if(typeof r!=typeof e)return!1;if(typeof r=="string")return r===e;var i=r.tagClass===e.tagClass&&r.type===e.type&&r.constructed===e.constructed&&r.composed===e.composed&&ue.equals(r.value,e.value);return t&&t.includeBitStringContents&&(i=i&&r.bitStringContents===e.bitStringContents),i};ue.getBerValueLength=function(r){var e=r.getByte();if(e!==128){var t,n=e&128;return n?t=r.getInt((e&127)<<3):t=e,t}};function i2(r,e,t){if(t>e){var n=new Error("Too few bytes to parse DER.");throw n.available=r.length(),n.remaining=e,n.requested=t,n}}var R1e=function(r,e){var t=r.getByte();if(e--,t!==128){var n,i=t&128;if(!i)n=t;else{var s=t&127;i2(r,e,s),n=r.getInt(s<<3)}if(n<0)throw new Error("Negative length: "+n);return n}};ue.fromDer=function(r,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),typeof r=="string"&&(r=br.util.createBuffer(r));var t=r.length(),n=ew(r,r.length(),0,e);if(e.parseAllBytes&&r.length()!==0){var i=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw i.byteCount=t,i.remaining=r.length(),i}return n};function ew(r,e,t,n){var i;i2(r,e,2);var s=r.getByte();e--;var o=s&192,a=s&31;i=r.length();var c=R1e(r,e);if(e-=i-r.length(),c!==void 0&&c>e){if(n.strict){var u=new Error("Too few bytes to read ASN.1 value.");throw u.available=r.length(),u.remaining=e,u.requested=c,u}c=e}var f,h,p=(s&32)===32;if(p)if(f=[],c===void 0)for(;;){if(i2(r,e,2),r.bytes(2)===String.fromCharCode(0,0)){r.getBytes(2),e-=2;break}i=r.length(),f.push(ew(r,e,t+1,n)),e-=i-r.length()}else for(;c>0;)i=r.length(),f.push(ew(r,c,t+1,n)),e-=i-r.length(),c-=i-r.length();if(f===void 0&&o===ue.Class.UNIVERSAL&&a===ue.Type.BITSTRING&&(h=r.bytes(c)),f===void 0&&n.decodeBitStrings&&o===ue.Class.UNIVERSAL&&a===ue.Type.BITSTRING&&c>1){var d=r.read,m=e,g=0;if(a===ue.Type.BITSTRING&&(i2(r,e,1),g=r.getByte(),e--),g===0)try{i=r.length();var y={strict:!0,decodeBitStrings:!0},w=ew(r,e,t+1,y),b=i-r.length();e-=b,a==ue.Type.BITSTRING&&b++;var _=w.tagClass;b===c&&(_===ue.Class.UNIVERSAL||_===ue.Class.CONTEXT_SPECIFIC)&&(f=[w])}catch{}f===void 0&&(r.read=d,e=m)}if(f===void 0){if(c===void 0){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");c=e}if(a===ue.Type.BMPSTRING)for(f="";c>0;c-=2)i2(r,e,2),f+=String.fromCharCode(r.getInt16()),e-=2;else f=r.getBytes(c),e-=c}var v=h===void 0?null:{bitStringContents:h};return ue.create(o,a,p,f,v)}ue.toDer=function(r){var e=br.util.createBuffer(),t=r.tagClass|r.type,n=br.util.createBuffer(),i=!1;if("bitStringContents"in r&&(i=!0,r.original&&(i=ue.equals(r,r.original))),i)n.putBytes(r.bitStringContents);else if(r.composed){r.constructed?t|=32:n.putByte(0);for(var s=0;s<r.value.length;++s)r.value[s]!==void 0&&n.putBuffer(ue.toDer(r.value[s]))}else if(r.type===ue.Type.BMPSTRING)for(var s=0;s<r.value.length;++s)n.putInt16(r.value.charCodeAt(s));else r.type===ue.Type.INTEGER&&r.value.length>1&&(r.value.charCodeAt(0)===0&&!(r.value.charCodeAt(1)&128)||r.value.charCodeAt(0)===255&&(r.value.charCodeAt(1)&128)===128)?n.putBytes(r.value.substr(1)):n.putBytes(r.value);if(e.putByte(t),n.length()<=127)e.putByte(n.length()&127);else{var o=n.length(),a="";do a+=String.fromCharCode(o&255),o=o>>>8;while(o>0);e.putByte(a.length|128);for(var s=a.length-1;s>=0;--s)e.putByte(a.charCodeAt(s))}return e.putBuffer(n),e};ue.oidToDer=function(r){var e=r.split("."),t=br.util.createBuffer();t.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var n,i,s,o,a=2;a<e.length;++a){n=!0,i=[],s=parseInt(e[a],10);do o=s&127,s=s>>>7,n||(o|=128),i.push(o),n=!1;while(s>0);for(var c=i.length-1;c>=0;--c)t.putByte(i[c])}return t};ue.derToOid=function(r){var e;typeof r=="string"&&(r=br.util.createBuffer(r));var t=r.getByte();e=Math.floor(t/40)+"."+t%40;for(var n=0;r.length()>0;)t=r.getByte(),n=n<<7,t&128?n+=t&127:(e+="."+(n+t),n=0);return e};ue.utcTimeToDate=function(r){var e=new Date,t=parseInt(r.substr(0,2),10);t=t>=50?1900+t:2e3+t;var n=parseInt(r.substr(2,2),10)-1,i=parseInt(r.substr(4,2),10),s=parseInt(r.substr(6,2),10),o=parseInt(r.substr(8,2),10),a=0;if(r.length>11){var c=r.charAt(10),u=10;c!=="+"&&c!=="-"&&(a=parseInt(r.substr(10,2),10),u+=2)}if(e.setUTCFullYear(t,n,i),e.setUTCHours(s,o,a,0),u&&(c=r.charAt(u),c==="+"||c==="-")){var f=parseInt(r.substr(u+1,2),10),h=parseInt(r.substr(u+4,2),10),p=f*60+h;p*=6e4,c==="+"?e.setTime(+e-p):e.setTime(+e+p)}return e};ue.generalizedTimeToDate=function(r){var e=new Date,t=parseInt(r.substr(0,4),10),n=parseInt(r.substr(4,2),10)-1,i=parseInt(r.substr(6,2),10),s=parseInt(r.substr(8,2),10),o=parseInt(r.substr(10,2),10),a=parseInt(r.substr(12,2),10),c=0,u=0,f=!1;r.charAt(r.length-1)==="Z"&&(f=!0);var h=r.length-5,p=r.charAt(h);if(p==="+"||p==="-"){var d=parseInt(r.substr(h+1,2),10),m=parseInt(r.substr(h+4,2),10);u=d*60+m,u*=6e4,p==="+"&&(u*=-1),f=!0}return r.charAt(14)==="."&&(c=parseFloat(r.substr(14),10)*1e3),f?(e.setUTCFullYear(t,n,i),e.setUTCHours(s,o,a,c),e.setTime(+e+u)):(e.setFullYear(t,n,i),e.setHours(s,o,a,c)),e};ue.dateToUtcTime=function(r){if(typeof r=="string")return r;var e="",t=[];t.push((""+r.getUTCFullYear()).substr(2)),t.push(""+(r.getUTCMonth()+1)),t.push(""+r.getUTCDate()),t.push(""+r.getUTCHours()),t.push(""+r.getUTCMinutes()),t.push(""+r.getUTCSeconds());for(var n=0;n<t.length;++n)t[n].length<2&&(e+="0"),e+=t[n];return e+="Z",e};ue.dateToGeneralizedTime=function(r){if(typeof r=="string")return r;var e="",t=[];t.push(""+r.getUTCFullYear()),t.push(""+(r.getUTCMonth()+1)),t.push(""+r.getUTCDate()),t.push(""+r.getUTCHours()),t.push(""+r.getUTCMinutes()),t.push(""+r.getUTCSeconds());for(var n=0;n<t.length;++n)t[n].length<2&&(e+="0"),e+=t[n];return e+="Z",e};ue.integerToDer=function(r){var e=br.util.createBuffer();if(r>=-128&&r<128)return e.putSignedInt(r,8);if(r>=-32768&&r<32768)return e.putSignedInt(r,16);if(r>=-8388608&&r<8388608)return e.putSignedInt(r,24);if(r>=-2147483648&&r<2147483648)return e.putSignedInt(r,32);var t=new Error("Integer too large; max is 32-bits.");throw t.integer=r,t};ue.derToInteger=function(r){typeof r=="string"&&(r=br.util.createBuffer(r));var e=r.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return r.getSignedInt(e)};ue.validate=function(r,e,t,n){var i=!1;if((r.tagClass===e.tagClass||typeof e.tagClass>"u")&&(r.type===e.type||typeof e.type>"u"))if(r.constructed===e.constructed||typeof e.constructed>"u"){if(i=!0,e.value&&br.util.isArray(e.value))for(var s=0,o=0;i&&o<e.value.length;++o)i=e.value[o].optional||!1,r.value[s]&&(i=ue.validate(r.value[s],e.value[o],t,n),i?++s:e.value[o].optional&&(i=!0)),!i&&n&&n.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+r.value.length+'"');if(i&&t&&(e.capture&&(t[e.capture]=r.value),e.captureAsn1&&(t[e.captureAsn1]=r),e.captureBitStringContents&&"bitStringContents"in r&&(t[e.captureBitStringContents]=r.bitStringContents),e.captureBitStringValue&&"bitStringContents"in r)){var a;if(r.bitStringContents.length<2)t[e.captureBitStringValue]="";else{var c=r.bitStringContents.charCodeAt(0);if(c!==0)throw new Error("captureBitStringValue only supported for zero unused bits");t[e.captureBitStringValue]=r.bitStringContents.slice(1)}}}else n&&n.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+r.constructed+'"');else n&&(r.tagClass!==e.tagClass&&n.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+r.tagClass+'"'),r.type!==e.type&&n.push("["+e.name+'] Expected type "'+e.type+'", got "'+r.type+'"'));return i};var zU=/[^\\u0000-\\u00ff]/;ue.prettyPrint=function(r,e,t){var n="";e=e||0,t=t||2,e>0&&(n+=`
`);for(var i="",s=0;s<e*t;++s)i+=" ";switch(n+=i+"Tag: ",r.tagClass){case ue.Class.UNIVERSAL:n+="Universal:";break;case ue.Class.APPLICATION:n+="Application:";break;case ue.Class.CONTEXT_SPECIFIC:n+="Context-Specific:";break;case ue.Class.PRIVATE:n+="Private:";break}if(r.tagClass===ue.Class.UNIVERSAL)switch(n+=r.type,r.type){case ue.Type.NONE:n+=" (None)";break;case ue.Type.BOOLEAN:n+=" (Boolean)";break;case ue.Type.INTEGER:n+=" (Integer)";break;case ue.Type.BITSTRING:n+=" (Bit string)";break;case ue.Type.OCTETSTRING:n+=" (Octet string)";break;case ue.Type.NULL:n+=" (Null)";break;case ue.Type.OID:n+=" (Object Identifier)";break;case ue.Type.ODESC:n+=" (Object Descriptor)";break;case ue.Type.EXTERNAL:n+=" (External or Instance of)";break;case ue.Type.REAL:n+=" (Real)";break;case ue.Type.ENUMERATED:n+=" (Enumerated)";break;case ue.Type.EMBEDDED:n+=" (Embedded PDV)";break;case ue.Type.UTF8:n+=" (UTF8)";break;case ue.Type.ROID:n+=" (Relative Object Identifier)";break;case ue.Type.SEQUENCE:n+=" (Sequence)";break;case ue.Type.SET:n+=" (Set)";break;case ue.Type.PRINTABLESTRING:n+=" (Printable String)";break;case ue.Type.IA5String:n+=" (IA5String (ASCII))";break;case ue.Type.UTCTIME:n+=" (UTC time)";break;case ue.Type.GENERALIZEDTIME:n+=" (Generalized time)";break;case ue.Type.BMPSTRING:n+=" (BMP String)";break}else n+=r.type;if(n+=`
`,n+=i+"Constructed: "+r.constructed+`
`,r.composed){for(var o=0,a="",s=0;s<r.value.length;++s)r.value[s]!==void 0&&(o+=1,a+=ue.prettyPrint(r.value[s],e+1,t),s+1<r.value.length&&(a+=","));n+=i+"Sub values: "+o+a}else{if(n+=i+"Value: ",r.type===ue.Type.OID){var c=ue.derToOid(r.value);n+=c,br.pki&&br.pki.oids&&c in br.pki.oids&&(n+=" ("+br.pki.oids[c]+") ")}if(r.type===ue.Type.INTEGER)try{n+=ue.derToInteger(r.value)}catch{n+="0x"+br.util.bytesToHex(r.value)}else if(r.type===ue.Type.BITSTRING){if(r.value.length>1?n+="0x"+br.util.bytesToHex(r.value.slice(1)):n+="(none)",r.value.length>0){var u=r.value.charCodeAt(0);u==1?n+=" (1 unused bit shown)":u>1&&(n+=" ("+u+" unused bits shown)")}}else if(r.type===ue.Type.OCTETSTRING)zU.test(r.value)||(n+="("+r.value+") "),n+="0x"+br.util.bytesToHex(r.value);else if(r.type===ue.Type.UTF8)try{n+=br.util.decodeUtf8(r.value)}catch(f){if(f.message==="URI malformed")n+="0x"+br.util.bytesToHex(r.value)+" (malformed UTF8)";else throw f}else r.type===ue.Type.PRINTABLESTRING||r.type===ue.Type.IA5String?n+=r.value:zU.test(r.value)?n+="0x"+br.util.bytesToHex(r.value):r.value.length===0?n+="[null]":n+=r.value}return n}});var Tv=P((ZFe,qU)=>{l();var Nn=Je();hr();qU.exports=Nn.cipher=Nn.cipher||{};Nn.cipher.algorithms=Nn.cipher.algorithms||{};Nn.cipher.createCipher=function(r,e){var t=r;if(typeof t=="string"&&(t=Nn.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+r);return new Nn.cipher.BlockCipher({algorithm:t,key:e,decrypt:!1})};Nn.cipher.createDecipher=function(r,e){var t=r;if(typeof t=="string"&&(t=Nn.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+r);return new Nn.cipher.BlockCipher({algorithm:t,key:e,decrypt:!0})};Nn.cipher.registerAlgorithm=function(r,e){r=r.toUpperCase(),Nn.cipher.algorithms[r]=e};Nn.cipher.getAlgorithm=function(r){return r=r.toUpperCase(),r in Nn.cipher.algorithms?Nn.cipher.algorithms[r]:null};var Av=Nn.cipher.BlockCipher=function(r){this.algorithm=r.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=r.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=r.decrypt,this.algorithm.initialize(r)};Av.prototype.start=function(r){r=r||{};var e={};for(var t in r)e[t]=r[t];e.decrypt=this._decrypt,this._finish=!1,this._input=Nn.util.createBuffer(),this.output=r.output||Nn.util.createBuffer(),this.mode.start(e)};Av.prototype.update=function(r){for(r&&this._input.putBuffer(r);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};Av.prototype.finish=function(r){r&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(t){return r(this.blockSize,t,!1)},this.mode.unpad=function(t){return r(this.blockSize,t,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))}});var Rv=P((eVe,$U)=>{l();var Dn=Je();hr();Dn.cipher=Dn.cipher||{};var et=$U.exports=Dn.cipher.modes=Dn.cipher.modes||{};et.ecb=function(r){r=r||{},this.name="ECB",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};et.ecb.prototype.start=function(r){};et.ecb.prototype.encrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=r.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};et.ecb.prototype.decrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=r.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};et.ecb.prototype.pad=function(r,e){var t=r.length()===this.blockSize?this.blockSize:this.blockSize-r.length();return r.fillWithByte(t,t),!0};et.ecb.prototype.unpad=function(r,e){if(e.overflow>0)return!1;var t=r.length(),n=r.at(t-1);return n>this.blockSize<<2?!1:(r.truncate(n),!0)};et.cbc=function(r){r=r||{},this.name="CBC",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};et.cbc.prototype.start=function(r){if(r.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in r)this._iv=tw(r.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};et.cbc.prototype.encrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^r.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n]);this._prev=this._outBlock};et.cbc.prototype.decrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=r.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)};et.cbc.prototype.pad=function(r,e){var t=r.length()===this.blockSize?this.blockSize:this.blockSize-r.length();return r.fillWithByte(t,t),!0};et.cbc.prototype.unpad=function(r,e){if(e.overflow>0)return!1;var t=r.length(),n=r.at(t-1);return n>this.blockSize<<2?!1:(r.truncate(n),!0)};et.cfb=function(r){r=r||{},this.name="CFB",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=Dn.util.createBuffer(),this._partialBytes=0};et.cfb.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");this._iv=tw(r.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};et.cfb.prototype.encrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)this._inBlock[i]=r.getInt32()^this._outBlock[i],e.putInt32(this._inBlock[i]);return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialBlock[i]=r.getInt32()^this._outBlock[i],this._partialOutput.putInt32(this._partialBlock[i]);if(s>0)r.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};et.cfb.prototype.decrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)this._inBlock[i]=r.getInt32(),e.putInt32(this._inBlock[i]^this._outBlock[i]);return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialBlock[i]=r.getInt32(),this._partialOutput.putInt32(this._partialBlock[i]^this._outBlock[i]);if(s>0)r.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};et.ofb=function(r){r=r||{},this.name="OFB",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Dn.util.createBuffer(),this._partialBytes=0};et.ofb.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");this._iv=tw(r.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};et.ofb.prototype.encrypt=function(r,e,t){var n=r.length();if(r.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)e.putInt32(r.getInt32()^this._outBlock[i]),this._inBlock[i]=this._outBlock[i];return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(r.getInt32()^this._outBlock[i]);if(s>0)r.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._outBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};et.ofb.prototype.decrypt=et.ofb.prototype.encrypt;et.ctr=function(r){r=r||{},this.name="CTR",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Dn.util.createBuffer(),this._partialBytes=0};et.ctr.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");this._iv=tw(r.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};et.ctr.prototype.encrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize)for(var i=0;i<this._ints;++i)e.putInt32(r.getInt32()^this._outBlock[i]);else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(r.getInt32()^this._outBlock[i]);if(s>0&&(r.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}rw(this._inBlock)};et.ctr.prototype.decrypt=et.ctr.prototype.encrypt;et.gcm=function(r){r=r||{},this.name="GCM",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=Dn.util.createBuffer(),this._partialBytes=0,this._R=3774873600};et.gcm.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");var e=Dn.util.createBuffer(r.iv);this._cipherLength=0;var t;if("additionalData"in r?t=Dn.util.createBuffer(r.additionalData):t=Dn.util.createBuffer(),"tagLength"in r?this._tagLength=r.tagLength:this._tagLength=128,this._tag=null,r.decrypt&&(this._tag=Dn.util.createBuffer(r.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var n=e.length();if(n===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(Iv(n*8)))}this._inBlock=this._j0.slice(0),rw(this._inBlock),this._partialBytes=0,t=Dn.util.createBuffer(t),this._aDataLength=Iv(t.length()*8);var i=t.length()%this.blockSize;for(i&&t.fillWithByte(0,this.blockSize-i),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])};et.gcm.prototype.encrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]^=r.getInt32());this._cipherLength+=this.blockSize}else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(r.getInt32()^this._outBlock[i]);if(s<=0||t){if(t){var o=n%this.blockSize;this._cipherLength+=o,this._partialOutput.truncate(this.blockSize-o)}else this._cipherLength+=this.blockSize;for(var i=0;i<this._ints;++i)this._outBlock[i]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return r.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),rw(this._inBlock)};et.gcm.prototype.decrypt=function(r,e,t){var n=r.length();if(n<this.blockSize&&!(t&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),rw(this._inBlock),this._hashBlock[0]=r.getInt32(),this._hashBlock[1]=r.getInt32(),this._hashBlock[2]=r.getInt32(),this._hashBlock[3]=r.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]^this._hashBlock[i]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize};et.gcm.prototype.afterFinish=function(r,e){var t=!0;e.decrypt&&e.overflow&&r.truncate(this.blockSize-e.overflow),this.tag=Dn.util.createBuffer();var n=this._aDataLength.concat(Iv(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,n);var i=[];this.cipher.encrypt(this._j0,i);for(var s=0;s<this._ints;++s)this.tag.putInt32(this._s[s]^i[s]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(t=!1),t};et.gcm.prototype.multiply=function(r,e){for(var t=[0,0,0,0],n=e.slice(0),i=0;i<128;++i){var s=r[i/32|0]&1<<31-i%32;s&&(t[0]^=n[0],t[1]^=n[1],t[2]^=n[2],t[3]^=n[3]),this.pow(n,n)}return t};et.gcm.prototype.pow=function(r,e){for(var t=r[3]&1,n=3;n>0;--n)e[n]=r[n]>>>1|(r[n-1]&1)<<31;e[0]=r[0]>>>1,t&&(e[0]^=this._R)};et.gcm.prototype.tableMultiply=function(r){for(var e=[0,0,0,0],t=0;t<32;++t){var n=t/8|0,i=r[n]>>>(7-t%8)*4&15,s=this._m[t][i];e[0]^=s[0],e[1]^=s[1],e[2]^=s[2],e[3]^=s[3]}return e};et.gcm.prototype.ghash=function(r,e,t){return e[0]^=t[0],e[1]^=t[1],e[2]^=t[2],e[3]^=t[3],this.tableMultiply(e)};et.gcm.prototype.generateHashTable=function(r,e){for(var t=8/e,n=4*t,i=16*t,s=new Array(i),o=0;o<i;++o){var a=[0,0,0,0],c=o/n|0,u=(n-1-o%n)*e;a[c]=1<<e-1<<u,s[o]=this.generateSubHashTable(this.multiply(a,r),e)}return s};et.gcm.prototype.generateSubHashTable=function(r,e){var t=1<<e,n=t>>>1,i=new Array(t);i[n]=r.slice(0);for(var s=n>>>1;s>0;)this.pow(i[2*s],i[s]=[]),s>>=1;for(s=2;s<n;){for(var o=1;o<s;++o){var a=i[s],c=i[o];i[s+o]=[a[0]^c[0],a[1]^c[1],a[2]^c[2],a[3]^c[3]]}s*=2}for(i[0]=[0,0,0,0],s=n+1;s<t;++s){var u=i[s^n];i[s]=[r[0]^u[0],r[1]^u[1],r[2]^u[2],r[3]^u[3]]}return i};function tw(r,e){if(typeof r=="string"&&(r=Dn.util.createBuffer(r)),Dn.util.isArray(r)&&r.length>4){var t=r;r=Dn.util.createBuffer();for(var n=0;n<t.length;++n)r.putByte(t[n])}if(r.length()<e)throw new Error("Invalid IV length; got "+r.length()+" bytes and expected "+e+" bytes.");if(!Dn.util.isArray(r)){for(var i=[],s=e/4,n=0;n<s;++n)i.push(r.getInt32());r=i}return r}function rw(r){r[r.length-1]=r[r.length-1]+1&4294967295}function Iv(r){return[r/4294967296|0,r&4294967295]}});var Gp=P((rVe,WU)=>{l();var dr=Je();Tv();Rv();hr();WU.exports=dr.aes=dr.aes||{};dr.aes.startEncrypting=function(r,e,t,n){var i=nw({key:r,output:t,decrypt:!1,mode:n});return i.start(e),i};dr.aes.createEncryptionCipher=function(r,e){return nw({key:r,output:null,decrypt:!1,mode:e})};dr.aes.startDecrypting=function(r,e,t,n){var i=nw({key:r,output:t,decrypt:!0,mode:n});return i.start(e),i};dr.aes.createDecryptionCipher=function(r,e){return nw({key:r,output:null,decrypt:!0,mode:e})};dr.aes.Algorithm=function(r,e){kv||GU();var t=this;t.name=r,t.mode=new e({blockSize:16,cipher:{encrypt:function(n,i){return Pv(t._w,n,i,!1)},decrypt:function(n,i){return Pv(t._w,n,i,!0)}}}),t._init=!1};dr.aes.Algorithm.prototype.initialize=function(r){if(!this._init){var e=r.key,t;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=dr.util.createBuffer(e);else if(dr.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){t=e,e=dr.util.createBuffer();for(var n=0;n<t.length;++n)e.putByte(t[n])}if(!dr.util.isArray(e)){t=e,e=[];var i=t.length();if(i===16||i===24||i===32){i=i>>>2;for(var n=0;n<i;++n)e.push(t.getInt32())}}if(!dr.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var s=this.mode.name,o=["CFB","OFB","CTR","GCM"].indexOf(s)!==-1;this._w=jU(e,r.decrypt&&!o),this._init=!0}};dr.aes._expandKey=function(r,e){return kv||GU(),jU(r,e)};dr.aes._updateBlock=Pv;Hp("AES-ECB",dr.cipher.modes.ecb);Hp("AES-CBC",dr.cipher.modes.cbc);Hp("AES-CFB",dr.cipher.modes.cfb);Hp("AES-OFB",dr.cipher.modes.ofb);Hp("AES-CTR",dr.cipher.modes.ctr);Hp("AES-GCM",dr.cipher.modes.gcm);function Hp(r,e){var t=function(){return new dr.aes.Algorithm(r,e)};dr.cipher.registerAlgorithm(r,t)}var kv=!1,$p=4,Oi,Cv,HU,ph,Oo;function GU(){kv=!0,HU=[0,1,2,4,8,16,32,64,128,27,54];for(var r=new Array(256),e=0;e<128;++e)r[e]=e<<1,r[e+128]=e+128<<1^283;Oi=new Array(256),Cv=new Array(256),ph=new Array(4),Oo=new Array(4);for(var e=0;e<4;++e)ph[e]=new Array(256),Oo[e]=new Array(256);for(var t=0,n=0,i,s,o,a,c,u,f,e=0;e<256;++e){a=n^n<<1^n<<2^n<<3^n<<4,a=a>>8^a&255^99,Oi[t]=a,Cv[a]=t,c=r[a],i=r[t],s=r[i],o=r[s],u=c<<24^a<<16^a<<8^(a^c),f=(i^s^o)<<24^(t^o)<<16^(t^s^o)<<8^(t^i^o);for(var h=0;h<4;++h)ph[h][t]=u,Oo[h][a]=f,u=u<<24|u>>>8,f=f<<24|f>>>8;t===0?t=n=1:(t=i^r[r[r[i^o]]],n^=r[r[n]])}}function jU(r,e){for(var t=r.slice(0),n,i=1,s=t.length,o=s+6+1,a=$p*o,c=s;c<a;++c)n=t[c-1],c%s===0?(n=Oi[n>>>16&255]<<24^Oi[n>>>8&255]<<16^Oi[n&255]<<8^Oi[n>>>24]^HU[i]<<24,i++):s>6&&c%s===4&&(n=Oi[n>>>24]<<24^Oi[n>>>16&255]<<16^Oi[n>>>8&255]<<8^Oi[n&255]),t[c]=t[c-s]^n;if(e){var u,f=Oo[0],h=Oo[1],p=Oo[2],d=Oo[3],m=t.slice(0);a=t.length;for(var c=0,g=a-$p;c<a;c+=$p,g-=$p)if(c===0||c===a-$p)m[c]=t[g],m[c+1]=t[g+3],m[c+2]=t[g+2],m[c+3]=t[g+1];else for(var y=0;y<$p;++y)u=t[g+y],m[c+(3&-y)]=f[Oi[u>>>24]]^h[Oi[u>>>16&255]]^p[Oi[u>>>8&255]]^d[Oi[u&255]];t=m}return t}function Pv(r,e,t,n){var i=r.length/4-1,s,o,a,c,u;n?(s=Oo[0],o=Oo[1],a=Oo[2],c=Oo[3],u=Cv):(s=ph[0],o=ph[1],a=ph[2],c=ph[3],u=Oi);var f,h,p,d,m,g,y;f=e[0]^r[0],h=e[n?3:1]^r[1],p=e[2]^r[2],d=e[n?1:3]^r[3];for(var w=3,b=1;b<i;++b)m=s[f>>>24]^o[h>>>16&255]^a[p>>>8&255]^c[d&255]^r[++w],g=s[h>>>24]^o[p>>>16&255]^a[d>>>8&255]^c[f&255]^r[++w],y=s[p>>>24]^o[d>>>16&255]^a[f>>>8&255]^c[h&255]^r[++w],d=s[d>>>24]^o[f>>>16&255]^a[h>>>8&255]^c[p&255]^r[++w],f=m,h=g,p=y;t[0]=u[f>>>24]<<24^u[h>>>16&255]<<16^u[p>>>8&255]<<8^u[d&255]^r[++w],t[n?3:1]=u[h>>>24]<<24^u[p>>>16&255]<<16^u[d>>>8&255]<<8^u[f&255]^r[++w],t[2]=u[p>>>24]<<24^u[d>>>16&255]<<16^u[f>>>8&255]<<8^u[h&255]^r[++w],t[n?1:3]=u[d>>>24]<<24^u[f>>>16&255]<<16^u[h>>>8&255]<<8^u[p&255]^r[++w]}function nw(r){r=r||{};var e=(r.mode||"CBC").toUpperCase(),t="AES-"+e,n;r.decrypt?n=dr.cipher.createDecipher(t,r.key):n=dr.cipher.createCipher(t,r.key);var i=n.start;return n.start=function(s,o){var a=null;o instanceof dr.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=s,i.call(n,o)},n}});var sw=P((iVe,QU)=>{l();var Ir=Je();Tv();Rv();hr();QU.exports=Ir.des=Ir.des||{};Ir.des.startEncrypting=function(r,e,t,n){var i=iw({key:r,output:t,decrypt:!1,mode:n||(e===null?"ECB":"CBC")});return i.start(e),i};Ir.des.createEncryptionCipher=function(r,e){return iw({key:r,output:null,decrypt:!1,mode:e})};Ir.des.startDecrypting=function(r,e,t,n){var i=iw({key:r,output:t,decrypt:!0,mode:n||(e===null?"ECB":"CBC")});return i.start(e),i};Ir.des.createDecryptionCipher=function(r,e){return iw({key:r,output:null,decrypt:!0,mode:e})};Ir.des.Algorithm=function(r,e){var t=this;t.name=r,t.mode=new e({blockSize:8,cipher:{encrypt:function(n,i){return YU(t._keys,n,i,!1)},decrypt:function(n,i){return YU(t._keys,n,i,!0)}}}),t._init=!1};Ir.des.Algorithm.prototype.initialize=function(r){if(!this._init){var e=Ir.util.createBuffer(r.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=U1e(e),this._init=!0}};Ea("DES-ECB",Ir.cipher.modes.ecb);Ea("DES-CBC",Ir.cipher.modes.cbc);Ea("DES-CFB",Ir.cipher.modes.cfb);Ea("DES-OFB",Ir.cipher.modes.ofb);Ea("DES-CTR",Ir.cipher.modes.ctr);Ea("3DES-ECB",Ir.cipher.modes.ecb);Ea("3DES-CBC",Ir.cipher.modes.cbc);Ea("3DES-CFB",Ir.cipher.modes.cfb);Ea("3DES-OFB",Ir.cipher.modes.ofb);Ea("3DES-CTR",Ir.cipher.modes.ctr);function Ea(r,e){var t=function(){return new Ir.des.Algorithm(r,e)};Ir.cipher.registerAlgorithm(r,t)}var C1e=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],P1e=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],k1e=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],O1e=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],N1e=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],D1e=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],L1e=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],B1e=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function U1e(r){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],t=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],n=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],i=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],a=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],c=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],f=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],h=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],p=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],d=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],m=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],g=r.length()>8?3:1,y=[],w=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],b=0,_,v=0;v<g;v++){var I=r.getInt32(),x=r.getInt32();_=(I>>>4^x)&252645135,x^=_,I^=_<<4,_=(x>>>-16^I)&65535,I^=_,x^=_<<-16,_=(I>>>2^x)&858993459,x^=_,I^=_<<2,_=(x>>>-16^I)&65535,I^=_,x^=_<<-16,_=(I>>>1^x)&1431655765,x^=_,I^=_<<1,_=(x>>>8^I)&16711935,I^=_,x^=_<<8,_=(I>>>1^x)&1431655765,x^=_,I^=_<<1,_=I<<8|x>>>20&240,I=x<<24|x<<8&16711680|x>>>8&65280|x>>>24&240,x=_;for(var A=0;A<w.length;++A){w[A]?(I=I<<2|I>>>26,x=x<<2|x>>>26):(I=I<<1|I>>>27,x=x<<1|x>>>27),I&=-15,x&=-15;var R=e[I>>>28]|t[I>>>24&15]|n[I>>>20&15]|i[I>>>16&15]|s[I>>>12&15]|o[I>>>8&15]|a[I>>>4&15],O=c[x>>>28]|u[x>>>24&15]|f[x>>>20&15]|h[x>>>16&15]|p[x>>>12&15]|d[x>>>8&15]|m[x>>>4&15];_=(O>>>16^R)&65535,y[b++]=R^_,y[b++]=O^_<<16}}return y}function YU(r,e,t,n){var i=r.length===32?3:9,s;i===3?s=n?[30,-2,-2]:[0,32,2]:s=n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var o,a=e[0],c=e[1];o=(a>>>4^c)&252645135,c^=o,a^=o<<4,o=(a>>>16^c)&65535,c^=o,a^=o<<16,o=(c>>>2^a)&858993459,a^=o,c^=o<<2,o=(c>>>8^a)&16711935,a^=o,c^=o<<8,o=(a>>>1^c)&1431655765,c^=o,a^=o<<1,a=a<<1|a>>>31,c=c<<1|c>>>31;for(var u=0;u<i;u+=3){for(var f=s[u+1],h=s[u+2],p=s[u];p!=f;p+=h){var d=c^r[p],m=(c>>>4|c<<28)^r[p+1];o=a,a=c,c=o^(P1e[d>>>24&63]|O1e[d>>>16&63]|D1e[d>>>8&63]|B1e[d&63]|C1e[m>>>24&63]|k1e[m>>>16&63]|N1e[m>>>8&63]|L1e[m&63])}o=a,a=c,c=o}a=a>>>1|a<<31,c=c>>>1|c<<31,o=(a>>>1^c)&1431655765,c^=o,a^=o<<1,o=(c>>>8^a)&16711935,a^=o,c^=o<<8,o=(c>>>2^a)&858993459,a^=o,c^=o<<2,o=(a>>>16^c)&65535,c^=o,a^=o<<16,o=(a>>>4^c)&252645135,c^=o,a^=o<<4,t[0]=a,t[1]=c}function iw(r){r=r||{};var e=(r.mode||"CBC").toUpperCase(),t="DES-"+e,n;r.decrypt?n=Ir.cipher.createDecipher(t,r.key):n=Ir.cipher.createCipher(t,r.key);var i=n.start;return n.start=function(s,o){var a=null;o instanceof Ir.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=s,i.call(n,o)},n}});var bu=P((oVe,XU)=>{l();var ow=Je();XU.exports=ow.md=ow.md||{};ow.md.algorithms=ow.md.algorithms||{}});var JU=P((cVe,ZU)=>{l();var Vc=Je();bu();hr();var M1e=ZU.exports=Vc.hmac=Vc.hmac||{};M1e.create=function(){var r=null,e=null,t=null,n=null,i={};return i.start=function(s,o){if(s!==null)if(typeof s=="string")if(s=s.toLowerCase(),s in Vc.md.algorithms)e=Vc.md.algorithms[s].create();else throw new Error('Unknown hash algorithm "'+s+'"');else e=s;if(o===null)o=r;else{if(typeof o=="string")o=Vc.util.createBuffer(o);else if(Vc.util.isArray(o)){var a=o;o=Vc.util.createBuffer();for(var c=0;c<a.length;++c)o.putByte(a[c])}var u=o.length();u>e.blockLength&&(e.start(),e.update(o.bytes()),o=e.digest()),t=Vc.util.createBuffer(),n=Vc.util.createBuffer(),u=o.length();for(var c=0;c<u;++c){var a=o.at(c);t.putByte(54^a),n.putByte(92^a)}if(u<e.blockLength)for(var a=e.blockLength-u,c=0;c<a;++c)t.putByte(54),n.putByte(92);r=o,t=t.bytes(),n=n.bytes()}e.start(),e.update(t)},i.update=function(s){e.update(s)},i.getMac=function(){var s=e.digest().bytes();return e.start(),e.update(n),e.update(s),e.digest()},i.digest=i.getMac,i}});var Eu=P(()=>{l()});var Ov=P((dVe,eM)=>{l();var Ni=Je();JU();bu();hr();var F1e=Ni.pkcs5=Ni.pkcs5||{},zc;Ni.util.isNodejs&&!Ni.options.usePureJavaScript&&(zc=Eu());eM.exports=Ni.pbkdf2=F1e.pbkdf2=function(r,e,t,n,i,s){if(typeof i=="function"&&(s=i,i=null),Ni.util.isNodejs&&!Ni.options.usePureJavaScript&&zc.pbkdf2&&(i===null||typeof i!="object")&&(zc.pbkdf2Sync.length>4||!i||i==="sha1"))return typeof i!="string"&&(i="sha1"),r=Buffer.from(r,"binary"),e=Buffer.from(e,"binary"),s?zc.pbkdf2Sync.length===4?zc.pbkdf2(r,e,t,n,function(_,v){if(_)return s(_);s(null,v.toString("binary"))}):zc.pbkdf2(r,e,t,n,i,function(_,v){if(_)return s(_);s(null,v.toString("binary"))}):zc.pbkdf2Sync.length===4?zc.pbkdf2Sync(r,e,t,n).toString("binary"):zc.pbkdf2Sync(r,e,t,n,i).toString("binary");if((typeof i>"u"||i===null)&&(i="sha1"),typeof i=="string"){if(!(i in Ni.md.algorithms))throw new Error("Unknown hash algorithm: "+i);i=Ni.md[i].create()}var o=i.digestLength;if(n>4294967295*o){var a=new Error("Derived key is too long.");if(s)return s(a);throw a}var c=Math.ceil(n/o),u=n-(c-1)*o,f=Ni.hmac.create();f.start(i,r);var h="",p,d,m;if(!s){for(var g=1;g<=c;++g){f.start(null,null),f.update(e),f.update(Ni.util.int32ToBytes(g)),p=m=f.digest().getBytes();for(var y=2;y<=t;++y)f.start(null,null),f.update(m),d=f.digest().getBytes(),p=Ni.util.xorBytes(p,d,o),m=d;h+=g<c?p:p.substr(0,u)}return h}var g=1,y;function w(){if(g>c)return s(null,h);f.start(null,null),f.update(e),f.update(Ni.util.int32ToBytes(g)),p=m=f.digest().getBytes(),y=2,b()}function b(){if(y<=t)return f.start(null,null),f.update(m),d=f.digest().getBytes(),p=Ni.util.xorBytes(p,d,o),m=d,++y,Ni.util.setImmediate(b);h+=g<c?p:p.substr(0,u),++g,w()}w()}});var lw=P((mVe,rM)=>{l();var cw=Je();hr();var tM=rM.exports=cw.pem=cw.pem||{};tM.encode=function(r,e){e=e||{};var t="-----BEGIN "+r.type+`-----\r
`,n;if(r.procType&&(n={name:"Proc-Type",values:[String(r.procType.version),r.procType.type]},t+=aw(n)),r.contentDomain&&(n={name:"Content-Domain",values:[r.contentDomain]},t+=aw(n)),r.dekInfo&&(n={name:"DEK-Info",values:[r.dekInfo.algorithm]},r.dekInfo.parameters&&n.values.push(r.dekInfo.parameters),t+=aw(n)),r.headers)for(var i=0;i<r.headers.length;++i)t+=aw(r.headers[i]);return r.procType&&(t+=`\r
`),t+=cw.util.encode64(r.body,e.maxline||64)+`\r
`,t+="-----END "+r.type+`-----\r
`,t};tM.decode=function(r){for(var e=[],t=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,n=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,i=/\r?\n/,s;s=t.exec(r),!!s;){var o=s[1];o==="NEW CERTIFICATE REQUEST"&&(o="CERTIFICATE REQUEST");var a={type:o,procType:null,contentDomain:null,dekInfo:null,headers:[],body:cw.util.decode64(s[3])};if(e.push(a),!!s[2]){for(var c=s[2].split(i),u=0;s&&u<c.length;){for(var f=c[u].replace(/\s+$/,""),h=u+1;h<c.length;++h){var p=c[h];if(!/\s/.test(p[0]))break;f+=p,u=h}if(s=f.match(n),s){for(var d={name:s[1],values:[]},m=s[2].split(","),g=0;g<m.length;++g)d.values.push(V1e(m[g]));if(a.procType)if(!a.contentDomain&&d.name==="Content-Domain")a.contentDomain=m[0]||"";else if(!a.dekInfo&&d.name==="DEK-Info"){if(d.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');a.dekInfo={algorithm:m[0],parameters:m[1]||null}}else a.headers.push(d);else{if(d.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(d.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');a.procType={version:m[0],type:m[1]}}}++u}if(a.procType==="ENCRYPTED"&&!a.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function aw(r){for(var e=r.name+": ",t=[],n=function(c,u){return" "+u},i=0;i<r.values.length;++i)t.push(r.values[i].replace(/^(\S+\r\n)/,n));e+=t.join(",")+`\r
`;for(var s=0,o=-1,i=0;i<e.length;++i,++s)if(s>65&&o!==-1){var a=e[o];a===","?(++o,e=e.substr(0,o)+`\r
 `+e.substr(o)):e=e.substr(0,o)+`\r
`+a+e.substr(o+1),s=i-o-1,o=-1,++i}else(e[i]===" "||e[i]==="	"||e[i]===",")&&(o=i);return e}function V1e(r){return r.replace(/^\s+/,"")}});var cM=P((yVe,aM)=>{l();var _a=Je();bu();hr();var iM=aM.exports=_a.sha256=_a.sha256||{};_a.md.sha256=_a.md.algorithms.sha256=iM;iM.create=function(){sM||z1e();var r=null,e=_a.util.createBuffer(),t=new Array(64),n={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var i=n.messageLengthSize/4,s=0;s<i;++s)n.fullMessageLength.push(0);return e=_a.util.createBuffer(),r={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},n},n.start(),n.update=function(i,s){s==="utf8"&&(i=_a.util.encodeUtf8(i));var o=i.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(i),nM(r,t,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var i=_a.util.createBuffer();i.putBytes(e.bytes());var s=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=s&n.blockLength-1;i.putBytes(Nv.substr(0,n.blockLength-o));for(var a,c,u=n.fullMessageLength[0]*8,f=0;f<n.fullMessageLength.length-1;++f)a=n.fullMessageLength[f+1]*8,c=a/4294967296>>>0,u+=c,i.putInt32(u>>>0),u=a>>>0;i.putInt32(u);var h={h0:r.h0,h1:r.h1,h2:r.h2,h3:r.h3,h4:r.h4,h5:r.h5,h6:r.h6,h7:r.h7};nM(h,t,i);var p=_a.util.createBuffer();return p.putInt32(h.h0),p.putInt32(h.h1),p.putInt32(h.h2),p.putInt32(h.h3),p.putInt32(h.h4),p.putInt32(h.h5),p.putInt32(h.h6),p.putInt32(h.h7),p},n};var Nv=null,sM=!1,oM=null;function z1e(){Nv=String.fromCharCode(128),Nv+=_a.util.fillString(String.fromCharCode(0),64),oM=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],sM=!0}function nM(r,e,t){for(var n,i,s,o,a,c,u,f,h,p,d,m,g,y,w,b=t.length();b>=64;){for(u=0;u<16;++u)e[u]=t.getInt32();for(;u<64;++u)n=e[u-2],n=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,i=e[u-15],i=(i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,e[u]=n+e[u-7]+i+e[u-16]|0;for(f=r.h0,h=r.h1,p=r.h2,d=r.h3,m=r.h4,g=r.h5,y=r.h6,w=r.h7,u=0;u<64;++u)o=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7),a=y^m&(g^y),s=(f>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10),c=f&h|p&(f^h),n=w+o+a+oM[u]+e[u],i=s+c,w=y,y=g,g=m,m=d+n>>>0,d=p,p=h,h=f,f=n+i>>>0;r.h0=r.h0+f|0,r.h1=r.h1+h|0,r.h2=r.h2+p|0,r.h3=r.h3+d|0,r.h4=r.h4+m|0,r.h5=r.h5+g|0,r.h6=r.h6+y|0,r.h7=r.h7+w|0,b-=64}}});var uM=P((bVe,lM)=>{l();var va=Je();hr();var uw=null;va.util.isNodejs&&!va.options.usePureJavaScript&&!process.versions["node-webkit"]&&(uw=Eu());var K1e=lM.exports=va.prng=va.prng||{};K1e.create=function(r){for(var e={plugin:r,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},t=r.md,n=new Array(32),i=0;i<32;++i)n[i]=t.create();e.pools=n,e.pool=0,e.generate=function(u,f){if(!f)return e.generateSync(u);var h=e.plugin.cipher,p=e.plugin.increment,d=e.plugin.formatKey,m=e.plugin.formatSeed,g=va.util.createBuffer();e.key=null,y();function y(w){if(w)return f(w);if(g.length()>=u)return f(null,g.getBytes(u));if(e.generated>1048575&&(e.key=null),e.key===null)return va.util.nextTick(function(){s(y)});var b=h(e.key,e.seed);e.generated+=b.length,g.putBytes(b),e.key=d(h(e.key,p(e.seed))),e.seed=m(h(e.key,e.seed)),va.util.setImmediate(y)}},e.generateSync=function(u){var f=e.plugin.cipher,h=e.plugin.increment,p=e.plugin.formatKey,d=e.plugin.formatSeed;e.key=null;for(var m=va.util.createBuffer();m.length()<u;){e.generated>1048575&&(e.key=null),e.key===null&&o();var g=f(e.key,e.seed);e.generated+=g.length,m.putBytes(g),e.key=p(f(e.key,h(e.seed))),e.seed=d(f(e.key,e.seed))}return m.getBytes(u)};function s(u){if(e.pools[0].messageLength>=32)return a(),u();var f=32-e.pools[0].messageLength<<5;e.seedFile(f,function(h,p){if(h)return u(h);e.collect(p),a(),u()})}function o(){if(e.pools[0].messageLength>=32)return a();var u=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(u)),a()}function a(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var u=e.plugin.md.create();u.update(e.keyBytes);for(var f=1,h=0;h<32;++h)e.reseeds%f===0&&(u.update(e.pools[h].digest().getBytes()),e.pools[h].start()),f=f<<1;e.keyBytes=u.digest().getBytes(),u.start(),u.update(e.keyBytes);var p=u.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(p),e.generated=0}function c(u){var f=null,h=va.util.globalScope,p=h.crypto||h.msCrypto;p&&p.getRandomValues&&(f=function(I){return p.getRandomValues(I)});var d=va.util.createBuffer();if(f)for(;d.length()<u;){var m=Math.max(1,Math.min(u-d.length(),65536)/4),g=new Uint32Array(Math.floor(m));try{f(g);for(var y=0;y<g.length;++y)d.putInt32(g[y])}catch(I){if(!(typeof QuotaExceededError<"u"&&I instanceof QuotaExceededError))throw I}}if(d.length()<u)for(var w,b,_,v=Math.floor(Math.random()*65536);d.length()<u;){b=16807*(v&65535),w=16807*(v>>16),b+=(w&32767)<<16,b+=w>>15,b=(b&2147483647)+(b>>31),v=b&4294967295;for(var y=0;y<3;++y)_=v>>>(y<<3),_^=Math.floor(Math.random()*256),d.putByte(_&255)}return d.getBytes(u)}return uw?(e.seedFile=function(u,f){uw.randomBytes(u,function(h,p){if(h)return f(h);f(null,p.toString())})},e.seedFileSync=function(u){return uw.randomBytes(u).toString()}):(e.seedFile=function(u,f){try{f(null,c(u))}catch(h){f(h)}},e.seedFileSync=c),e.collect=function(u){for(var f=u.length,h=0;h<f;++h)e.pools[e.pool].update(u.substr(h,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(u,f){for(var h="",p=0;p<f;p+=8)h+=String.fromCharCode(u>>p&255);e.collect(h)},e.registerWorker=function(u){if(u===self)e.seedFile=function(h,p){function d(m){var g=m.data;g.forge&&g.forge.prng&&(self.removeEventListener("message",d),p(g.forge.prng.err,g.forge.prng.bytes))}self.addEventListener("message",d),self.postMessage({forge:{prng:{needed:h}}})};else{var f=function(h){var p=h.data;p.forge&&p.forge.prng&&e.seedFile(p.forge.prng.needed,function(d,m){u.postMessage({forge:{prng:{err:d,bytes:m}}})})};u.addEventListener("message",f)}},e}});var mh=P((_Ve,Dv)=>{l();var Ln=Je();Gp();cM();uM();hr();(function(){if(Ln.random&&Ln.random.getBytes){Dv.exports=Ln.random;return}(function(r){var e={},t=new Array(4),n=Ln.util.createBuffer();e.formatKey=function(h){var p=Ln.util.createBuffer(h);return h=new Array(4),h[0]=p.getInt32(),h[1]=p.getInt32(),h[2]=p.getInt32(),h[3]=p.getInt32(),Ln.aes._expandKey(h,!1)},e.formatSeed=function(h){var p=Ln.util.createBuffer(h);return h=new Array(4),h[0]=p.getInt32(),h[1]=p.getInt32(),h[2]=p.getInt32(),h[3]=p.getInt32(),h},e.cipher=function(h,p){return Ln.aes._updateBlock(h,p,t,!1),n.putInt32(t[0]),n.putInt32(t[1]),n.putInt32(t[2]),n.putInt32(t[3]),n.getBytes()},e.increment=function(h){return++h[3],h},e.md=Ln.md.sha256;function i(){var h=Ln.prng.create(e);return h.getBytes=function(p,d){return h.generate(p,d)},h.getBytesSync=function(p){return h.generate(p)},h}var s=i(),o=null,a=Ln.util.globalScope,c=a.crypto||a.msCrypto;if(c&&c.getRandomValues&&(o=function(h){return c.getRandomValues(h)}),Ln.options.usePureJavaScript||!Ln.util.isNodejs&&!o){if(typeof window>"u"||window.document,s.collectInt(+new Date,32),typeof navigator<"u"){var u="";for(var f in navigator)try{typeof navigator[f]=="string"&&(u+=navigator[f])}catch{}s.collect(u),u=null}r&&(r().mousemove(function(h){s.collectInt(h.clientX,16),s.collectInt(h.clientY,16)}),r().keypress(function(h){s.collectInt(h.charCode,8)}))}if(!Ln.random)Ln.random=s;else for(var f in s)Ln.random[f]=s[f];Ln.random.createInstance=i,Dv.exports=Ln.random})(typeof jQuery<"u"?jQuery:null)})()});var pM=P((SVe,dM)=>{l();var Ki=Je();hr();var Lv=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],fM=[1,2,3,5],q1e=function(r,e){return r<<e&65535|(r&65535)>>16-e},$1e=function(r,e){return(r&65535)>>e|r<<16-e&65535};dM.exports=Ki.rc2=Ki.rc2||{};Ki.rc2.expandKey=function(r,e){typeof r=="string"&&(r=Ki.util.createBuffer(r)),e=e||128;var t=r,n=r.length(),i=e,s=Math.ceil(i/8),o=255>>(i&7),a;for(a=n;a<128;a++)t.putByte(Lv[t.at(a-1)+t.at(a-n)&255]);for(t.setAt(128-s,Lv[t.at(128-s)&o]),a=127-s;a>=0;a--)t.setAt(a,Lv[t.at(a+1)^t.at(a+s)]);return t};var hM=function(r,e,t){var n=!1,i=null,s=null,o=null,a,c,u,f,h=[];for(r=Ki.rc2.expandKey(r,e),u=0;u<64;u++)h.push(r.getInt16Le());t?(a=function(m){for(u=0;u<4;u++)m[u]+=h[f]+(m[(u+3)%4]&m[(u+2)%4])+(~m[(u+3)%4]&m[(u+1)%4]),m[u]=q1e(m[u],fM[u]),f++},c=function(m){for(u=0;u<4;u++)m[u]+=h[m[(u+3)%4]&63]}):(a=function(m){for(u=3;u>=0;u--)m[u]=$1e(m[u],fM[u]),m[u]-=h[f]+(m[(u+3)%4]&m[(u+2)%4])+(~m[(u+3)%4]&m[(u+1)%4]),f--},c=function(m){for(u=3;u>=0;u--)m[u]-=h[m[(u+3)%4]&63]});var p=function(m){var g=[];for(u=0;u<4;u++){var y=i.getInt16Le();o!==null&&(t?y^=o.getInt16Le():o.putInt16Le(y)),g.push(y&65535)}f=t?0:63;for(var w=0;w<m.length;w++)for(var b=0;b<m[w][0];b++)m[w][1](g);for(u=0;u<4;u++)o!==null&&(t?o.putInt16Le(g[u]):g[u]^=o.getInt16Le()),s.putInt16Le(g[u])},d=null;return d={start:function(m,g){m&&typeof m=="string"&&(m=Ki.util.createBuffer(m)),n=!1,i=Ki.util.createBuffer(),s=g||new Ki.util.createBuffer,o=m,d.output=s},update:function(m){for(n||i.putBuffer(m);i.length()>=8;)p([[5,a],[1,c],[6,a],[1,c],[5,a]])},finish:function(m){var g=!0;if(t)if(m)g=m(8,i,!t);else{var y=i.length()===8?8:8-i.length();i.fillWithByte(y,y)}if(g&&(n=!0,d.update()),!t&&(g=i.length()===0,g))if(m)g=m(8,s,!t);else{var w=s.length(),b=s.at(w-1);b>w?g=!1:s.truncate(b)}return g}},d};Ki.rc2.startEncrypting=function(r,e,t){var n=Ki.rc2.createEncryptionCipher(r,128);return n.start(e,t),n};Ki.rc2.createEncryptionCipher=function(r,e){return hM(r,e,!0)};Ki.rc2.startDecrypting=function(r,e,t){var n=Ki.rc2.createDecryptionCipher(r,128);return n.start(e,t),n};Ki.rc2.createDecryptionCipher=function(r,e){return hM(r,e,!1)}});var dw=P((AVe,vM)=>{l();var Bv=Je();vM.exports=Bv.jsbn=Bv.jsbn||{};var Kc,H1e=0xdeadbeefcafe,mM=(H1e&16777215)==15715070;function X(r,e,t){this.data=[],r!=null&&(typeof r=="number"?this.fromNumber(r,e,t):e==null&&typeof r!="string"?this.fromString(r,256):this.fromString(r,e))}Bv.jsbn.BigInteger=X;function At(){return new X(null)}function G1e(r,e,t,n,i,s){for(;--s>=0;){var o=e*this.data[r++]+t.data[n]+i;i=Math.floor(o/67108864),t.data[n++]=o&67108863}return i}function j1e(r,e,t,n,i,s){for(var o=e&32767,a=e>>15;--s>=0;){var c=this.data[r]&32767,u=this.data[r++]>>15,f=a*c+u*o;c=o*c+((f&32767)<<15)+t.data[n]+(i&1073741823),i=(c>>>30)+(f>>>15)+a*u+(i>>>30),t.data[n++]=c&1073741823}return i}function gM(r,e,t,n,i,s){for(var o=e&16383,a=e>>14;--s>=0;){var c=this.data[r]&16383,u=this.data[r++]>>14,f=a*c+u*o;c=o*c+((f&16383)<<14)+t.data[n]+i,i=(c>>28)+(f>>14)+a*u,t.data[n++]=c&268435455}return i}typeof navigator>"u"?(X.prototype.am=gM,Kc=28):mM&&navigator.appName=="Microsoft Internet Explorer"?(X.prototype.am=j1e,Kc=30):mM&&navigator.appName!="Netscape"?(X.prototype.am=G1e,Kc=26):(X.prototype.am=gM,Kc=28);X.prototype.DB=Kc;X.prototype.DM=(1<<Kc)-1;X.prototype.DV=1<<Kc;var Uv=52;X.prototype.FV=Math.pow(2,Uv);X.prototype.F1=Uv-Kc;X.prototype.F2=2*Kc-Uv;var W1e="0123456789abcdefghijklmnopqrstuvwxyz",fw=new Array,jp,$s;jp="0".charCodeAt(0);for($s=0;$s<=9;++$s)fw[jp++]=$s;jp="a".charCodeAt(0);for($s=10;$s<36;++$s)fw[jp++]=$s;jp="A".charCodeAt(0);for($s=10;$s<36;++$s)fw[jp++]=$s;function yM(r){return W1e.charAt(r)}function wM(r,e){var t=fw[r.charCodeAt(e)];return t??-1}function Y1e(r){for(var e=this.t-1;e>=0;--e)r.data[e]=this.data[e];r.t=this.t,r.s=this.s}function Q1e(r){this.t=1,this.s=r<0?-1:0,r>0?this.data[0]=r:r<-1?this.data[0]=r+this.DV:this.t=0}function _u(r){var e=At();return e.fromInt(r),e}function X1e(r,e){var t;if(e==16)t=4;else if(e==8)t=3;else if(e==256)t=8;else if(e==2)t=1;else if(e==32)t=5;else if(e==4)t=2;else{this.fromRadix(r,e);return}this.t=0,this.s=0;for(var n=r.length,i=!1,s=0;--n>=0;){var o=t==8?r[n]&255:wM(r,n);if(o<0){r.charAt(n)=="-"&&(i=!0);continue}i=!1,s==0?this.data[this.t++]=o:s+t>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this.data[this.t++]=o>>this.DB-s):this.data[this.t-1]|=o<<s,s+=t,s>=this.DB&&(s-=this.DB)}t==8&&r[0]&128&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&X.ZERO.subTo(this,this)}function Z1e(){for(var r=this.s&this.DM;this.t>0&&this.data[this.t-1]==r;)--this.t}function J1e(r){if(this.s<0)return"-"+this.negate().toString(r);var e;if(r==16)e=4;else if(r==8)e=3;else if(r==2)e=1;else if(r==32)e=5;else if(r==4)e=2;else return this.toRadix(r);var t=(1<<e)-1,n,i=!1,s="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0)for(a<this.DB&&(n=this.data[o]>>a)>0&&(i=!0,s=yM(n));o>=0;)a<e?(n=(this.data[o]&(1<<a)-1)<<e-a,n|=this.data[--o]>>(a+=this.DB-e)):(n=this.data[o]>>(a-=e)&t,a<=0&&(a+=this.DB,--o)),n>0&&(i=!0),i&&(s+=yM(n));return i?s:"0"}function eme(){var r=At();return X.ZERO.subTo(this,r),r}function tme(){return this.s<0?this.negate():this}function rme(r){var e=this.s-r.s;if(e!=0)return e;var t=this.t;if(e=t-r.t,e!=0)return this.s<0?-e:e;for(;--t>=0;)if((e=this.data[t]-r.data[t])!=0)return e;return 0}function hw(r){var e=1,t;return(t=r>>>16)!=0&&(r=t,e+=16),(t=r>>8)!=0&&(r=t,e+=8),(t=r>>4)!=0&&(r=t,e+=4),(t=r>>2)!=0&&(r=t,e+=2),(t=r>>1)!=0&&(r=t,e+=1),e}function nme(){return this.t<=0?0:this.DB*(this.t-1)+hw(this.data[this.t-1]^this.s&this.DM)}function ime(r,e){var t;for(t=this.t-1;t>=0;--t)e.data[t+r]=this.data[t];for(t=r-1;t>=0;--t)e.data[t]=0;e.t=this.t+r,e.s=this.s}function sme(r,e){for(var t=r;t<this.t;++t)e.data[t-r]=this.data[t];e.t=Math.max(this.t-r,0),e.s=this.s}function ome(r,e){var t=r%this.DB,n=this.DB-t,i=(1<<n)-1,s=Math.floor(r/this.DB),o=this.s<<t&this.DM,a;for(a=this.t-1;a>=0;--a)e.data[a+s+1]=this.data[a]>>n|o,o=(this.data[a]&i)<<t;for(a=s-1;a>=0;--a)e.data[a]=0;e.data[s]=o,e.t=this.t+s+1,e.s=this.s,e.clamp()}function ame(r,e){e.s=this.s;var t=Math.floor(r/this.DB);if(t>=this.t){e.t=0;return}var n=r%this.DB,i=this.DB-n,s=(1<<n)-1;e.data[0]=this.data[t]>>n;for(var o=t+1;o<this.t;++o)e.data[o-t-1]|=(this.data[o]&s)<<i,e.data[o-t]=this.data[o]>>n;n>0&&(e.data[this.t-t-1]|=(this.s&s)<<i),e.t=this.t-t,e.clamp()}function cme(r,e){for(var t=0,n=0,i=Math.min(r.t,this.t);t<i;)n+=this.data[t]-r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;if(r.t<this.t){for(n-=r.s;t<this.t;)n+=this.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;t<r.t;)n-=r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n-=r.s}e.s=n<0?-1:0,n<-1?e.data[t++]=this.DV+n:n>0&&(e.data[t++]=n),e.t=t,e.clamp()}function lme(r,e){var t=this.abs(),n=r.abs(),i=t.t;for(e.t=i+n.t;--i>=0;)e.data[i]=0;for(i=0;i<n.t;++i)e.data[i+t.t]=t.am(0,n.data[i],e,i,0,t.t);e.s=0,e.clamp(),this.s!=r.s&&X.ZERO.subTo(e,e)}function ume(r){for(var e=this.abs(),t=r.t=2*e.t;--t>=0;)r.data[t]=0;for(t=0;t<e.t-1;++t){var n=e.am(t,e.data[t],r,2*t,0,1);(r.data[t+e.t]+=e.am(t+1,2*e.data[t],r,2*t+1,n,e.t-t-1))>=e.DV&&(r.data[t+e.t]-=e.DV,r.data[t+e.t+1]=1)}r.t>0&&(r.data[r.t-1]+=e.am(t,e.data[t],r,2*t,0,1)),r.s=0,r.clamp()}function fme(r,e,t){var n=r.abs();if(!(n.t<=0)){var i=this.abs();if(i.t<n.t){e?.fromInt(0),t!=null&&this.copyTo(t);return}t==null&&(t=At());var s=At(),o=this.s,a=r.s,c=this.DB-hw(n.data[n.t-1]);c>0?(n.lShiftTo(c,s),i.lShiftTo(c,t)):(n.copyTo(s),i.copyTo(t));var u=s.t,f=s.data[u-1];if(f!=0){var h=f*(1<<this.F1)+(u>1?s.data[u-2]>>this.F2:0),p=this.FV/h,d=(1<<this.F1)/h,m=1<<this.F2,g=t.t,y=g-u,w=e??At();for(s.dlShiftTo(y,w),t.compareTo(w)>=0&&(t.data[t.t++]=1,t.subTo(w,t)),X.ONE.dlShiftTo(u,w),w.subTo(s,s);s.t<u;)s.data[s.t++]=0;for(;--y>=0;){var b=t.data[--g]==f?this.DM:Math.floor(t.data[g]*p+(t.data[g-1]+m)*d);if((t.data[g]+=s.am(0,b,t,y,0,u))<b)for(s.dlShiftTo(y,w),t.subTo(w,t);t.data[g]<--b;)t.subTo(w,t)}e!=null&&(t.drShiftTo(u,e),o!=a&&X.ZERO.subTo(e,e)),t.t=u,t.clamp(),c>0&&t.rShiftTo(c,t),o<0&&X.ZERO.subTo(t,t)}}}function hme(r){var e=At();return this.abs().divRemTo(r,null,e),this.s<0&&e.compareTo(X.ZERO)>0&&r.subTo(e,e),e}function gh(r){this.m=r}function dme(r){return r.s<0||r.compareTo(this.m)>=0?r.mod(this.m):r}function pme(r){return r}function mme(r){r.divRemTo(this.m,null,r)}function gme(r,e,t){r.multiplyTo(e,t),this.reduce(t)}function yme(r,e){r.squareTo(e),this.reduce(e)}gh.prototype.convert=dme;gh.prototype.revert=pme;gh.prototype.reduce=mme;gh.prototype.mulTo=gme;gh.prototype.sqrTo=yme;function wme(){if(this.t<1)return 0;var r=this.data[0];if(!(r&1))return 0;var e=r&3;return e=e*(2-(r&15)*e)&15,e=e*(2-(r&255)*e)&255,e=e*(2-((r&65535)*e&65535))&65535,e=e*(2-r*e%this.DV)%this.DV,e>0?this.DV-e:-e}function yh(r){this.m=r,this.mp=r.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<r.DB-15)-1,this.mt2=2*r.t}function bme(r){var e=At();return r.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),r.s<0&&e.compareTo(X.ZERO)>0&&this.m.subTo(e,e),e}function Eme(r){var e=At();return r.copyTo(e),this.reduce(e),e}function _me(r){for(;r.t<=this.mt2;)r.data[r.t++]=0;for(var e=0;e<this.m.t;++e){var t=r.data[e]&32767,n=t*this.mpl+((t*this.mph+(r.data[e]>>15)*this.mpl&this.um)<<15)&r.DM;for(t=e+this.m.t,r.data[t]+=this.m.am(0,n,r,e,0,this.m.t);r.data[t]>=r.DV;)r.data[t]-=r.DV,r.data[++t]++}r.clamp(),r.drShiftTo(this.m.t,r),r.compareTo(this.m)>=0&&r.subTo(this.m,r)}function vme(r,e){r.squareTo(e),this.reduce(e)}function Sme(r,e,t){r.multiplyTo(e,t),this.reduce(t)}yh.prototype.convert=bme;yh.prototype.revert=Eme;yh.prototype.reduce=_me;yh.prototype.mulTo=Sme;yh.prototype.sqrTo=vme;function xme(){return(this.t>0?this.data[0]&1:this.s)==0}function Ame(r,e){if(r>4294967295||r<1)return X.ONE;var t=At(),n=At(),i=e.convert(this),s=hw(r)-1;for(i.copyTo(t);--s>=0;)if(e.sqrTo(t,n),(r&1<<s)>0)e.mulTo(n,i,t);else{var o=t;t=n,n=o}return e.revert(t)}function Tme(r,e){var t;return r<256||e.isEven()?t=new gh(e):t=new yh(e),this.exp(r,t)}X.prototype.copyTo=Y1e;X.prototype.fromInt=Q1e;X.prototype.fromString=X1e;X.prototype.clamp=Z1e;X.prototype.dlShiftTo=ime;X.prototype.drShiftTo=sme;X.prototype.lShiftTo=ome;X.prototype.rShiftTo=ame;X.prototype.subTo=cme;X.prototype.multiplyTo=lme;X.prototype.squareTo=ume;X.prototype.divRemTo=fme;X.prototype.invDigit=wme;X.prototype.isEven=xme;X.prototype.exp=Ame;X.prototype.toString=J1e;X.prototype.negate=eme;X.prototype.abs=tme;X.prototype.compareTo=rme;X.prototype.bitLength=nme;X.prototype.mod=hme;X.prototype.modPowInt=Tme;X.ZERO=_u(0);X.ONE=_u(1);function Ime(){var r=At();return this.copyTo(r),r}function Rme(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function Cme(){return this.t==0?this.s:this.data[0]<<24>>24}function Pme(){return this.t==0?this.s:this.data[0]<<16>>16}function kme(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function Ome(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function Nme(r){if(r==null&&(r=10),this.signum()==0||r<2||r>36)return"0";var e=this.chunkSize(r),t=Math.pow(r,e),n=_u(t),i=At(),s=At(),o="";for(this.divRemTo(n,i,s);i.signum()>0;)o=(t+s.intValue()).toString(r).substr(1)+o,i.divRemTo(n,i,s);return s.intValue().toString(r)+o}function Dme(r,e){this.fromInt(0),e==null&&(e=10);for(var t=this.chunkSize(e),n=Math.pow(e,t),i=!1,s=0,o=0,a=0;a<r.length;++a){var c=wM(r,a);if(c<0){r.charAt(a)=="-"&&this.signum()==0&&(i=!0);continue}o=e*o+c,++s>=t&&(this.dMultiply(n),this.dAddOffset(o,0),s=0,o=0)}s>0&&(this.dMultiply(Math.pow(e,s)),this.dAddOffset(o,0)),i&&X.ZERO.subTo(this,this)}function Lme(r,e,t){if(typeof e=="number")if(r<2)this.fromInt(1);else for(this.fromNumber(r,t),this.testBit(r-1)||this.bitwiseTo(X.ONE.shiftLeft(r-1),Mv,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>r&&this.subTo(X.ONE.shiftLeft(r-1),this);else{var n=new Array,i=r&7;n.length=(r>>3)+1,e.nextBytes(n),i>0?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}}function Bme(){var r=this.t,e=new Array;e[0]=this.s;var t=this.DB-r*this.DB%8,n,i=0;if(r-- >0)for(t<this.DB&&(n=this.data[r]>>t)!=(this.s&this.DM)>>t&&(e[i++]=n|this.s<<this.DB-t);r>=0;)t<8?(n=(this.data[r]&(1<<t)-1)<<8-t,n|=this.data[--r]>>(t+=this.DB-8)):(n=this.data[r]>>(t-=8)&255,t<=0&&(t+=this.DB,--r)),n&128&&(n|=-256),i==0&&(this.s&128)!=(n&128)&&++i,(i>0||n!=this.s)&&(e[i++]=n);return e}function Ume(r){return this.compareTo(r)==0}function Mme(r){return this.compareTo(r)<0?this:r}function Fme(r){return this.compareTo(r)>0?this:r}function Vme(r,e,t){var n,i,s=Math.min(r.t,this.t);for(n=0;n<s;++n)t.data[n]=e(this.data[n],r.data[n]);if(r.t<this.t){for(i=r.s&this.DM,n=s;n<this.t;++n)t.data[n]=e(this.data[n],i);t.t=this.t}else{for(i=this.s&this.DM,n=s;n<r.t;++n)t.data[n]=e(i,r.data[n]);t.t=r.t}t.s=e(this.s,r.s),t.clamp()}function zme(r,e){return r&e}function Kme(r){var e=At();return this.bitwiseTo(r,zme,e),e}function Mv(r,e){return r|e}function qme(r){var e=At();return this.bitwiseTo(r,Mv,e),e}function bM(r,e){return r^e}function $me(r){var e=At();return this.bitwiseTo(r,bM,e),e}function EM(r,e){return r&~e}function Hme(r){var e=At();return this.bitwiseTo(r,EM,e),e}function Gme(){for(var r=At(),e=0;e<this.t;++e)r.data[e]=this.DM&~this.data[e];return r.t=this.t,r.s=~this.s,r}function jme(r){var e=At();return r<0?this.rShiftTo(-r,e):this.lShiftTo(r,e),e}function Wme(r){var e=At();return r<0?this.lShiftTo(-r,e):this.rShiftTo(r,e),e}function Yme(r){if(r==0)return-1;var e=0;return r&65535||(r>>=16,e+=16),r&255||(r>>=8,e+=8),r&15||(r>>=4,e+=4),r&3||(r>>=2,e+=2),r&1||++e,e}function Qme(){for(var r=0;r<this.t;++r)if(this.data[r]!=0)return r*this.DB+Yme(this.data[r]);return this.s<0?this.t*this.DB:-1}function Xme(r){for(var e=0;r!=0;)r&=r-1,++e;return e}function Zme(){for(var r=0,e=this.s&this.DM,t=0;t<this.t;++t)r+=Xme(this.data[t]^e);return r}function Jme(r){var e=Math.floor(r/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<r%this.DB)!=0}function e2e(r,e){var t=X.ONE.shiftLeft(r);return this.bitwiseTo(t,e,t),t}function t2e(r){return this.changeBit(r,Mv)}function r2e(r){return this.changeBit(r,EM)}function n2e(r){return this.changeBit(r,bM)}function i2e(r,e){for(var t=0,n=0,i=Math.min(r.t,this.t);t<i;)n+=this.data[t]+r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;if(r.t<this.t){for(n+=r.s;t<this.t;)n+=this.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;t<r.t;)n+=r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n+=r.s}e.s=n<0?-1:0,n>0?e.data[t++]=n:n<-1&&(e.data[t++]=this.DV+n),e.t=t,e.clamp()}function s2e(r){var e=At();return this.addTo(r,e),e}function o2e(r){var e=At();return this.subTo(r,e),e}function a2e(r){var e=At();return this.multiplyTo(r,e),e}function c2e(r){var e=At();return this.divRemTo(r,e,null),e}function l2e(r){var e=At();return this.divRemTo(r,null,e),e}function u2e(r){var e=At(),t=At();return this.divRemTo(r,e,t),new Array(e,t)}function f2e(r){this.data[this.t]=this.am(0,r-1,this,0,0,this.t),++this.t,this.clamp()}function h2e(r,e){if(r!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=r;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function s2(){}function _M(r){return r}function d2e(r,e,t){r.multiplyTo(e,t)}function p2e(r,e){r.squareTo(e)}s2.prototype.convert=_M;s2.prototype.revert=_M;s2.prototype.mulTo=d2e;s2.prototype.sqrTo=p2e;function m2e(r){return this.exp(r,new s2)}function g2e(r,e,t){var n=Math.min(this.t+r.t,e);for(t.s=0,t.t=n;n>0;)t.data[--n]=0;var i;for(i=t.t-this.t;n<i;++n)t.data[n+this.t]=this.am(0,r.data[n],t,n,0,this.t);for(i=Math.min(r.t,e);n<i;++n)this.am(0,r.data[n],t,n,0,e-n);t.clamp()}function y2e(r,e,t){--e;var n=t.t=this.t+r.t-e;for(t.s=0;--n>=0;)t.data[n]=0;for(n=Math.max(e-this.t,0);n<r.t;++n)t.data[this.t+n-e]=this.am(e-n,r.data[n],t,0,0,this.t+n-e);t.clamp(),t.drShiftTo(1,t)}function Wp(r){this.r2=At(),this.q3=At(),X.ONE.dlShiftTo(2*r.t,this.r2),this.mu=this.r2.divide(r),this.m=r}function w2e(r){if(r.s<0||r.t>2*this.m.t)return r.mod(this.m);if(r.compareTo(this.m)<0)return r;var e=At();return r.copyTo(e),this.reduce(e),e}function b2e(r){return r}function E2e(r){for(r.drShiftTo(this.m.t-1,this.r2),r.t>this.m.t+1&&(r.t=this.m.t+1,r.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);r.compareTo(this.r2)<0;)r.dAddOffset(1,this.m.t+1);for(r.subTo(this.r2,r);r.compareTo(this.m)>=0;)r.subTo(this.m,r)}function _2e(r,e){r.squareTo(e),this.reduce(e)}function v2e(r,e,t){r.multiplyTo(e,t),this.reduce(t)}Wp.prototype.convert=w2e;Wp.prototype.revert=b2e;Wp.prototype.reduce=E2e;Wp.prototype.mulTo=v2e;Wp.prototype.sqrTo=_2e;function S2e(r,e){var t=r.bitLength(),n,i=_u(1),s;if(t<=0)return i;t<18?n=1:t<48?n=3:t<144?n=4:t<768?n=5:n=6,t<8?s=new gh(e):e.isEven()?s=new Wp(e):s=new yh(e);var o=new Array,a=3,c=n-1,u=(1<<n)-1;if(o[1]=s.convert(this),n>1){var f=At();for(s.sqrTo(o[1],f);a<=u;)o[a]=At(),s.mulTo(f,o[a-2],o[a]),a+=2}var h=r.t-1,p,d=!0,m=At(),g;for(t=hw(r.data[h])-1;h>=0;){for(t>=c?p=r.data[h]>>t-c&u:(p=(r.data[h]&(1<<t+1)-1)<<c-t,h>0&&(p|=r.data[h-1]>>this.DB+t-c)),a=n;!(p&1);)p>>=1,--a;if((t-=a)<0&&(t+=this.DB,--h),d)o[p].copyTo(i),d=!1;else{for(;a>1;)s.sqrTo(i,m),s.sqrTo(m,i),a-=2;a>0?s.sqrTo(i,m):(g=i,i=m,m=g),s.mulTo(m,o[p],i)}for(;h>=0&&!(r.data[h]&1<<t);)s.sqrTo(i,m),g=i,i=m,m=g,--t<0&&(t=this.DB-1,--h)}return s.revert(i)}function x2e(r){var e=this.s<0?this.negate():this.clone(),t=r.s<0?r.negate():r.clone();if(e.compareTo(t)<0){var n=e;e=t,t=n}var i=e.getLowestSetBit(),s=t.getLowestSetBit();if(s<0)return e;for(i<s&&(s=i),s>0&&(e.rShiftTo(s,e),t.rShiftTo(s,t));e.signum()>0;)(i=e.getLowestSetBit())>0&&e.rShiftTo(i,e),(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),e.compareTo(t)>=0?(e.subTo(t,e),e.rShiftTo(1,e)):(t.subTo(e,t),t.rShiftTo(1,t));return s>0&&t.lShiftTo(s,t),t}function A2e(r){if(r<=0)return 0;var e=this.DV%r,t=this.s<0?r-1:0;if(this.t>0)if(e==0)t=this.data[0]%r;else for(var n=this.t-1;n>=0;--n)t=(e*t+this.data[n])%r;return t}function T2e(r){var e=r.isEven();if(this.isEven()&&e||r.signum()==0)return X.ZERO;for(var t=r.clone(),n=this.clone(),i=_u(1),s=_u(0),o=_u(0),a=_u(1);t.signum()!=0;){for(;t.isEven();)t.rShiftTo(1,t),e?((!i.isEven()||!s.isEven())&&(i.addTo(this,i),s.subTo(r,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(r,s),s.rShiftTo(1,s);for(;n.isEven();)n.rShiftTo(1,n),e?((!o.isEven()||!a.isEven())&&(o.addTo(this,o),a.subTo(r,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(r,a),a.rShiftTo(1,a);t.compareTo(n)>=0?(t.subTo(n,t),e&&i.subTo(o,i),s.subTo(a,s)):(n.subTo(t,n),e&&o.subTo(i,o),a.subTo(s,a))}if(n.compareTo(X.ONE)!=0)return X.ZERO;if(a.compareTo(r)>=0)return a.subtract(r);if(a.signum()<0)a.addTo(r,a);else return a;return a.signum()<0?a.add(r):a}var No=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],I2e=(1<<26)/No[No.length-1];function R2e(r){var e,t=this.abs();if(t.t==1&&t.data[0]<=No[No.length-1]){for(e=0;e<No.length;++e)if(t.data[0]==No[e])return!0;return!1}if(t.isEven())return!1;for(e=1;e<No.length;){for(var n=No[e],i=e+1;i<No.length&&n<I2e;)n*=No[i++];for(n=t.modInt(n);e<i;)if(n%No[e++]==0)return!1}return t.millerRabin(r)}function C2e(r){var e=this.subtract(X.ONE),t=e.getLowestSetBit();if(t<=0)return!1;for(var n=e.shiftRight(t),i=P2e(),s,o=0;o<r;++o){do s=new X(this.bitLength(),i);while(s.compareTo(X.ONE)<=0||s.compareTo(e)>=0);var a=s.modPow(n,this);if(a.compareTo(X.ONE)!=0&&a.compareTo(e)!=0){for(var c=1;c++<t&&a.compareTo(e)!=0;)if(a=a.modPowInt(2,this),a.compareTo(X.ONE)==0)return!1;if(a.compareTo(e)!=0)return!1}}return!0}function P2e(){return{nextBytes:function(r){for(var e=0;e<r.length;++e)r[e]=Math.floor(Math.random()*256)}}}X.prototype.chunkSize=kme;X.prototype.toRadix=Nme;X.prototype.fromRadix=Dme;X.prototype.fromNumber=Lme;X.prototype.bitwiseTo=Vme;X.prototype.changeBit=e2e;X.prototype.addTo=i2e;X.prototype.dMultiply=f2e;X.prototype.dAddOffset=h2e;X.prototype.multiplyLowerTo=g2e;X.prototype.multiplyUpperTo=y2e;X.prototype.modInt=A2e;X.prototype.millerRabin=C2e;X.prototype.clone=Ime;X.prototype.intValue=Rme;X.prototype.byteValue=Cme;X.prototype.shortValue=Pme;X.prototype.signum=Ome;X.prototype.toByteArray=Bme;X.prototype.equals=Ume;X.prototype.min=Mme;X.prototype.max=Fme;X.prototype.and=Kme;X.prototype.or=qme;X.prototype.xor=$me;X.prototype.andNot=Hme;X.prototype.not=Gme;X.prototype.shiftLeft=jme;X.prototype.shiftRight=Wme;X.prototype.getLowestSetBit=Qme;X.prototype.bitCount=Zme;X.prototype.testBit=Jme;X.prototype.setBit=t2e;X.prototype.clearBit=r2e;X.prototype.flipBit=n2e;X.prototype.add=s2e;X.prototype.subtract=o2e;X.prototype.multiply=a2e;X.prototype.divide=c2e;X.prototype.remainder=l2e;X.prototype.divideAndRemainder=u2e;X.prototype.modPow=S2e;X.prototype.modInverse=T2e;X.prototype.pow=m2e;X.prototype.gcd=x2e;X.prototype.isProbablePrime=R2e});var IM=P((IVe,TM)=>{l();var Sa=Je();bu();hr();var xM=TM.exports=Sa.sha1=Sa.sha1||{};Sa.md.sha1=Sa.md.algorithms.sha1=xM;xM.create=function(){AM||k2e();var r=null,e=Sa.util.createBuffer(),t=new Array(80),n={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var i=n.messageLengthSize/4,s=0;s<i;++s)n.fullMessageLength.push(0);return e=Sa.util.createBuffer(),r={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},n},n.start(),n.update=function(i,s){s==="utf8"&&(i=Sa.util.encodeUtf8(i));var o=i.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(i),SM(r,t,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var i=Sa.util.createBuffer();i.putBytes(e.bytes());var s=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=s&n.blockLength-1;i.putBytes(Fv.substr(0,n.blockLength-o));for(var a,c,u=n.fullMessageLength[0]*8,f=0;f<n.fullMessageLength.length-1;++f)a=n.fullMessageLength[f+1]*8,c=a/4294967296>>>0,u+=c,i.putInt32(u>>>0),u=a>>>0;i.putInt32(u);var h={h0:r.h0,h1:r.h1,h2:r.h2,h3:r.h3,h4:r.h4};SM(h,t,i);var p=Sa.util.createBuffer();return p.putInt32(h.h0),p.putInt32(h.h1),p.putInt32(h.h2),p.putInt32(h.h3),p.putInt32(h.h4),p},n};var Fv=null,AM=!1;function k2e(){Fv=String.fromCharCode(128),Fv+=Sa.util.fillString(String.fromCharCode(0),64),AM=!0}function SM(r,e,t){for(var n,i,s,o,a,c,u,f,h=t.length();h>=64;){for(i=r.h0,s=r.h1,o=r.h2,a=r.h3,c=r.h4,f=0;f<16;++f)n=t.getInt32(),e[f]=n,u=a^s&(o^a),n=(i<<5|i>>>27)+u+c+1518500249+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;f<20;++f)n=e[f-3]^e[f-8]^e[f-14]^e[f-16],n=n<<1|n>>>31,e[f]=n,u=a^s&(o^a),n=(i<<5|i>>>27)+u+c+1518500249+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;f<32;++f)n=e[f-3]^e[f-8]^e[f-14]^e[f-16],n=n<<1|n>>>31,e[f]=n,u=s^o^a,n=(i<<5|i>>>27)+u+c+1859775393+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;f<40;++f)n=e[f-6]^e[f-16]^e[f-28]^e[f-32],n=n<<2|n>>>30,e[f]=n,u=s^o^a,n=(i<<5|i>>>27)+u+c+1859775393+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;f<60;++f)n=e[f-6]^e[f-16]^e[f-28]^e[f-32],n=n<<2|n>>>30,e[f]=n,u=s&o|a&(s^o),n=(i<<5|i>>>27)+u+c+2400959708+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;f<80;++f)n=e[f-6]^e[f-16]^e[f-28]^e[f-32],n=n<<2|n>>>30,e[f]=n,u=s^o^a,n=(i<<5|i>>>27)+u+c+3395469782+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;r.h0=r.h0+i|0,r.h1=r.h1+s|0,r.h2=r.h2+o|0,r.h3=r.h3+a|0,r.h4=r.h4+c|0,h-=64}}});var PM=P((CVe,CM)=>{l();var xa=Je();hr();mh();IM();var RM=CM.exports=xa.pkcs1=xa.pkcs1||{};RM.encode_rsa_oaep=function(r,e,t){var n,i,s,o;typeof t=="string"?(n=t,i=arguments[3]||void 0,s=arguments[4]||void 0):t&&(n=t.label||void 0,i=t.seed||void 0,s=t.md||void 0,t.mgf1&&t.mgf1.md&&(o=t.mgf1.md)),s?s.start():s=xa.md.sha1.create(),o||(o=s);var a=Math.ceil(r.n.bitLength()/8),c=a-2*s.digestLength-2;if(e.length>c){var u=new Error("RSAES-OAEP input message length is too long.");throw u.length=e.length,u.maxLength=c,u}n||(n=""),s.update(n,"raw");for(var f=s.digest(),h="",p=c-e.length,d=0;d<p;d++)h+="\0";var m=f.getBytes()+h+""+e;if(!i)i=xa.random.getBytes(s.digestLength);else if(i.length!==s.digestLength){var u=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw u.seedLength=i.length,u.digestLength=s.digestLength,u}var g=pw(i,a-s.digestLength-1,o),y=xa.util.xorBytes(m,g,m.length),w=pw(y,s.digestLength,o),b=xa.util.xorBytes(i,w,i.length);return"\0"+b+y};RM.decode_rsa_oaep=function(r,e,t){var n,i,s;typeof t=="string"?(n=t,i=arguments[3]||void 0):t&&(n=t.label||void 0,i=t.md||void 0,t.mgf1&&t.mgf1.md&&(s=t.mgf1.md));var o=Math.ceil(r.n.bitLength()/8);if(e.length!==o){var y=new Error("RSAES-OAEP encoded message length is invalid.");throw y.length=e.length,y.expectedLength=o,y}if(i===void 0?i=xa.md.sha1.create():i.start(),s||(s=i),o<2*i.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");n||(n=""),i.update(n,"raw");for(var a=i.digest().getBytes(),c=e.charAt(0),u=e.substring(1,i.digestLength+1),f=e.substring(1+i.digestLength),h=pw(f,i.digestLength,s),p=xa.util.xorBytes(u,h,u.length),d=pw(p,o-i.digestLength-1,s),m=xa.util.xorBytes(f,d,f.length),g=m.substring(0,i.digestLength),y=c!=="\0",w=0;w<i.digestLength;++w)y|=a.charAt(w)!==g.charAt(w);for(var b=1,_=i.digestLength,v=i.digestLength;v<m.length;v++){var I=m.charCodeAt(v),x=I&1^1,A=b?65534:0;y|=I&A,b=b&x,_+=b}if(y||m.charCodeAt(_)!==1)throw new Error("Invalid RSAES-OAEP padding.");return m.substring(_+1)};function pw(r,e,t){t||(t=xa.md.sha1.create());for(var n="",i=Math.ceil(e/t.digestLength),s=0;s<i;++s){var o=String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255);t.start(),t.update(r+o),n+=t.digest().getBytes()}return n.substring(0,e)}});var kM=P((kVe,Vv)=>{l();var vu=Je();hr();dw();mh();(function(){if(vu.prime){Vv.exports=vu.prime;return}var r=Vv.exports=vu.prime=vu.prime||{},e=vu.jsbn.BigInteger,t=[6,4,2,4,2,4,6,2],n=new e(null);n.fromInt(30);var i=function(h,p){return h|p};r.generateProbablePrime=function(h,p,d){typeof p=="function"&&(d=p,p={}),p=p||{};var m=p.algorithm||"PRIMEINC";typeof m=="string"&&(m={name:m}),m.options=m.options||{};var g=p.prng||vu.random,y={nextBytes:function(w){for(var b=g.getBytesSync(w.length),_=0;_<w.length;++_)w[_]=b.charCodeAt(_)}};if(m.name==="PRIMEINC")return s(h,y,m.options,d);throw new Error("Invalid prime generation algorithm: "+m.name)};function s(h,p,d,m){return"workers"in d?c(h,p,d,m):o(h,p,d,m)}function o(h,p,d,m){var g=u(h,p),y=0,w=f(g.bitLength());"millerRabinTests"in d&&(w=d.millerRabinTests);var b=10;"maxBlockTime"in d&&(b=d.maxBlockTime),a(g,h,p,y,w,b,m)}function a(h,p,d,m,g,y,w){var b=+new Date;do{if(h.bitLength()>p&&(h=u(p,d)),h.isProbablePrime(g))return w(null,h);h.dAddOffset(t[m++%8],0)}while(y<0||+new Date-b<y);vu.util.setImmediate(function(){a(h,p,d,m,g,y,w)})}function c(h,p,d,m){if(typeof Worker>"u")return o(h,p,d,m);var g=u(h,p),y=d.workers,w=d.workLoad||100,b=w*30/8,_=d.workerScript||"forge/prime.worker.js";if(y===-1)return vu.util.estimateCores(function(I,x){I&&(x=2),y=x-1,v()});v();function v(){y=Math.max(1,y);for(var I=[],x=0;x<y;++x)I[x]=new Worker(_);for(var A=y,x=0;x<y;++x)I[x].addEventListener("message",O);var R=!1;function O(V){if(!R){--A;var $=V.data;if($.found){for(var Y=0;Y<I.length;++Y)I[Y].terminate();return R=!0,m(null,new e($.prime,16))}g.bitLength()>h&&(g=u(h,p));var Q=g.toString(16);V.target.postMessage({hex:Q,workLoad:w}),g.dAddOffset(b,0)}}}}function u(h,p){var d=new e(h,p),m=h-1;return d.testBit(m)||d.bitwiseTo(e.ONE.shiftLeft(m),i,d),d.dAddOffset(31-d.mod(n).byteValue(),0),d}function f(h){return h<=100?27:h<=150?18:h<=200?15:h<=250?12:h<=300?9:h<=350?8:h<=400?7:h<=500?6:h<=600?5:h<=800?4:h<=1250?3:2}})()});var o2=P((NVe,MM)=>{l();var Oe=Je();wu();dw();qp();PM();kM();mh();hr();typeof gt>"u"&&(gt=Oe.jsbn.BigInteger);var gt,zv=Oe.util.isNodejs?Eu():null,q=Oe.asn1,Hs=Oe.util;Oe.pki=Oe.pki||{};MM.exports=Oe.pki.rsa=Oe.rsa=Oe.rsa||{};var $e=Oe.pki,O2e=[6,4,2,4,2,4,6,2],N2e={name:"PrivateKeyInfo",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:q.Class.UNIVERSAL,type:q.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:q.Class.UNIVERSAL,type:q.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},D2e={name:"RSAPrivateKey",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},L2e={name:"RSAPublicKey",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},B2e=Oe.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:q.Class.UNIVERSAL,type:q.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:q.Class.UNIVERSAL,type:q.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},U2e={name:"DigestInfo",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:q.Class.UNIVERSAL,type:q.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:q.Class.UNIVERSAL,type:q.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:q.Class.UNIVERSAL,type:q.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},M2e=function(r){var e;if(r.algorithm in $e.oids)e=$e.oids[r.algorithm];else{var t=new Error("Unknown message digest algorithm.");throw t.algorithm=r.algorithm,t}var n=q.oidToDer(e).getBytes(),i=q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[]),s=q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[]);s.value.push(q.create(q.Class.UNIVERSAL,q.Type.OID,!1,n)),s.value.push(q.create(q.Class.UNIVERSAL,q.Type.NULL,!1,""));var o=q.create(q.Class.UNIVERSAL,q.Type.OCTETSTRING,!1,r.digest().getBytes());return i.value.push(s),i.value.push(o),q.toDer(i).getBytes()},BM=function(r,e,t){if(t)return r.modPow(e.e,e.n);if(!e.p||!e.q)return r.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(gt.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(gt.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var n;do n=new gt(Oe.util.bytesToHex(Oe.random.getBytes(e.n.bitLength()/8)),16);while(n.compareTo(e.n)>=0||!n.gcd(e.n).equals(gt.ONE));r=r.multiply(n.modPow(e.e,e.n)).mod(e.n);for(var i=r.mod(e.p).modPow(e.dP,e.p),s=r.mod(e.q).modPow(e.dQ,e.q);i.compareTo(s)<0;)i=i.add(e.p);var o=i.subtract(s).multiply(e.qInv).mod(e.p).multiply(e.q).add(s);return o=o.multiply(n.modInverse(e.n)).mod(e.n),o};$e.rsa.encrypt=function(r,e,t){var n=t,i,s=Math.ceil(e.n.bitLength()/8);t!==!1&&t!==!0?(n=t===2,i=UM(r,e,t)):(i=Oe.util.createBuffer(),i.putBytes(r));for(var o=new gt(i.toHex(),16),a=BM(o,e,n),c=a.toString(16),u=Oe.util.createBuffer(),f=s-Math.ceil(c.length/2);f>0;)u.putByte(0),--f;return u.putBytes(Oe.util.hexToBytes(c)),u.getBytes()};$e.rsa.decrypt=function(r,e,t,n){var i=Math.ceil(e.n.bitLength()/8);if(r.length!==i){var s=new Error("Encrypted message length is invalid.");throw s.length=r.length,s.expected=i,s}var o=new gt(Oe.util.createBuffer(r).toHex(),16);if(o.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var a=BM(o,e,t),c=a.toString(16),u=Oe.util.createBuffer(),f=i-Math.ceil(c.length/2);f>0;)u.putByte(0),--f;return u.putBytes(Oe.util.hexToBytes(c)),n!==!1?mw(u.getBytes(),e,t):u.getBytes()};$e.rsa.createKeyPairGenerationState=function(r,e,t){typeof r=="string"&&(r=parseInt(r,10)),r=r||2048,t=t||{};var n=t.prng||Oe.random,i={nextBytes:function(a){for(var c=n.getBytesSync(a.length),u=0;u<a.length;++u)a[u]=c.charCodeAt(u)}},s=t.algorithm||"PRIMEINC",o;if(s==="PRIMEINC")o={algorithm:s,state:0,bits:r,rng:i,eInt:e||65537,e:new gt(null),p:null,q:null,qBits:r>>1,pBits:r-(r>>1),pqState:0,num:null,keys:null},o.e.fromInt(o.eInt);else throw new Error("Invalid key generation algorithm: "+s);return o};$e.rsa.stepKeyPairGenerationState=function(r,e){"algorithm"in r||(r.algorithm="PRIMEINC");var t=new gt(null);t.fromInt(30);for(var n=0,i=function(h,p){return h|p},s=+new Date,o,a=0;r.keys===null&&(e<=0||a<e);){if(r.state===0){var c=r.p===null?r.pBits:r.qBits,u=c-1;r.pqState===0?(r.num=new gt(c,r.rng),r.num.testBit(u)||r.num.bitwiseTo(gt.ONE.shiftLeft(u),i,r.num),r.num.dAddOffset(31-r.num.mod(t).byteValue(),0),n=0,++r.pqState):r.pqState===1?r.num.bitLength()>c?r.pqState=0:r.num.isProbablePrime(V2e(r.num.bitLength()))?++r.pqState:r.num.dAddOffset(O2e[n++%8],0):r.pqState===2?r.pqState=r.num.subtract(gt.ONE).gcd(r.e).compareTo(gt.ONE)===0?3:0:r.pqState===3&&(r.pqState=0,r.p===null?r.p=r.num:r.q=r.num,r.p!==null&&r.q!==null&&++r.state,r.num=null)}else if(r.state===1)r.p.compareTo(r.q)<0&&(r.num=r.p,r.p=r.q,r.q=r.num),++r.state;else if(r.state===2)r.p1=r.p.subtract(gt.ONE),r.q1=r.q.subtract(gt.ONE),r.phi=r.p1.multiply(r.q1),++r.state;else if(r.state===3)r.phi.gcd(r.e).compareTo(gt.ONE)===0?++r.state:(r.p=null,r.q=null,r.state=0);else if(r.state===4)r.n=r.p.multiply(r.q),r.n.bitLength()===r.bits?++r.state:(r.q=null,r.state=0);else if(r.state===5){var f=r.e.modInverse(r.phi);r.keys={privateKey:$e.rsa.setPrivateKey(r.n,r.e,f,r.p,r.q,f.mod(r.p1),f.mod(r.q1),r.q.modInverse(r.p)),publicKey:$e.rsa.setPublicKey(r.n,r.e)}}o=+new Date,a+=o-s,s=o}return r.keys!==null};$e.rsa.generateKeyPair=function(r,e,t,n){if(arguments.length===1?typeof r=="object"?(t=r,r=void 0):typeof r=="function"&&(n=r,r=void 0):arguments.length===2?typeof r=="number"?typeof e=="function"?(n=e,e=void 0):typeof e!="number"&&(t=e,e=void 0):(t=r,n=e,r=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof t=="function"&&(n=t,t=void 0):(n=t,t=e,e=void 0)),t=t||{},r===void 0&&(r=t.bits||2048),e===void 0&&(e=t.e||65537),!Oe.options.usePureJavaScript&&!t.prng&&r>=256&&r<=16384&&(e===65537||e===3)){if(n){if(OM("generateKeyPair"))return zv.generateKeyPair("rsa",{modulusLength:r,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(a,c,u){if(a)return n(a);n(null,{privateKey:$e.privateKeyFromPem(u),publicKey:$e.publicKeyFromPem(c)})});if(NM("generateKey")&&NM("exportKey"))return Hs.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:LM(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(a){return Hs.globalScope.crypto.subtle.exportKey("pkcs8",a.privateKey)}).then(void 0,function(a){n(a)}).then(function(a){if(a){var c=$e.privateKeyFromAsn1(q.fromDer(Oe.util.createBuffer(a)));n(null,{privateKey:c,publicKey:$e.setRsaPublicKey(c.n,c.e)})}});if(DM("generateKey")&&DM("exportKey")){var i=Hs.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:LM(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);i.oncomplete=function(a){var c=a.target.result,u=Hs.globalScope.msCrypto.subtle.exportKey("pkcs8",c.privateKey);u.oncomplete=function(f){var h=f.target.result,p=$e.privateKeyFromAsn1(q.fromDer(Oe.util.createBuffer(h)));n(null,{privateKey:p,publicKey:$e.setRsaPublicKey(p.n,p.e)})},u.onerror=function(f){n(f)}},i.onerror=function(a){n(a)};return}}else if(OM("generateKeyPairSync")){var s=zv.generateKeyPairSync("rsa",{modulusLength:r,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:$e.privateKeyFromPem(s.privateKey),publicKey:$e.publicKeyFromPem(s.publicKey)}}}var o=$e.rsa.createKeyPairGenerationState(r,e,t);if(!n)return $e.rsa.stepKeyPairGenerationState(o,0),o.keys;F2e(o,t,n)};$e.setRsaPublicKey=$e.rsa.setPublicKey=function(r,e){var t={n:r,e};return t.encrypt=function(n,i,s){if(typeof i=="string"?i=i.toUpperCase():i===void 0&&(i="RSAES-PKCS1-V1_5"),i==="RSAES-PKCS1-V1_5")i={encode:function(a,c,u){return UM(a,c,2).getBytes()}};else if(i==="RSA-OAEP"||i==="RSAES-OAEP")i={encode:function(a,c){return Oe.pkcs1.encode_rsa_oaep(c,a,s)}};else if(["RAW","NONE","NULL",null].indexOf(i)!==-1)i={encode:function(a){return a}};else if(typeof i=="string")throw new Error('Unsupported encryption scheme: "'+i+'".');var o=i.encode(n,t,!0);return $e.rsa.encrypt(o,t,!0)},t.verify=function(n,i,s,o){typeof s=="string"?s=s.toUpperCase():s===void 0&&(s="RSASSA-PKCS1-V1_5"),o===void 0&&(o={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in o||(o._parseAllDigestBytes=!0),s==="RSASSA-PKCS1-V1_5"?s={verify:function(c,u){u=mw(u,t,!0);var f=q.fromDer(u,{parseAllBytes:o._parseAllDigestBytes}),h={},p=[];if(!q.validate(f,U2e,h,p)){var d=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw d.errors=p,d}var m=q.derToOid(h.algorithmIdentifier);if(!(m===Oe.oids.md2||m===Oe.oids.md5||m===Oe.oids.sha1||m===Oe.oids.sha224||m===Oe.oids.sha256||m===Oe.oids.sha384||m===Oe.oids.sha512||m===Oe.oids["sha512-224"]||m===Oe.oids["sha512-256"])){var d=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw d.oid=m,d}if((m===Oe.oids.md2||m===Oe.oids.md5)&&!("parameters"in h))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return c===h.digest}}:(s==="NONE"||s==="NULL"||s===null)&&(s={verify:function(c,u){return u=mw(u,t,!0),c===u}});var a=$e.rsa.decrypt(i,t,!0,!1);return s.verify(n,a,t.n.bitLength())},t};$e.setRsaPrivateKey=$e.rsa.setPrivateKey=function(r,e,t,n,i,s,o,a){var c={n:r,e,d:t,p:n,q:i,dP:s,dQ:o,qInv:a};return c.decrypt=function(u,f,h){typeof f=="string"?f=f.toUpperCase():f===void 0&&(f="RSAES-PKCS1-V1_5");var p=$e.rsa.decrypt(u,c,!1,!1);if(f==="RSAES-PKCS1-V1_5")f={decode:mw};else if(f==="RSA-OAEP"||f==="RSAES-OAEP")f={decode:function(d,m){return Oe.pkcs1.decode_rsa_oaep(m,d,h)}};else if(["RAW","NONE","NULL",null].indexOf(f)!==-1)f={decode:function(d){return d}};else throw new Error('Unsupported encryption scheme: "'+f+'".');return f.decode(p,c,!1)},c.sign=function(u,f){var h=!1;typeof f=="string"&&(f=f.toUpperCase()),f===void 0||f==="RSASSA-PKCS1-V1_5"?(f={encode:M2e},h=1):(f==="NONE"||f==="NULL"||f===null)&&(f={encode:function(){return u}},h=1);var p=f.encode(u,c.n.bitLength());return $e.rsa.encrypt(p,c,h)},c};$e.wrapRsaPrivateKey=function(r){return q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,q.integerToDer(0).getBytes()),q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[q.create(q.Class.UNIVERSAL,q.Type.OID,!1,q.oidToDer($e.oids.rsaEncryption).getBytes()),q.create(q.Class.UNIVERSAL,q.Type.NULL,!1,"")]),q.create(q.Class.UNIVERSAL,q.Type.OCTETSTRING,!1,q.toDer(r).getBytes())])};$e.privateKeyFromAsn1=function(r){var e={},t=[];if(q.validate(r,N2e,e,t)&&(r=q.fromDer(Oe.util.createBuffer(e.privateKey))),e={},t=[],!q.validate(r,D2e,e,t)){var n=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw n.errors=t,n}var i,s,o,a,c,u,f,h;return i=Oe.util.createBuffer(e.privateKeyModulus).toHex(),s=Oe.util.createBuffer(e.privateKeyPublicExponent).toHex(),o=Oe.util.createBuffer(e.privateKeyPrivateExponent).toHex(),a=Oe.util.createBuffer(e.privateKeyPrime1).toHex(),c=Oe.util.createBuffer(e.privateKeyPrime2).toHex(),u=Oe.util.createBuffer(e.privateKeyExponent1).toHex(),f=Oe.util.createBuffer(e.privateKeyExponent2).toHex(),h=Oe.util.createBuffer(e.privateKeyCoefficient).toHex(),$e.setRsaPrivateKey(new gt(i,16),new gt(s,16),new gt(o,16),new gt(a,16),new gt(c,16),new gt(u,16),new gt(f,16),new gt(h,16))};$e.privateKeyToAsn1=$e.privateKeyToRSAPrivateKey=function(r){return q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,q.integerToDer(0).getBytes()),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,Aa(r.n)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,Aa(r.e)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,Aa(r.d)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,Aa(r.p)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,Aa(r.q)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,Aa(r.dP)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,Aa(r.dQ)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,Aa(r.qInv))])};$e.publicKeyFromAsn1=function(r){var e={},t=[];if(q.validate(r,B2e,e,t)){var n=q.derToOid(e.publicKeyOid);if(n!==$e.oids.rsaEncryption){var i=new Error("Cannot read public key. Unknown OID.");throw i.oid=n,i}r=e.rsaPublicKey}if(t=[],!q.validate(r,L2e,e,t)){var i=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw i.errors=t,i}var s=Oe.util.createBuffer(e.publicKeyModulus).toHex(),o=Oe.util.createBuffer(e.publicKeyExponent).toHex();return $e.setRsaPublicKey(new gt(s,16),new gt(o,16))};$e.publicKeyToAsn1=$e.publicKeyToSubjectPublicKeyInfo=function(r){return q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[q.create(q.Class.UNIVERSAL,q.Type.OID,!1,q.oidToDer($e.oids.rsaEncryption).getBytes()),q.create(q.Class.UNIVERSAL,q.Type.NULL,!1,"")]),q.create(q.Class.UNIVERSAL,q.Type.BITSTRING,!1,[$e.publicKeyToRSAPublicKey(r)])])};$e.publicKeyToRSAPublicKey=function(r){return q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,Aa(r.n)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,Aa(r.e))])};function UM(r,e,t){var n=Oe.util.createBuffer(),i=Math.ceil(e.n.bitLength()/8);if(r.length>i-11){var s=new Error("Message is too long for PKCS#1 v1.5 padding.");throw s.length=r.length,s.max=i-11,s}n.putByte(0),n.putByte(t);var o=i-3-r.length,a;if(t===0||t===1){a=t===0?0:255;for(var c=0;c<o;++c)n.putByte(a)}else for(;o>0;){for(var u=0,f=Oe.random.getBytes(o),c=0;c<o;++c)a=f.charCodeAt(c),a===0?++u:n.putByte(a);o=u}return n.putByte(0),n.putBytes(r),n}function mw(r,e,t,n){var i=Math.ceil(e.n.bitLength()/8),s=Oe.util.createBuffer(r),o=s.getByte(),a=s.getByte();if(o!==0||t&&a!==0&&a!==1||!t&&a!=2||t&&a===0&&typeof n>"u")throw new Error("Encryption block is invalid.");var c=0;if(a===0){c=i-3-n;for(var u=0;u<c;++u)if(s.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(a===1)for(c=0;s.length()>1;){if(s.getByte()!==255){--s.read;break}++c}else if(a===2)for(c=0;s.length()>1;){if(s.getByte()===0){--s.read;break}++c}var f=s.getByte();if(f!==0||c!==i-3-s.length())throw new Error("Encryption block is invalid.");return s.getBytes()}function F2e(r,e,t){typeof e=="function"&&(t=e,e={}),e=e||{};var n={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(n.prng=e.prng),i();function i(){s(r.pBits,function(a,c){if(a)return t(a);if(r.p=c,r.q!==null)return o(a,r.q);s(r.qBits,o)})}function s(a,c){Oe.prime.generateProbablePrime(a,n,c)}function o(a,c){if(a)return t(a);if(r.q=c,r.p.compareTo(r.q)<0){var u=r.p;r.p=r.q,r.q=u}if(r.p.subtract(gt.ONE).gcd(r.e).compareTo(gt.ONE)!==0){r.p=null,i();return}if(r.q.subtract(gt.ONE).gcd(r.e).compareTo(gt.ONE)!==0){r.q=null,s(r.qBits,o);return}if(r.p1=r.p.subtract(gt.ONE),r.q1=r.q.subtract(gt.ONE),r.phi=r.p1.multiply(r.q1),r.phi.gcd(r.e).compareTo(gt.ONE)!==0){r.p=r.q=null,i();return}if(r.n=r.p.multiply(r.q),r.n.bitLength()!==r.bits){r.q=null,s(r.qBits,o);return}var f=r.e.modInverse(r.phi);r.keys={privateKey:$e.rsa.setPrivateKey(r.n,r.e,f,r.p,r.q,f.mod(r.p1),f.mod(r.q1),r.q.modInverse(r.p)),publicKey:$e.rsa.setPublicKey(r.n,r.e)},t(null,r.keys)}}function Aa(r){var e=r.toString(16);e[0]>="8"&&(e="00"+e);var t=Oe.util.hexToBytes(e);return t.length>1&&(t.charCodeAt(0)===0&&!(t.charCodeAt(1)&128)||t.charCodeAt(0)===255&&(t.charCodeAt(1)&128)===128)?t.substr(1):t}function V2e(r){return r<=100?27:r<=150?18:r<=200?15:r<=250?12:r<=300?9:r<=350?8:r<=400?7:r<=500?6:r<=600?5:r<=800?4:r<=1250?3:2}function OM(r){return Oe.util.isNodejs&&typeof zv[r]=="function"}function NM(r){return typeof Hs.globalScope<"u"&&typeof Hs.globalScope.crypto=="object"&&typeof Hs.globalScope.crypto.subtle=="object"&&typeof Hs.globalScope.crypto.subtle[r]=="function"}function DM(r){return typeof Hs.globalScope<"u"&&typeof Hs.globalScope.msCrypto=="object"&&typeof Hs.globalScope.msCrypto.subtle=="object"&&typeof Hs.globalScope.msCrypto.subtle[r]=="function"}function LM(r){for(var e=Oe.util.hexToBytes(r.toString(16)),t=new Uint8Array(e.length),n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t}});var Kv=P((LVe,qM)=>{l();var de=Je();Gp();wu();sw();bu();qp();Ov();lw();mh();pM();o2();hr();typeof FM>"u"&&(FM=de.jsbn.BigInteger);var FM,j=de.asn1,Ge=de.pki=de.pki||{};qM.exports=Ge.pbe=de.pbe=de.pbe||{};var wh=Ge.oids,z2e={name:"EncryptedPrivateKeyInfo",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:j.Class.UNIVERSAL,type:j.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:j.Class.UNIVERSAL,type:j.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},K2e={name:"PBES2Algorithms",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:j.Class.UNIVERSAL,type:j.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:j.Class.UNIVERSAL,type:j.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:j.Class.UNIVERSAL,type:j.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:j.Class.UNIVERSAL,type:j.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:j.Class.UNIVERSAL,type:j.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:j.Class.UNIVERSAL,type:j.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:j.Class.UNIVERSAL,type:j.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},q2e={name:"pkcs-12PbeParams",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:j.Class.UNIVERSAL,type:j.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:j.Class.UNIVERSAL,type:j.Type.INTEGER,constructed:!1,capture:"iterations"}]};Ge.encryptPrivateKeyInfo=function(r,e,t){t=t||{},t.saltSize=t.saltSize||8,t.count=t.count||2048,t.algorithm=t.algorithm||"aes128",t.prfAlgorithm=t.prfAlgorithm||"sha1";var n=de.random.getBytesSync(t.saltSize),i=t.count,s=j.integerToDer(i),o,a,c;if(t.algorithm.indexOf("aes")===0||t.algorithm==="des"){var u,f,h;switch(t.algorithm){case"aes128":o=16,u=16,f=wh["aes128-CBC"],h=de.aes.createEncryptionCipher;break;case"aes192":o=24,u=16,f=wh["aes192-CBC"],h=de.aes.createEncryptionCipher;break;case"aes256":o=32,u=16,f=wh["aes256-CBC"],h=de.aes.createEncryptionCipher;break;case"des":o=8,u=8,f=wh.desCBC,h=de.des.createEncryptionCipher;break;default:var p=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw p.algorithm=t.algorithm,p}var d="hmacWith"+t.prfAlgorithm.toUpperCase(),m=KM(d),g=de.pkcs5.pbkdf2(e,n,i,o,m),y=de.random.getBytesSync(u),w=h(g);w.start(y),w.update(j.toDer(r)),w.finish(),c=w.output.getBytes();var b=$2e(n,s,o,d);a=j.create(j.Class.UNIVERSAL,j.Type.SEQUENCE,!0,[j.create(j.Class.UNIVERSAL,j.Type.OID,!1,j.oidToDer(wh.pkcs5PBES2).getBytes()),j.create(j.Class.UNIVERSAL,j.Type.SEQUENCE,!0,[j.create(j.Class.UNIVERSAL,j.Type.SEQUENCE,!0,[j.create(j.Class.UNIVERSAL,j.Type.OID,!1,j.oidToDer(wh.pkcs5PBKDF2).getBytes()),b]),j.create(j.Class.UNIVERSAL,j.Type.SEQUENCE,!0,[j.create(j.Class.UNIVERSAL,j.Type.OID,!1,j.oidToDer(f).getBytes()),j.create(j.Class.UNIVERSAL,j.Type.OCTETSTRING,!1,y)])])])}else if(t.algorithm==="3des"){o=24;var _=new de.util.ByteBuffer(n),g=Ge.pbe.generatePkcs12Key(e,_,1,i,o),y=Ge.pbe.generatePkcs12Key(e,_,2,i,o),w=de.des.createEncryptionCipher(g);w.start(y),w.update(j.toDer(r)),w.finish(),c=w.output.getBytes(),a=j.create(j.Class.UNIVERSAL,j.Type.SEQUENCE,!0,[j.create(j.Class.UNIVERSAL,j.Type.OID,!1,j.oidToDer(wh["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),j.create(j.Class.UNIVERSAL,j.Type.SEQUENCE,!0,[j.create(j.Class.UNIVERSAL,j.Type.OCTETSTRING,!1,n),j.create(j.Class.UNIVERSAL,j.Type.INTEGER,!1,s.getBytes())])])}else{var p=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw p.algorithm=t.algorithm,p}var v=j.create(j.Class.UNIVERSAL,j.Type.SEQUENCE,!0,[a,j.create(j.Class.UNIVERSAL,j.Type.OCTETSTRING,!1,c)]);return v};Ge.decryptPrivateKeyInfo=function(r,e){var t=null,n={},i=[];if(!j.validate(r,z2e,n,i)){var s=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}var o=j.derToOid(n.encryptionOid),a=Ge.pbe.getCipher(o,n.encryptionParams,e),c=de.util.createBuffer(n.encryptedData);return a.update(c),a.finish()&&(t=j.fromDer(a.output)),t};Ge.encryptedPrivateKeyToPem=function(r,e){var t={type:"ENCRYPTED PRIVATE KEY",body:j.toDer(r).getBytes()};return de.pem.encode(t,{maxline:e})};Ge.encryptedPrivateKeyFromPem=function(r){var e=de.pem.decode(r)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var t=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return j.fromDer(e.body)};Ge.encryptRsaPrivateKey=function(r,e,t){if(t=t||{},!t.legacy){var n=Ge.wrapRsaPrivateKey(Ge.privateKeyToAsn1(r));return n=Ge.encryptPrivateKeyInfo(n,e,t),Ge.encryptedPrivateKeyToPem(n)}var i,s,o,a;switch(t.algorithm){case"aes128":i="AES-128-CBC",o=16,s=de.random.getBytesSync(16),a=de.aes.createEncryptionCipher;break;case"aes192":i="AES-192-CBC",o=24,s=de.random.getBytesSync(16),a=de.aes.createEncryptionCipher;break;case"aes256":i="AES-256-CBC",o=32,s=de.random.getBytesSync(16),a=de.aes.createEncryptionCipher;break;case"3des":i="DES-EDE3-CBC",o=24,s=de.random.getBytesSync(8),a=de.des.createEncryptionCipher;break;case"des":i="DES-CBC",o=8,s=de.random.getBytesSync(8),a=de.des.createEncryptionCipher;break;default:var c=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+t.algorithm+'".');throw c.algorithm=t.algorithm,c}var u=de.pbe.opensslDeriveBytes(e,s.substr(0,8),o),f=a(u);f.start(s),f.update(j.toDer(Ge.privateKeyToAsn1(r))),f.finish();var h={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:i,parameters:de.util.bytesToHex(s).toUpperCase()},body:f.output.getBytes()};return de.pem.encode(h)};Ge.decryptRsaPrivateKey=function(r,e){var t=null,n=de.pem.decode(r)[0];if(n.type!=="ENCRYPTED PRIVATE KEY"&&n.type!=="PRIVATE KEY"&&n.type!=="RSA PRIVATE KEY"){var i=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw i.headerType=i,i}if(n.procType&&n.procType.type==="ENCRYPTED"){var s,o;switch(n.dekInfo.algorithm){case"DES-CBC":s=8,o=de.des.createDecryptionCipher;break;case"DES-EDE3-CBC":s=24,o=de.des.createDecryptionCipher;break;case"AES-128-CBC":s=16,o=de.aes.createDecryptionCipher;break;case"AES-192-CBC":s=24,o=de.aes.createDecryptionCipher;break;case"AES-256-CBC":s=32,o=de.aes.createDecryptionCipher;break;case"RC2-40-CBC":s=5,o=function(h){return de.rc2.createDecryptionCipher(h,40)};break;case"RC2-64-CBC":s=8,o=function(h){return de.rc2.createDecryptionCipher(h,64)};break;case"RC2-128-CBC":s=16,o=function(h){return de.rc2.createDecryptionCipher(h,128)};break;default:var i=new Error('Could not decrypt private key; unsupported encryption algorithm "'+n.dekInfo.algorithm+'".');throw i.algorithm=n.dekInfo.algorithm,i}var a=de.util.hexToBytes(n.dekInfo.parameters),c=de.pbe.opensslDeriveBytes(e,a.substr(0,8),s),u=o(c);if(u.start(a),u.update(de.util.createBuffer(n.body)),u.finish())t=u.output.getBytes();else return t}else t=n.body;return n.type==="ENCRYPTED PRIVATE KEY"?t=Ge.decryptPrivateKeyInfo(j.fromDer(t),e):t=j.fromDer(t),t!==null&&(t=Ge.privateKeyFromAsn1(t)),t};Ge.pbe.generatePkcs12Key=function(r,e,t,n,i,s){var o,a;if(typeof s>"u"||s===null){if(!("sha1"in de.md))throw new Error('"sha1" hash algorithm unavailable.');s=de.md.sha1.create()}var c=s.digestLength,u=s.blockLength,f=new de.util.ByteBuffer,h=new de.util.ByteBuffer;if(r!=null){for(a=0;a<r.length;a++)h.putInt16(r.charCodeAt(a));h.putInt16(0)}var p=h.length(),d=e.length(),m=new de.util.ByteBuffer;m.fillWithByte(t,u);var g=u*Math.ceil(d/u),y=new de.util.ByteBuffer;for(a=0;a<g;a++)y.putByte(e.at(a%d));var w=u*Math.ceil(p/u),b=new de.util.ByteBuffer;for(a=0;a<w;a++)b.putByte(h.at(a%p));var _=y;_.putBuffer(b);for(var v=Math.ceil(i/c),I=1;I<=v;I++){var x=new de.util.ByteBuffer;x.putBytes(m.bytes()),x.putBytes(_.bytes());for(var A=0;A<n;A++)s.start(),s.update(x.getBytes()),x=s.digest();var R=new de.util.ByteBuffer;for(a=0;a<u;a++)R.putByte(x.at(a%c));var O=Math.ceil(d/u)+Math.ceil(p/u),V=new de.util.ByteBuffer;for(o=0;o<O;o++){var $=new de.util.ByteBuffer(_.getBytes(u)),Y=511;for(a=R.length()-1;a>=0;a--)Y=Y>>8,Y+=R.at(a)+$.at(a),$.setAt(a,Y&255);V.putBuffer($)}_=V,f.putBuffer(x)}return f.truncate(f.length()-i),f};Ge.pbe.getCipher=function(r,e,t){switch(r){case Ge.oids.pkcs5PBES2:return Ge.pbe.getCipherForPBES2(r,e,t);case Ge.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case Ge.oids["pbewithSHAAnd40BitRC2-CBC"]:return Ge.pbe.getCipherForPKCS12PBE(r,e,t);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=r,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}};Ge.pbe.getCipherForPBES2=function(r,e,t){var n={},i=[];if(!j.validate(e,K2e,n,i)){var s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}if(r=j.derToOid(n.kdfOid),r!==Ge.oids.pkcs5PBKDF2){var s=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw s.oid=r,s.supportedOids=["pkcs5PBKDF2"],s}if(r=j.derToOid(n.encOid),r!==Ge.oids["aes128-CBC"]&&r!==Ge.oids["aes192-CBC"]&&r!==Ge.oids["aes256-CBC"]&&r!==Ge.oids["des-EDE3-CBC"]&&r!==Ge.oids.desCBC){var s=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw s.oid=r,s.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],s}var o=n.kdfSalt,a=de.util.createBuffer(n.kdfIterationCount);a=a.getInt(a.length()<<3);var c,u;switch(Ge.oids[r]){case"aes128-CBC":c=16,u=de.aes.createDecryptionCipher;break;case"aes192-CBC":c=24,u=de.aes.createDecryptionCipher;break;case"aes256-CBC":c=32,u=de.aes.createDecryptionCipher;break;case"des-EDE3-CBC":c=24,u=de.des.createDecryptionCipher;break;case"desCBC":c=8,u=de.des.createDecryptionCipher;break}var f=zM(n.prfOid),h=de.pkcs5.pbkdf2(t,o,a,c,f),p=n.encIv,d=u(h);return d.start(p),d};Ge.pbe.getCipherForPKCS12PBE=function(r,e,t){var n={},i=[];if(!j.validate(e,q2e,n,i)){var s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}var o=de.util.createBuffer(n.salt),a=de.util.createBuffer(n.iterations);a=a.getInt(a.length()<<3);var c,u,f;switch(r){case Ge.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:c=24,u=8,f=de.des.startDecrypting;break;case Ge.oids["pbewithSHAAnd40BitRC2-CBC"]:c=5,u=8,f=function(g,y){var w=de.rc2.createDecryptionCipher(g,40);return w.start(y,null),w};break;default:var s=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw s.oid=r,s}var h=zM(n.prfOid),p=Ge.pbe.generatePkcs12Key(t,o,1,a,c,h);h.start();var d=Ge.pbe.generatePkcs12Key(t,o,2,a,u,h);return f(p,d)};Ge.pbe.opensslDeriveBytes=function(r,e,t,n){if(typeof n>"u"||n===null){if(!("md5"in de.md))throw new Error('"md5" hash algorithm unavailable.');n=de.md.md5.create()}e===null&&(e="");for(var i=[VM(n,r+e)],s=16,o=1;s<t;++o,s+=16)i.push(VM(n,i[o-1]+r+e));return i.join("").substr(0,t)};function VM(r,e){return r.start().update(e).digest().getBytes()}function zM(r){var e;if(!r)e="hmacWithSHA1";else if(e=Ge.oids[j.derToOid(r)],!e){var t=new Error("Unsupported PRF OID.");throw t.oid=r,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}return KM(e)}function KM(r){var e=de.md;switch(r){case"hmacWithSHA224":e=de.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":r=r.substr(8).toLowerCase();break;default:var t=new Error("Unsupported PRF algorithm.");throw t.algorithm=r,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}if(!e||!(r in e))throw new Error("Unknown hash algorithm: "+r);return e[r].create()}function $2e(r,e,t,n){var i=j.create(j.Class.UNIVERSAL,j.Type.SEQUENCE,!0,[j.create(j.Class.UNIVERSAL,j.Type.OCTETSTRING,!1,r),j.create(j.Class.UNIVERSAL,j.Type.INTEGER,!1,e.getBytes())]);return n!=="hmacWithSHA1"&&i.value.push(j.create(j.Class.UNIVERSAL,j.Type.INTEGER,!1,de.util.hexToBytes(t.toString(16))),j.create(j.Class.UNIVERSAL,j.Type.SEQUENCE,!0,[j.create(j.Class.UNIVERSAL,j.Type.OID,!1,j.oidToDer(Ge.oids[n]).getBytes()),j.create(j.Class.UNIVERSAL,j.Type.NULL,!1,"")])),i}});var oF=P((YVe,sF)=>{"use strict";l();sF.exports=Un;var f2=_h();function Un(r,e){this.lo=r>>>0,this.hi=e>>>0}var Eh=Un.zero=new Un(0,0);Eh.toNumber=function(){return 0};Eh.zzEncode=Eh.zzDecode=function(){return this};Eh.length=function(){return 1};var lge=Un.zeroHash="\0\0\0\0\0\0\0\0";Un.fromNumber=function(e){if(e===0)return Eh;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Un(n,i)};Un.from=function(e){if(typeof e=="number")return Un.fromNumber(e);if(f2.isString(e))if(f2.Long)e=f2.Long.fromString(e);else return Un.fromNumber(parseInt(e,10));return e.low||e.high?new Un(e.low>>>0,e.high>>>0):Eh};Un.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};Un.prototype.toLong=function(e){return f2.Long?new f2.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var Ru=String.prototype.charCodeAt;Un.fromHash=function(e){return e===lge?Eh:new Un((Ru.call(e,0)|Ru.call(e,1)<<8|Ru.call(e,2)<<16|Ru.call(e,3)<<24)>>>0,(Ru.call(e,4)|Ru.call(e,5)<<8|Ru.call(e,6)<<16|Ru.call(e,7)<<24)>>>0)};Un.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Un.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Un.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Un.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var _h=P(Zv=>{"use strict";l();var Ae=Zv;Ae.asPromise=Xl();Ae.base64=Zl();Ae.EventEmitter=Jl();Ae.float=eu();Ae.inquire=tu();Ae.utf8=ru();Ae.pool=nu();Ae.LongBits=oF();Ae.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);Ae.global=Ae.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||Zv;Ae.emptyArray=Object.freeze?Object.freeze([]):[];Ae.emptyObject=Object.freeze?Object.freeze({}):{};Ae.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Ae.isString=function(e){return typeof e=="string"||e instanceof String};Ae.isObject=function(e){return e&&typeof e=="object"};Ae.isset=Ae.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};Ae.Buffer=function(){try{var r=Ae.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();Ae._Buffer_from=null;Ae._Buffer_allocUnsafe=null;Ae.newBuffer=function(e){return typeof e=="number"?Ae.Buffer?Ae._Buffer_allocUnsafe(e):new Ae.Array(e):Ae.Buffer?Ae._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Ae.Array=typeof Uint8Array<"u"?Uint8Array:Array;Ae.Long=Ae.global.dcodeIO&&Ae.global.dcodeIO.Long||Ae.global.Long||Ae.inquire("long");Ae.key2Re=/^true|false|0|1$/;Ae.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Ae.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Ae.longToHash=function(e){return e?Ae.LongBits.from(e).toHash():Ae.LongBits.zeroHash};Ae.longFromHash=function(e,t){var n=Ae.LongBits.fromHash(e);return Ae.Long?Ae.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function aF(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}Ae.merge=aF;Ae.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function cF(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&aF(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Ae.newError=cF;Ae.ProtocolError=cF("ProtocolError");Ae.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Ae.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};Ae.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Ae._configure=function(){var r=Ae.Buffer;if(!r){Ae._Buffer_from=Ae._Buffer_allocUnsafe=null;return}Ae._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},Ae._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var tS=P((JVe,dF)=>{"use strict";l();dF.exports=en;var Ia=_h(),eS,fF=Ia.LongBits,uge=Ia.utf8;function Do(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function en(r){this.buf=r,this.pos=0,this.len=r.length}var lF=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new en(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new en(e);throw Error("illegal buffer")},hF=function(){return Ia.Buffer?function(t){return(en.create=function(i){return Ia.Buffer.isBuffer(i)?new eS(i):lF(i)})(t)}:lF};en.create=hF();en.prototype._slice=Ia.Array.prototype.subarray||Ia.Array.prototype.slice;en.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Do(this,10);return e}}();en.prototype.int32=function(){return this.uint32()|0};en.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Jv(){var r=new fF(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Do(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw Do(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}en.prototype.bool=function(){return this.uint32()!==0};function vw(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}en.prototype.fixed32=function(){if(this.pos+4>this.len)throw Do(this,4);return vw(this.buf,this.pos+=4)};en.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Do(this,4);return vw(this.buf,this.pos+=4)|0};function uF(){if(this.pos+8>this.len)throw Do(this,8);return new fF(vw(this.buf,this.pos+=4),vw(this.buf,this.pos+=4))}en.prototype.float=function(){if(this.pos+4>this.len)throw Do(this,4);var e=Ia.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};en.prototype.double=function(){if(this.pos+8>this.len)throw Do(this,4);var e=Ia.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};en.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Do(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};en.prototype.string=function(){var e=this.bytes();return uge.read(e,0,e.length)};en.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Do(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Do(this);while(this.buf[this.pos++]&128);return this};en.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};en._configure=function(r){eS=r,en.create=hF(),eS._configure();var e=Ia.Long?"toLong":"toNumber";Ia.merge(en.prototype,{int64:function(){return Jv.call(this)[e](!1)},uint64:function(){return Jv.call(this)[e](!0)},sint64:function(){return Jv.call(this).zzDecode()[e](!1)},fixed64:function(){return uF.call(this)[e](!0)},sfixed64:function(){return uF.call(this)[e](!1)}})}});var yF=P((tze,gF)=>{"use strict";l();gF.exports=vh;var mF=tS();(vh.prototype=Object.create(mF.prototype)).constructor=vh;var pF=_h();function vh(r){mF.call(this,r)}vh._configure=function(){pF.Buffer&&(vh.prototype._slice=pF.Buffer.prototype.slice)};vh.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};vh._configure()});var cS=P((nze,_F)=>{"use strict";l();_F.exports=Tt;var Gs=_h(),rS,Sw=Gs.LongBits,wF=Gs.base64,bF=Gs.utf8;function h2(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function iS(){}function fge(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function Tt(){this.len=0,this.head=new h2(iS,0,0),this.tail=this.head,this.states=null}var EF=function(){return Gs.Buffer?function(){return(Tt.create=function(){return new rS})()}:function(){return new Tt}};Tt.create=EF();Tt.alloc=function(e){return new Gs.Array(e)};Gs.Array!==Array&&(Tt.alloc=Gs.pool(Tt.alloc,Gs.Array.prototype.subarray));Tt.prototype._push=function(e,t,n){return this.tail=this.tail.next=new h2(e,t,n),this.len+=t,this};function sS(r,e,t){e[t]=r&255}function hge(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function oS(r,e){this.len=r,this.next=void 0,this.val=e}oS.prototype=Object.create(h2.prototype);oS.prototype.fn=hge;Tt.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new oS((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Tt.prototype.int32=function(e){return e<0?this._push(aS,10,Sw.fromNumber(e)):this.uint32(e)};Tt.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function aS(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}Tt.prototype.uint64=function(e){var t=Sw.from(e);return this._push(aS,t.length(),t)};Tt.prototype.int64=Tt.prototype.uint64;Tt.prototype.sint64=function(e){var t=Sw.from(e).zzEncode();return this._push(aS,t.length(),t)};Tt.prototype.bool=function(e){return this._push(sS,1,e?1:0)};function nS(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}Tt.prototype.fixed32=function(e){return this._push(nS,4,e>>>0)};Tt.prototype.sfixed32=Tt.prototype.fixed32;Tt.prototype.fixed64=function(e){var t=Sw.from(e);return this._push(nS,4,t.lo)._push(nS,4,t.hi)};Tt.prototype.sfixed64=Tt.prototype.fixed64;Tt.prototype.float=function(e){return this._push(Gs.float.writeFloatLE,4,e)};Tt.prototype.double=function(e){return this._push(Gs.float.writeDoubleLE,8,e)};var dge=Gs.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Tt.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(sS,1,0);if(Gs.isString(e)){var n=Tt.alloc(t=wF.length(e));wF.decode(e,n,0),e=n}return this.uint32(t)._push(dge,t,e)};Tt.prototype.string=function(e){var t=bF.length(e);return t?this.uint32(t)._push(bF.write,t,e):this._push(sS,1,0)};Tt.prototype.fork=function(){return this.states=new fge(this),this.head=this.tail=new h2(iS,0,0),this.len=0,this};Tt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new h2(iS,0,0),this.len=0),this};Tt.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};Tt.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};Tt._configure=function(r){rS=r,Tt.create=EF(),rS._configure()}});var xF=P((sze,SF)=>{"use strict";l();SF.exports=Ra;var vF=cS();(Ra.prototype=Object.create(vF.prototype)).constructor=Ra;var Cu=_h();function Ra(){vF.call(this)}Ra._configure=function(){Ra.alloc=Cu._Buffer_allocUnsafe,Ra.writeBytesBuffer=Cu.Buffer&&Cu.Buffer.prototype instanceof Uint8Array&&Cu.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};Ra.prototype.bytes=function(e){Cu.isString(e)&&(e=Cu._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Ra.writeBytesBuffer,t,e),this};function pge(r,e,t){r.length<40?Cu.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}Ra.prototype.string=function(e){var t=Cu.Buffer.byteLength(e);return this.uint32(t),t&&this._push(pge,t,e),this};Ra._configure()});var HF=P((gKe,$F)=>{l();var vr=Je();bu();hr();var p2=$F.exports=vr.sha512=vr.sha512||{};vr.md.sha512=vr.md.algorithms.sha512=p2;var KF=vr.sha384=vr.sha512.sha384=vr.sha512.sha384||{};KF.create=function(){return p2.create("SHA-384")};vr.md.sha384=vr.md.algorithms.sha384=KF;vr.sha512.sha256=vr.sha512.sha256||{create:function(){return p2.create("SHA-512/256")}};vr.md["sha512/256"]=vr.md.algorithms["sha512/256"]=vr.sha512.sha256;vr.sha512.sha224=vr.sha512.sha224||{create:function(){return p2.create("SHA-512/224")}};vr.md["sha512/224"]=vr.md.algorithms["sha512/224"]=vr.sha512.sha224;p2.create=function(r){if(qF||Tge(),typeof r>"u"&&(r="SHA-512"),!(r in xh))throw new Error("Invalid SHA-512 algorithm: "+r);for(var e=xh[r],t=null,n=vr.util.createBuffer(),i=new Array(80),s=0;s<80;++s)i[s]=new Array(2);var o=64;switch(r){case"SHA-384":o=48;break;case"SHA-512/256":o=32;break;case"SHA-512/224":o=28;break}var a={algorithm:r.replace("-","").toLowerCase(),blockLength:128,digestLength:o,messageLength:0,fullMessageLength:null,messageLengthSize:16};return a.start=function(){a.messageLength=0,a.fullMessageLength=a.messageLength128=[];for(var c=a.messageLengthSize/4,u=0;u<c;++u)a.fullMessageLength.push(0);n=vr.util.createBuffer(),t=new Array(e.length);for(var u=0;u<e.length;++u)t[u]=e[u].slice(0);return a},a.start(),a.update=function(c,u){u==="utf8"&&(c=vr.util.encodeUtf8(c));var f=c.length;a.messageLength+=f,f=[f/4294967296>>>0,f>>>0];for(var h=a.fullMessageLength.length-1;h>=0;--h)a.fullMessageLength[h]+=f[1],f[1]=f[0]+(a.fullMessageLength[h]/4294967296>>>0),a.fullMessageLength[h]=a.fullMessageLength[h]>>>0,f[0]=f[1]/4294967296>>>0;return n.putBytes(c),zF(t,i,n),(n.read>2048||n.length()===0)&&n.compact(),a},a.digest=function(){var c=vr.util.createBuffer();c.putBytes(n.bytes());var u=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize,f=u&a.blockLength-1;c.putBytes(yS.substr(0,a.blockLength-f));for(var h,p,d=a.fullMessageLength[0]*8,m=0;m<a.fullMessageLength.length-1;++m)h=a.fullMessageLength[m+1]*8,p=h/4294967296>>>0,d+=p,c.putInt32(d>>>0),d=h>>>0;c.putInt32(d);for(var g=new Array(t.length),m=0;m<t.length;++m)g[m]=t[m].slice(0);zF(g,i,c);var y=vr.util.createBuffer(),w;r==="SHA-512"?w=g.length:r==="SHA-384"?w=g.length-2:w=g.length-4;for(var m=0;m<w;++m)y.putInt32(g[m][0]),(m!==w-1||r!=="SHA-512/224")&&y.putInt32(g[m][1]);return y},a};var yS=null,qF=!1,wS=null,xh=null;function Tge(){yS=String.fromCharCode(128),yS+=vr.util.fillString(String.fromCharCode(0),128),wS=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],xh={},xh["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],xh["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],xh["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],xh["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],qF=!0}function zF(r,e,t){for(var n,i,s,o,a,c,u,f,h,p,d,m,g,y,w,b,_,v,I,x,A,R,O,V,$,Y,Q,pe,re,he,H,ve,St,nt,it,ct=t.length();ct>=128;){for(re=0;re<16;++re)e[re][0]=t.getInt32()>>>0,e[re][1]=t.getInt32()>>>0;for(;re<80;++re)ve=e[re-2],he=ve[0],H=ve[1],n=((he>>>19|H<<13)^(H>>>29|he<<3)^he>>>6)>>>0,i=((he<<13|H>>>19)^(H<<3|he>>>29)^(he<<26|H>>>6))>>>0,nt=e[re-15],he=nt[0],H=nt[1],s=((he>>>1|H<<31)^(he>>>8|H<<24)^he>>>7)>>>0,o=((he<<31|H>>>1)^(he<<24|H>>>8)^(he<<25|H>>>7))>>>0,St=e[re-7],it=e[re-16],H=i+St[1]+o+it[1],e[re][0]=n+St[0]+s+it[0]+(H/4294967296>>>0)>>>0,e[re][1]=H>>>0;for(g=r[0][0],y=r[0][1],w=r[1][0],b=r[1][1],_=r[2][0],v=r[2][1],I=r[3][0],x=r[3][1],A=r[4][0],R=r[4][1],O=r[5][0],V=r[5][1],$=r[6][0],Y=r[6][1],Q=r[7][0],pe=r[7][1],re=0;re<80;++re)u=((A>>>14|R<<18)^(A>>>18|R<<14)^(R>>>9|A<<23))>>>0,f=((A<<18|R>>>14)^(A<<14|R>>>18)^(R<<23|A>>>9))>>>0,h=($^A&(O^$))>>>0,p=(Y^R&(V^Y))>>>0,a=((g>>>28|y<<4)^(y>>>2|g<<30)^(y>>>7|g<<25))>>>0,c=((g<<4|y>>>28)^(y<<30|g>>>2)^(y<<25|g>>>7))>>>0,d=(g&w|_&(g^w))>>>0,m=(y&b|v&(y^b))>>>0,H=pe+f+p+wS[re][1]+e[re][1],n=Q+u+h+wS[re][0]+e[re][0]+(H/4294967296>>>0)>>>0,i=H>>>0,H=c+m,s=a+d+(H/4294967296>>>0)>>>0,o=H>>>0,Q=$,pe=Y,$=O,Y=V,O=A,V=R,H=x+i,A=I+n+(H/4294967296>>>0)>>>0,R=H>>>0,I=_,x=v,_=w,v=b,w=g,b=y,H=i+o,g=n+s+(H/4294967296>>>0)>>>0,y=H>>>0;H=r[0][1]+y,r[0][0]=r[0][0]+g+(H/4294967296>>>0)>>>0,r[0][1]=H>>>0,H=r[1][1]+b,r[1][0]=r[1][0]+w+(H/4294967296>>>0)>>>0,r[1][1]=H>>>0,H=r[2][1]+v,r[2][0]=r[2][0]+_+(H/4294967296>>>0)>>>0,r[2][1]=H>>>0,H=r[3][1]+x,r[3][0]=r[3][0]+I+(H/4294967296>>>0)>>>0,r[3][1]=H>>>0,H=r[4][1]+R,r[4][0]=r[4][0]+A+(H/4294967296>>>0)>>>0,r[4][1]=H>>>0,H=r[5][1]+V,r[5][0]=r[5][0]+O+(H/4294967296>>>0)>>>0,r[5][1]=H>>>0,H=r[6][1]+Y,r[6][0]=r[6][0]+$+(H/4294967296>>>0)>>>0,r[6][1]=H>>>0,H=r[7][1]+pe,r[7][0]=r[7][0]+Q+(H/4294967296>>>0)>>>0,r[7][1]=H>>>0,ct-=128}}});var CV=P((hqe,RV)=>{"use strict";l();RV.exports=Fn;var A2=Rh();function Fn(r,e){this.lo=r>>>0,this.hi=e>>>0}var Ih=Fn.zero=new Fn(0,0);Ih.toNumber=function(){return 0};Ih.zzEncode=Ih.zzDecode=function(){return this};Ih.length=function(){return 1};var nye=Fn.zeroHash="\0\0\0\0\0\0\0\0";Fn.fromNumber=function(e){if(e===0)return Ih;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Fn(n,i)};Fn.from=function(e){if(typeof e=="number")return Fn.fromNumber(e);if(A2.isString(e))if(A2.Long)e=A2.Long.fromString(e);else return Fn.fromNumber(parseInt(e,10));return e.low||e.high?new Fn(e.low>>>0,e.high>>>0):Ih};Fn.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};Fn.prototype.toLong=function(e){return A2.Long?new A2.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var Du=String.prototype.charCodeAt;Fn.fromHash=function(e){return e===nye?Ih:new Fn((Du.call(e,0)|Du.call(e,1)<<8|Du.call(e,2)<<16|Du.call(e,3)<<24)>>>0,(Du.call(e,4)|Du.call(e,5)<<8|Du.call(e,6)<<16|Du.call(e,7)<<24)>>>0)};Fn.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Fn.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Fn.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Fn.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var Rh=P(LS=>{"use strict";l();var Te=LS;Te.asPromise=Xl();Te.base64=Zl();Te.EventEmitter=Jl();Te.float=eu();Te.inquire=tu();Te.utf8=ru();Te.pool=nu();Te.LongBits=CV();Te.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);Te.global=Te.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||LS;Te.emptyArray=Object.freeze?Object.freeze([]):[];Te.emptyObject=Object.freeze?Object.freeze({}):{};Te.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Te.isString=function(e){return typeof e=="string"||e instanceof String};Te.isObject=function(e){return e&&typeof e=="object"};Te.isset=Te.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};Te.Buffer=function(){try{var r=Te.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();Te._Buffer_from=null;Te._Buffer_allocUnsafe=null;Te.newBuffer=function(e){return typeof e=="number"?Te.Buffer?Te._Buffer_allocUnsafe(e):new Te.Array(e):Te.Buffer?Te._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Te.Array=typeof Uint8Array<"u"?Uint8Array:Array;Te.Long=Te.global.dcodeIO&&Te.global.dcodeIO.Long||Te.global.Long||Te.inquire("long");Te.key2Re=/^true|false|0|1$/;Te.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Te.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Te.longToHash=function(e){return e?Te.LongBits.from(e).toHash():Te.LongBits.zeroHash};Te.longFromHash=function(e,t){var n=Te.LongBits.fromHash(e);return Te.Long?Te.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function PV(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}Te.merge=PV;Te.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function kV(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&PV(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Te.newError=kV;Te.ProtocolError=kV("ProtocolError");Te.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Te.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};Te.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Te._configure=function(){var r=Te.Buffer;if(!r){Te._Buffer_from=Te._Buffer_allocUnsafe=null;return}Te._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},Te._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var MS=P((gqe,BV)=>{"use strict";l();BV.exports=tn;var Oa=Rh(),US,DV=Oa.LongBits,iye=Oa.utf8;function Vo(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function tn(r){this.buf=r,this.pos=0,this.len=r.length}var OV=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new tn(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new tn(e);throw Error("illegal buffer")},LV=function(){return Oa.Buffer?function(t){return(tn.create=function(i){return Oa.Buffer.isBuffer(i)?new US(i):OV(i)})(t)}:OV};tn.create=LV();tn.prototype._slice=Oa.Array.prototype.subarray||Oa.Array.prototype.slice;tn.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Vo(this,10);return e}}();tn.prototype.int32=function(){return this.uint32()|0};tn.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function BS(){var r=new DV(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Vo(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw Vo(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}tn.prototype.bool=function(){return this.uint32()!==0};function Lw(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}tn.prototype.fixed32=function(){if(this.pos+4>this.len)throw Vo(this,4);return Lw(this.buf,this.pos+=4)};tn.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Vo(this,4);return Lw(this.buf,this.pos+=4)|0};function NV(){if(this.pos+8>this.len)throw Vo(this,8);return new DV(Lw(this.buf,this.pos+=4),Lw(this.buf,this.pos+=4))}tn.prototype.float=function(){if(this.pos+4>this.len)throw Vo(this,4);var e=Oa.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};tn.prototype.double=function(){if(this.pos+8>this.len)throw Vo(this,4);var e=Oa.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};tn.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Vo(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};tn.prototype.string=function(){var e=this.bytes();return iye.read(e,0,e.length)};tn.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Vo(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Vo(this);while(this.buf[this.pos++]&128);return this};tn.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};tn._configure=function(r){US=r,tn.create=LV(),US._configure();var e=Oa.Long?"toLong":"toNumber";Oa.merge(tn.prototype,{int64:function(){return BS.call(this)[e](!1)},uint64:function(){return BS.call(this)[e](!0)},sint64:function(){return BS.call(this).zzDecode()[e](!1)},fixed64:function(){return NV.call(this)[e](!0)},sfixed64:function(){return NV.call(this)[e](!1)}})}});var VV=P((wqe,FV)=>{"use strict";l();FV.exports=Ch;var MV=MS();(Ch.prototype=Object.create(MV.prototype)).constructor=Ch;var UV=Rh();function Ch(r){MV.call(this,r)}Ch._configure=function(){UV.Buffer&&(Ch.prototype._slice=UV.Buffer.prototype.slice)};Ch.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Ch._configure()});var HS=P((Eqe,$V)=>{"use strict";l();$V.exports=Rt;var Ws=Rh(),FS,Bw=Ws.LongBits,zV=Ws.base64,KV=Ws.utf8;function T2(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function zS(){}function sye(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function Rt(){this.len=0,this.head=new T2(zS,0,0),this.tail=this.head,this.states=null}var qV=function(){return Ws.Buffer?function(){return(Rt.create=function(){return new FS})()}:function(){return new Rt}};Rt.create=qV();Rt.alloc=function(e){return new Ws.Array(e)};Ws.Array!==Array&&(Rt.alloc=Ws.pool(Rt.alloc,Ws.Array.prototype.subarray));Rt.prototype._push=function(e,t,n){return this.tail=this.tail.next=new T2(e,t,n),this.len+=t,this};function KS(r,e,t){e[t]=r&255}function oye(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function qS(r,e){this.len=r,this.next=void 0,this.val=e}qS.prototype=Object.create(T2.prototype);qS.prototype.fn=oye;Rt.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new qS((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Rt.prototype.int32=function(e){return e<0?this._push($S,10,Bw.fromNumber(e)):this.uint32(e)};Rt.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function $S(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}Rt.prototype.uint64=function(e){var t=Bw.from(e);return this._push($S,t.length(),t)};Rt.prototype.int64=Rt.prototype.uint64;Rt.prototype.sint64=function(e){var t=Bw.from(e).zzEncode();return this._push($S,t.length(),t)};Rt.prototype.bool=function(e){return this._push(KS,1,e?1:0)};function VS(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}Rt.prototype.fixed32=function(e){return this._push(VS,4,e>>>0)};Rt.prototype.sfixed32=Rt.prototype.fixed32;Rt.prototype.fixed64=function(e){var t=Bw.from(e);return this._push(VS,4,t.lo)._push(VS,4,t.hi)};Rt.prototype.sfixed64=Rt.prototype.fixed64;Rt.prototype.float=function(e){return this._push(Ws.float.writeFloatLE,4,e)};Rt.prototype.double=function(e){return this._push(Ws.float.writeDoubleLE,8,e)};var aye=Ws.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Rt.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(KS,1,0);if(Ws.isString(e)){var n=Rt.alloc(t=zV.length(e));zV.decode(e,n,0),e=n}return this.uint32(t)._push(aye,t,e)};Rt.prototype.string=function(e){var t=KV.length(e);return t?this.uint32(t)._push(KV.write,t,e):this._push(KS,1,0)};Rt.prototype.fork=function(){return this.states=new sye(this),this.head=this.tail=new T2(zS,0,0),this.len=0,this};Rt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new T2(zS,0,0),this.len=0),this};Rt.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};Rt.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};Rt._configure=function(r){FS=r,Rt.create=qV(),FS._configure()}});var jV=P((vqe,GV)=>{"use strict";l();GV.exports=Na;var HV=HS();(Na.prototype=Object.create(HV.prototype)).constructor=Na;var Lu=Rh();function Na(){HV.call(this)}Na._configure=function(){Na.alloc=Lu._Buffer_allocUnsafe,Na.writeBytesBuffer=Lu.Buffer&&Lu.Buffer.prototype instanceof Uint8Array&&Lu.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};Na.prototype.bytes=function(e){Lu.isString(e)&&(e=Lu._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Na.writeBytesBuffer,t,e),this};function cye(r,e,t){r.length<40?Lu.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}Na.prototype.string=function(e){var t=Lu.Buffer.byteLength(e);return this.uint32(t),t&&this._push(cye,t,e),this};Na._configure()});var Gw=P((sx,ox)=>{l();(function(r,e){typeof sx=="object"&&typeof ox<"u"?ox.exports=function(t,n,i,s,o){for(n=n.split?n.split("."):n,s=0;s<n.length;s++)t=t?t[n[s]]:o;return t===o?i:t}:typeof define=="function"&&define.amd?define(function(){return function(t,n,i,s,o){for(n=n.split?n.split("."):n,s=0;s<n.length;s++)t=t?t[n[s]]:o;return t===o?i:t}}):r.dlv=function(t,n,i,s,o){for(n=n.split?n.split("."):n,s=0;s<n.length;s++)t=t?t[n[s]]:o;return t===o?i:t}})(sx)});var kz=P((wWe,Pz)=>{"use strict";l();var Lye=/^(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9])?\.){0,126}(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9]))\.?$/i;Pz.exports=function(e,t){if(t==null&&(t=!1),e.length<2||e.length>255)return!1;var n=e[e.length-1];if(t){if(n!==".")return!1}else if(n===".")return!1;return Lye.test(e)}});var iK=P((V2,g6)=>{l();(function(r,e){"use strict";var t={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function n(d){if(!Array.isArray(d)&&!ArrayBuffer.isView(d))return!1;for(var m=0;m<d.length;m++)if(!Number.isInteger(d[m])||d[m]<0||d[m]>255)return!1;return!0}function i(d,m){return(d&65535)*m+(((d>>>16)*m&65535)<<16)}function s(d,m){return d<<m|d>>>32-m}function o(d){return d^=d>>>16,d=i(d,2246822507),d^=d>>>13,d=i(d,3266489909),d^=d>>>16,d}function a(d,m){d=[d[0]>>>16,d[0]&65535,d[1]>>>16,d[1]&65535],m=[m[0]>>>16,m[0]&65535,m[1]>>>16,m[1]&65535];var g=[0,0,0,0];return g[3]+=d[3]+m[3],g[2]+=g[3]>>>16,g[3]&=65535,g[2]+=d[2]+m[2],g[1]+=g[2]>>>16,g[2]&=65535,g[1]+=d[1]+m[1],g[0]+=g[1]>>>16,g[1]&=65535,g[0]+=d[0]+m[0],g[0]&=65535,[g[0]<<16|g[1],g[2]<<16|g[3]]}function c(d,m){d=[d[0]>>>16,d[0]&65535,d[1]>>>16,d[1]&65535],m=[m[0]>>>16,m[0]&65535,m[1]>>>16,m[1]&65535];var g=[0,0,0,0];return g[3]+=d[3]*m[3],g[2]+=g[3]>>>16,g[3]&=65535,g[2]+=d[2]*m[3],g[1]+=g[2]>>>16,g[2]&=65535,g[2]+=d[3]*m[2],g[1]+=g[2]>>>16,g[2]&=65535,g[1]+=d[1]*m[3],g[0]+=g[1]>>>16,g[1]&=65535,g[1]+=d[2]*m[2],g[0]+=g[1]>>>16,g[1]&=65535,g[1]+=d[3]*m[1],g[0]+=g[1]>>>16,g[1]&=65535,g[0]+=d[0]*m[3]+d[1]*m[2]+d[2]*m[1]+d[3]*m[0],g[0]&=65535,[g[0]<<16|g[1],g[2]<<16|g[3]]}function u(d,m){return m%=64,m===32?[d[1],d[0]]:m<32?[d[0]<<m|d[1]>>>32-m,d[1]<<m|d[0]>>>32-m]:(m-=32,[d[1]<<m|d[0]>>>32-m,d[0]<<m|d[1]>>>32-m])}function f(d,m){return m%=64,m===0?d:m<32?[d[0]<<m|d[1]>>>32-m,d[1]<<m]:[d[1]<<m-32,0]}function h(d,m){return[d[0]^m[0],d[1]^m[1]]}function p(d){return d=h(d,[0,d[0]>>>1]),d=c(d,[4283543511,3981806797]),d=h(d,[0,d[0]>>>1]),d=c(d,[3301882366,444984403]),d=h(d,[0,d[0]>>>1]),d}t.x86.hash32=function(d,m){if(t.inputValidation&&!n(d))return e;m=m||0;for(var g=d.length%4,y=d.length-g,w=m,b=0,_=3432918353,v=461845907,I=0;I<y;I=I+4)b=d[I]|d[I+1]<<8|d[I+2]<<16|d[I+3]<<24,b=i(b,_),b=s(b,15),b=i(b,v),w^=b,w=s(w,13),w=i(w,5)+3864292196;switch(b=0,g){case 3:b^=d[I+2]<<16;case 2:b^=d[I+1]<<8;case 1:b^=d[I],b=i(b,_),b=s(b,15),b=i(b,v),w^=b}return w^=d.length,w=o(w),w>>>0},t.x86.hash128=function(d,m){if(t.inputValidation&&!n(d))return e;m=m||0;for(var g=d.length%16,y=d.length-g,w=m,b=m,_=m,v=m,I=0,x=0,A=0,R=0,O=597399067,V=2869860233,$=951274213,Y=2716044179,Q=0;Q<y;Q=Q+16)I=d[Q]|d[Q+1]<<8|d[Q+2]<<16|d[Q+3]<<24,x=d[Q+4]|d[Q+5]<<8|d[Q+6]<<16|d[Q+7]<<24,A=d[Q+8]|d[Q+9]<<8|d[Q+10]<<16|d[Q+11]<<24,R=d[Q+12]|d[Q+13]<<8|d[Q+14]<<16|d[Q+15]<<24,I=i(I,O),I=s(I,15),I=i(I,V),w^=I,w=s(w,19),w+=b,w=i(w,5)+1444728091,x=i(x,V),x=s(x,16),x=i(x,$),b^=x,b=s(b,17),b+=_,b=i(b,5)+197830471,A=i(A,$),A=s(A,17),A=i(A,Y),_^=A,_=s(_,15),_+=v,_=i(_,5)+2530024501,R=i(R,Y),R=s(R,18),R=i(R,O),v^=R,v=s(v,13),v+=w,v=i(v,5)+850148119;switch(I=0,x=0,A=0,R=0,g){case 15:R^=d[Q+14]<<16;case 14:R^=d[Q+13]<<8;case 13:R^=d[Q+12],R=i(R,Y),R=s(R,18),R=i(R,O),v^=R;case 12:A^=d[Q+11]<<24;case 11:A^=d[Q+10]<<16;case 10:A^=d[Q+9]<<8;case 9:A^=d[Q+8],A=i(A,$),A=s(A,17),A=i(A,Y),_^=A;case 8:x^=d[Q+7]<<24;case 7:x^=d[Q+6]<<16;case 6:x^=d[Q+5]<<8;case 5:x^=d[Q+4],x=i(x,V),x=s(x,16),x=i(x,$),b^=x;case 4:I^=d[Q+3]<<24;case 3:I^=d[Q+2]<<16;case 2:I^=d[Q+1]<<8;case 1:I^=d[Q],I=i(I,O),I=s(I,15),I=i(I,V),w^=I}return w^=d.length,b^=d.length,_^=d.length,v^=d.length,w+=b,w+=_,w+=v,b+=w,_+=w,v+=w,w=o(w),b=o(b),_=o(_),v=o(v),w+=b,w+=_,w+=v,b+=w,_+=w,v+=w,("00000000"+(w>>>0).toString(16)).slice(-8)+("00000000"+(b>>>0).toString(16)).slice(-8)+("00000000"+(_>>>0).toString(16)).slice(-8)+("00000000"+(v>>>0).toString(16)).slice(-8)},t.x64.hash128=function(d,m){if(t.inputValidation&&!n(d))return e;m=m||0;for(var g=d.length%16,y=d.length-g,w=[0,m],b=[0,m],_=[0,0],v=[0,0],I=[2277735313,289559509],x=[1291169091,658871167],A=0;A<y;A=A+16)_=[d[A+4]|d[A+5]<<8|d[A+6]<<16|d[A+7]<<24,d[A]|d[A+1]<<8|d[A+2]<<16|d[A+3]<<24],v=[d[A+12]|d[A+13]<<8|d[A+14]<<16|d[A+15]<<24,d[A+8]|d[A+9]<<8|d[A+10]<<16|d[A+11]<<24],_=c(_,I),_=u(_,31),_=c(_,x),w=h(w,_),w=u(w,27),w=a(w,b),w=a(c(w,[0,5]),[0,1390208809]),v=c(v,x),v=u(v,33),v=c(v,I),b=h(b,v),b=u(b,31),b=a(b,w),b=a(c(b,[0,5]),[0,944331445]);switch(_=[0,0],v=[0,0],g){case 15:v=h(v,f([0,d[A+14]],48));case 14:v=h(v,f([0,d[A+13]],40));case 13:v=h(v,f([0,d[A+12]],32));case 12:v=h(v,f([0,d[A+11]],24));case 11:v=h(v,f([0,d[A+10]],16));case 10:v=h(v,f([0,d[A+9]],8));case 9:v=h(v,[0,d[A+8]]),v=c(v,x),v=u(v,33),v=c(v,I),b=h(b,v);case 8:_=h(_,f([0,d[A+7]],56));case 7:_=h(_,f([0,d[A+6]],48));case 6:_=h(_,f([0,d[A+5]],40));case 5:_=h(_,f([0,d[A+4]],32));case 4:_=h(_,f([0,d[A+3]],24));case 3:_=h(_,f([0,d[A+2]],16));case 2:_=h(_,f([0,d[A+1]],8));case 1:_=h(_,[0,d[A]]),_=c(_,I),_=u(_,31),_=c(_,x),w=h(w,_)}return w=h(w,[0,d.length]),b=h(b,[0,d.length]),w=a(w,b),b=a(b,w),w=p(w),b=p(b),w=a(w,b),b=a(b,w),("00000000"+(w[0]>>>0).toString(16)).slice(-8)+("00000000"+(w[1]>>>0).toString(16)).slice(-8)+("00000000"+(b[0]>>>0).toString(16)).slice(-8)+("00000000"+(b[1]>>>0).toString(16)).slice(-8)},typeof V2<"u"?(typeof g6<"u"&&g6.exports&&(V2=g6.exports=t),V2.murmurHash3=t):typeof define=="function"&&define.amd?define([],function(){return t}):(t._murmurHash3=r.murmurHash3,t.noConflict=function(){return r.murmurHash3=t._murmurHash3,t._murmurHash3=e,t.noConflict=e,t},r.murmurHash3=t)})(V2)});var oK=P((SXe,sK)=>{l();sK.exports=iK()});var bK=P((bZe,wK)=>{l();var bx=class{constructor(e,t=12,n=8*1024,i=32*1024,s=64,o){this.bits=t,this.min=n,this.max=i,this.asModule=e,this.rabin=new e.Rabin(t,n,i,s,o),this.polynomial=o}fingerprint(e){let{__retain:t,__release:n,__allocArray:i,__getInt32Array:s,Int32Array_ID:o,Uint8Array_ID:a}=this.asModule,c=new Int32Array(Math.ceil(e.length/this.min)),u=t(i(o,c)),f=t(i(a,e)),h=this.rabin.fingerprint(f,u),p=s(h);n(f),n(u);let d=p.indexOf(0);return d>=0?p.subarray(0,d):p}};wK.exports=bx});var AK=P(q2=>{"use strict";l();var i3e=typeof BigUint64Array<"u",z2=Symbol(),K2=1024;function EK(r,e){let t=new Uint32Array(r),n=new Uint16Array(r);var i=t[e+-4>>>2]>>>1,s=e>>>1;if(i<=K2)return String.fromCharCode.apply(String,n.subarray(s,s+i));let o=[];do{let a=n[s+K2-1],c=a>=55296&&a<56320?K2-1:K2;o.push(String.fromCharCode.apply(String,n.subarray(s,s+=c))),i-=c}while(i>K2);return o.join("")+String.fromCharCode.apply(String,n.subarray(s,s+i))}function Ex(r){let e={};function t(i,s){return i?EK(i.buffer,s):"<yet unknown>"}let n=r.env=r.env||{};return n.abort=n.abort||function(s,o,a,c){let u=e.memory||n.memory;throw Error("abort: "+t(u,s)+" at "+t(u,o)+":"+a+":"+c)},n.trace=n.trace||function(s,o){let a=e.memory||n.memory;console.log("trace: "+t(a,s)+(o?" ":"")+Array.prototype.slice.call(arguments,2,2+o).join(", "))},r.Math=r.Math||Math,r.Date=r.Date||Date,e}function _x(r,e){let t=e.exports,n=t.memory,i=t.table,s=t.__alloc,o=t.__retain,a=t.__rtti_base||-1;function c(x){let A=new Uint32Array(n.buffer),R=A[a>>>2];if((x>>>=0)>=R)throw Error("invalid id: "+x);return A[(a+4>>>2)+x*2]}function u(x){let A=new Uint32Array(n.buffer),R=A[a>>>2];if((x>>>=0)>=R)throw Error("invalid id: "+x);return A[(a+4>>>2)+x*2+1]}function f(x){return 31-Math.clz32(x>>>5&31)}function h(x){return 31-Math.clz32(x>>>14&31)}function p(x){let A=x.length,R=s(A<<1,1),O=new Uint16Array(n.buffer);for(var V=0,$=R>>>1;V<A;++V)O[$+V]=x.charCodeAt(V);return R}r.__allocString=p;function d(x){let A=n.buffer;if(new Uint32Array(A)[x+-8>>>2]!==1)throw Error("not a string: "+x);return EK(A,x)}r.__getString=d;function m(x,A,R){let O=n.buffer;if(R)switch(x){case 2:return new Float32Array(O);case 3:return new Float64Array(O)}else switch(x){case 0:return new(A?Int8Array:Uint8Array)(O);case 1:return new(A?Int16Array:Uint16Array)(O);case 2:return new(A?Int32Array:Uint32Array)(O);case 3:return new(A?BigInt64Array:BigUint64Array)(O)}throw Error("unsupported align: "+x)}function g(x,A){let R=c(x);if(!(R&3))throw Error("not an array: "+x+" @ "+R);let O=f(R),V=A.length,$=s(V<<O,0),Y=s(R&2?16:12,x),Q=new Uint32Array(n.buffer);Q[Y+0>>>2]=o($),Q[Y+4>>>2]=$,Q[Y+8>>>2]=V<<O,R&2&&(Q[Y+12>>>2]=V);let pe=m(O,R&1024,R&2048);if(R&8192)for(let re=0;re<V;++re)pe[($>>>O)+re]=o(A[re]);else pe.set(A,$>>>O);return Y}r.__allocArray=g;function y(x){let A=new Uint32Array(n.buffer),R=A[x+-8>>>2],O=c(R);if(!(O&1))throw Error("not an array: "+R);let V=f(O);var $=A[x+4>>>2];let Y=O&2?A[x+12>>>2]:A[$+-4>>>2]>>>V;return m(V,O&1024,O&2048).subarray($>>>=V,$+Y)}r.__getArrayView=y;function w(x){let A=y(x),R=A.length,O=new Array(R);for(let V=0;V<R;V++)O[V]=A[V];return O}r.__getArray=w;function b(x){let A=n.buffer,R=new Uint32Array(A)[x+-4>>>2];return A.slice(x,x+R)}r.__getArrayBuffer=b;function _(x,A,R){return new x(v(x,A,R))}function v(x,A,R){let O=n.buffer,V=new Uint32Array(O),$=V[R+4>>>2];return new x(O,$,V[$+-4>>>2]>>>A)}r.__getInt8Array=_.bind(null,Int8Array,0),r.__getInt8ArrayView=v.bind(null,Int8Array,0),r.__getUint8Array=_.bind(null,Uint8Array,0),r.__getUint8ArrayView=v.bind(null,Uint8Array,0),r.__getUint8ClampedArray=_.bind(null,Uint8ClampedArray,0),r.__getUint8ClampedArrayView=v.bind(null,Uint8ClampedArray,0),r.__getInt16Array=_.bind(null,Int16Array,1),r.__getInt16ArrayView=v.bind(null,Int16Array,1),r.__getUint16Array=_.bind(null,Uint16Array,1),r.__getUint16ArrayView=v.bind(null,Uint16Array,1),r.__getInt32Array=_.bind(null,Int32Array,2),r.__getInt32ArrayView=v.bind(null,Int32Array,2),r.__getUint32Array=_.bind(null,Uint32Array,2),r.__getUint32ArrayView=v.bind(null,Uint32Array,2),i3e&&(r.__getInt64Array=_.bind(null,BigInt64Array,3),r.__getInt64ArrayView=v.bind(null,BigInt64Array,3),r.__getUint64Array=_.bind(null,BigUint64Array,3),r.__getUint64ArrayView=v.bind(null,BigUint64Array,3)),r.__getFloat32Array=_.bind(null,Float32Array,2),r.__getFloat32ArrayView=v.bind(null,Float32Array,2),r.__getFloat64Array=_.bind(null,Float64Array,3),r.__getFloat64ArrayView=v.bind(null,Float64Array,3);function I(x,A){let R=new Uint32Array(n.buffer);var O=R[x+-8>>>2];if(O<=R[a>>>2])do if(O==A)return!0;while(O=u(O));return!1}return r.__instanceof=I,r.memory=r.memory||n,r.table=r.table||i,xK(t,r)}function _K(r){return typeof Response<"u"&&r instanceof Response}async function vK(r,e){return _K(r=await r)?SK(r,e):_x(Ex(e||(e={})),await WebAssembly.instantiate(r instanceof WebAssembly.Module?r:await WebAssembly.compile(r),e))}q2.instantiate=vK;function s3e(r,e){return _x(Ex(e||(e={})),new WebAssembly.Instance(r instanceof WebAssembly.Module?r:new WebAssembly.Module(r),e))}q2.instantiateSync=s3e;async function SK(r,e){return WebAssembly.instantiateStreaming?_x(Ex(e||(e={})),(await WebAssembly.instantiateStreaming(r,e)).instance):vK(_K(r=await r)?r.arrayBuffer():r,e)}q2.instantiateStreaming=SK;function xK(r,e){var t=e?Object.create(e):{},n=r.__argumentsLength?function(i){r.__argumentsLength.value=i}:r.__setArgumentsLength||r.__setargc||function(){};for(let i in r){if(!Object.prototype.hasOwnProperty.call(r,i))continue;let s=r[i],o=i.split("."),a=t;for(;o.length>1;){let f=o.shift();Object.prototype.hasOwnProperty.call(a,f)||(a[f]={}),a=a[f]}let c=o[0],u=c.indexOf("#");if(u>=0){let f=c.substring(0,u),h=a[f];if(typeof h>"u"||!h.prototype){let p=function(...d){return p.wrap(p.prototype.constructor(0,...d))};p.prototype={valueOf:function(){return this[z2]}},p.wrap=function(d){return Object.create(p.prototype,{[z2]:{value:d,writable:!1}})},h&&Object.getOwnPropertyNames(h).forEach(d=>Object.defineProperty(p,d,Object.getOwnPropertyDescriptor(h,d))),a[f]=p}if(c=c.substring(u+1),a=a[f].prototype,/^(get|set):/.test(c)){if(!Object.prototype.hasOwnProperty.call(a,c=c.substring(4))){let p=r[i.replace("set:","get:")],d=r[i.replace("get:","set:")];Object.defineProperty(a,c,{get:function(){return p(this[z2])},set:function(m){d(this[z2],m)},enumerable:!0})}}else c==="constructor"?(a[c]=(...p)=>(n(p.length),s(...p))).original=s:(a[c]=function(...p){return n(p.length),s(this[z2],...p)}).original=s}else/^(get|set):/.test(c)?Object.prototype.hasOwnProperty.call(a,c=c.substring(4))||Object.defineProperty(a,c,{get:r[i.replace("set:","get:")],set:r[i.replace("get:","set:")],enumerable:!0}):typeof s=="function"&&s!==n?(a[c]=(...f)=>(n(f.length),s(...f))).original=s:a[c]=s}return t}q2.demangle=xK});var IK=P((SZe,TK)=>{l();var{instantiate:o3e}=AK();vx.supported=typeof WebAssembly<"u";function vx(r={}){if(!vx.supported)return null;var e=new Uint8Array([0,97,115,109,1,0,0,0,1,78,14,96,2,127,126,0,96,1,127,1,126,96,2,127,127,0,96,1,127,1,127,96,1,127,0,96,2,127,127,1,127,96,3,127,127,127,1,127,96,0,0,96,3,127,127,127,0,96,0,1,127,96,4,127,127,127,127,0,96,5,127,127,127,127,127,1,127,96,1,126,1,127,96,2,126,126,1,126,2,13,1,3,101,110,118,5,97,98,111,114,116,0,10,3,54,53,2,2,8,9,3,5,2,8,6,5,3,4,2,6,9,12,13,2,5,11,3,2,3,2,3,2,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,6,7,7,4,4,5,3,1,0,1,6,47,9,127,1,65,0,11,127,1,65,0,11,127,0,65,3,11,127,0,65,4,11,127,1,65,0,11,127,1,65,0,11,127,1,65,0,11,127,0,65,240,2,11,127,0,65,6,11,7,240,5,41,6,109,101,109,111,114,121,2,0,7,95,95,97,108,108,111,99,0,10,8,95,95,114,101,116,97,105,110,0,11,9,95,95,114,101,108,101,97,115,101,0,12,9,95,95,99,111,108,108,101,99,116,0,51,11,95,95,114,116,116,105,95,98,97,115,101,3,7,13,73,110,116,51,50,65,114,114,97,121,95,73,68,3,2,13,85,105,110,116,56,65,114,114,97,121,95,73,68,3,3,6,100,101,103,114,101,101,0,16,3,109,111,100,0,17,5,82,97,98,105,110,3,8,16,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,0,21,16,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,0,22,21,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,23,21,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,24,14,82,97,98,105,110,35,103,101,116,58,119,112,111,115,0,25,14,82,97,98,105,110,35,115,101,116,58,119,112,111,115,0,26,15,82,97,98,105,110,35,103,101,116,58,99,111,117,110,116,0,27,15,82,97,98,105,110,35,115,101,116,58,99,111,117,110,116,0,28,13,82,97,98,105,110,35,103,101,116,58,112,111,115,0,29,13,82,97,98,105,110,35,115,101,116,58,112,111,115,0,30,15,82,97,98,105,110,35,103,101,116,58,115,116,97,114,116,0,31,15,82,97,98,105,110,35,115,101,116,58,115,116,97,114,116,0,32,16,82,97,98,105,110,35,103,101,116,58,100,105,103,101,115,116,0,33,16,82,97,98,105,110,35,115,101,116,58,100,105,103,101,115,116,0,34,21,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,35,21,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,36,22,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,37,22,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,38,31,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,39,31,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,40,20,82,97,98,105,110,35,103,101,116,58,112,111,108,121,110,111,109,105,97,108,0,41,20,82,97,98,105,110,35,115,101,116,58,112,111,108,121,110,111,109,105,97,108,0,42,17,82,97,98,105,110,35,103,101,116,58,109,105,110,115,105,122,101,0,43,17,82,97,98,105,110,35,115,101,116,58,109,105,110,115,105,122,101,0,44,17,82,97,98,105,110,35,103,101,116,58,109,97,120,115,105,122,101,0,45,17,82,97,98,105,110,35,115,101,116,58,109,97,120,115,105,122,101,0,46,14,82,97,98,105,110,35,103,101,116,58,109,97,115,107,0,47,14,82,97,98,105,110,35,115,101,116,58,109,97,115,107,0,48,17,82,97,98,105,110,35,99,111,110,115,116,114,117,99,116,111,114,0,20,17,82,97,98,105,110,35,102,105,110,103,101,114,112,114,105,110,116,0,49,8,1,50,10,165,31,53,199,1,1,4,127,32,1,40,2,0,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,3,65,4,107,118,65,16,115,33,4,32,3,65,7,107,11,33,3,32,1,40,2,20,33,2,32,1,40,2,16,34,5,4,64,32,5,32,2,54,2,20,11,32,2,4,64,32,2,32,5,54,2,16,11,32,1,32,0,32,4,32,3,65,4,116,106,65,2,116,106,40,2,96,70,4,64,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,2,54,2,96,32,2,69,4,64,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,65,127,115,113,34,1,54,2,4,32,1,69,4,64,32,0,32,0,40,2,0,65,1,32,3,116,65,127,115,113,54,2,0,11,11,11,11,226,2,1,6,127,32,1,40,2,0,33,3,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,34,5,65,1,113,4,64,32,3,65,124,113,65,16,106,32,5,65,124,113,106,34,2,65,240,255,255,255,3,73,4,64,32,0,32,4,16,1,32,1,32,2,32,3,65,3,113,114,34,3,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,33,5,11,11,32,3,65,2,113,4,64,32,1,65,4,107,40,2,0,34,2,40,2,0,34,6,65,124,113,65,16,106,32,3,65,124,113,106,34,7,65,240,255,255,255,3,73,4,64,32,0,32,2,16,1,32,2,32,7,32,6,65,3,113,114,34,3,54,2,0,32,2,33,1,11,11,32,4,32,5,65,2,114,54,2,0,32,4,65,4,107,32,1,54,2,0,32,0,32,3,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,2,65,4,107,118,65,16,115,33,4,32,2,65,7,107,11,34,3,65,4,116,32,4,106,65,2,116,106,40,2,96,33,2,32,1,65,0,54,2,16,32,1,32,2,54,2,20,32,2,4,64,32,2,32,1,54,2,16,11,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,1,54,2,96,32,0,32,0,40,2,0,65,1,32,3,116,114,54,2,0,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,114,54,2,4,11,119,1,1,127,32,2,2,127,32,0,40,2,160,12,34,2,4,64,32,2,32,1,65,16,107,70,4,64,32,2,40,2,0,33,3,32,1,65,16,107,33,1,11,11,32,1,11,107,34,2,65,48,73,4,64,15,11,32,1,32,3,65,2,113,32,2,65,32,107,65,1,114,114,54,2,0,32,1,65,0,54,2,16,32,1,65,0,54,2,20,32,1,32,2,106,65,16,107,34,2,65,2,54,2,0,32,0,32,2,54,2,160,12,32,0,32,1,16,2,11,155,1,1,3,127,35,0,34,0,69,4,64,65,1,63,0,34,0,74,4,127,65,1,32,0,107,64,0,65,0,72,5,65,0,11,4,64,0,11,65,176,3,34,0,65,0,54,2,0,65,208,15,65,0,54,2,0,3,64,32,1,65,23,73,4,64,32,1,65,2,116,65,176,3,106,65,0,54,2,4,65,0,33,2,3,64,32,2,65,16,73,4,64,32,1,65,4,116,32,2,106,65,2,116,65,176,3,106,65,0,54,2,96,32,2,65,1,106,33,2,12,1,11,11,32,1,65,1,106,33,1,12,1,11,11,65,176,3,65,224,15,63,0,65,16,116,16,3,65,176,3,36,0,11,32,0,11,45,0,32,0,65,240,255,255,255,3,79,4,64,65,32,65,224,0,65,201,3,65,29,16,0,0,11,32,0,65,15,106,65,112,113,34,0,65,16,32,0,65,16,75,27,11,169,1,1,1,127,32,0,32,1,65,128,2,73,4,127,32,1,65,4,118,33,1,65,0,5,32,1,65,248,255,255,255,1,73,4,64,32,1,65,1,65,27,32,1,103,107,116,106,65,1,107,33,1,11,32,1,65,31,32,1,103,107,34,2,65,4,107,118,65,16,115,33,1,32,2,65,7,107,11,34,2,65,2,116,106,40,2,4,65,127,32,1,116,113,34,1,4,127,32,0,32,1,104,32,2,65,4,116,106,65,2,116,106,40,2,96,5,32,0,40,2,0,65,127,32,2,65,1,106,116,113,34,1,4,127,32,0,32,0,32,1,104,34,0,65,2,116,106,40,2,4,104,32,0,65,4,116,106,65,2,116,106,40,2,96,5,65,0,11,11,11,111,1,1,127,63,0,34,2,32,1,65,248,255,255,255,1,73,4,127,32,1,65,1,65,27,32,1,103,107,116,65,1,107,106,5,32,1,11,65,16,32,0,40,2,160,12,32,2,65,16,116,65,16,107,71,116,106,65,255,255,3,106,65,128,128,124,113,65,16,118,34,1,32,2,32,1,74,27,64,0,65,0,72,4,64,32,1,64,0,65,0,72,4,64,0,11,11,32,0,32,2,65,16,116,63,0,65,16,116,16,3,11,113,1,2,127,32,1,40,2,0,34,3,65,124,113,32,2,107,34,4,65,32,79,4,64,32,1,32,2,32,3,65,2,113,114,54,2,0,32,2,32,1,65,16,106,106,34,1,32,4,65,16,107,65,1,114,54,2,0,32,0,32,1,16,2,5,32,1,32,3,65,126,113,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,32,1,65,16,106,32,1,40,2,0,65,124,113,106,40,2,0,65,125,113,54,2,0,11,11,91,1,2,127,32,0,32,1,16,5,34,4,16,6,34,3,69,4,64,65,1,36,1,65,0,36,1,32,0,32,4,16,6,34,3,69,4,64,32,0,32,4,16,7,32,0,32,4,16,6,33,3,11,11,32,3,65,0,54,2,4,32,3,32,2,54,2,8,32,3,32,1,54,2,12,32,0,32,3,16,1,32,0,32,3,32,4,16,8,32,3,11,13,0,16,4,32,0,32,1,16,9,65,16,106,11,33,1,1,127,32,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,18,0,32,0,65,172,3,75,4,64,32,0,65,16,107,16,52,11,11,140,3,1,1,127,2,64,32,1,69,13,0,32,0,65,0,58,0,0,32,0,32,1,106,65,1,107,65,0,58,0,0,32,1,65,2,77,13,0,32,0,65,1,106,65,0,58,0,0,32,0,65,2,106,65,0,58,0,0,32,0,32,1,106,34,2,65,2,107,65,0,58,0,0,32,2,65,3,107,65,0,58,0,0,32,1,65,6,77,13,0,32,0,65,3,106,65,0,58,0,0,32,0,32,1,106,65,4,107,65,0,58,0,0,32,1,65,8,77,13,0,32,1,65,0,32,0,107,65,3,113,34,1,107,33,2,32,0,32,1,106,34,0,65,0,54,2,0,32,0,32,2,65,124,113,34,1,106,65,4,107,65,0,54,2,0,32,1,65,8,77,13,0,32,0,65,4,106,65,0,54,2,0,32,0,65,8,106,65,0,54,2,0,32,0,32,1,106,34,2,65,12,107,65,0,54,2,0,32,2,65,8,107,65,0,54,2,0,32,1,65,24,77,13,0,32,0,65,12,106,65,0,54,2,0,32,0,65,16,106,65,0,54,2,0,32,0,65,20,106,65,0,54,2,0,32,0,65,24,106,65,0,54,2,0,32,0,32,1,106,34,2,65,28,107,65,0,54,2,0,32,2,65,24,107,65,0,54,2,0,32,2,65,20,107,65,0,54,2,0,32,2,65,16,107,65,0,54,2,0,32,0,32,0,65,4,113,65,24,106,34,2,106,33,0,32,1,32,2,107,33,1,3,64,32,1,65,32,79,4,64,32,0,66,0,55,3,0,32,0,65,8,106,66,0,55,3,0,32,0,65,16,106,66,0,55,3,0,32,0,65,24,106,66,0,55,3,0,32,1,65,32,107,33,1,32,0,65,32,106,33,0,12,1,11,11,11,11,178,1,1,3,127,32,1,65,240,255,255,255,3,32,2,118,75,4,64,65,144,1,65,192,1,65,23,65,56,16,0,0,11,32,1,32,2,116,34,3,65,0,16,10,34,2,32,3,16,13,32,0,69,4,64,65,12,65,2,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,2,34,1,32,0,40,2,0,34,4,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,32,4,16,12,11,32,0,32,1,54,2,0,32,0,32,2,54,2,4,32,0,32,3,54,2,8,32,0,11,46,1,2,127,65,12,65,5,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,65,128,2,65,3,16,14,11,9,0,65,63,32,0,121,167,107,11,49,1,2,127,65,63,32,1,121,167,107,33,2,3,64,65,63,32,0,121,167,107,32,2,107,34,3,65,0,78,4,64,32,0,32,1,32,3,172,134,133,33,0,12,1,11,11,32,0,11,40,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,163,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,65,0,58,0,0,11,38,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,152,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,45,0,0,11,254,5,2,1,127,4,126,32,0,69,4,64,65,232,0,65,6,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,24,32,0,66,0,55,3,32,32,0,66,0,55,3,40,32,0,66,0,55,3,48,32,0,66,0,55,3,56,32,0,66,0,55,3,64,32,0,66,0,55,3,72,32,0,66,0,55,3,80,32,0,66,0,55,3,88,32,0,66,0,55,3,96,32,0,32,2,173,55,3,80,32,0,32,3,173,55,3,88,65,12,65,4,16,10,34,2,65,172,3,75,4,64,32,2,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,32,4,65,0,16,14,33,2,32,0,40,2,0,16,12,32,0,32,2,54,2,0,32,0,32,4,54,2,4,32,0,66,1,32,1,173,134,66,1,125,55,3,96,32,0,66,243,130,183,218,216,230,232,30,55,3,72,35,4,69,4,64,65,0,33,2,3,64,32,2,65,128,2,72,4,64,32,2,65,255,1,113,173,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,65,0,33,4,3,64,32,4,32,0,40,2,4,65,1,107,72,4,64,32,6,66,8,134,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,32,4,65,1,106,33,4,12,1,11,11,35,6,40,2,4,32,2,65,3,116,106,32,6,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,63,32,0,41,3,72,121,167,107,172,33,7,65,0,33,2,3,64,32,2,65,128,2,72,4,64,35,5,33,1,32,2,172,32,7,134,34,8,33,6,65,63,32,0,41,3,72,34,9,121,167,107,33,3,3,64,65,63,32,6,121,167,107,32,3,107,34,4,65,0,78,4,64,32,6,32,9,32,4,172,134,133,33,6,12,1,11,11,32,1,40,2,4,32,2,65,3,116,106,32,6,32,8,132,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,1,36,4,11,32,0,66,0,55,3,24,32,0,66,0,55,3,32,65,0,33,2,3,64,32,2,32,0,40,2,4,72,4,64,32,0,40,2,0,32,2,16,18,32,2,65,1,106,33,2,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,6,66,45,136,167,65,3,116,106,41,3,0,32,6,66,8,134,66,1,132,133,55,3,40,32,0,11,38,1,1,127,32,0,40,2,0,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,55,1,2,127,32,1,32,0,40,2,0,34,2,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,16,12,11,32,0,32,1,54,2,0,11,7,0,32,0,40,2,4,11,9,0,32,0,32,1,54,2,4,11,7,0,32,0,40,2,8,11,9,0,32,0,32,1,54,2,8,11,7,0,32,0,41,3,16,11,9,0,32,0,32,1,55,3,16,11,7,0,32,0,41,3,24,11,9,0,32,0,32,1,55,3,24,11,7,0,32,0,41,3,32,11,9,0,32,0,32,1,55,3,32,11,7,0,32,0,41,3,40,11,9,0,32,0,32,1,55,3,40,11,7,0,32,0,41,3,48,11,9,0,32,0,32,1,55,3,48,11,7,0,32,0,41,3,56,11,9,0,32,0,32,1,55,3,56,11,7,0,32,0,41,3,64,11,9,0,32,0,32,1,55,3,64,11,7,0,32,0,41,3,72,11,9,0,32,0,32,1,55,3,72,11,7,0,32,0,41,3,80,11,9,0,32,0,32,1,55,3,80,11,7,0,32,0,41,3,88,11,9,0,32,0,32,1,55,3,88,11,7,0,32,0,41,3,96,11,9,0,32,0,32,1,55,3,96,11,172,4,2,5,127,1,126,32,2,65,172,3,75,4,64,32,2,65,16,107,34,4,32,4,40,2,4,65,1,106,54,2,4,11,32,2,33,4,65,0,33,2,32,1,40,2,8,33,5,32,1,40,2,4,33,6,3,64,2,127,65,0,33,3,3,64,32,3,32,5,72,4,64,32,3,32,6,106,45,0,0,33,1,32,0,40,2,0,32,0,40,2,8,16,19,33,7,32,0,40,2,8,32,0,40,2,0,40,2,4,106,32,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,7,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,1,173,32,8,66,8,134,132,133,55,3,40,32,0,32,0,41,3,16,66,1,124,55,3,16,32,0,32,0,41,3,24,66,1,124,55,3,24,32,0,41,3,16,32,0,41,3,80,90,4,127,32,0,41,3,40,32,0,41,3,96,131,80,5,65,0,11,4,127,65,1,5,32,0,41,3,16,32,0,41,3,88,90,11,4,64,32,0,32,0,41,3,32,55,3,48,32,0,32,0,41,3,16,55,3,56,32,0,32,0,41,3,40,55,3,64,65,0,33,1,3,64,32,1,32,0,40,2,4,72,4,64,32,0,40,2,0,32,1,16,18,32,1,65,1,106,33,1,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,8,66,8,134,66,1,132,133,55,3,40,32,3,65,1,106,12,3,11,32,3,65,1,106,33,3,12,1,11,11,65,127,11,34,1,65,0,78,4,64,32,5,32,1,107,33,5,32,1,32,6,106,33,6,32,2,34,1,65,1,106,33,2,32,4,40,2,4,32,1,65,2,116,106,32,0,41,3,56,62,2,0,12,1,11,11,32,4,11,10,0,16,15,36,5,16,15,36,6,11,3,0,1,11,73,1,2,127,32,0,40,2,4,34,1,65,255,255,255,255,0,113,34,2,65,1,70,4,64,32,0,65,16,106,16,53,32,0,32,0,40,2,0,65,1,114,54,2,0,35,0,32,0,16,2,5,32,0,32,2,65,1,107,32,1,65,128,128,128,128,127,113,114,54,2,4,11,11,58,0,2,64,2,64,2,64,32,0,65,8,107,40,2,0,14,7,0,0,1,1,1,1,1,2,11,15,11,32,0,40,2,0,34,0,4,64,32,0,65,172,3,79,4,64,32,0,65,16,107,16,52,11,11,15,11,0,11,11,137,3,7,0,65,16,11,55,40,0,0,0,1,0,0,0,1,0,0,0,40,0,0,0,97,0,108,0,108,0,111,0,99,0,97,0,116,0,105,0,111,0,110,0,32,0,116,0,111,0,111,0,32,0,108,0,97,0,114,0,103,0,101,0,65,208,0,11,45,30,0,0,0,1,0,0,0,1,0,0,0,30,0,0,0,126,0,108,0,105,0,98,0,47,0,114,0,116,0,47,0,116,0,108,0,115,0,102,0,46,0,116,0,115,0,65,128,1,11,43,28,0,0,0,1,0,0,0,1,0,0,0,28,0,0,0,73,0,110,0,118,0,97,0,108,0,105,0,100,0,32,0,108,0,101,0,110,0,103,0,116,0,104,0,65,176,1,11,53,38,0,0,0,1,0,0,0,1,0,0,0,38,0,0,0,126,0,108,0,105,0,98,0,47,0,97,0,114,0,114,0,97,0,121,0,98,0,117,0,102,0,102,0,101,0,114,0,46,0,116,0,115,0,65,240,1,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,73,0,110,0,100,0,101,0,120,0,32,0,111,0,117,0,116,0,32,0,111,0,102,0,32,0,114,0,97,0,110,0,103,0,101,0,65,176,2,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,126,0,108,0,105,0,98,0,47,0,116,0,121,0,112,0,101,0,100,0,97,0,114,0,114,0,97,0,121,0,46,0,116,0,115,0,65,240,2,11,53,7,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,145,4,0,0,2,0,0,0,49,0,0,0,2,0,0,0,17,1,0,0,2,0,0,0,16,0,34,16,115,111,117,114,99,101,77,97,112,112,105,110,103,85,82,76,16,46,47,114,97,98,105,110,46,119,97,115,109,46,109,97,112]);return o3e(new Response(new Blob([e],{type:"application/wasm"})),r)}TK.exports=vx});var PK=P((AZe,CK)=>{l();var RK=bK(),a3e=IK(),c3e=async(r,e,t,n,i)=>{let s=await a3e();return new RK(s,r,e,t,n,i)};CK.exports={Rabin:RK,create:c3e}});var MK=P((ZZe,UK)=>{"use strict";l();UK.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let n=this._internalPositionFor(e,!1);if(t===void 0)n!==-1&&(this._unsetInternalPos(n),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let i=!1;n===-1?(n=this._data.length,this._setBit(e),this._changedData=!0):i=!0,this._setInternalPos(n,e,t,i),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();let t=this._internalPositionFor(e,!0);if(t!==-1)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){let e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,n=new Array(this.length);for(;t<this.length;)n[t]=e(this.get(t),t,this),t++;return n}reduce(e,t){let n=0,i=t;for(;n<this.length;){let s=this.get(n);i=e(i,s,n),n++}return i}find(e){let t=0,n,i;for(;t<this.length&&!n;)i=this.get(t),n=e(i),t++;return n?i:void 0}_internalPositionFor(e,t){let n=this._bytePosFor(e,t);if(n>=this._bitArrays.length)return-1;let i=this._bitArrays[n],s=e-n*7;if(!((i&1<<s)>0))return-1;let a=this._bitArrays.slice(0,n).reduce(y3e,0),c=~(4294967295<<s+1),u=BK(i&c);return a+u-1}_bytePosFor(e,t){let n=Math.floor(e/7),i=n+1;for(;!t&&this._bitArrays.length<i;)this._bitArrays.push(0);return n}_setBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-t*7}_unsetBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-t*7)}_setInternalPos(e,t,n,i){let s=this._data,o=[t,n];if(i)this._sortData(),s[e]=o;else{if(s.length)if(s[s.length-1][0]>=t)s.push(o);else if(s[0][0]<=t)s.unshift(o);else{let a=Math.round(s.length/2);this._data=s.slice(0,a).concat(o).concat(s.slice(a))}else this._data.push(o);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(w3e),this._changedData=!1}bitField(){let e=[],t=8,n=0,i=0,s,o=this._bitArrays.slice();for(;o.length||n;){n===0&&(s=o.shift(),n=7);let c=Math.min(n,t),u=~(255<<c),f=s&u;i|=f<<8-t,s=s>>>c,n-=c,t-=c,(!t||!n&&!o.length)&&(e.push(i),i=0,t=8)}for(var a=e.length-1;a>0&&e[a]===0;a--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(b3e)}};function y3e(r,e){return r+BK(e)}function BK(r){let e=r;return e=e-(e>>1&1431655765),e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}function w3e(r,e){return r[0]-e[0]}function b3e(r){return r[1]}});var yq=P((Vtt,gq)=>{"use strict";l();gq.exports={RTLD_LAZY:1,RTLD_NOW:2,RTLD_GLOBAL:256,RTLD_LOCAL:0,RTLD_DEEPBIND:8,E2BIG:7,EACCES:13,EADDRINUSE:98,EADDRNOTAVAIL:99,EAFNOSUPPORT:97,EAGAIN:11,EALREADY:114,EBADF:9,EBADMSG:74,EBUSY:16,ECANCELED:125,ECHILD:10,ECONNABORTED:103,ECONNREFUSED:111,ECONNRESET:104,EDEADLK:35,EDESTADDRREQ:89,EDOM:33,EDQUOT:122,EEXIST:17,EFAULT:14,EFBIG:27,EHOSTUNREACH:113,EIDRM:43,EILSEQ:84,EINPROGRESS:115,EINTR:4,EINVAL:22,EIO:5,EISCONN:106,EISDIR:21,ELOOP:40,EMFILE:24,EMLINK:31,EMSGSIZE:90,EMULTIHOP:72,ENAMETOOLONG:36,ENETDOWN:100,ENETRESET:102,ENETUNREACH:101,ENFILE:23,ENOBUFS:105,ENODATA:61,ENODEV:19,ENOENT:2,ENOEXEC:8,ENOLCK:37,ENOLINK:67,ENOMEM:12,ENOMSG:42,ENOPROTOOPT:92,ENOSPC:28,ENOSR:63,ENOSTR:60,ENOSYS:38,ENOTCONN:107,ENOTDIR:20,ENOTEMPTY:39,ENOTSOCK:88,ENOTSUP:95,ENOTTY:25,ENXIO:6,EOPNOTSUPP:95,EOVERFLOW:75,EPERM:1,EPIPE:32,EPROTO:71,EPROTONOSUPPORT:93,EPROTOTYPE:91,ERANGE:34,EROFS:30,ESPIPE:29,ESRCH:3,ESTALE:116,ETIME:62,ETIMEDOUT:110,ETXTBSY:26,EWOULDBLOCK:11,EXDEV:18,PRIORITY_LOW:19,PRIORITY_BELOW_NORMAL:10,PRIORITY_NORMAL:0,PRIORITY_ABOVE_NORMAL:-7,PRIORITY_HIGH:-14,PRIORITY_HIGHEST:-20,SIGHUP:1,SIGINT:2,SIGQUIT:3,SIGILL:4,SIGTRAP:5,SIGABRT:6,SIGIOT:6,SIGBUS:7,SIGFPE:8,SIGKILL:9,SIGUSR1:10,SIGSEGV:11,SIGUSR2:12,SIGPIPE:13,SIGALRM:14,SIGTERM:15,SIGCHLD:17,SIGSTKFLT:16,SIGCONT:18,SIGSTOP:19,SIGTSTP:20,SIGTTIN:21,SIGTTOU:22,SIGURG:23,SIGXCPU:24,SIGXFSZ:25,SIGVTALRM:26,SIGPROF:27,SIGWINCH:28,SIGIO:29,SIGPOLL:29,SIGPWR:30,SIGSYS:31,UV_FS_SYMLINK_DIR:1,UV_FS_SYMLINK_JUNCTION:2,O_RDONLY:0,O_WRONLY:1,O_RDWR:2,UV_DIRENT_UNKNOWN:0,UV_DIRENT_FILE:1,UV_DIRENT_DIR:2,UV_DIRENT_LINK:3,UV_DIRENT_FIFO:4,UV_DIRENT_SOCKET:5,UV_DIRENT_CHAR:6,UV_DIRENT_BLOCK:7,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:64,O_EXCL:128,UV_FS_O_FILEMAP:0,O_NOCTTY:256,O_TRUNC:512,O_APPEND:1024,O_DIRECTORY:65536,O_NOATIME:262144,O_NOFOLLOW:131072,O_SYNC:1052672,O_DSYNC:4096,O_DIRECT:16384,O_NONBLOCK:2048,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1,UV_FS_COPYFILE_FICLONE:2,COPYFILE_FICLONE:2,UV_FS_COPYFILE_FICLONE_FORCE:4,COPYFILE_FICLONE_FORCE:4,OPENSSL_VERSION_NUMBER:805306496,SSL_OP_ALL:2147485776,SSL_OP_ALLOW_NO_DHE_KEX:1024,SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION:262144,SSL_OP_CIPHER_SERVER_PREFERENCE:4194304,SSL_OP_CISCO_ANYCONNECT:32768,SSL_OP_COOKIE_EXCHANGE:8192,SSL_OP_CRYPTOPRO_TLSEXT_BUG:2147483648,SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS:2048,SSL_OP_EPHEMERAL_RSA:0,SSL_OP_LEGACY_SERVER_CONNECT:4,SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER:0,SSL_OP_MICROSOFT_SESS_ID_BUG:0,SSL_OP_MSIE_SSLV2_RSA_PADDING:0,SSL_OP_NETSCAPE_CA_DN_BUG:0,SSL_OP_NETSCAPE_CHALLENGE_BUG:0,SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG:0,SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG:0,SSL_OP_NO_COMPRESSION:131072,SSL_OP_NO_ENCRYPT_THEN_MAC:524288,SSL_OP_NO_QUERY_MTU:4096,SSL_OP_NO_RENEGOTIATION:1073741824,SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION:65536,SSL_OP_NO_SSLv2:0,SSL_OP_NO_SSLv3:33554432,SSL_OP_NO_TICKET:16384,SSL_OP_NO_TLSv1:67108864,SSL_OP_NO_TLSv1_1:268435456,SSL_OP_NO_TLSv1_2:134217728,SSL_OP_NO_TLSv1_3:536870912,SSL_OP_PKCS1_CHECK_1:0,SSL_OP_PKCS1_CHECK_2:0,SSL_OP_PRIORITIZE_CHACHA:2097152,SSL_OP_SINGLE_DH_USE:0,SSL_OP_SINGLE_ECDH_USE:0,SSL_OP_SSLEAY_080_CLIENT_DH_BUG:0,SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG:0,SSL_OP_TLS_BLOCK_PADDING_BUG:0,SSL_OP_TLS_D5_BUG:0,SSL_OP_TLS_ROLLBACK_BUG:8388608,ENGINE_METHOD_RSA:1,ENGINE_METHOD_DSA:2,ENGINE_METHOD_DH:4,ENGINE_METHOD_RAND:8,ENGINE_METHOD_EC:2048,ENGINE_METHOD_CIPHERS:64,ENGINE_METHOD_DIGESTS:128,ENGINE_METHOD_PKEY_METHS:512,ENGINE_METHOD_PKEY_ASN1_METHS:1024,ENGINE_METHOD_ALL:65535,ENGINE_METHOD_NONE:0,DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,RSA_PSS_SALTLEN_DIGEST:-1,RSA_PSS_SALTLEN_MAX_SIGN:-2,RSA_PSS_SALTLEN_AUTO:-2,defaultCoreCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA",TLS1_VERSION:769,TLS1_1_VERSION:770,TLS1_2_VERSION:771,TLS1_3_VERSION:772,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6,defaultCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA"}});var jG=P((Zft,GG)=>{"use strict";l();GG.exports=zn;var vg=ef();function zn(r,e){this.lo=r>>>0,this.hi=e>>>0}var Zh=zn.zero=new zn(0,0);Zh.toNumber=function(){return 0};Zh.zzEncode=Zh.zzDecode=function(){return this};Zh.length=function(){return 1};var dbe=zn.zeroHash="\0\0\0\0\0\0\0\0";zn.fromNumber=function(e){if(e===0)return Zh;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new zn(n,i)};zn.from=function(e){if(typeof e=="number")return zn.fromNumber(e);if(vg.isString(e))if(vg.Long)e=vg.Long.fromString(e);else return zn.fromNumber(parseInt(e,10));return e.low||e.high?new zn(e.low>>>0,e.high>>>0):Zh};zn.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};zn.prototype.toLong=function(e){return vg.Long?new vg.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var Ju=String.prototype.charCodeAt;zn.fromHash=function(e){return e===dbe?Zh:new zn((Ju.call(e,0)|Ju.call(e,1)<<8|Ju.call(e,2)<<16|Ju.call(e,3)<<24)>>>0,(Ju.call(e,4)|Ju.call(e,5)<<8|Ju.call(e,6)<<16|Ju.call(e,7)<<24)>>>0)};zn.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};zn.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};zn.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};zn.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var ef=P(QA=>{"use strict";l();var Ie=QA;Ie.asPromise=Xl();Ie.base64=Zl();Ie.EventEmitter=Jl();Ie.float=eu();Ie.inquire=tu();Ie.utf8=ru();Ie.pool=nu();Ie.LongBits=jG();Ie.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);Ie.global=Ie.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||QA;Ie.emptyArray=Object.freeze?Object.freeze([]):[];Ie.emptyObject=Object.freeze?Object.freeze({}):{};Ie.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Ie.isString=function(e){return typeof e=="string"||e instanceof String};Ie.isObject=function(e){return e&&typeof e=="object"};Ie.isset=Ie.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};Ie.Buffer=function(){try{var r=Ie.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();Ie._Buffer_from=null;Ie._Buffer_allocUnsafe=null;Ie.newBuffer=function(e){return typeof e=="number"?Ie.Buffer?Ie._Buffer_allocUnsafe(e):new Ie.Array(e):Ie.Buffer?Ie._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Ie.Array=typeof Uint8Array<"u"?Uint8Array:Array;Ie.Long=Ie.global.dcodeIO&&Ie.global.dcodeIO.Long||Ie.global.Long||Ie.inquire("long");Ie.key2Re=/^true|false|0|1$/;Ie.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Ie.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Ie.longToHash=function(e){return e?Ie.LongBits.from(e).toHash():Ie.LongBits.zeroHash};Ie.longFromHash=function(e,t){var n=Ie.LongBits.fromHash(e);return Ie.Long?Ie.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function WG(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}Ie.merge=WG;Ie.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function YG(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&WG(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Ie.newError=YG;Ie.ProtocolError=YG("ProtocolError");Ie.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Ie.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};Ie.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Ie._configure=function(){var r=Ie.Buffer;if(!r){Ie._Buffer_from=Ie._Buffer_allocUnsafe=null;return}Ie._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},Ie._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var nT=P((rht,JG)=>{"use strict";l();JG.exports=Pt;var ro=ef(),XA,g5=ro.LongBits,QG=ro.base64,XG=ro.utf8;function Sg(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function JA(){}function pbe(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function Pt(){this.len=0,this.head=new Sg(JA,0,0),this.tail=this.head,this.states=null}var ZG=function(){return ro.Buffer?function(){return(Pt.create=function(){return new XA})()}:function(){return new Pt}};Pt.create=ZG();Pt.alloc=function(e){return new ro.Array(e)};ro.Array!==Array&&(Pt.alloc=ro.pool(Pt.alloc,ro.Array.prototype.subarray));Pt.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Sg(e,t,n),this.len+=t,this};function eT(r,e,t){e[t]=r&255}function mbe(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function tT(r,e){this.len=r,this.next=void 0,this.val=e}tT.prototype=Object.create(Sg.prototype);tT.prototype.fn=mbe;Pt.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new tT((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Pt.prototype.int32=function(e){return e<0?this._push(rT,10,g5.fromNumber(e)):this.uint32(e)};Pt.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function rT(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}Pt.prototype.uint64=function(e){var t=g5.from(e);return this._push(rT,t.length(),t)};Pt.prototype.int64=Pt.prototype.uint64;Pt.prototype.sint64=function(e){var t=g5.from(e).zzEncode();return this._push(rT,t.length(),t)};Pt.prototype.bool=function(e){return this._push(eT,1,e?1:0)};function ZA(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}Pt.prototype.fixed32=function(e){return this._push(ZA,4,e>>>0)};Pt.prototype.sfixed32=Pt.prototype.fixed32;Pt.prototype.fixed64=function(e){var t=g5.from(e);return this._push(ZA,4,t.lo)._push(ZA,4,t.hi)};Pt.prototype.sfixed64=Pt.prototype.fixed64;Pt.prototype.float=function(e){return this._push(ro.float.writeFloatLE,4,e)};Pt.prototype.double=function(e){return this._push(ro.float.writeDoubleLE,8,e)};var gbe=ro.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Pt.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(eT,1,0);if(ro.isString(e)){var n=Pt.alloc(t=QG.length(e));QG.decode(e,n,0),e=n}return this.uint32(t)._push(gbe,t,e)};Pt.prototype.string=function(e){var t=XG.length(e);return t?this.uint32(t)._push(XG.write,t,e):this._push(eT,1,0)};Pt.prototype.fork=function(){return this.states=new pbe(this),this.head=this.tail=new Sg(JA,0,0),this.len=0,this};Pt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Sg(JA,0,0),this.len=0),this};Pt.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};Pt.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};Pt._configure=function(r){XA=r,Pt.create=ZG(),XA._configure()}});var rj=P((iht,tj)=>{"use strict";l();tj.exports=Ga;var ej=nT();(Ga.prototype=Object.create(ej.prototype)).constructor=Ga;var tf=ef();function Ga(){ej.call(this)}Ga._configure=function(){Ga.alloc=tf._Buffer_allocUnsafe,Ga.writeBytesBuffer=tf.Buffer&&tf.Buffer.prototype instanceof Uint8Array&&tf.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};Ga.prototype.bytes=function(e){tf.isString(e)&&(e=tf._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Ga.writeBytesBuffer,t,e),this};function ybe(r,e,t){r.length<40?tf.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}Ga.prototype.string=function(e){var t=tf.Buffer.byteLength(e);return this.uint32(t),t&&this._push(ybe,t,e),this};Ga._configure()});var oT=P((oht,aj)=>{"use strict";l();aj.exports=rn;var ja=ef(),sT,sj=ja.LongBits,wbe=ja.utf8;function $o(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function rn(r){this.buf=r,this.pos=0,this.len=r.length}var nj=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new rn(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new rn(e);throw Error("illegal buffer")},oj=function(){return ja.Buffer?function(t){return(rn.create=function(i){return ja.Buffer.isBuffer(i)?new sT(i):nj(i)})(t)}:nj};rn.create=oj();rn.prototype._slice=ja.Array.prototype.subarray||ja.Array.prototype.slice;rn.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,$o(this,10);return e}}();rn.prototype.int32=function(){return this.uint32()|0};rn.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function iT(){var r=new sj(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw $o(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw $o(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}rn.prototype.bool=function(){return this.uint32()!==0};function y5(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}rn.prototype.fixed32=function(){if(this.pos+4>this.len)throw $o(this,4);return y5(this.buf,this.pos+=4)};rn.prototype.sfixed32=function(){if(this.pos+4>this.len)throw $o(this,4);return y5(this.buf,this.pos+=4)|0};function ij(){if(this.pos+8>this.len)throw $o(this,8);return new sj(y5(this.buf,this.pos+=4),y5(this.buf,this.pos+=4))}rn.prototype.float=function(){if(this.pos+4>this.len)throw $o(this,4);var e=ja.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};rn.prototype.double=function(){if(this.pos+8>this.len)throw $o(this,4);var e=ja.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};rn.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw $o(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};rn.prototype.string=function(){var e=this.bytes();return wbe.read(e,0,e.length)};rn.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw $o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw $o(this);while(this.buf[this.pos++]&128);return this};rn.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};rn._configure=function(r){sT=r,rn.create=oj(),sT._configure();var e=ja.Long?"toLong":"toNumber";ja.merge(rn.prototype,{int64:function(){return iT.call(this)[e](!1)},uint64:function(){return iT.call(this)[e](!0)},sint64:function(){return iT.call(this).zzDecode()[e](!1)},fixed64:function(){return ij.call(this)[e](!0)},sfixed64:function(){return ij.call(this)[e](!1)}})}});var fj=P((cht,uj)=>{"use strict";l();uj.exports=Jh;var lj=oT();(Jh.prototype=Object.create(lj.prototype)).constructor=Jh;var cj=ef();function Jh(r){lj.call(this,r)}Jh._configure=function(){cj.Buffer&&(Jh.prototype._slice=cj.Buffer.prototype.slice)};Jh.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Jh._configure()});var dj=P((uht,hj)=>{"use strict";l();hj.exports=xg;var aT=ef();(xg.prototype=Object.create(aT.EventEmitter.prototype)).constructor=xg;function xg(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");aT.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(t)}xg.prototype.rpcCall=function r(e,t,n,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return aT.asPromise(r,o,e,t,n,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(c,u){if(c)return o.emit("error",c,e),s(c);if(u===null){o.end(!0);return}if(!(u instanceof n))try{u=n[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(f){return o.emit("error",f,e),s(f)}return o.emit("data",u,e),s(null,u)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};xg.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var mj=P(pj=>{"use strict";l();var bbe=pj;bbe.Service=dj()});var yj=P((pht,gj)=>{"use strict";l();gj.exports={}});var Ej=P(bj=>{"use strict";l();var Xi=bj;Xi.build="minimal";Xi.Writer=nT();Xi.BufferWriter=rj();Xi.Reader=oT();Xi.BufferReader=fj();Xi.util=ef();Xi.rpc=mj();Xi.roots=yj();Xi.configure=wj;function wj(){Xi.util._configure(),Xi.Writer._configure(Xi.BufferWriter),Xi.Reader._configure(Xi.BufferReader)}wj()});var rf=P((wht,_j)=>{"use strict";l();_j.exports=Ej()});var Aj=P((cT,xj)=>{"use strict";l();Object.defineProperty(cT,"__esModule",{value:!0});b5.BASE=2166136261;function b5(r,e=b5.BASE){let t=r.length;for(let n=0;n<t;n++)e^=r.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}cT.default=b5;xj.exports=b5});var Xj=P((Hdt,I5)=>{"use strict";l();I5.exports=$be;I5.exports.format=Yj;I5.exports.parse=Qj;var zbe=/\B(?=(\d{3})+(?!\d))/g,Kbe=/(?:\.0*|(\.[^0]+)0+)$/,af={b:1,kb:1<<10,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},qbe=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function $be(r,e){return typeof r=="string"?Qj(r):typeof r=="number"?Yj(r,e):null}function Yj(r,e){if(!Number.isFinite(r))return null;var t=Math.abs(r),n=e&&e.thousandsSeparator||"",i=e&&e.unitSeparator||"",s=e&&e.decimalPlaces!==void 0?e.decimalPlaces:2,o=Boolean(e&&e.fixedDecimals),a=e&&e.unit||"";(!a||!af[a.toLowerCase()])&&(t>=af.pb?a="PB":t>=af.tb?a="TB":t>=af.gb?a="GB":t>=af.mb?a="MB":t>=af.kb?a="KB":a="B");var c=r/af[a.toLowerCase()],u=c.toFixed(s);return o||(u=u.replace(Kbe,"$1")),n&&(u=u.split(".").map(function(f,h){return h===0?f.replace(zbe,n):f}).join(".")),u+i+a}function Qj(r){if(typeof r=="number"&&!isNaN(r))return r;if(typeof r!="string")return null;var e=qbe.exec(r),t,n="b";return e?(t=parseFloat(e[1]),n=e[4].toLowerCase()):(t=parseInt(r,10),n="b"),isNaN(t)?null:Math.floor(af[n]*t)}});var RW=P(IW=>{"use strict";l();IW.supports=function(...e){let t=e.reduce((n,i)=>Object.assign(n,i),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})}});var jo=P((u1t,CW)=>{"use strict";l();CW.exports=class extends Error{constructor(e,t){super(e||""),typeof t=="object"&&t!==null&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}});var NT=P((h1t,PW)=>{"use strict";l();var OT=null;PW.exports=function(){return OT===null&&(OT={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),OT}});var BT=P(kW=>{"use strict";l();var DT=jo(),pEe=new Set(["buffer","view","utf8"]),LT=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!pEe.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new DT(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new DT(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new DT(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};kW.Encoding=LT});var VT=P(L5=>{"use strict";l();var{Buffer:MT}=fp()||{},{Encoding:FT}=BT(),mEe=NT(),Lg=class extends FT{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new Bg({encode:this.encode,decode:e=>this.decode(MT.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},Bg=class extends FT{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new Lg({encode:e=>{let t=this.encode(e);return MT.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},UT=class extends FT{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new Lg({encode:e=>MT.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){let{textEncoder:e,textDecoder:t}=mEe();return new Bg({encode:n=>e.encode(this.encode(n)),decode:n=>this.decode(t.decode(n)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};L5.BufferFormat=Lg;L5.ViewFormat=Bg;L5.UTF8Format=UT});var LW=P(ld=>{"use strict";l();var{Buffer:bi}=fp()||{Buffer:{isBuffer:()=>!1}},{textEncoder:NW,textDecoder:OW}=NT()(),{BufferFormat:Ug,ViewFormat:zT,UTF8Format:DW}=VT(),B5=r=>r;ld.utf8=new DW({encode:function(r){return bi.isBuffer(r)?r.toString("utf8"):ArrayBuffer.isView(r)?OW.decode(r):String(r)},decode:B5,name:"utf8",createViewTranscoder(){return new zT({encode:function(r){return ArrayBuffer.isView(r)?r:NW.encode(r)},decode:function(r){return OW.decode(r)},name:`${this.name}+view`})},createBufferTranscoder(){return new Ug({encode:function(r){return bi.isBuffer(r)?r:ArrayBuffer.isView(r)?bi.from(r.buffer,r.byteOffset,r.byteLength):bi.from(String(r),"utf8")},decode:function(r){return r.toString("utf8")},name:`${this.name}+buffer`})}});ld.json=new DW({encode:JSON.stringify,decode:JSON.parse,name:"json"});ld.buffer=new Ug({encode:function(r){return bi.isBuffer(r)?r:ArrayBuffer.isView(r)?bi.from(r.buffer,r.byteOffset,r.byteLength):bi.from(String(r),"utf8")},decode:B5,name:"buffer",createViewTranscoder(){return new zT({encode:function(r){return ArrayBuffer.isView(r)?r:bi.from(String(r),"utf8")},decode:function(r){return bi.from(r.buffer,r.byteOffset,r.byteLength)},name:`${this.name}+view`})}});ld.view=new zT({encode:function(r){return ArrayBuffer.isView(r)?r:NW.encode(r)},decode:B5,name:"view",createBufferTranscoder(){return new Ug({encode:function(r){return bi.isBuffer(r)?r:ArrayBuffer.isView(r)?bi.from(r.buffer,r.byteOffset,r.byteLength):bi.from(String(r),"utf8")},decode:B5,name:`${this.name}+buffer`})}});ld.hex=new Ug({encode:function(r){return bi.isBuffer(r)?r:bi.from(String(r),"hex")},decode:function(r){return r.toString("hex")},name:"hex"});ld.base64=new Ug({encode:function(r){return bi.isBuffer(r)?r:bi.from(String(r),"base64")},decode:function(r){return r.toString("base64")},name:"base64"})});var MW=P(UW=>{"use strict";l();var BW=jo(),M5=LW(),{Encoding:gEe}=BT(),{BufferFormat:yEe,ViewFormat:wEe,UTF8Format:bEe}=VT(),Mg=Symbol("formats"),U5=Symbol("encodings"),EEe=new Set(["buffer","view","utf8"]),KT=class{constructor(e){if(Array.isArray(e)){if(!e.every(t=>EEe.has(t)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[U5]=new Map,this[Mg]=new Set(e);for(let t in M5)try{this.encoding(t)}catch(n){if(n.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw n}}encodings(){return Array.from(new Set(this[U5].values()))}encoding(e){let t=this[U5].get(e);if(t===void 0){if(typeof e=="string"&&e!==""){if(t=xEe[e],!t)throw new BW(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");t=_Ee(e)}let{name:n,format:i}=t;if(!this[Mg].has(i))if(this[Mg].has("view"))t=t.createViewTranscoder();else if(this[Mg].has("buffer"))t=t.createBufferTranscoder();else if(this[Mg].has("utf8"))t=t.createUTF8Transcoder();else throw new BW(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(let s of[e,n,t.name,t.commonName])this[U5].set(s,t)}return t}};UW.Transcoder=KT;function _Ee(r){if(r instanceof gEe)return r;let e="type"in r&&typeof r.type=="string"?r.type:void 0,t=r.name||e||`anonymous-${AEe++}`;switch(vEe(r)){case"view":return new wEe({...r,name:t});case"utf8":return new bEe({...r,name:t});case"buffer":return new yEe({...r,name:t});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function vEe(r){return"format"in r&&r.format!==void 0?r.format:"buffer"in r&&typeof r.buffer=="boolean"?r.buffer?"buffer":"utf8":"code"in r&&Number.isInteger(r.code)?"view":"buffer"}var SEe={binary:M5.buffer,"utf-8":M5.utf8},xEe={...M5,...SEe},AEe=0});var ri=P((v1t,qT)=>{"use strict";l();var W0=typeof Reflect=="object"?Reflect:null,FW=W0&&typeof W0.apply=="function"?W0.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},F5;W0&&typeof W0.ownKeys=="function"?F5=W0.ownKeys:Object.getOwnPropertySymbols?F5=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:F5=function(e){return Object.getOwnPropertyNames(e)};function TEe(r){console&&console.warn&&console.warn(r)}var zW=Number.isNaN||function(e){return e!==e};function er(){er.init.call(this)}qT.exports=er;qT.exports.once=PEe;er.EventEmitter=er;er.prototype._events=void 0;er.prototype._eventsCount=0;er.prototype._maxListeners=void 0;var VW=10;function V5(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(er,"defaultMaxListeners",{enumerable:!0,get:function(){return VW},set:function(r){if(typeof r!="number"||r<0||zW(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");VW=r}});er.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};er.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||zW(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function KW(r){return r._maxListeners===void 0?er.defaultMaxListeners:r._maxListeners}er.prototype.getMaxListeners=function(){return KW(this)};er.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")FW(c,this,t);else for(var u=c.length,f=jW(c,u),n=0;n<u;++n)FW(f[n],this,t);return!0};function qW(r,e,t,n){var i,s,o;if(V5(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=KW(r),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,TEe(a)}return r}er.prototype.addListener=function(e,t){return qW(this,e,t,!1)};er.prototype.on=er.prototype.addListener;er.prototype.prependListener=function(e,t){return qW(this,e,t,!0)};function IEe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function $W(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=IEe.bind(n);return i.listener=t,n.wrapFn=i,i}er.prototype.once=function(e,t){return V5(t),this.on(e,$W(this,e,t)),this};er.prototype.prependOnceListener=function(e,t){return V5(t),this.prependListener(e,$W(this,e,t)),this};er.prototype.removeListener=function(e,t){var n,i,s,o,a;if(V5(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():REe(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};er.prototype.off=er.prototype.removeListener;er.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function HW(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?CEe(i):jW(i,i.length)}er.prototype.listeners=function(e){return HW(this,e,!0)};er.prototype.rawListeners=function(e){return HW(this,e,!1)};er.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):GW.call(r,e)};er.prototype.listenerCount=GW;function GW(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}er.prototype.eventNames=function(){return this._eventsCount>0?F5(this._events):[]};function jW(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function REe(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function CEe(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function PEe(r,e){return new Promise(function(t,n){function i(o){r.removeListener(e,s),n(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}WW(r,e,s,{once:!0}),e!=="error"&&kEe(r,i,{once:!0})})}function kEe(r,e,t){typeof r.on=="function"&&WW(r,"error",e,t)}function WW(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var QW=P((x1t,YW)=>{l();YW.exports=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r)});var Fg=P($T=>{"use strict";l();var XW=QW();$T.fromCallback=function(r,e){if(r===void 0){var t=new Promise(function(n,i){r=function(s,o){s?i(s):n(o)}});r[e!==void 0?e:"promise"]=t}else if(typeof r!="function")throw new TypeError("Callback must be a function");return r};$T.fromPromise=function(r,e){if(e===void 0)return r;r.then(function(t){XW(()=>e(null,t))}).catch(function(t){XW(()=>e(t))})}});var z5=P(HT=>{"use strict";l();HT.getCallback=function(r,e){return typeof r=="function"?r:e};HT.getOptions=function(r,e){return typeof r=="object"&&r!==null?r:e!==void 0?e:{}}});var mf=P(H5=>{"use strict";l();var{fromCallback:GT}=Fg(),Ss=jo(),{getOptions:jT,getCallback:ZW}=z5(),ud=Symbol("promise"),Y0=Symbol("callback"),Ya=Symbol("working"),fd=Symbol("handleOne"),cl=Symbol("handleMany"),WT=Symbol("autoClose"),df=Symbol("finishWork"),Qa=Symbol("returnMany"),uf=Symbol("closing"),Vg=Symbol("handleClose"),K5=Symbol("closed"),zg=Symbol("closeCallbacks"),hf=Symbol("keyEncoding"),hd=Symbol("valueEncoding"),YT=Symbol("abortOnClose"),q5=Symbol("legacy"),QT=Symbol("keys"),XT=Symbol("values"),ff=Symbol("limit"),io=Symbol("count"),$5=Object.freeze({}),OEe=()=>{},JW=!1,Kg=class{constructor(e,t,n){if(typeof e!="object"||e===null){let i=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${i}`)}if(typeof t!="object"||t===null)throw new TypeError("The second argument must be an options object");this[K5]=!1,this[zg]=[],this[Ya]=!1,this[uf]=!1,this[WT]=!1,this[Y0]=null,this[fd]=this[fd].bind(this),this[cl]=this[cl].bind(this),this[Vg]=this[Vg].bind(this),this[hf]=t[hf],this[hd]=t[hd],this[q5]=n,this[ff]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[io]=0,this[YT]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[io]}get limit(){return this[ff]}next(e){let t;if(e===void 0)t=new Promise((n,i)=>{e=(s,o,a)=>{s?i(s):this[q5]?o===void 0&&a===void 0?n():n([o,a]):n(o)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[uf]?this.nextTick(e,new Ss("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Ya]?this.nextTick(e,new Ss("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[Ya]=!0,this[Y0]=e,this[io]>=this[ff]?this.nextTick(this[fd],null):this._next(this[fd])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=ZW(t,n),n=GT(n,ud),t=jT(t,$5),Number.isInteger(e)?(this[uf]?this.nextTick(n,new Ss("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Ya]?this.nextTick(n,new Ss("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[ff]<1/0&&(e=Math.min(e,this[ff]-this[io])),this[Ya]=!0,this[Y0]=n,e<=0?this.nextTick(this[cl],null,[]):this._nextv(e,t,this[cl])),n[ud]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[ud])}_nextv(e,t,n){let i=[],s=(o,a,c)=>{if(o)return n(o);if(this[q5]?a===void 0&&c===void 0:a===void 0)return n(null,i);i.push(this[q5]?[a,c]:a),i.length===e?n(null,i):this._next(s)};this._next(s)}all(e,t){return t=ZW(e,t),t=GT(t,ud),e=jT(e,$5),this[uf]?this.nextTick(t,new Ss("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Ya]?this.nextTick(t,new Ss("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[Ya]=!0,this[Y0]=t,this[WT]=!0,this[io]>=this[ff]?this.nextTick(this[cl],null,[]):this._all(e,this[cl])),t[ud]}_all(e,t){let n=this[io],i=[],s=()=>{let a=this[ff]<1/0?Math.min(1e3,this[ff]-n):1e3;a<=0?this.nextTick(t,null,i):this._nextv(a,$5,o)},o=(a,c)=>{a?t(a):c.length===0?t(null,i):(i.push.apply(i,c),n+=c.length,s())};s()}[df](){let e=this[Y0];return this[YT]&&e===null?OEe:(this[Ya]=!1,this[Y0]=null,this[uf]&&this._close(this[Vg]),e)}[Qa](e,t,n){this[WT]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=jT(t,$5),!this[uf]){if(this[Ya])throw new Ss("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{let n=this.db.keyEncoding(t.keyEncoding||this[hf]),i=n.format;t.keyEncoding!==i&&(t={...t,keyEncoding:i});let s=this.db.prefixKey(n.encode(e),i);this._seek(s,t)}}}_seek(e,t){throw new Ss("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=GT(e,ud),this[K5]?this.nextTick(e):this[uf]?this[zg].push(e):(this[uf]=!0,this[zg].push(e),this[Ya]?this[YT]&&this[df]()(new Ss("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[Vg])),e[ud]}_close(e){this.nextTick(e)}[Vg](){this[K5]=!0,this.db.detachResource(this);let e=this[zg];this[zg]=[];for(let t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[K5]||await this.close()}}},Q0=class extends Kg{constructor(e,t){super(e,t,!0),this[QT]=t.keys!==!1,this[XT]=t.values!==!1}[fd](e,t,n){let i=this[df]();if(e)return i(e);try{t=this[QT]&&t!==void 0?this[hf].decode(t):void 0,n=this[XT]&&n!==void 0?this[hd].decode(n):void 0}catch(s){return i(new pf("entry",s))}t===void 0&&n===void 0||this[io]++,i(null,t,n)}[cl](e,t){let n=this[df]();if(e)return this[Qa](n,e);try{for(let i of t){let s=i[0],o=i[1];i[0]=this[QT]&&s!==void 0?this[hf].decode(s):void 0,i[1]=this[XT]&&o!==void 0?this[hd].decode(o):void 0}}catch(i){return this[Qa](n,new pf("entries",i))}this[io]+=t.length,this[Qa](n,null,t)}end(e){return!JW&&typeof console<"u"&&(JW=!0,console.warn(new Ss("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},ZT=class extends Kg{constructor(e,t){super(e,t,!1)}[fd](e,t){let n=this[df]();if(e)return n(e);try{t=t!==void 0?this[hf].decode(t):void 0}catch(i){return n(new pf("key",i))}t!==void 0&&this[io]++,n(null,t)}[cl](e,t){let n=this[df]();if(e)return this[Qa](n,e);try{for(let i=0;i<t.length;i++){let s=t[i];t[i]=s!==void 0?this[hf].decode(s):void 0}}catch(i){return this[Qa](n,new pf("keys",i))}this[io]+=t.length,this[Qa](n,null,t)}},JT=class extends Kg{constructor(e,t){super(e,t,!1)}[fd](e,t){let n=this[df]();if(e)return n(e);try{t=t!==void 0?this[hd].decode(t):void 0}catch(i){return n(new pf("value",i))}t!==void 0&&this[io]++,n(null,t)}[cl](e,t){let n=this[df]();if(e)return this[Qa](n,e);try{for(let i=0;i<t.length;i++){let s=t[i];t[i]=s!==void 0?this[hd].decode(s):void 0}}catch(i){return this[Qa](n,new pf("values",i))}this[io]+=t.length,this[Qa](n,null,t)}},pf=class extends Ss{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}};for(let r of["_ended property","_nexting property","_end method"])Object.defineProperty(Q0.prototype,r.split(" ")[0],{get(){throw new Ss(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new Ss(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})}});Q0.keyEncoding=hf;Q0.valueEncoding=hd;H5.AbstractIterator=Q0;H5.AbstractKeyIterator=ZT;H5.AbstractValueIterator=JT});var eY=P(eI=>{"use strict";l();var{AbstractKeyIterator:NEe,AbstractValueIterator:DEe}=mf(),dd=Symbol("iterator"),qg=Symbol("callback"),X0=Symbol("handleOne"),pd=Symbol("handleMany"),$g=class extends NEe{constructor(e,t){super(e,t),this[dd]=e.iterator({...t,keys:!0,values:!1}),this[X0]=this[X0].bind(this),this[pd]=this[pd].bind(this)}},G5=class extends DEe{constructor(e,t){super(e,t),this[dd]=e.iterator({...t,keys:!1,values:!0}),this[X0]=this[X0].bind(this),this[pd]=this[pd].bind(this)}};for(let r of[$g,G5]){let e=r===$g,t=e?n=>n[0]:n=>n[1];r.prototype._next=function(n){this[qg]=n,this[dd].next(this[X0])},r.prototype[X0]=function(n,i,s){let o=this[qg];n?o(n):o(null,e?i:s)},r.prototype._nextv=function(n,i,s){this[qg]=s,this[dd].nextv(n,i,this[pd])},r.prototype._all=function(n,i){this[qg]=i,this[dd].all(n,this[pd])},r.prototype[pd]=function(n,i){let s=this[qg];n?s(n):s(null,i.map(t))},r.prototype._seek=function(n,i){this[dd].seek(n,i)},r.prototype._close=function(n){this[dd].close(n)}}eI.DefaultKeyIterator=$g;eI.DefaultValueIterator=G5});var tY=P(Z5=>{"use strict";l();var{AbstractIterator:LEe,AbstractKeyIterator:BEe,AbstractValueIterator:UEe}=mf(),tI=jo(),Ji=Symbol("nut"),Q5=Symbol("undefer"),X5=Symbol("factory"),j5=class extends LEe{constructor(e,t){super(e,t),this[Ji]=null,this[X5]=()=>e.iterator(t),this.db.defer(()=>this[Q5]())}},W5=class extends BEe{constructor(e,t){super(e,t),this[Ji]=null,this[X5]=()=>e.keys(t),this.db.defer(()=>this[Q5]())}},Y5=class extends UEe{constructor(e,t){super(e,t),this[Ji]=null,this[X5]=()=>e.values(t),this.db.defer(()=>this[Q5]())}};for(let r of[j5,W5,Y5])r.prototype[Q5]=function(){this.db.status==="open"&&(this[Ji]=this[X5]())},r.prototype._next=function(e){this[Ji]!==null?this[Ji].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new tI("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._nextv=function(e,t,n){this[Ji]!==null?this[Ji].nextv(e,t,n):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,t,n)):this.nextTick(n,new tI("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._all=function(e,t){this[Ji]!==null?this[Ji].all(t):this.db.status==="opening"?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new tI("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._seek=function(e,t){this[Ji]!==null?this[Ji]._seek(e,t):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,t))},r.prototype._close=function(e){this[Ji]!==null?this[Ji].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};Z5.DeferredIterator=j5;Z5.DeferredKeyIterator=W5;Z5.DeferredValueIterator=Y5});var nI=P(nY=>{"use strict";l();var{fromCallback:rY}=Fg(),J5=jo(),{getCallback:MEe,getOptions:FEe}=z5(),e8=Symbol("promise"),so=Symbol("status"),Z0=Symbol("operations"),Hg=Symbol("finishClose"),J0=Symbol("closeCallbacks"),rI=class{constructor(e){if(typeof e!="object"||e===null){let t=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[Z0]=[],this[J0]=[],this[so]="open",this[Hg]=this[Hg].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[Z0].length}put(e,t,n){if(this[so]!=="open")throw new J5("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let i=this.db._checkKey(e)||this.db._checkValue(t);if(i)throw i;let s=n&&n.sublevel!=null?n.sublevel:this.db,o=n,a=s.keyEncoding(n&&n.keyEncoding),c=s.valueEncoding(n&&n.valueEncoding),u=a.format;n={...n,keyEncoding:u,valueEncoding:c.format},s!==this.db&&(n.sublevel=null);let f=s.prefixKey(a.encode(e),u),h=c.encode(t);return this._put(f,h,n),this[Z0].push({...o,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if(this[so]!=="open")throw new J5("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let n=this.db._checkKey(e);if(n)throw n;let i=t&&t.sublevel!=null?t.sublevel:this.db,s=t,o=i.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},i!==this.db&&(t.sublevel=null),this._del(i.prefixKey(o.encode(e),a),t),this[Z0].push({...s,type:"del",key:e}),this}_del(e,t){}clear(){if(this[so]!=="open")throw new J5("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[Z0]=[],this}_clear(){}write(e,t){return t=MEe(e,t),t=rY(t,e8),e=FEe(e),this[so]!=="open"?this.nextTick(t,new J5("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(t):(this[so]="writing",this._write(e,n=>{this[so]="closing",this[J0].push(()=>t(n)),n||this.db.emit("batch",this[Z0]),this._close(this[Hg])})),t[e8]}_write(e,t){}close(e){return e=rY(e,e8),this[so]==="closing"?this[J0].push(e):this[so]==="closed"?this.nextTick(e):(this[J0].push(e),this[so]!=="writing"&&(this[so]="closing",this._close(this[Hg]))),e[e8]}_close(e){this.nextTick(e)}[Hg](){this[so]="closed",this.db.detachResource(this);let e=this[J0];this[J0]=[];for(let t of e)t()}};nY.AbstractChainedBatch=rI});var sY=P(iY=>{"use strict";l();var{AbstractChainedBatch:VEe}=nI(),zEe=jo(),e1=Symbol("encoded"),iI=class extends VEe{constructor(e){super(e),this[e1]=[]}_put(e,t,n){this[e1].push({...n,type:"put",key:e,value:t})}_del(e,t){this[e1].push({...t,type:"del",key:e})}_clear(){this[e1]=[]}_write(e,t){this.db.status==="opening"?this.db.defer(()=>this._write(e,t)):this.db.status==="open"?this[e1].length===0?this.nextTick(t):this.db._batch(this[e1],e,t):this.nextTick(t,new zEe("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};iY.DefaultChainedBatch=iI});var cY=P((V1t,aY)=>{"use strict";l();var oY=jo(),KEe=Object.prototype.hasOwnProperty,qEe=new Set(["lt","lte","gt","gte"]);aY.exports=function(r,e){let t={};for(let n in r)if(KEe.call(r,n)&&!(n==="keyEncoding"||n==="valueEncoding")){if(n==="start"||n==="end")throw new oY(`The legacy range option '${n}' has been removed`,{code:"LEVEL_LEGACY"});if(n==="encoding")throw new oY("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});qEe.has(n)?t[n]=e.encode(r[n]):t[n]=r[n]}return t.reverse=!!t.reverse,t.limit=Number.isInteger(t.limit)&&t.limit>=0?t.limit:-1,t}});var sI=P((K1t,uY)=>{l();var lY;uY.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:globalThis):r=>(lY||(lY=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0))});var dY=P(($1t,hY)=>{"use strict";l();var fY=sI();hY.exports=function(r,...e){e.length===0?fY(r):fY(()=>r(...e))}});var pY=P(t8=>{"use strict";l();var{AbstractIterator:$Ee,AbstractKeyIterator:HEe,AbstractValueIterator:GEe}=mf(),t1=Symbol("unfix"),Wo=Symbol("iterator"),md=Symbol("handleOne"),gf=Symbol("handleMany"),ll=Symbol("callback"),Gg=class extends $Ee{constructor(e,t,n,i){super(e,t),this[Wo]=n,this[t1]=i,this[md]=this[md].bind(this),this[gf]=this[gf].bind(this),this[ll]=null}[md](e,t,n){let i=this[ll];if(e)return i(e);t!==void 0&&(t=this[t1](t)),i(e,t,n)}[gf](e,t){let n=this[ll];if(e)return n(e);for(let i of t){let s=i[0];s!==void 0&&(i[0]=this[t1](s))}n(e,t)}},jg=class extends HEe{constructor(e,t,n,i){super(e,t),this[Wo]=n,this[t1]=i,this[md]=this[md].bind(this),this[gf]=this[gf].bind(this),this[ll]=null}[md](e,t){let n=this[ll];if(e)return n(e);t!==void 0&&(t=this[t1](t)),n(e,t)}[gf](e,t){let n=this[ll];if(e)return n(e);for(let i=0;i<t.length;i++){let s=t[i];s!==void 0&&(t[i]=this[t1](s))}n(e,t)}},Wg=class extends GEe{constructor(e,t,n){super(e,t),this[Wo]=n}};for(let r of[Gg,jg])r.prototype._next=function(e){this[ll]=e,this[Wo].next(this[md])},r.prototype._nextv=function(e,t,n){this[ll]=n,this[Wo].nextv(e,t,this[gf])},r.prototype._all=function(e,t){this[ll]=t,this[Wo].all(e,this[gf])};for(let r of[Wg])r.prototype._next=function(e){this[Wo].next(e)},r.prototype._nextv=function(e,t,n){this[Wo].nextv(e,t,n)},r.prototype._all=function(e,t){this[Wo].all(e,t)};for(let r of[Gg,jg,Wg])r.prototype._seek=function(e,t){this[Wo].seek(e,t)},r.prototype._close=function(e){this[Wo].close(e)};t8.AbstractSublevelIterator=Gg;t8.AbstractSublevelKeyIterator=jg;t8.AbstractSublevelValueIterator=Wg});var wY=P((W1t,yY)=>{"use strict";l();var oI=jo(),{Buffer:lI}=fp()||{},{AbstractSublevelIterator:jEe,AbstractSublevelKeyIterator:WEe,AbstractSublevelValueIterator:YEe}=pY(),ul=Symbol("prefix"),mY=Symbol("upperBound"),Yg=Symbol("prefixRange"),xs=Symbol("parent"),aI=Symbol("unfix"),gY=new TextEncoder,QEe={separator:"!"};yY.exports=function({AbstractLevel:r}){class e extends r{static defaults(n){if(typeof n=="string")throw new oI("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(n&&n.open)throw new oI("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return n==null?QEe:n.separator?n:{...n,separator:"!"}}constructor(n,i,s){let{separator:o,manifest:a,...c}=e.defaults(s);i=ZEe(i,o);let u=o.charCodeAt(0)+1,f=n[xs]||n;if(!gY.encode(i).every(d=>d>u&&d<127))throw new oI(`Prefix must use bytes > ${u} < ${127}`,{code:"LEVEL_INVALID_PREFIX"});super(XEe(f,a),c);let h=(n.prefix||"")+o+i+o,p=h.slice(0,-1)+String.fromCharCode(u);this[xs]=f,this[ul]=new r8(h),this[mY]=new r8(p),this[aI]=new uI,this.nextTick=f.nextTick}prefixKey(n,i){if(i==="utf8")return this[ul].utf8+n;if(n.byteLength===0)return this[ul][i];if(i==="view"){let s=this[ul].view,o=new Uint8Array(s.byteLength+n.byteLength);return o.set(s,0),o.set(n,s.byteLength),o}else{let s=this[ul].buffer;return lI.concat([s,n],s.byteLength+n.byteLength)}}[Yg](n,i){n.gte!==void 0?n.gte=this.prefixKey(n.gte,i):n.gt!==void 0?n.gt=this.prefixKey(n.gt,i):n.gte=this[ul][i],n.lte!==void 0?n.lte=this.prefixKey(n.lte,i):n.lt!==void 0?n.lt=this.prefixKey(n.lt,i):n.lte=this[mY][i]}get prefix(){return this[ul].utf8}get db(){return this[xs]}_open(n,i){this[xs].open({passive:!0},i)}_put(n,i,s,o){this[xs].put(n,i,s,o)}_get(n,i,s){this[xs].get(n,i,s)}_getMany(n,i,s){this[xs].getMany(n,i,s)}_del(n,i,s){this[xs].del(n,i,s)}_batch(n,i,s){this[xs].batch(n,i,s)}_clear(n,i){this[Yg](n,n.keyEncoding),this[xs].clear(n,i)}_iterator(n){this[Yg](n,n.keyEncoding);let i=this[xs].iterator(n),s=this[aI].get(this[ul].utf8.length,n.keyEncoding);return new jEe(this,n,i,s)}_keys(n){this[Yg](n,n.keyEncoding);let i=this[xs].keys(n),s=this[aI].get(this[ul].utf8.length,n.keyEncoding);return new WEe(this,n,i,s)}_values(n){this[Yg](n,n.keyEncoding);let i=this[xs].values(n);return new YEe(this,n,i)}}return{AbstractSublevel:e}};var XEe=function(r,e){return{...r.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...e,encodings:{utf8:cI(r,"utf8"),buffer:cI(r,"buffer"),view:cI(r,"view")}}},cI=function(r,e){return r.supports.encodings[e]?r.keyEncoding(e).name===e:!1},r8=class{constructor(e){this.utf8=e,this.view=gY.encode(e),this.buffer=lI?lI.from(this.view.buffer,0,this.view.byteLength):{}}},uI=class{constructor(){this.cache=new Map}get(e,t){let n=this.cache.get(t);return n===void 0&&(t==="view"?n=function(i,s){return s.subarray(i)}.bind(null,e):n=function(i,s){return s.slice(i)}.bind(null,e),this.cache.set(t,n)),n}},ZEe=function(r,e){let t=0,n=r.length;for(;t<n&&r[t]===e;)t++;for(;n>t&&r[n-1]===e;)n--;return r.slice(t,n)}});var mI=P(pI=>{"use strict";l();var{supports:JEe}=RW(),{Transcoder:e7e}=MW(),{EventEmitter:t7e}=ri(),{fromCallback:yf}=Fg(),Yo=jo(),{AbstractIterator:gd}=mf(),{DefaultKeyIterator:r7e,DefaultValueIterator:n7e}=eY(),{DeferredIterator:i7e,DeferredKeyIterator:s7e,DeferredValueIterator:o7e}=tY(),{DefaultChainedBatch:bY}=sY(),{getCallback:yd,getOptions:wf}=z5(),n8=cY(),je=Symbol("promise"),fl=Symbol("landed"),wd=Symbol("resources"),fI=Symbol("closeResources"),Qg=Symbol("operations"),Xg=Symbol("undefer"),i8=Symbol("deferOpen"),EY=Symbol("options"),tt=Symbol("status"),bd=Symbol("defaultOptions"),r1=Symbol("transcoder"),s8=Symbol("keyEncoding"),hI=Symbol("valueEncoding"),a7e=()=>{},Zg=class extends t7e{constructor(e,t){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");t=wf(t);let{keyEncoding:n,valueEncoding:i,passive:s,...o}=t;this[wd]=new Set,this[Qg]=[],this[i8]=!0,this[EY]=o,this[tt]="opening",this.supports=JEe(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[r1]=new e7e(c7e(this)),this[s8]=this[r1].encoding(n||"utf8"),this[hI]=this[r1].encoding(i||"utf8");for(let a of this[r1].encodings())this.supports.encodings[a.commonName]||(this.supports.encodings[a.commonName]=!0);this[bd]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[s8].commonName,valueEncoding:this[hI].commonName}),key:Object.freeze({keyEncoding:this[s8].commonName})},this.nextTick(()=>{this[i8]&&this.open({passive:!1},a7e)})}get status(){return this[tt]}keyEncoding(e){return this[r1].encoding(e??this[s8])}valueEncoding(e){return this[r1].encoding(e??this[hI])}open(e,t){t=yd(e,t),t=yf(t,je),e={...this[EY],...wf(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;let n=i=>{this[tt]==="closing"||this[tt]==="opening"?this.once(fl,i?()=>n(i):n):this[tt]!=="open"?t(new Yo("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:i})):t()};return e.passive?this[tt]==="opening"?this.once(fl,n):this.nextTick(n):this[tt]==="closed"||this[i8]?(this[i8]=!1,this[tt]="opening",this.emit("opening"),this._open(e,i=>{if(i){this[tt]="closed",this[fI](()=>{this.emit(fl),n(i)}),this[Xg]();return}this[tt]="open",this[Xg](),this.emit(fl),this[tt]==="open"&&this.emit("open"),this[tt]==="open"&&this.emit("ready"),n()})):this[tt]==="open"?this.nextTick(n):this.once(fl,()=>this.open(e,t)),t[je]}_open(e,t){this.nextTick(t)}close(e){e=yf(e,je);let t=n=>{this[tt]==="opening"||this[tt]==="closing"?this.once(fl,n?t(n):t):this[tt]!=="closed"?e(new Yo("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if(this[tt]==="open"){this[tt]="closing",this.emit("closing");let n=i=>{this[tt]="open",this[Xg](),this.emit(fl),t(i)};this[fI](()=>{this._close(i=>{if(i)return n(i);this[tt]="closed",this[Xg](),this.emit(fl),this[tt]==="closed"&&this.emit("closed"),t()})})}else this[tt]==="closed"?this.nextTick(t):this.once(fl,()=>this.close(e));return e[je]}[fI](e){if(this[wd].size===0)return this.nextTick(e);let t=this[wd].size,n=!0,i=()=>{--t===0&&(n?this.nextTick(e):e())};for(let s of this[wd])s.close(i);n=!1,this[wd].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=yd(t,n),n=yf(n,je),t=wf(t,this[bd].entry),this[tt]==="opening")return this.defer(()=>this.get(e,t,n)),n[je];if(n1(this,n))return n[je];let i=this._checkKey(e);if(i)return this.nextTick(n,i),n[je];let s=this.keyEncoding(t.keyEncoding),o=this.valueEncoding(t.valueEncoding),a=s.format,c=o.format;return(t.keyEncoding!==a||t.valueEncoding!==c)&&(t=Object.assign({},t,{keyEncoding:a,valueEncoding:c})),this._get(this.prefixKey(s.encode(e),a),t,(u,f)=>{if(u)return(u.code==="LEVEL_NOT_FOUND"||u.notFound||/NotFound/i.test(u))&&(u.code||(u.code="LEVEL_NOT_FOUND"),u.notFound||(u.notFound=!0),u.status||(u.status=404)),n(u);try{f=o.decode(f)}catch(h){return n(new Yo("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:h}))}n(null,f)}),n[je]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=yd(t,n),n=yf(n,je),t=wf(t,this[bd].entry),this[tt]==="opening")return this.defer(()=>this.getMany(e,t,n)),n[je];if(n1(this,n))return n[je];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[je];if(e.length===0)return this.nextTick(n,null,[]),n[je];let i=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),o=i.format,a=s.format;(t.keyEncoding!==o||t.valueEncoding!==a)&&(t=Object.assign({},t,{keyEncoding:o,valueEncoding:a}));let c=new Array(e.length);for(let u=0;u<e.length;u++){let f=e[u],h=this._checkKey(f);if(h)return this.nextTick(n,h),n[je];c[u]=this.prefixKey(i.encode(f),o)}return this._getMany(c,t,(u,f)=>{if(u)return n(u);try{for(let h=0;h<f.length;h++)f[h]!==void 0&&(f[h]=s.decode(f[h]))}catch(h){return n(new Yo(`Could not decode one or more of ${f.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:h}))}n(null,f)}),n[je]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,i){if(i=yd(n,i),i=yf(i,je),n=wf(n,this[bd].entry),this[tt]==="opening")return this.defer(()=>this.put(e,t,n,i)),i[je];if(n1(this,i))return i[je];let s=this._checkKey(e)||this._checkValue(t);if(s)return this.nextTick(i,s),i[je];let o=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),c=o.format,u=a.format;(n.keyEncoding!==c||n.valueEncoding!==u)&&(n=Object.assign({},n,{keyEncoding:c,valueEncoding:u}));let f=this.prefixKey(o.encode(e),c),h=a.encode(t);return this._put(f,h,n,p=>{if(p)return i(p);this.emit("put",e,t),i()}),i[je]}_put(e,t,n,i){this.nextTick(i)}del(e,t,n){if(n=yd(t,n),n=yf(n,je),t=wf(t,this[bd].key),this[tt]==="opening")return this.defer(()=>this.del(e,t,n)),n[je];if(n1(this,n))return n[je];let i=this._checkKey(e);if(i)return this.nextTick(n,i),n[je];let s=this.keyEncoding(t.keyEncoding),o=s.format;return t.keyEncoding!==o&&(t=Object.assign({},t,{keyEncoding:o})),this._del(this.prefixKey(s.encode(e),o),t,a=>{if(a)return n(a);this.emit("del",e),n()}),n[je]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if(this[tt]==="opening")return new bY(this);if(this[tt]!=="open")throw new Yo("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?n=e:n=yd(t,n),n=yf(n,je),t=wf(t,this[bd].empty),this[tt]==="opening")return this.defer(()=>this.batch(e,t,n)),n[je];if(n1(this,n))return n[je];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[je];if(e.length===0)return this.nextTick(n),n[je];let i=new Array(e.length),{keyEncoding:s,valueEncoding:o,...a}=t;for(let c=0;c<e.length;c++){if(typeof e[c]!="object"||e[c]===null)return this.nextTick(n,new TypeError("A batch operation must be an object")),n[je];let u=Object.assign({},e[c]);if(u.type!=="put"&&u.type!=="del")return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[je];let f=this._checkKey(u.key);if(f)return this.nextTick(n,f),n[je];let h=u.sublevel!=null?u.sublevel:this,p=h.keyEncoding(u.keyEncoding||s),d=p.format;if(u.key=h.prefixKey(p.encode(u.key),d),u.keyEncoding=d,u.type==="put"){let m=this._checkValue(u.value);if(m)return this.nextTick(n,m),n[je];let g=h.valueEncoding(u.valueEncoding||o);u.value=g.encode(u.value),u.valueEncoding=g.format}h!==this&&(u.sublevel=null),i[c]=u}return this._batch(i,a,c=>{if(c)return n(c);this.emit("batch",e),n()}),n[je]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,dI.defaults(t))}_sublevel(e,t){return new dI(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=yd(e,t),t=yf(t,je),e=wf(e,this[bd].empty),this[tt]==="opening")return this.defer(()=>this.clear(e,t)),t[je];if(n1(this,t))return t[je];let n=e,i=this.keyEncoding(e.keyEncoding);return e=n8(e,i),e.keyEncoding=i.format,e.limit===0?this.nextTick(t):this._clear(e,s=>{if(s)return t(s);this.emit("clear",n),t()}),t[je]}_clear(e,t){this.nextTick(t)}iterator(e){let t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=n8(e,t),e.keys=e.keys!==!1,e.values=e.values!==!1,e[gd.keyEncoding]=t,e[gd.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[tt]==="opening")return new i7e(this,e);if(this[tt]!=="open")throw new Yo("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new gd(this,e)}keys(e){let t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=n8(e,t),e[gd.keyEncoding]=t,e[gd.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[tt]==="opening")return new s7e(this,e);if(this[tt]!=="open")throw new Yo("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new r7e(this,e)}values(e){let t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=n8(e,t),e[gd.keyEncoding]=t,e[gd.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[tt]==="opening")return new o7e(this,e);if(this[tt]!=="open")throw new Yo("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new n7e(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[Qg].push(e)}[Xg](){if(this[Qg].length===0)return;let e=this[Qg];this[Qg]=[];for(let t of e)t()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[wd].add(e)}detachResource(e){this[wd].delete(e)}_chainedBatch(){return new bY(this)}_checkKey(e){if(e==null)return new Yo("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new Yo("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};Zg.prototype.nextTick=dY();var{AbstractSublevel:dI}=wY()({AbstractLevel:Zg});pI.AbstractLevel=Zg;pI.AbstractSublevel=dI;var n1=function(r,e){return r[tt]!=="open"?(r.nextTick(e,new Yo("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},c7e=function(r){return Object.keys(r.supports.encodings).filter(e=>!!r.supports.encodings[e])}});var gI=P(Ed=>{"use strict";l();Ed.AbstractLevel=mI().AbstractLevel;Ed.AbstractSublevel=mI().AbstractSublevel;Ed.AbstractIterator=mf().AbstractIterator;Ed.AbstractKeyIterator=mf().AbstractKeyIterator;Ed.AbstractValueIterator=mf().AbstractValueIterator;Ed.AbstractChainedBatch=nI().AbstractChainedBatch});var vY=P((emt,_Y)=>{l();_Y.exports=u7e;var l7e=sI();function u7e(r,e,t){if(typeof e!="number")throw new Error("second argument must be a Number");let n,i,s,o,a,c=!0,u;Array.isArray(r)?(n=[],s=i=r.length):(o=Object.keys(r),n={},s=i=o.length);function f(p){function d(){t&&t(p,n),t=null}c?l7e(d):d()}function h(p,d,m){if(n[p]=m,d&&(a=!0),--s===0||d)f(d);else if(!a&&u<i){let g;o?(g=o[u],u+=1,r[g](function(y,w){h(g,y,w)})):(g=u,u+=1,r[g](function(y,w){h(g,y,w)}))}}u=e,s?o?o.some(function(p,d){return r[p](function(m,g){h(p,m,g)}),d===e-1}):r.some(function(p,d){return p(function(m,g){h(d,m,g)}),d===e-1}):f(null),c=!1}});var yI=P((rmt,SY)=>{"use strict";l();SY.exports=function(e){let t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,n=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,i=e.gte===void 0,s=e.lte===void 0;return t!==void 0&&n!==void 0?IDBKeyRange.bound(t,n,i,s):t!==void 0?IDBKeyRange.lowerBound(t,i):n!==void 0?IDBKeyRange.upperBound(n,s):null}});var wI=P((imt,xY)=>{"use strict";l();var f7e=new TextEncoder;xY.exports=function(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):f7e.encode(r)}});var CY=P(RY=>{"use strict";l();var{AbstractIterator:h7e}=gI(),AY=yI(),o8=wI(),Xa=Symbol("cache"),hl=Symbol("finished"),As=Symbol("options"),dl=Symbol("currentOptions"),_d=Symbol("position"),bI=Symbol("location"),i1=Symbol("first"),TY={},EI=class extends h7e{constructor(e,t,n){super(e,n),this[Xa]=[],this[hl]=this.limit===0,this[As]=n,this[dl]={...n},this[_d]=void 0,this[bI]=t,this[i1]=!0}_nextv(e,t,n){if(this[i1]=!1,this[hl])return this.nextTick(n,null,[]);if(this[Xa].length>0)return e=Math.min(e,this[Xa].length),this.nextTick(n,null,this[Xa].splice(0,e));this[_d]!==void 0&&(this[As].reverse?(this[dl].lt=this[_d],this[dl].lte=void 0):(this[dl].gt=this[_d],this[dl].gte=void 0));let i;try{i=AY(this[dl])}catch{return this[hl]=!0,this.nextTick(n,null,[])}let s=this.db.db.transaction([this[bI]],"readonly"),o=s.objectStore(this[bI]),a=[];if(this[As].reverse){let c=!this[As].values&&o.openKeyCursor?"openKeyCursor":"openCursor";o[c](i,"prev").onsuccess=u=>{let f=u.target.result;if(f){let{key:h,value:p}=f;this[_d]=h,a.push([this[As].keys&&h!==void 0?o8(h):void 0,this[As].values&&p!==void 0?o8(p):void 0]),a.length<e?f.continue():IY(s)}else this[hl]=!0}}else{let c,u,f=()=>{if(c===void 0||u===void 0)return;let h=Math.max(c.length,u.length);h===0||e===1/0?this[hl]=!0:this[_d]=c[h-1],a.length=h;for(let p=0;p<h;p++){let d=c[p],m=u[p];a[p]=[this[As].keys&&d!==void 0?o8(d):void 0,this[As].values&&m!==void 0?o8(m):void 0]}IY(s)};this[As].keys||e<1/0?o.getAllKeys(i,e<1/0?e:void 0).onsuccess=h=>{c=h.target.result,f()}:(c=[],this.nextTick(f)),this[As].values?o.getAll(i,e<1/0?e:void 0).onsuccess=h=>{u=h.target.result,f()}:(u=[],this.nextTick(f))}s.onabort=()=>{n(s.error||new Error("aborted by user")),n=null},s.oncomplete=()=>{n(null,a),n=null}}_next(e){if(this[Xa].length>0){let[t,n]=this[Xa].shift();this.nextTick(e,null,t,n)}else if(this[hl])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[i1]&&(this[i1]=!1,t=1),this._nextv(t,TY,(n,i)=>{if(n)return e(n);this[Xa]=i,this._next(e)})}}_all(e,t){this[i1]=!1;let n=this[Xa].splice(0,this[Xa].length),i=this.limit-this.count-n.length;if(i<=0)return this.nextTick(t,null,n);this._nextv(i,TY,(s,o)=>{if(s)return t(s);n.length>0&&(o=n.concat(o)),t(null,o)})}_seek(e,t){this[i1]=!0,this[Xa]=[],this[hl]=!1,this[_d]=void 0,this[dl]={...this[As]};let n;try{n=AY(this[As])}catch{this[hl]=!0;return}n!==null&&!n.includes(e)?this[hl]=!0:this[As].reverse?this[dl].lte=e:this[dl].gte=e}};RY.Iterator=EI;function IY(r){typeof r.commit=="function"&&r.commit()}});var kY=P((cmt,PY)=>{"use strict";l();PY.exports=function(e,t,n,i,s){if(i.limit===0)return e.nextTick(s);let o=e.db.transaction([t],"readwrite"),a=o.objectStore(t),c=0;o.oncomplete=function(){s()},o.onabort=function(){s(o.error||new Error("aborted by user"))};let u=a.openKeyCursor?"openKeyCursor":"openCursor",f=i.reverse?"prev":"next";a[u](n,f).onsuccess=function(h){let p=h.target.result;p&&(a.delete(p.key).onsuccess=function(){(i.limit<=0||++c<i.limit)&&p.continue()})}}});var UY=P(BY=>{"use strict";l();var{AbstractLevel:d7e}=gI(),OY=jo(),p7e=vY(),{fromCallback:m7e}=Fg(),{Iterator:g7e}=CY(),NY=wI(),y7e=kY(),w7e=yI(),LY="level-js-",Jg=Symbol("idb"),_I=Symbol("namePrefix"),pl=Symbol("location"),vI=Symbol("version"),vd=Symbol("store"),ey=Symbol("onComplete"),DY=Symbol("promise"),a8=class extends d7e{constructor(e,t,n){if(typeof t=="function"||typeof n=="function")throw new OY("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{prefix:i,version:s,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),typeof e!="string")throw new Error("constructor requires a location string argument");this[pl]=e,this[_I]=i??LY,this[vI]=parseInt(s||1,10),this[Jg]=null}get location(){return this[pl]}get namePrefix(){return this[_I]}get version(){return this[vI]}get db(){return this[Jg]}get type(){return"browser-level"}_open(e,t){let n=indexedDB.open(this[_I]+this[pl],this[vI]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[Jg]=n.result,t()},n.onupgradeneeded=i=>{let s=i.target.result;s.objectStoreNames.contains(this[pl])||s.createObjectStore(this[pl])}}[vd](e){return this[Jg].transaction([this[pl]],e).objectStore(this[pl])}[ey](e,t){let n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){let i=this[vd]("readonly"),s;try{s=i.get(e)}catch(o){return this.nextTick(n,o)}this[ey](s,function(o,a){if(o)return n(o);if(a===void 0)return n(new OY("Entry not found",{code:"LEVEL_NOT_FOUND"}));n(null,NY(a))})}_getMany(e,t,n){let i=this[vd]("readonly"),s=e.map(o=>a=>{let c;try{c=i.get(o)}catch(u){return a(u)}c.onsuccess=()=>{let u=c.result;a(null,u===void 0?u:NY(u))},c.onerror=u=>{u.stopPropagation(),a(c.error)}});p7e(s,16,n)}_del(e,t,n){let i=this[vd]("readwrite"),s;try{s=i.delete(e)}catch(o){return this.nextTick(n,o)}this[ey](s,n)}_put(e,t,n,i){let s=this[vd]("readwrite"),o;try{o=s.put(t,e)}catch(a){return this.nextTick(i,a)}this[ey](o,i)}_iterator(e){return new g7e(this,this[pl],e)}_batch(e,t,n){let i=this[vd]("readwrite"),s=i.transaction,o=0,a;s.onabort=function(){n(a||s.error||new Error("aborted by user"))},s.oncomplete=function(){n()};function c(){let u=e[o++],f=u.key,h;try{h=u.type==="del"?i.delete(f):i.put(u.value,f)}catch(p){a=p,s.abort();return}o<e.length?h.onsuccess=c:typeof s.commit=="function"&&s.commit()}c()}_clear(e,t){let n,i;try{n=w7e(e)}catch{return this.nextTick(t)}if(e.limit>=0)return y7e(this,this[pl],n,e,t);try{let s=this[vd]("readwrite");i=n?s.delete(n):s.clear()}catch(s){return this.nextTick(t,s)}this[ey](i,t)}_close(e){this[Jg].close(),this.nextTick(e)}};a8.destroy=function(r,e,t){typeof e=="function"&&(t=e,e=LY),t=m7e(t,DY);let n=indexedDB.deleteDatabase(e+r);return n.onsuccess=function(){t()},n.onerror=function(i){t(i)},t[DY]};BY.BrowserLevel=a8});var FY=P(MY=>{l();MY.Level=UY().BrowserLevel});var hQ=P((Ogt,fQ)=>{"use strict";l();fQ.exports=$n;var iy=vf();function $n(r,e){this.lo=r>>>0,this.hi=e>>>0}var Sd=$n.zero=new $n(0,0);Sd.toNumber=function(){return 0};Sd.zzEncode=Sd.zzDecode=function(){return this};Sd.length=function(){return 1};var i_e=$n.zeroHash="\0\0\0\0\0\0\0\0";$n.fromNumber=function(e){if(e===0)return Sd;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new $n(n,i)};$n.from=function(e){if(typeof e=="number")return $n.fromNumber(e);if(iy.isString(e))if(iy.Long)e=iy.Long.fromString(e);else return $n.fromNumber(parseInt(e,10));return e.low||e.high?new $n(e.low>>>0,e.high>>>0):Sd};$n.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};$n.prototype.toLong=function(e){return iy.Long?new iy.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var _f=String.prototype.charCodeAt;$n.fromHash=function(e){return e===i_e?Sd:new $n((_f.call(e,0)|_f.call(e,1)<<8|_f.call(e,2)<<16|_f.call(e,3)<<24)>>>0,(_f.call(e,4)|_f.call(e,5)<<8|_f.call(e,6)<<16|_f.call(e,7)<<24)>>>0)};$n.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};$n.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};$n.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};$n.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var vf=P(UI=>{"use strict";l();var Re=UI;Re.asPromise=Xl();Re.base64=Zl();Re.EventEmitter=Jl();Re.float=eu();Re.inquire=tu();Re.utf8=ru();Re.pool=nu();Re.LongBits=hQ();Re.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);Re.global=Re.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||UI;Re.emptyArray=Object.freeze?Object.freeze([]):[];Re.emptyObject=Object.freeze?Object.freeze({}):{};Re.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Re.isString=function(e){return typeof e=="string"||e instanceof String};Re.isObject=function(e){return e&&typeof e=="object"};Re.isset=Re.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};Re.Buffer=function(){try{var r=Re.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();Re._Buffer_from=null;Re._Buffer_allocUnsafe=null;Re.newBuffer=function(e){return typeof e=="number"?Re.Buffer?Re._Buffer_allocUnsafe(e):new Re.Array(e):Re.Buffer?Re._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Re.Array=typeof Uint8Array<"u"?Uint8Array:Array;Re.Long=Re.global.dcodeIO&&Re.global.dcodeIO.Long||Re.global.Long||Re.inquire("long");Re.key2Re=/^true|false|0|1$/;Re.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Re.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Re.longToHash=function(e){return e?Re.LongBits.from(e).toHash():Re.LongBits.zeroHash};Re.longFromHash=function(e,t){var n=Re.LongBits.fromHash(e);return Re.Long?Re.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function dQ(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}Re.merge=dQ;Re.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function pQ(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&dQ(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return r}}),e.prototype.toString=function(){return this.name+": "+this.message},e}Re.newError=pQ;Re.ProtocolError=pQ("ProtocolError");Re.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Re.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};Re.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Re._configure=function(){var r=Re.Buffer;if(!r){Re._Buffer_from=Re._Buffer_allocUnsafe=null;return}Re._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},Re._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var $I=P((Bgt,wQ)=>{"use strict";l();wQ.exports=kt;var oo=vf(),MI,g8=oo.LongBits,mQ=oo.base64,gQ=oo.utf8;function sy(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function VI(){}function s_e(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function kt(){this.len=0,this.head=new sy(VI,0,0),this.tail=this.head,this.states=null}var yQ=function(){return oo.Buffer?function(){return(kt.create=function(){return new MI})()}:function(){return new kt}};kt.create=yQ();kt.alloc=function(e){return new oo.Array(e)};oo.Array!==Array&&(kt.alloc=oo.pool(kt.alloc,oo.Array.prototype.subarray));kt.prototype._push=function(e,t,n){return this.tail=this.tail.next=new sy(e,t,n),this.len+=t,this};function zI(r,e,t){e[t]=r&255}function o_e(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function KI(r,e){this.len=r,this.next=void 0,this.val=e}KI.prototype=Object.create(sy.prototype);KI.prototype.fn=o_e;kt.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new KI((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};kt.prototype.int32=function(e){return e<0?this._push(qI,10,g8.fromNumber(e)):this.uint32(e)};kt.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function qI(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}kt.prototype.uint64=function(e){var t=g8.from(e);return this._push(qI,t.length(),t)};kt.prototype.int64=kt.prototype.uint64;kt.prototype.sint64=function(e){var t=g8.from(e).zzEncode();return this._push(qI,t.length(),t)};kt.prototype.bool=function(e){return this._push(zI,1,e?1:0)};function FI(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}kt.prototype.fixed32=function(e){return this._push(FI,4,e>>>0)};kt.prototype.sfixed32=kt.prototype.fixed32;kt.prototype.fixed64=function(e){var t=g8.from(e);return this._push(FI,4,t.lo)._push(FI,4,t.hi)};kt.prototype.sfixed64=kt.prototype.fixed64;kt.prototype.float=function(e){return this._push(oo.float.writeFloatLE,4,e)};kt.prototype.double=function(e){return this._push(oo.float.writeDoubleLE,8,e)};var a_e=oo.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};kt.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(zI,1,0);if(oo.isString(e)){var n=kt.alloc(t=mQ.length(e));mQ.decode(e,n,0),e=n}return this.uint32(t)._push(a_e,t,e)};kt.prototype.string=function(e){var t=gQ.length(e);return t?this.uint32(t)._push(gQ.write,t,e):this._push(zI,1,0)};kt.prototype.fork=function(){return this.states=new s_e(this),this.head=this.tail=new sy(VI,0,0),this.len=0,this};kt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sy(VI,0,0),this.len=0),this};kt.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};kt.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};kt._configure=function(r){MI=r,kt.create=yQ(),MI._configure()}});var _Q=P((Mgt,EQ)=>{"use strict";l();EQ.exports=ec;var bQ=$I();(ec.prototype=Object.create(bQ.prototype)).constructor=ec;var Sf=vf();function ec(){bQ.call(this)}ec._configure=function(){ec.alloc=Sf._Buffer_allocUnsafe,ec.writeBytesBuffer=Sf.Buffer&&Sf.Buffer.prototype instanceof Uint8Array&&Sf.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};ec.prototype.bytes=function(e){Sf.isString(e)&&(e=Sf._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(ec.writeBytesBuffer,t,e),this};function c_e(r,e,t){r.length<40?Sf.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}ec.prototype.string=function(e){var t=Sf.Buffer.byteLength(e);return this.uint32(t),t&&this._push(c_e,t,e),this};ec._configure()});var jI=P((Vgt,TQ)=>{"use strict";l();TQ.exports=sn;var tc=vf(),GI,xQ=tc.LongBits,l_e=tc.utf8;function Qo(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function sn(r){this.buf=r,this.pos=0,this.len=r.length}var vQ=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new sn(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new sn(e);throw Error("illegal buffer")},AQ=function(){return tc.Buffer?function(t){return(sn.create=function(i){return tc.Buffer.isBuffer(i)?new GI(i):vQ(i)})(t)}:vQ};sn.create=AQ();sn.prototype._slice=tc.Array.prototype.subarray||tc.Array.prototype.slice;sn.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Qo(this,10);return e}}();sn.prototype.int32=function(){return this.uint32()|0};sn.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function HI(){var r=new xQ(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Qo(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw Qo(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}sn.prototype.bool=function(){return this.uint32()!==0};function y8(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}sn.prototype.fixed32=function(){if(this.pos+4>this.len)throw Qo(this,4);return y8(this.buf,this.pos+=4)};sn.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Qo(this,4);return y8(this.buf,this.pos+=4)|0};function SQ(){if(this.pos+8>this.len)throw Qo(this,8);return new xQ(y8(this.buf,this.pos+=4),y8(this.buf,this.pos+=4))}sn.prototype.float=function(){if(this.pos+4>this.len)throw Qo(this,4);var e=tc.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};sn.prototype.double=function(){if(this.pos+8>this.len)throw Qo(this,4);var e=tc.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};sn.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Qo(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};sn.prototype.string=function(){var e=this.bytes();return l_e.read(e,0,e.length)};sn.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Qo(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Qo(this);while(this.buf[this.pos++]&128);return this};sn.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};sn._configure=function(r){GI=r,sn.create=AQ(),GI._configure();var e=tc.Long?"toLong":"toNumber";tc.merge(sn.prototype,{int64:function(){return HI.call(this)[e](!1)},uint64:function(){return HI.call(this)[e](!0)},sint64:function(){return HI.call(this).zzDecode()[e](!1)},fixed64:function(){return SQ.call(this)[e](!0)},sfixed64:function(){return SQ.call(this)[e](!1)}})}});var PQ=P((Kgt,CQ)=>{"use strict";l();CQ.exports=xd;var RQ=jI();(xd.prototype=Object.create(RQ.prototype)).constructor=xd;var IQ=vf();function xd(r){RQ.call(this,r)}xd._configure=function(){IQ.Buffer&&(xd.prototype._slice=IQ.Buffer.prototype.slice)};xd.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};xd._configure()});var OQ=P(($gt,kQ)=>{"use strict";l();kQ.exports=oy;var WI=vf();(oy.prototype=Object.create(WI.EventEmitter.prototype)).constructor=oy;function oy(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");WI.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(t)}oy.prototype.rpcCall=function r(e,t,n,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return WI.asPromise(r,o,e,t,n,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(c,u){if(c)return o.emit("error",c,e),s(c);if(u===null){o.end(!0);return}if(!(u instanceof n))try{u=n[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(f){return o.emit("error",f,e),s(f)}return o.emit("data",u,e),s(null,u)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};oy.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var DQ=P(NQ=>{"use strict";l();var u_e=NQ;u_e.Service=OQ()});var BQ=P((Wgt,LQ)=>{"use strict";l();LQ.exports={}});var FQ=P(MQ=>{"use strict";l();var es=MQ;es.build="minimal";es.Writer=$I();es.BufferWriter=_Q();es.Reader=jI();es.BufferReader=PQ();es.util=vf();es.rpc=DQ();es.roots=BQ();es.configure=UQ;function UQ(){es.util._configure(),es.Writer._configure(es.BufferWriter),es.Reader._configure(es.BufferReader)}UQ()});var YI=P((Zgt,VQ)=>{"use strict";l();VQ.exports=FQ()});var KQ=P((zQ,ay)=>{l();(function(r,e){typeof define=="function"&&define.amd?define(["protobufjs/minimal"],e):typeof op=="function"&&typeof ay=="object"&&ay&&ay.exports&&(ay.exports=e(YI()))})(zQ,function(r){"use strict";var e=r.Reader,t=r.Writer,n=r.util,i=r.roots.default||(r.roots.default={});return i.RPC=function(){function s(a){if(this.subscriptions=[],this.messages=[],a)for(var c=Object.keys(a),u=0;u<c.length;++u)a[c[u]]!=null&&(this[c[u]]=a[c[u]])}s.prototype.subscriptions=n.emptyArray,s.prototype.messages=n.emptyArray,s.prototype.control=null;var o;return Object.defineProperty(s.prototype,"_control",{get:n.oneOfGetter(o=["control"]),set:n.oneOfSetter(o)}),s.encode=function(c,u){if(u||(u=t.create()),c.subscriptions!=null&&c.subscriptions.length)for(var f=0;f<c.subscriptions.length;++f)i.RPC.SubOpts.encode(c.subscriptions[f],u.uint32(10).fork()).ldelim();if(c.messages!=null&&c.messages.length)for(var f=0;f<c.messages.length;++f)i.RPC.Message.encode(c.messages[f],u.uint32(18).fork()).ldelim();return c.control!=null&&Object.hasOwnProperty.call(c,"control")&&i.RPC.ControlMessage.encode(c.control,u.uint32(26).fork()).ldelim(),u},s.decode=function(c,u){c instanceof e||(c=e.create(c));for(var f=u===void 0?c.len:c.pos+u,h=new i.RPC;c.pos<f;){var p=c.uint32();switch(p>>>3){case 1:h.subscriptions&&h.subscriptions.length||(h.subscriptions=[]),h.subscriptions.push(i.RPC.SubOpts.decode(c,c.uint32()));break;case 2:h.messages&&h.messages.length||(h.messages=[]),h.messages.push(i.RPC.Message.decode(c,c.uint32()));break;case 3:h.control=i.RPC.ControlMessage.decode(c,c.uint32());break;default:c.skipType(p&7);break}}return h},s.fromObject=function(c){if(c instanceof i.RPC)return c;var u=new i.RPC;if(c.subscriptions){if(!Array.isArray(c.subscriptions))throw TypeError(".RPC.subscriptions: array expected");u.subscriptions=[];for(var f=0;f<c.subscriptions.length;++f){if(typeof c.subscriptions[f]!="object")throw TypeError(".RPC.subscriptions: object expected");u.subscriptions[f]=i.RPC.SubOpts.fromObject(c.subscriptions[f])}}if(c.messages){if(!Array.isArray(c.messages))throw TypeError(".RPC.messages: array expected");u.messages=[];for(var f=0;f<c.messages.length;++f){if(typeof c.messages[f]!="object")throw TypeError(".RPC.messages: object expected");u.messages[f]=i.RPC.Message.fromObject(c.messages[f])}}if(c.control!=null){if(typeof c.control!="object")throw TypeError(".RPC.control: object expected");u.control=i.RPC.ControlMessage.fromObject(c.control)}return u},s.toObject=function(c,u){u||(u={});var f={};if((u.arrays||u.defaults)&&(f.subscriptions=[],f.messages=[]),c.subscriptions&&c.subscriptions.length){f.subscriptions=[];for(var h=0;h<c.subscriptions.length;++h)f.subscriptions[h]=i.RPC.SubOpts.toObject(c.subscriptions[h],u)}if(c.messages&&c.messages.length){f.messages=[];for(var h=0;h<c.messages.length;++h)f.messages[h]=i.RPC.Message.toObject(c.messages[h],u)}return c.control!=null&&c.hasOwnProperty("control")&&(f.control=i.RPC.ControlMessage.toObject(c.control,u),u.oneofs&&(f._control="control")),f},s.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},s.SubOpts=function(){function a(u){if(u)for(var f=Object.keys(u),h=0;h<f.length;++h)u[f[h]]!=null&&(this[f[h]]=u[f[h]])}a.prototype.subscribe=null,a.prototype.topic=null;var c;return Object.defineProperty(a.prototype,"_subscribe",{get:n.oneOfGetter(c=["subscribe"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_topic",{get:n.oneOfGetter(c=["topic"]),set:n.oneOfSetter(c)}),a.encode=function(f,h){return h||(h=t.create()),f.subscribe!=null&&Object.hasOwnProperty.call(f,"subscribe")&&h.uint32(8).bool(f.subscribe),f.topic!=null&&Object.hasOwnProperty.call(f,"topic")&&h.uint32(18).string(f.topic),h},a.decode=function(f,h){f instanceof e||(f=e.create(f));for(var p=h===void 0?f.len:f.pos+h,d=new i.RPC.SubOpts;f.pos<p;){var m=f.uint32();switch(m>>>3){case 1:d.subscribe=f.bool();break;case 2:d.topic=f.string();break;default:f.skipType(m&7);break}}return d},a.fromObject=function(f){if(f instanceof i.RPC.SubOpts)return f;var h=new i.RPC.SubOpts;return f.subscribe!=null&&(h.subscribe=Boolean(f.subscribe)),f.topic!=null&&(h.topic=String(f.topic)),h},a.toObject=function(f,h){h||(h={});var p={};return f.subscribe!=null&&f.hasOwnProperty("subscribe")&&(p.subscribe=f.subscribe,h.oneofs&&(p._subscribe="subscribe")),f.topic!=null&&f.hasOwnProperty("topic")&&(p.topic=f.topic,h.oneofs&&(p._topic="topic")),p},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.Message=function(){function a(u){if(u)for(var f=Object.keys(u),h=0;h<f.length;++h)u[f[h]]!=null&&(this[f[h]]=u[f[h]])}a.prototype.from=null,a.prototype.data=null,a.prototype.seqno=null,a.prototype.topic="",a.prototype.signature=null,a.prototype.key=null;var c;return Object.defineProperty(a.prototype,"_from",{get:n.oneOfGetter(c=["from"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_data",{get:n.oneOfGetter(c=["data"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_seqno",{get:n.oneOfGetter(c=["seqno"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_signature",{get:n.oneOfGetter(c=["signature"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_key",{get:n.oneOfGetter(c=["key"]),set:n.oneOfSetter(c)}),a.encode=function(f,h){return h||(h=t.create()),f.from!=null&&Object.hasOwnProperty.call(f,"from")&&h.uint32(10).bytes(f.from),f.data!=null&&Object.hasOwnProperty.call(f,"data")&&h.uint32(18).bytes(f.data),f.seqno!=null&&Object.hasOwnProperty.call(f,"seqno")&&h.uint32(26).bytes(f.seqno),h.uint32(34).string(f.topic),f.signature!=null&&Object.hasOwnProperty.call(f,"signature")&&h.uint32(42).bytes(f.signature),f.key!=null&&Object.hasOwnProperty.call(f,"key")&&h.uint32(50).bytes(f.key),h},a.decode=function(f,h){f instanceof e||(f=e.create(f));for(var p=h===void 0?f.len:f.pos+h,d=new i.RPC.Message;f.pos<p;){var m=f.uint32();switch(m>>>3){case 1:d.from=f.bytes();break;case 2:d.data=f.bytes();break;case 3:d.seqno=f.bytes();break;case 4:d.topic=f.string();break;case 5:d.signature=f.bytes();break;case 6:d.key=f.bytes();break;default:f.skipType(m&7);break}}if(!d.hasOwnProperty("topic"))throw n.ProtocolError("missing required 'topic'",{instance:d});return d},a.fromObject=function(f){if(f instanceof i.RPC.Message)return f;var h=new i.RPC.Message;return f.from!=null&&(typeof f.from=="string"?n.base64.decode(f.from,h.from=n.newBuffer(n.base64.length(f.from)),0):f.from.length&&(h.from=f.from)),f.data!=null&&(typeof f.data=="string"?n.base64.decode(f.data,h.data=n.newBuffer(n.base64.length(f.data)),0):f.data.length&&(h.data=f.data)),f.seqno!=null&&(typeof f.seqno=="string"?n.base64.decode(f.seqno,h.seqno=n.newBuffer(n.base64.length(f.seqno)),0):f.seqno.length&&(h.seqno=f.seqno)),f.topic!=null&&(h.topic=String(f.topic)),f.signature!=null&&(typeof f.signature=="string"?n.base64.decode(f.signature,h.signature=n.newBuffer(n.base64.length(f.signature)),0):f.signature.length&&(h.signature=f.signature)),f.key!=null&&(typeof f.key=="string"?n.base64.decode(f.key,h.key=n.newBuffer(n.base64.length(f.key)),0):f.key.length&&(h.key=f.key)),h},a.toObject=function(f,h){h||(h={});var p={};return h.defaults&&(p.topic=""),f.from!=null&&f.hasOwnProperty("from")&&(p.from=h.bytes===String?n.base64.encode(f.from,0,f.from.length):h.bytes===Array?Array.prototype.slice.call(f.from):f.from,h.oneofs&&(p._from="from")),f.data!=null&&f.hasOwnProperty("data")&&(p.data=h.bytes===String?n.base64.encode(f.data,0,f.data.length):h.bytes===Array?Array.prototype.slice.call(f.data):f.data,h.oneofs&&(p._data="data")),f.seqno!=null&&f.hasOwnProperty("seqno")&&(p.seqno=h.bytes===String?n.base64.encode(f.seqno,0,f.seqno.length):h.bytes===Array?Array.prototype.slice.call(f.seqno):f.seqno,h.oneofs&&(p._seqno="seqno")),f.topic!=null&&f.hasOwnProperty("topic")&&(p.topic=f.topic),f.signature!=null&&f.hasOwnProperty("signature")&&(p.signature=h.bytes===String?n.base64.encode(f.signature,0,f.signature.length):h.bytes===Array?Array.prototype.slice.call(f.signature):f.signature,h.oneofs&&(p._signature="signature")),f.key!=null&&f.hasOwnProperty("key")&&(p.key=h.bytes===String?n.base64.encode(f.key,0,f.key.length):h.bytes===Array?Array.prototype.slice.call(f.key):f.key,h.oneofs&&(p._key="key")),p},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.ControlMessage=function(){function a(c){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],c)for(var u=Object.keys(c),f=0;f<u.length;++f)c[u[f]]!=null&&(this[u[f]]=c[u[f]])}return a.prototype.ihave=n.emptyArray,a.prototype.iwant=n.emptyArray,a.prototype.graft=n.emptyArray,a.prototype.prune=n.emptyArray,a.encode=function(u,f){if(f||(f=t.create()),u.ihave!=null&&u.ihave.length)for(var h=0;h<u.ihave.length;++h)i.RPC.ControlIHave.encode(u.ihave[h],f.uint32(10).fork()).ldelim();if(u.iwant!=null&&u.iwant.length)for(var h=0;h<u.iwant.length;++h)i.RPC.ControlIWant.encode(u.iwant[h],f.uint32(18).fork()).ldelim();if(u.graft!=null&&u.graft.length)for(var h=0;h<u.graft.length;++h)i.RPC.ControlGraft.encode(u.graft[h],f.uint32(26).fork()).ldelim();if(u.prune!=null&&u.prune.length)for(var h=0;h<u.prune.length;++h)i.RPC.ControlPrune.encode(u.prune[h],f.uint32(34).fork()).ldelim();return f},a.decode=function(u,f){u instanceof e||(u=e.create(u));for(var h=f===void 0?u.len:u.pos+f,p=new i.RPC.ControlMessage;u.pos<h;){var d=u.uint32();switch(d>>>3){case 1:p.ihave&&p.ihave.length||(p.ihave=[]),p.ihave.push(i.RPC.ControlIHave.decode(u,u.uint32()));break;case 2:p.iwant&&p.iwant.length||(p.iwant=[]),p.iwant.push(i.RPC.ControlIWant.decode(u,u.uint32()));break;case 3:p.graft&&p.graft.length||(p.graft=[]),p.graft.push(i.RPC.ControlGraft.decode(u,u.uint32()));break;case 4:p.prune&&p.prune.length||(p.prune=[]),p.prune.push(i.RPC.ControlPrune.decode(u,u.uint32()));break;default:u.skipType(d&7);break}}return p},a.fromObject=function(u){if(u instanceof i.RPC.ControlMessage)return u;var f=new i.RPC.ControlMessage;if(u.ihave){if(!Array.isArray(u.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");f.ihave=[];for(var h=0;h<u.ihave.length;++h){if(typeof u.ihave[h]!="object")throw TypeError(".RPC.ControlMessage.ihave: object expected");f.ihave[h]=i.RPC.ControlIHave.fromObject(u.ihave[h])}}if(u.iwant){if(!Array.isArray(u.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");f.iwant=[];for(var h=0;h<u.iwant.length;++h){if(typeof u.iwant[h]!="object")throw TypeError(".RPC.ControlMessage.iwant: object expected");f.iwant[h]=i.RPC.ControlIWant.fromObject(u.iwant[h])}}if(u.graft){if(!Array.isArray(u.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");f.graft=[];for(var h=0;h<u.graft.length;++h){if(typeof u.graft[h]!="object")throw TypeError(".RPC.ControlMessage.graft: object expected");f.graft[h]=i.RPC.ControlGraft.fromObject(u.graft[h])}}if(u.prune){if(!Array.isArray(u.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");f.prune=[];for(var h=0;h<u.prune.length;++h){if(typeof u.prune[h]!="object")throw TypeError(".RPC.ControlMessage.prune: object expected");f.prune[h]=i.RPC.ControlPrune.fromObject(u.prune[h])}}return f},a.toObject=function(u,f){f||(f={});var h={};if((f.arrays||f.defaults)&&(h.ihave=[],h.iwant=[],h.graft=[],h.prune=[]),u.ihave&&u.ihave.length){h.ihave=[];for(var p=0;p<u.ihave.length;++p)h.ihave[p]=i.RPC.ControlIHave.toObject(u.ihave[p],f)}if(u.iwant&&u.iwant.length){h.iwant=[];for(var p=0;p<u.iwant.length;++p)h.iwant[p]=i.RPC.ControlIWant.toObject(u.iwant[p],f)}if(u.graft&&u.graft.length){h.graft=[];for(var p=0;p<u.graft.length;++p)h.graft[p]=i.RPC.ControlGraft.toObject(u.graft[p],f)}if(u.prune&&u.prune.length){h.prune=[];for(var p=0;p<u.prune.length;++p)h.prune[p]=i.RPC.ControlPrune.toObject(u.prune[p],f)}return h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.ControlIHave=function(){function a(u){if(this.messageIDs=[],u)for(var f=Object.keys(u),h=0;h<f.length;++h)u[f[h]]!=null&&(this[f[h]]=u[f[h]])}a.prototype.topicID=null,a.prototype.messageIDs=n.emptyArray;var c;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(c=["topicID"]),set:n.oneOfSetter(c)}),a.encode=function(f,h){if(h||(h=t.create()),f.topicID!=null&&Object.hasOwnProperty.call(f,"topicID")&&h.uint32(10).string(f.topicID),f.messageIDs!=null&&f.messageIDs.length)for(var p=0;p<f.messageIDs.length;++p)h.uint32(18).bytes(f.messageIDs[p]);return h},a.decode=function(f,h){f instanceof e||(f=e.create(f));for(var p=h===void 0?f.len:f.pos+h,d=new i.RPC.ControlIHave;f.pos<p;){var m=f.uint32();switch(m>>>3){case 1:d.topicID=f.string();break;case 2:d.messageIDs&&d.messageIDs.length||(d.messageIDs=[]),d.messageIDs.push(f.bytes());break;default:f.skipType(m&7);break}}return d},a.fromObject=function(f){if(f instanceof i.RPC.ControlIHave)return f;var h=new i.RPC.ControlIHave;if(f.topicID!=null&&(h.topicID=String(f.topicID)),f.messageIDs){if(!Array.isArray(f.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");h.messageIDs=[];for(var p=0;p<f.messageIDs.length;++p)typeof f.messageIDs[p]=="string"?n.base64.decode(f.messageIDs[p],h.messageIDs[p]=n.newBuffer(n.base64.length(f.messageIDs[p])),0):f.messageIDs[p].length&&(h.messageIDs[p]=f.messageIDs[p])}return h},a.toObject=function(f,h){h||(h={});var p={};if((h.arrays||h.defaults)&&(p.messageIDs=[]),f.topicID!=null&&f.hasOwnProperty("topicID")&&(p.topicID=f.topicID,h.oneofs&&(p._topicID="topicID")),f.messageIDs&&f.messageIDs.length){p.messageIDs=[];for(var d=0;d<f.messageIDs.length;++d)p.messageIDs[d]=h.bytes===String?n.base64.encode(f.messageIDs[d],0,f.messageIDs[d].length):h.bytes===Array?Array.prototype.slice.call(f.messageIDs[d]):f.messageIDs[d]}return p},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.ControlIWant=function(){function a(c){if(this.messageIDs=[],c)for(var u=Object.keys(c),f=0;f<u.length;++f)c[u[f]]!=null&&(this[u[f]]=c[u[f]])}return a.prototype.messageIDs=n.emptyArray,a.encode=function(u,f){if(f||(f=t.create()),u.messageIDs!=null&&u.messageIDs.length)for(var h=0;h<u.messageIDs.length;++h)f.uint32(10).bytes(u.messageIDs[h]);return f},a.decode=function(u,f){u instanceof e||(u=e.create(u));for(var h=f===void 0?u.len:u.pos+f,p=new i.RPC.ControlIWant;u.pos<h;){var d=u.uint32();switch(d>>>3){case 1:p.messageIDs&&p.messageIDs.length||(p.messageIDs=[]),p.messageIDs.push(u.bytes());break;default:u.skipType(d&7);break}}return p},a.fromObject=function(u){if(u instanceof i.RPC.ControlIWant)return u;var f=new i.RPC.ControlIWant;if(u.messageIDs){if(!Array.isArray(u.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");f.messageIDs=[];for(var h=0;h<u.messageIDs.length;++h)typeof u.messageIDs[h]=="string"?n.base64.decode(u.messageIDs[h],f.messageIDs[h]=n.newBuffer(n.base64.length(u.messageIDs[h])),0):u.messageIDs[h].length&&(f.messageIDs[h]=u.messageIDs[h])}return f},a.toObject=function(u,f){f||(f={});var h={};if((f.arrays||f.defaults)&&(h.messageIDs=[]),u.messageIDs&&u.messageIDs.length){h.messageIDs=[];for(var p=0;p<u.messageIDs.length;++p)h.messageIDs[p]=f.bytes===String?n.base64.encode(u.messageIDs[p],0,u.messageIDs[p].length):f.bytes===Array?Array.prototype.slice.call(u.messageIDs[p]):u.messageIDs[p]}return h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.ControlGraft=function(){function a(u){if(u)for(var f=Object.keys(u),h=0;h<f.length;++h)u[f[h]]!=null&&(this[f[h]]=u[f[h]])}a.prototype.topicID=null;var c;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(c=["topicID"]),set:n.oneOfSetter(c)}),a.encode=function(f,h){return h||(h=t.create()),f.topicID!=null&&Object.hasOwnProperty.call(f,"topicID")&&h.uint32(10).string(f.topicID),h},a.decode=function(f,h){f instanceof e||(f=e.create(f));for(var p=h===void 0?f.len:f.pos+h,d=new i.RPC.ControlGraft;f.pos<p;){var m=f.uint32();switch(m>>>3){case 1:d.topicID=f.string();break;default:f.skipType(m&7);break}}return d},a.fromObject=function(f){if(f instanceof i.RPC.ControlGraft)return f;var h=new i.RPC.ControlGraft;return f.topicID!=null&&(h.topicID=String(f.topicID)),h},a.toObject=function(f,h){h||(h={});var p={};return f.topicID!=null&&f.hasOwnProperty("topicID")&&(p.topicID=f.topicID,h.oneofs&&(p._topicID="topicID")),p},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.ControlPrune=function(){function a(u){if(this.peers=[],u)for(var f=Object.keys(u),h=0;h<f.length;++h)u[f[h]]!=null&&(this[f[h]]=u[f[h]])}a.prototype.topicID=null,a.prototype.peers=n.emptyArray,a.prototype.backoff=null;var c;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(c=["topicID"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_backoff",{get:n.oneOfGetter(c=["backoff"]),set:n.oneOfSetter(c)}),a.encode=function(f,h){if(h||(h=t.create()),f.topicID!=null&&Object.hasOwnProperty.call(f,"topicID")&&h.uint32(10).string(f.topicID),f.peers!=null&&f.peers.length)for(var p=0;p<f.peers.length;++p)i.RPC.PeerInfo.encode(f.peers[p],h.uint32(18).fork()).ldelim();return f.backoff!=null&&Object.hasOwnProperty.call(f,"backoff")&&h.uint32(24).uint64(f.backoff),h},a.decode=function(f,h){f instanceof e||(f=e.create(f));for(var p=h===void 0?f.len:f.pos+h,d=new i.RPC.ControlPrune;f.pos<p;){var m=f.uint32();switch(m>>>3){case 1:d.topicID=f.string();break;case 2:d.peers&&d.peers.length||(d.peers=[]),d.peers.push(i.RPC.PeerInfo.decode(f,f.uint32()));break;case 3:d.backoff=f.uint64();break;default:f.skipType(m&7);break}}return d},a.fromObject=function(f){if(f instanceof i.RPC.ControlPrune)return f;var h=new i.RPC.ControlPrune;if(f.topicID!=null&&(h.topicID=String(f.topicID)),f.peers){if(!Array.isArray(f.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");h.peers=[];for(var p=0;p<f.peers.length;++p){if(typeof f.peers[p]!="object")throw TypeError(".RPC.ControlPrune.peers: object expected");h.peers[p]=i.RPC.PeerInfo.fromObject(f.peers[p])}}return f.backoff!=null&&(n.Long?(h.backoff=n.Long.fromValue(f.backoff)).unsigned=!0:typeof f.backoff=="string"?h.backoff=parseInt(f.backoff,10):typeof f.backoff=="number"?h.backoff=f.backoff:typeof f.backoff=="object"&&(h.backoff=new n.LongBits(f.backoff.low>>>0,f.backoff.high>>>0).toNumber(!0))),h},a.toObject=function(f,h){h||(h={});var p={};if((h.arrays||h.defaults)&&(p.peers=[]),f.topicID!=null&&f.hasOwnProperty("topicID")&&(p.topicID=f.topicID,h.oneofs&&(p._topicID="topicID")),f.peers&&f.peers.length){p.peers=[];for(var d=0;d<f.peers.length;++d)p.peers[d]=i.RPC.PeerInfo.toObject(f.peers[d],h)}return f.backoff!=null&&f.hasOwnProperty("backoff")&&(typeof f.backoff=="number"?p.backoff=h.longs===String?String(f.backoff):f.backoff:p.backoff=h.longs===String?n.Long.prototype.toString.call(f.backoff):h.longs===Number?new n.LongBits(f.backoff.low>>>0,f.backoff.high>>>0).toNumber(!0):f.backoff,h.oneofs&&(p._backoff="backoff")),p},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.PeerInfo=function(){function a(u){if(u)for(var f=Object.keys(u),h=0;h<f.length;++h)u[f[h]]!=null&&(this[f[h]]=u[f[h]])}a.prototype.peerID=null,a.prototype.signedPeerRecord=null;var c;return Object.defineProperty(a.prototype,"_peerID",{get:n.oneOfGetter(c=["peerID"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_signedPeerRecord",{get:n.oneOfGetter(c=["signedPeerRecord"]),set:n.oneOfSetter(c)}),a.encode=function(f,h){return h||(h=t.create()),f.peerID!=null&&Object.hasOwnProperty.call(f,"peerID")&&h.uint32(10).bytes(f.peerID),f.signedPeerRecord!=null&&Object.hasOwnProperty.call(f,"signedPeerRecord")&&h.uint32(18).bytes(f.signedPeerRecord),h},a.decode=function(f,h){f instanceof e||(f=e.create(f));for(var p=h===void 0?f.len:f.pos+h,d=new i.RPC.PeerInfo;f.pos<p;){var m=f.uint32();switch(m>>>3){case 1:d.peerID=f.bytes();break;case 2:d.signedPeerRecord=f.bytes();break;default:f.skipType(m&7);break}}return d},a.fromObject=function(f){if(f instanceof i.RPC.PeerInfo)return f;var h=new i.RPC.PeerInfo;return f.peerID!=null&&(typeof f.peerID=="string"?n.base64.decode(f.peerID,h.peerID=n.newBuffer(n.base64.length(f.peerID)),0):f.peerID.length&&(h.peerID=f.peerID)),f.signedPeerRecord!=null&&(typeof f.signedPeerRecord=="string"?n.base64.decode(f.signedPeerRecord,h.signedPeerRecord=n.newBuffer(n.base64.length(f.signedPeerRecord)),0):f.signedPeerRecord.length&&(h.signedPeerRecord=f.signedPeerRecord)),h},a.toObject=function(f,h){h||(h={});var p={};return f.peerID!=null&&f.hasOwnProperty("peerID")&&(p.peerID=h.bytes===String?n.base64.encode(f.peerID,0,f.peerID.length):h.bytes===Array?Array.prototype.slice.call(f.peerID):f.peerID,h.oneofs&&(p._peerID="peerID")),f.signedPeerRecord!=null&&f.hasOwnProperty("signedPeerRecord")&&(p.signedPeerRecord=h.bytes===String?n.base64.encode(f.signedPeerRecord,0,f.signedPeerRecord.length):h.bytes===Array?Array.prototype.slice.call(f.signedPeerRecord):f.signedPeerRecord,h.oneofs&&(p._signedPeerRecord="signedPeerRecord")),p},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s}(),i})});var JQ=P((Myt,ZQ)=>{"use strict";l();function Gr(r,t){var t=t||{};this._head=0,this._tail=0,this._capacity=t.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(r)&&this._fromArray(r)}Gr.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}};Gr.prototype.get=function(e){return this.peekAt(e)};Gr.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};Gr.prototype.peekFront=function(){return this.peek()};Gr.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(Gr.prototype,"length",{get:function(){return this.size()}});Gr.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Gr.prototype.unshift=function(e){if(e===void 0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Gr.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}};Gr.prototype.push=function(e){if(e===void 0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Gr.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}};Gr.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var s=this._list[t],o;if(e<n/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+i&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[t]=this._list[t=t+1+i&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s}}};Gr.prototype.remove=function(e,t){var n=e,i,s=t;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||t<1)){if(n<0&&(n+=o),t===1||!t)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+t>=o)return i=this.toArray(),this.clear(),i;n+t>o&&(t=o-n);var c;for(i=new Array(t),c=0;c<t;c++)i[c]=this._list[this._head+n+c&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,c=t;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+t+a&this._capacityMask,c=t-1;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(n<o/2){for(this._head=this._head+e+t+a&this._capacityMask,c=e;c>0;c--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;s>0;)this._list[n=n-1+a&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+a&this._capacityMask,c=o-(t+e);c>0;c--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+a&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),i}}};Gr.prototype.splice=function(e,t){var n=e;if(n===(n|0)){var i=this.size();if(n<0&&(n+=i),!(n>i))if(arguments.length>2){var s,o,a,c=arguments.length,u=this._list.length,f=2;if(!i||n<i/2){for(o=new Array(n),s=0;s<n;s++)o[s]=this._list[this._head+s&this._capacityMask];for(t===0?(a=[],n>0&&(this._head=this._head+n+u&this._capacityMask)):(a=this.remove(n,t),this._head=this._head+n+u&this._capacityMask);c>f;)this.unshift(arguments[--c]);for(s=n;s>0;s--)this.unshift(o[s-1])}else{o=new Array(i-(n+t));var h=o.length;for(s=0;s<h;s++)o[s]=this._list[this._head+n+t+s&this._capacityMask];for(t===0?(a=[],n!=i&&(this._tail=this._head+n+u&this._capacityMask)):(a=this.remove(n,t),this._tail=this._tail-h+u&this._capacityMask);f<c;)this.push(arguments[f++]);for(s=0;s<h;s++)this.push(o[s])}return a}else return this.remove(n,t)}};Gr.prototype.clear=function(){this._head=0,this._tail=0};Gr.prototype.isEmpty=function(){return this._head===this._tail};Gr.prototype.toArray=function(){return this._copyArray(!1)};Gr.prototype._fromArray=function(e){for(var t=0;t<e.length;t++)this.push(e[t])};Gr.prototype._copyArray=function(e){var t=[],n=this._list,i=n.length,s;if(e||this._head>this._tail){for(s=this._head;s<i;s++)t.push(n[s]);for(s=0;s<this._tail;s++)t.push(n[s])}else for(s=this._head;s<this._tail;s++)t.push(n[s]);return t};Gr.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1};Gr.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};ZQ.exports=Gr});var UZ=P((K7t,BZ)=>{l();BZ.exports=r=>{if(r[Symbol.asyncIterator])return r;if(r.getReader)return async function*(){let e=r.getReader();try{for(;;){let{done:t,value:n}=await e.read();if(t)return;yield n}}finally{e.releaseLock()}}();throw new Error("unknown stream")}});var hR=P(()=>{l()});var dR=P((TRt,Aee)=>{"use strict";l();var j9e=Vp(),W9e=(r,e)=>({path:decodeURIComponent(new URL(r).pathname.split("/").pop()||""),content:Y9e(r,e)});async function*Y9e(r,e){yield*(await new j9e().get(r,e)).iterator()}Aee.exports=W9e});var Z8=P((Tkt,Xee)=>{"use strict";l();function vve(r){let e=new Uint8Array(r),t=0;if(r>0)if(r>65536)for(;t<r;)t+65536>r?(crypto.getRandomValues(e.subarray(t,t+(r-t))),t+=r-t):(crypto.getRandomValues(e.subarray(t,t+65536)),t+=65536);else crypto.getRandomValues(e);return e}Xee.exports=vve});var TR=P((kkt,AR)=>{"use strict";l();var xve=(r,e)=>Math.floor(Math.random()*(e-r+1)+r),ete=()=>{let r=new Error("Delay aborted");return r.name="AbortError",r},tte=({clearTimeout:r,setTimeout:e,willResolve:t})=>(n,{value:i,signal:s}={})=>{if(s&&s.aborted)return Promise.reject(ete());let o,a,c,u=r||clearTimeout,f=()=>{u(o),c(ete())},h=()=>{s&&s.removeEventListener("abort",f)},p=new Promise((d,m)=>{a=()=>{h(),t?d(i):m(i)},c=m,o=(e||setTimeout)(a,n)});return s&&s.addEventListener("abort",f,{once:!0}),p.clear=()=>{u(o),o=null,a()},p},rte=r=>{let e=tte({...r,willResolve:!0});return e.reject=tte({...r,willResolve:!1}),e.range=(t,n,i)=>e(xve(t,n),i),e},xR=rte();xR.createWithTimers=rte;AR.exports=xR;AR.exports.default=xR});var BR=P((ANt,Ete)=>{"use strict";l();var R1=new Map,Lve=()=>`${Date.now()}:${Math.floor(Math.random()*1e6)}`;async function Bve(r,e,t){for(;R1.get(t);){try{await r()}catch(n){setTimeout(()=>{throw n},1);break}if(!R1.get(t))break;await new Promise(n=>{let i=setTimeout(n,e);R1.set(t,i)})}}function Uve(r,e,t){t=t||e;let n=Lve(),i=setTimeout(()=>{Bve(r,e,n)},t);return R1.set(n,i),n}function Mve(r){let e=R1.get(r);e&&(clearTimeout(e),R1.delete(r))}Ete.exports={setDelayedInterval:Uve,clearDelayedInterval:Mve}});var Py=P((IDt,Tte)=>{l();Tte.exports=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration=typeof e>"u"?1:e}get msDuration(){return this.duration*1e3}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration=typeof e>"u"?0:e}get msBlockDuration(){return this.blockDuration*1e3}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly=typeof e>"u"?!1:Boolean(e)}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs=typeof e>"u"?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if(typeof e>"u"&&(e="rlflx"),typeof e!="string")throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}}});var Rte=P((PDt,Ite)=>{l();Ite.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){let e=Date.now();Object.keys(this._keys).forEach(t=>{this._keys[t]<=e&&delete this._keys[t]}),this._addedKeysAmount=Object.keys(this._keys).length}add(e,t){this.addMs(e,t*1e3)}addMs(e,t){this._keys[e]=Date.now()+t,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){let t=this._keys[e];if(t&&t>=Date.now()){this.collectExpired();let n=Date.now();return t>=n?t-n:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach(t=>{delete this._keys[t]})}}});var Pte=P((ODt,Cte)=>{l();var Kve=Rte();Cte.exports=Kve});var Ps=P((LDt,kte)=>{l();kte.exports=class{constructor(e,t,n,i){this.remainingPoints=typeof e>"u"?0:e,this.msBeforeNext=typeof t>"u"?0:t,this.consumedPoints=typeof n>"u"?0:n,this.isFirstInDuration=typeof i>"u"?!1:i}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=Boolean(e)}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}});var P1=P((MDt,Nte)=>{l();var MR=Py(),qve=Pte(),Ote=Ps();Nte.exports=class extends MR{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed||e.inmemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration||e.inmemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new qve}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("storeClient is not set");this._client=e}_afterConsume(e,t,n,i,s,o={}){let a=this._getRateLimiterRes(n,i,s);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&a.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(n,a.msBeforeNext),a.consumedPoints>this.points?t(a):e(a);if(a.consumedPoints>this.points){let c=Promise.resolve();this.blockDuration>0&&a.consumedPoints<=this.points+i&&(a.msBeforeNext=this.msBlockDuration,c=this._block(n,a.consumedPoints,this.msBlockDuration,o)),this.inMemoryBlockOnConsumed>0&&a.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(n,this.inMemoryBlockDuration),a.msBeforeNext=this.msInMemoryBlockDuration),c.then(()=>{t(a)}).catch(u=>{t(u)})}else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let c=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));c<this.execEvenlyMinDelayMs&&(c=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,c,a)}else e(a)}_handleError(e,t,n,i,s,o=!1,a={}){this.insuranceLimiter instanceof MR?this.insuranceLimiter[t](s,o,a).then(c=>{n(c)}).catch(c=>{i(c)}):i(e)}get _inmemoryBlockedKeys(){return this._inMemoryBlockedKeys}getInmemoryBlockMsBeforeExpire(e){return this.getInMemoryBlockMsBeforeExpire(e)}get inmemoryBlockOnConsumed(){return this.inMemoryBlockOnConsumed}set inmemoryBlockOnConsumed(e){this.inMemoryBlockOnConsumed=e}get inmemoryBlockDuration(){return this.inMemoryBlockDuration}set inmemoryBlockDuration(e){this.inMemoryBlockDuration=e}get msInmemoryBlockDuration(){return this.inMemoryBlockDuration*1e3}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&this.inMemoryBlockOnConsumed===0)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return this._inMemoryBlockDuration*1e3}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if(typeof e<"u"&&!(e instanceof MR))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,t,n={}){let i=t*1e3;return this._block(this.getKey(e),this.points+1,i,n)}set(e,t,n,i={}){let s=(n>=0?n:this.duration)*1e3;return this._block(this.getKey(e),t,s,i)}consume(e,t=1,n={}){return new Promise((i,s)=>{let o=this.getKey(e),a=this.getInMemoryBlockMsBeforeExpire(o);if(a>0)return s(new Ote(0,a));this._upsert(o,t,this._getKeySecDuration(n)*1e3,!1,n).then(c=>{this._afterConsume(i,s,o,t,c)}).catch(c=>{this._handleError(c,"consume",i,s,e,t,n)})})}penalty(e,t=1,n={}){let i=this.getKey(e);return new Promise((s,o)=>{this._upsert(i,t,this._getKeySecDuration(n)*1e3,!1,n).then(a=>{s(this._getRateLimiterRes(i,t,a))}).catch(a=>{this._handleError(a,"penalty",s,o,e,t,n)})})}reward(e,t=1,n={}){let i=this.getKey(e);return new Promise((s,o)=>{this._upsert(i,-t,this._getKeySecDuration(n)*1e3,!1,n).then(a=>{s(this._getRateLimiterRes(i,-t,a))}).catch(a=>{this._handleError(a,"reward",s,o,e,t,n)})})}get(e,t={}){let n=this.getKey(e);return new Promise((i,s)=>{this._get(n,t).then(o=>{i(o===null||typeof o>"u"?null:this._getRateLimiterRes(n,0,o))}).catch(o=>{this._handleError(o,"get",i,s,e,t)})})}delete(e,t={}){let n=this.getKey(e);return new Promise((i,s)=>{this._delete(n,t).then(o=>{this._inMemoryBlockedKeys.delete(n),i(o)}).catch(o=>{this._handleError(o,"delete",i,s,e,t)})})}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,t,n){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,t,n,i={}){return new Promise((s,o)=>{this._upsert(e,t,n,!0,i).then(()=>{s(new Ote(0,n>0?n:-1,t))}).catch(a=>{this._handleError(a,"block",s,o,this.parseKey(e),n/1e3,i)})})}_get(e,t={}){throw new Error("You have to implement the method '_get'!")}_delete(e,t={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,t,n,i=!1,s={}){throw new Error("You have to implement the method '_upsert'!")}}});var Bte=P((VDt,Lte)=>{l();var $ve=P1(),Hve=Ps(),Dte="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ",FR=class extends $ve{constructor(e){super(e),e.redis?this.client=e.redis:this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,typeof this.client.defineCommand=="function"&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:Dte})}_isRedisReady(){return this._rejectIfRedisNotReady?!(this.client.status&&this.client.status!=="ready"||typeof this.client.isReady=="function"&&!this.client.isReady()):!0}_getRateLimiterRes(e,t,n){let[i,s]=n;Array.isArray(i)&&([,i]=i,[,s]=s);let o=new Hve;return o.consumedPoints=parseInt(i),o.isFirstInDuration=o.consumedPoints===t,o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.msBeforeNext=s,o}_upsert(e,t,n,i=!1){return new Promise((s,o)=>{if(!this._isRedisReady())return o(new Error("Redis connection is not ready"));let a=Math.floor(n/1e3),c=this.client.multi();if(i)a>0?c.set(e,t,"EX",a):c.set(e,t),c.pttl(e).exec((u,f)=>u?o(u):s(f));else if(a>0){let u=function(f,h){return f?o(f):s(h)};typeof this.client.rlflxIncr=="function"?this.client.rlflxIncr(e,t,a,u):this.client.eval(Dte,1,e,t,a,u)}else c.incrby(e,t).pttl(e).exec((u,f)=>u?o(u):s(f))})}_get(e){return new Promise((t,n)=>{if(!this._isRedisReady())return n(new Error("Redis connection is not ready"));this.client.multi().get(e).pttl(e).exec((i,s)=>{if(i)n(i);else{let[o]=s;if(o===null)return t(null);t(s)}})})}_delete(e){return new Promise((t,n)=>{this.client.del(e,(i,s)=>{i?n(i):t(s>0)})})}};Lte.exports=FR});var Fte=P((KDt,Mte)=>{l();var Gve=P1(),jve=Ps();function Ute(r){try{let e=r.client?r.client:r,{version:t}=e.topology.s.options.metadata.driver,n=t.split(".").map(i=>parseInt(i));return{major:n[0],feature:n[1],patch:n[2]}}catch{return{major:0,feature:0,patch:0}}}var ky=class extends Gve{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,typeof this.client.then=="function"?this.client.then(t=>{this.client=t,this._initCollection(),this._driverVersion=Ute(this.client)}):(this._initCollection(),this._driverVersion=Ute(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?ky.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){let t=(typeof this.client.db=="function"?this.client.db(this.dbName):this.client).collection(this.tableName);t.createIndex({expire:-1},{expireAfterSeconds:0}),t.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=t}_getRateLimiterRes(e,t,n){let i=new jve,s;return typeof n.value>"u"?s=n:s=n.value,i.isFirstInDuration=s.points===t,i.consumedPoints=s.points,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=s.expire!==null?Math.max(new Date(s.expire).getTime()-Date.now(),0):-1,i}_upsert(e,t,n,i=!1,s={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let o=s.attrs||{},a,c;i?(a={key:e},a=Object.assign(a,o),c={$set:{key:e,points:t,expire:n>0?new Date(Date.now()+n):null}},c.$set=Object.assign(c.$set,o)):(a={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},a=Object.assign(a,o),c={$setOnInsert:{key:e,expire:n>0?new Date(Date.now()+n):null},$inc:{points:t}},c.$setOnInsert=Object.assign(c.$setOnInsert,o));let u={upsert:!0};return this._driverVersion.major>=4||this._driverVersion.major===3&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?u.returnDocument="after":u.returnOriginal=!1,new Promise((f,h)=>{this._collection.findOneAndUpdate(a,c,u).then(p=>{f(p)}).catch(p=>{if(p&&p.code===11e3){let d=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},o),m={$set:Object.assign({key:e,points:t,expire:n>0?new Date(Date.now()+n):null},o)};this._collection.findOneAndUpdate(d,m,u).then(g=>{f(g)}).catch(g=>{g&&g.code===11e3?this._upsert(e,t,n,i).then(y=>f(y)).catch(y=>h(y)):h(g)})}else h(p)})})}_get(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let n=t.attrs||{},i=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},n);return this._collection.findOne(i)}_delete(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let n=t.attrs||{},i=Object.assign({key:e},n);return this._collection.deleteOne(i).then(s=>s.deletedCount>0)}};Mte.exports=ky});var zte=P(($Dt,Vte)=>{l();var Wve=P1(),Yve=Ps(),VR=class extends Wve{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()):this._createDbAndTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()}).catch(n=>{if(typeof t=="function")t(n);else throw n})}clearExpired(e){return new Promise(t=>{this._getConnection().then(n=>{n.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],()=>{this._releaseConnection(n),t()})}).catch(()=>{t()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise((e,t)=>{this.client.getConnection((n,i)=>{if(n)return t(n);e(i)})});case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise((e,t)=>{this._getConnection().then(n=>{n.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,i=>{if(i)return this._releaseConnection(n),t(i);n.query(this._getCreateTableStmt(),s=>{if(s)return this._releaseConnection(n),t(s);this._releaseConnection(n),e()})})}).catch(n=>{t(n)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if(typeof e>"u")if(this.client.constructor.name==="Connection")e="connection";else if(this.client.constructor.name==="Pool")e="pool";else if(this.client.constructor.name==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:Boolean(e)}_getRateLimiterRes(e,t,n){let i=new Yve,[s]=n;return i.isFirstInDuration=t===s.points,i.consumedPoints=i.isFirstInDuration?t:s.points,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,i}_upsertTransaction(e,t,n,i,s){return new Promise((o,a)=>{e.query("BEGIN",c=>{if(c)return e.rollback(),a(c);let u=Date.now(),f=i>0?u+i:null,h,p;s?(h=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = ?, 
            expire = ?;`,p=[this.dbName,this.tableName,t,n,f,n,f]):(h=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = IF(expire <= ?, ?, points + (?)), 
            expire = IF(expire <= ?, ?, expire);`,p=[this.dbName,this.tableName,t,n,f,u,n,n,u,f]),e.query(h,p,d=>{if(d)return e.rollback(),a(d);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,t],(m,g)=>{if(m)return e.rollback(),a(m);e.query("COMMIT",y=>{if(y)return e.rollback(),a(y);o(g)})})})})})}_upsert(e,t,n,i=!1){return this.tableCreated?new Promise((s,o)=>{this._getConnection().then(a=>{this._upsertTransaction(a,e,t,n,i).then(c=>{s(c),this._releaseConnection(a)}).catch(c=>{o(c),this._releaseConnection(a)})}).catch(a=>{o(a)})}):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise((t,n)=>{this._getConnection().then(i=>{i.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],(s,o)=>{s?n(s):o.length===0?t(null):t(o),this._releaseConnection(i)})}).catch(i=>{n(i)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise((t,n)=>{this._getConnection().then(i=>{i.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],(s,o)=>{s?n(s):t(o.affectedRows>0),this._releaseConnection(i)})}).catch(i=>{n(i)})}):Promise.reject(Error("Table is not created yet"))}};Vte.exports=VR});var qte=P((GDt,Kte)=>{l();var Qve=P1(),Xve=Ps(),zR=class extends Qve{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?typeof t=="function"&&t():this._createTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()}).catch(n=>{if(typeof t=="function")t(n);else throw n})}clearExpired(e){return new Promise(t=>{let n={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[e]};this._query(n).then(()=>{t()}).catch(()=>{t()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master);default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);case"typeorm":return!0;default:return!0}}_createTable(){return new Promise((e,t)=>{this._query({text:this._getCreateTableStmt()}).then(()=>{e()}).catch(n=>{n.code==="23505"?e():t(n)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( 
      key varchar(255) PRIMARY KEY,
      points integer NOT NULL DEFAULT 0,
      expire bigint
    );`}get clientType(){return this._clientType}set clientType(e){let t=this.client.constructor.name;if(typeof e>"u")if(t==="Client")e="client";else if(t==="Pool"||t==="BoundPool")e="pool";else if(t==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:Boolean(e)}_getRateLimiterRes(e,t,n){let i=new Xve,s=n.rows[0];return i.isFirstInDuration=t===s.points,i.consumedPoints=i.isFirstInDuration?t:s.points,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,i}_query(e){let n={name:`${this.tableName.toLowerCase()}:${e.name}`,text:e.text,values:e.values};return new Promise((i,s)=>{this._getConnection().then(o=>{o.query(n).then(a=>{i(a),this._releaseConnection(o)}).catch(a=>{s(a),this._releaseConnection(o)})}).catch(o=>{s(o)})})}_upsert(e,t,n,i=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));let s=n>0?Date.now()+n:null,o=i?" $3 ":` CASE
             WHEN ${this.tableName}.expire <= $4 THEN $3
             ELSE ${this.tableName}.expire
            END `;return this._query({name:i?"rlflx-upsert-force":"rlflx-upsert",text:`
            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)
              ON CONFLICT(key) DO UPDATE SET
                points = CASE
                          WHEN (${this.tableName}.expire <= $4 OR 1=${i?1:0}) THEN $2
                          ELSE ${this.tableName}.points + ($2)
                         END,
                expire = ${o}
            RETURNING points, expire;`,values:[e,t,s,Date.now()]})}_get(e){return this.tableCreated?new Promise((t,n)=>{this._query({name:"rlflx-get",text:`
            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then(i=>{i.rowCount===0&&(i=null),t(i)}).catch(i=>{n(i)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[e]}).then(t=>t.rowCount>0):Promise.reject(Error("Table is not created yet"))}};Kte.exports=zR});var $te=P(()=>{l()});var Gte=P((ZDt,Hte)=>{l();Hte.exports=class{constructor(e,t,n=null){this.value=e,this.expiresAt=t,this.timeoutId=n}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){!(e instanceof Date)&&Number.isInteger(e)&&(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}}});var Wte=P((tLt,jte)=>{l();var Zve=Gte(),KR=Ps();jte.exports=class{constructor(){this._storage={}}incrby(e,t,n){if(this._storage[e]){let i=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return i!==0?(this._storage[e].value=this._storage[e].value+t,new KR(0,i,this._storage[e].value,!1)):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){let i=n*1e3;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new Zve(t,i>0?new Date(Date.now()+i):null),i>0&&(this._storage[e].timeoutId=setTimeout(()=>{delete this._storage[e]},i),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new KR(0,i===0?-1:i,this._storage[e].value,!0)}get(e){if(this._storage[e]){let t=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return new KR(0,t,this._storage[e].value,!1)}return null}delete(e){return this._storage[e]?(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0):!1}}});var $R=P((nLt,Qte)=>{l();var Jve=Py(),eSe=Wte(),Yte=Ps(),qR=class extends Jve{constructor(e={}){super(e),this._memoryStorage=new eSe}consume(e,t=1,n={}){return new Promise((i,s)=>{let o=this.getKey(e),a=this._getKeySecDuration(n),c=this._memoryStorage.incrby(o,t,a);if(c.remainingPoints=Math.max(this.points-c.consumedPoints,0),c.consumedPoints>this.points)this.blockDuration>0&&c.consumedPoints<=this.points+t&&(c=this._memoryStorage.set(o,c.consumedPoints,this.blockDuration)),s(c);else if(this.execEvenly&&c.msBeforeNext>0&&!c.isFirstInDuration){let u=Math.ceil(c.msBeforeNext/(c.remainingPoints+2));u<this.execEvenlyMinDelayMs&&(u=c.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(i,u,c)}else i(c)})}penalty(e,t=1,n={}){let i=this.getKey(e);return new Promise(s=>{let o=this._getKeySecDuration(n),a=this._memoryStorage.incrby(i,t,o);a.remainingPoints=Math.max(this.points-a.consumedPoints,0),s(a)})}reward(e,t=1,n={}){let i=this.getKey(e);return new Promise(s=>{let o=this._getKeySecDuration(n),a=this._memoryStorage.incrby(i,-t,o);a.remainingPoints=Math.max(this.points-a.consumedPoints,0),s(a)})}block(e,t){let n=t*1e3,i=this.points+1;return this._memoryStorage.set(this.getKey(e),i,t),Promise.resolve(new Yte(0,n===0?-1:n,i))}set(e,t,n){let i=(n>=0?n:this.duration)*1e3;return this._memoryStorage.set(this.getKey(e),t,n),Promise.resolve(new Yte(0,i===0?-1:i,t))}get(e){let t=this._memoryStorage.get(this.getKey(e));return t!==null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),Promise.resolve(t)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}};Qte.exports=qR});var nre=P((sLt,rre)=>{l();var Xte=$te(),tSe=Eu(),rSe=Py(),Jte=$R(),nSe=Ps(),uo="rate_limiter_flexible",N1=null,Zte=function(r,e,t,n){let i;n===null||n===!0||n===!1?i=n:i={remainingPoints:n.remainingPoints,msBeforeNext:n.msBeforeNext,consumedPoints:n.consumedPoints,isFirstInDuration:n.isFirstInDuration},r.send({channel:uo,keyPrefix:e.keyPrefix,promiseId:e.promiseId,type:t,data:i})},ere=function(r){setTimeout(()=>{this._initiated?process.send(r):typeof this._promises[r.promiseId]<"u"&&ere.call(this,r)},30)},k1=function(r,e,t,n,i){let s={channel:uo,keyPrefix:this.keyPrefix,func:r,promiseId:e,data:{key:t,arg:n,opts:i}};this._initiated?process.send(s):ere.call(this,s)},tre=function(r,e){if(!e||e.channel!==uo||typeof this._rateLimiters[e.keyPrefix]>"u")return!1;let t;switch(e.func){case"consume":t=this._rateLimiters[e.keyPrefix].consume(e.data.key,e.data.arg,e.data.opts);break;case"penalty":t=this._rateLimiters[e.keyPrefix].penalty(e.data.key,e.data.arg,e.data.opts);break;case"reward":t=this._rateLimiters[e.keyPrefix].reward(e.data.key,e.data.arg,e.data.opts);break;case"block":t=this._rateLimiters[e.keyPrefix].block(e.data.key,e.data.arg,e.data.opts);break;case"get":t=this._rateLimiters[e.keyPrefix].get(e.data.key,e.data.opts);break;case"delete":t=this._rateLimiters[e.keyPrefix].delete(e.data.key,e.data.opts);break;default:return!1}t&&t.then(n=>{Zte(r,e,"resolve",n)}).catch(n=>{Zte(r,e,"reject",n)})},iSe=function(r){if(!r||r.channel!==uo||r.keyPrefix!==this.keyPrefix)return!1;if(this._promises[r.promiseId]){clearTimeout(this._promises[r.promiseId].timeoutId);let e;switch(r.data===null||r.data===!0||r.data===!1?e=r.data:e=new nSe(r.data.remainingPoints,r.data.msBeforeNext,r.data.consumedPoints,r.data.isFirstInDuration),r.type){case"resolve":this._promises[r.promiseId].resolve(e);break;case"reject":this._promises[r.promiseId].reject(e);break;default:throw new Error(`RateLimiterCluster: no such message type '${r.type}'`)}delete this._promises[r.promiseId]}},sSe=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},O1=function(r,e){let t=process.hrtime(),n=t[0].toString()+t[1].toString();return typeof this._promises[n]<"u"&&(n+=tSe.randomBytes(12).toString("base64")),this._promises[n]={resolve:r,reject:e,timeoutId:setTimeout(()=>{delete this._promises[n],e(new Error("RateLimiterCluster timeout: no answer from master in time"))},this.timeoutMs)},n},HR=class{constructor(){if(N1)return N1;this._rateLimiters={},Xte.setMaxListeners(0),Xte.on("message",(e,t)=>{t&&t.channel===uo&&t.type==="init"?(typeof this._rateLimiters[t.opts.keyPrefix]>"u"&&(this._rateLimiters[t.opts.keyPrefix]=new Jte(t.opts)),e.send({channel:uo,type:"init",keyPrefix:t.opts.keyPrefix})):tre.call(this,e,t)}),N1=this}},GR=class{constructor(e){if(N1)return N1;this._rateLimiters={},e.launchBus((t,n)=>{n.on("process:msg",i=>{let s=i.raw;if(s&&s.channel===uo&&s.type==="init")typeof this._rateLimiters[s.opts.keyPrefix]>"u"&&(this._rateLimiters[s.opts.keyPrefix]=new Jte(s.opts)),e.sendDataToProcessId(i.process.pm_id,{data:{},topic:uo,channel:uo,type:"init",keyPrefix:s.opts.keyPrefix},(o,a)=>{o&&console.log(o,a)});else{let o={send:a=>{let c=a;c.topic=uo,typeof c.data>"u"&&(c.data={}),e.sendDataToProcessId(i.process.pm_id,c,(u,f)=>{u&&console.log(u,f)})}};tre.call(this,o,s)}})}),N1=this}},jR=class extends rSe{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs=typeof e>"u"?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),process.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,process.on("message",t=>{t&&t.channel===uo&&t.type==="init"&&t.keyPrefix===this.keyPrefix?this._initiated=!0:iSe.call(this,t)}),process.send({channel:uo,type:"init",opts:sSe.call(this)}),this._promises={}}consume(e,t=1,n={}){return new Promise((i,s)=>{let o=O1.call(this,i,s);k1.call(this,"consume",o,e,t,n)})}penalty(e,t=1,n={}){return new Promise((i,s)=>{let o=O1.call(this,i,s);k1.call(this,"penalty",o,e,t,n)})}reward(e,t=1,n={}){return new Promise((i,s)=>{let o=O1.call(this,i,s);k1.call(this,"reward",o,e,t,n)})}block(e,t,n={}){return new Promise((i,s)=>{let o=O1.call(this,i,s);k1.call(this,"block",o,e,t,n)})}get(e,t={}){return new Promise((n,i)=>{let s=O1.call(this,n,i);k1.call(this,"get",s,e,t)})}delete(e,t={}){return new Promise((n,i)=>{let s=O1.call(this,n,i);k1.call(this,"delete",s,e,t)})}};rre.exports={RateLimiterClusterMaster:HR,RateLimiterClusterMasterPM2:GR,RateLimiterCluster:jR}});var sre=P((aLt,ire)=>{l();var oSe=P1(),aSe=Ps(),WR=class extends oSe{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,t,n){let i=new aSe;return i.consumedPoints=parseInt(n.consumedPoints),i.isFirstInDuration=n.consumedPoints===t,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=n.msBeforeNext,i}_upsert(e,t,n,i=!1,s={}){return new Promise((o,a)=>{let c=Date.now(),u=Math.floor(n/1e3);i?this.client.set(e,t,u,f=>{f?a(f):this.client.set(`${e}_expire`,u>0?c+u*1e3:-1,u,()=>{let h={consumedPoints:t,msBeforeNext:u>0?u*1e3:-1};o(h)})}):this.client.incr(e,t,(f,h)=>{f||h===!1?this.client.add(e,t,u,(p,d)=>{if(p||!d)if(typeof s.attemptNumber>"u"||s.attemptNumber<3){let m=Object.assign({},s);m.attemptNumber=m.attemptNumber?m.attemptNumber+1:1,this._upsert(e,t,n,i,m).then(g=>o(g)).catch(g=>a(g))}else a(new Error("Can not add key"));else this.client.add(`${e}_expire`,u>0?c+u*1e3:-1,u,()=>{let m={consumedPoints:t,msBeforeNext:u>0?u*1e3:-1};o(m)})}):this.client.get(`${e}_expire`,(p,d)=>{if(p)a(p);else{let m=d===!1?0:d,g={consumedPoints:h,msBeforeNext:m>=0?Math.max(m-c,0):-1};o(g)}})})})}_get(e){return new Promise((t,n)=>{let i=Date.now();this.client.get(e,(s,o)=>{o?this.client.get(`${e}_expire`,(a,c)=>{if(a)n(a);else{let u=c===!1?0:c,f={consumedPoints:o,msBeforeNext:u>=0?Math.max(u-i,0):-1};t(f)}}):t(null)})})}_delete(e){return new Promise((t,n)=>{this.client.del(e,(i,s)=>{i?n(i):s===!1?t(s):this.client.del(`${e}_expire`,o=>{o?n(o):t(s)})})})}};ire.exports=WR});var cre=P((uLt,are)=>{l();var ore=Ps();are.exports=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if(typeof e>"u")throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway=typeof e>"u"?!1:e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new ore(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new ore(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,t=1){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.rejectBlack()),typeof n>"u"?this.limiter.consume(e,t):(this.runActionAnyway&&this.limiter.consume(e,t).catch(()=>{}),n)}block(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.block(e,t):(this.runActionAnyway&&this.limiter.block(e,t).catch(()=>{}),n)}penalty(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.penalty(e,t):(this.runActionAnyway&&this.limiter.penalty(e,t).catch(()=>{}),n)}reward(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.reward(e,t):(this.runActionAnyway&&this.limiter.reward(e,t).catch(()=>{}),n)}get(e){let t;return this.isWhiteListedSomewhere(e)?t=this.resolveWhite():this.isBlackListedSomewhere(e)&&(t=this.resolveBlack()),typeof t>"u"||this.runActionAnyway?this.limiter.get(e):t}delete(e){return this.limiter.delete(e)}}});var ure=P((dLt,lre)=>{l();var cSe=Py();lre.exports=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach(t=>{if(!(t instanceof cSe))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")}),this._limiters=e}consume(e,t=1){return new Promise((n,i)=>{let s=[];this._limiters.forEach(o=>{s.push(o.consume(e,t).catch(a=>({rejected:!0,rej:a})))}),Promise.all(s).then(o=>{let a={},c=!1;o.forEach(u=>{u.rejected===!0&&(c=!0)});for(let u=0;u<o.length;u++)c&&o[u].rejected===!0?a[this._limiters[u].keyPrefix]=o[u].rej:c||(a[this._limiters[u].keyPrefix]=o[u]);c?i(a):n(a)})})}}});var hre=P((gLt,fre)=>{l();fre.exports=class extends Error{constructor(e,t){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,t&&(this.extra=t)}}});var gre=P((bLt,mre)=>{l();var dre=hre(),pre=4294967295,YR="limiter";mre.exports=class{constructor(e,t={maxQueueSize:pre}){this._queueLimiters={KEY_DEFAULT:new pb(e,t)},this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(e=YR){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,t=YR){return this._queueLimiters[t]||(this._queueLimiters[t]=new pb(this._limiterFlexible,{key:t,maxQueueSize:this._maxQueueSize})),this._queueLimiters[t].removeTokens(e)}};var pb=class{constructor(e,t={maxQueueSize:pre,key:YR}){this._key=t.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then(e=>e!==null?e.remainingPoints:this._limiterFlexible.points)}removeTokens(e){let t=this;return new Promise((n,i)=>{if(e>t._limiterFlexible.points){i(new dre(`Requested tokens ${e} exceeds maximum ${t._limiterFlexible.points} tokens per interval`));return}t._queue.length>0?t._queueRequest.call(t,n,i,e):t._limiterFlexible.consume(t._key,e).then(s=>{n(s.remainingPoints)}).catch(s=>{s instanceof Error?i(s):(t._queueRequest.call(t,n,i,e),t._waitTimeout===null&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),s.msBeforeNext)))})})}_queueRequest(e,t,n){let i=this;i._queue.length<i._maxQueueSize?i._queue.push({resolve:e,reject:t,tokens:n}):t(new dre(`Number of requests reached it's maximum ${i._maxQueueSize}`))}_processFIFO(){let e=this;if(e._waitTimeout!==null&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),e._queue.length===0)return;let t=e._queue.shift();e._limiterFlexible.consume(e._key,t.tokens).then(n=>{t.resolve(n.remainingPoints),e._processFIFO.call(e)}).catch(n=>{n instanceof Error?(t.reject(n),e._processFIFO.call(e)):(e._queue.unshift(t),e._waitTimeout===null&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),n.msBeforeNext)))})}}});var wre=P((vLt,yre)=>{l();var QR=Ps();yre.exports=class{constructor(e,t){this._rateLimiter=e,this._burstLimiter=t}_combineRes(e,t){return new QR(e.remainingPoints,Math.min(e.msBeforeNext,t.msBeforeNext),e.consumedPoints,e.isFirstInDuration)}consume(e,t=1,n={}){return this._rateLimiter.consume(e,t,n).catch(i=>i instanceof QR?this._burstLimiter.consume(e,t,n).then(s=>Promise.resolve(this._combineRes(i,s))).catch(s=>s instanceof QR?Promise.reject(this._combineRes(i,s)):Promise.reject(s)):Promise.reject(i))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then(([t,n])=>this._combineRes(t,n))}get points(){return this._rateLimiter.points}}});var XR=P((xLt,bre)=>{l();var lSe=Bte(),uSe=Fte(),fSe=zte(),hSe=qte(),{RateLimiterClusterMaster:dSe,RateLimiterClusterMasterPM2:pSe,RateLimiterCluster:mSe}=nre(),gSe=$R(),ySe=sre(),wSe=cre(),bSe=ure(),ESe=gre(),_Se=wre(),vSe=Ps();bre.exports={RateLimiterRedis:lSe,RateLimiterMongo:uSe,RateLimiterMySQL:fSe,RateLimiterPostgres:hSe,RateLimiterMemory:gSe,RateLimiterMemcache:ySe,RateLimiterClusterMaster:dSe,RateLimiterClusterMasterPM2:pSe,RateLimiterCluster:mSe,RLWrapperBlackAndWhite:wSe,RateLimiterUnion:bSe,RateLimiterQueue:ESe,BurstyRateLimiter:_Se,RateLimiterRes:vSe}});var Sre=P((ZLt,vre)=>{"use strict";l();vre.exports=Hn;var Oy=Bd();function Hn(r,e){this.lo=r>>>0,this.hi=e>>>0}var Ld=Hn.zero=new Hn(0,0);Ld.toNumber=function(){return 0};Ld.zzEncode=Ld.zzDecode=function(){return this};Ld.length=function(){return 1};var TSe=Hn.zeroHash="\0\0\0\0\0\0\0\0";Hn.fromNumber=function(e){if(e===0)return Ld;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Hn(n,i)};Hn.from=function(e){if(typeof e=="number")return Hn.fromNumber(e);if(Oy.isString(e))if(Oy.Long)e=Oy.Long.fromString(e);else return Hn.fromNumber(parseInt(e,10));return e.low||e.high?new Hn(e.low>>>0,e.high>>>0):Ld};Hn.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};Hn.prototype.toLong=function(e){return Oy.Long?new Oy.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var Pf=String.prototype.charCodeAt;Hn.fromHash=function(e){return e===TSe?Ld:new Hn((Pf.call(e,0)|Pf.call(e,1)<<8|Pf.call(e,2)<<16|Pf.call(e,3)<<24)>>>0,(Pf.call(e,4)|Pf.call(e,5)<<8|Pf.call(e,6)<<16|Pf.call(e,7)<<24)>>>0)};Hn.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Hn.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Hn.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Hn.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var Bd=P(eC=>{"use strict";l();var Ce=eC;Ce.asPromise=Xl();Ce.base64=Zl();Ce.EventEmitter=Jl();Ce.float=eu();Ce.inquire=tu();Ce.utf8=ru();Ce.pool=nu();Ce.LongBits=Sre();Ce.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);Ce.global=Ce.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||eC;Ce.emptyArray=Object.freeze?Object.freeze([]):[];Ce.emptyObject=Object.freeze?Object.freeze({}):{};Ce.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Ce.isString=function(e){return typeof e=="string"||e instanceof String};Ce.isObject=function(e){return e&&typeof e=="object"};Ce.isset=Ce.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};Ce.Buffer=function(){try{var r=Ce.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();Ce._Buffer_from=null;Ce._Buffer_allocUnsafe=null;Ce.newBuffer=function(e){return typeof e=="number"?Ce.Buffer?Ce._Buffer_allocUnsafe(e):new Ce.Array(e):Ce.Buffer?Ce._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Ce.Array=typeof Uint8Array<"u"?Uint8Array:Array;Ce.Long=Ce.global.dcodeIO&&Ce.global.dcodeIO.Long||Ce.global.Long||Ce.inquire("long");Ce.key2Re=/^true|false|0|1$/;Ce.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Ce.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Ce.longToHash=function(e){return e?Ce.LongBits.from(e).toHash():Ce.LongBits.zeroHash};Ce.longFromHash=function(e,t){var n=Ce.LongBits.fromHash(e);return Ce.Long?Ce.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function xre(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}Ce.merge=xre;Ce.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Are(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&xre(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Ce.newError=Are;Ce.ProtocolError=Are("ProtocolError");Ce.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Ce.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};Ce.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Ce._configure=function(){var r=Ce.Buffer;if(!r){Ce._Buffer_from=Ce._Buffer_allocUnsafe=null;return}Ce._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},Ce._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var nC=P((rBt,Pre)=>{"use strict";l();Pre.exports=an;var oc=Bd(),rC,Rre=oc.LongBits,ISe=oc.utf8;function Jo(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function an(r){this.buf=r,this.pos=0,this.len=r.length}var Tre=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new an(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new an(e);throw Error("illegal buffer")},Cre=function(){return oc.Buffer?function(t){return(an.create=function(i){return oc.Buffer.isBuffer(i)?new rC(i):Tre(i)})(t)}:Tre};an.create=Cre();an.prototype._slice=oc.Array.prototype.subarray||oc.Array.prototype.slice;an.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Jo(this,10);return e}}();an.prototype.int32=function(){return this.uint32()|0};an.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function tC(){var r=new Rre(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Jo(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw Jo(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}an.prototype.bool=function(){return this.uint32()!==0};function Eb(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}an.prototype.fixed32=function(){if(this.pos+4>this.len)throw Jo(this,4);return Eb(this.buf,this.pos+=4)};an.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Jo(this,4);return Eb(this.buf,this.pos+=4)|0};function Ire(){if(this.pos+8>this.len)throw Jo(this,8);return new Rre(Eb(this.buf,this.pos+=4),Eb(this.buf,this.pos+=4))}an.prototype.float=function(){if(this.pos+4>this.len)throw Jo(this,4);var e=oc.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};an.prototype.double=function(){if(this.pos+8>this.len)throw Jo(this,4);var e=oc.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};an.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Jo(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};an.prototype.string=function(){var e=this.bytes();return ISe.read(e,0,e.length)};an.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Jo(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Jo(this);while(this.buf[this.pos++]&128);return this};an.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};an._configure=function(r){rC=r,an.create=Cre(),rC._configure();var e=oc.Long?"toLong":"toNumber";oc.merge(an.prototype,{int64:function(){return tC.call(this)[e](!1)},uint64:function(){return tC.call(this)[e](!0)},sint64:function(){return tC.call(this).zzDecode()[e](!1)},fixed64:function(){return Ire.call(this)[e](!0)},sfixed64:function(){return Ire.call(this)[e](!1)}})}});var Dre=P((iBt,Nre)=>{"use strict";l();Nre.exports=Ud;var Ore=nC();(Ud.prototype=Object.create(Ore.prototype)).constructor=Ud;var kre=Bd();function Ud(r){Ore.call(this,r)}Ud._configure=function(){kre.Buffer&&(Ud.prototype._slice=kre.Buffer.prototype.slice)};Ud.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Ud._configure()});var uC=P((oBt,Mre)=>{"use strict";l();Mre.exports=Ot;var fo=Bd(),iC,_b=fo.LongBits,Lre=fo.base64,Bre=fo.utf8;function Ny(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function oC(){}function RSe(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function Ot(){this.len=0,this.head=new Ny(oC,0,0),this.tail=this.head,this.states=null}var Ure=function(){return fo.Buffer?function(){return(Ot.create=function(){return new iC})()}:function(){return new Ot}};Ot.create=Ure();Ot.alloc=function(e){return new fo.Array(e)};fo.Array!==Array&&(Ot.alloc=fo.pool(Ot.alloc,fo.Array.prototype.subarray));Ot.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Ny(e,t,n),this.len+=t,this};function aC(r,e,t){e[t]=r&255}function CSe(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function cC(r,e){this.len=r,this.next=void 0,this.val=e}cC.prototype=Object.create(Ny.prototype);cC.prototype.fn=CSe;Ot.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new cC((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Ot.prototype.int32=function(e){return e<0?this._push(lC,10,_b.fromNumber(e)):this.uint32(e)};Ot.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function lC(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}Ot.prototype.uint64=function(e){var t=_b.from(e);return this._push(lC,t.length(),t)};Ot.prototype.int64=Ot.prototype.uint64;Ot.prototype.sint64=function(e){var t=_b.from(e).zzEncode();return this._push(lC,t.length(),t)};Ot.prototype.bool=function(e){return this._push(aC,1,e?1:0)};function sC(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}Ot.prototype.fixed32=function(e){return this._push(sC,4,e>>>0)};Ot.prototype.sfixed32=Ot.prototype.fixed32;Ot.prototype.fixed64=function(e){var t=_b.from(e);return this._push(sC,4,t.lo)._push(sC,4,t.hi)};Ot.prototype.sfixed64=Ot.prototype.fixed64;Ot.prototype.float=function(e){return this._push(fo.float.writeFloatLE,4,e)};Ot.prototype.double=function(e){return this._push(fo.float.writeDoubleLE,8,e)};var PSe=fo.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Ot.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(aC,1,0);if(fo.isString(e)){var n=Ot.alloc(t=Lre.length(e));Lre.decode(e,n,0),e=n}return this.uint32(t)._push(PSe,t,e)};Ot.prototype.string=function(e){var t=Bre.length(e);return t?this.uint32(t)._push(Bre.write,t,e):this._push(aC,1,0)};Ot.prototype.fork=function(){return this.states=new RSe(this),this.head=this.tail=new Ny(oC,0,0),this.len=0,this};Ot.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ny(oC,0,0),this.len=0),this};Ot.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};Ot.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};Ot._configure=function(r){iC=r,Ot.create=Ure(),iC._configure()}});var zre=P((cBt,Vre)=>{"use strict";l();Vre.exports=ac;var Fre=uC();(ac.prototype=Object.create(Fre.prototype)).constructor=ac;var kf=Bd();function ac(){Fre.call(this)}ac._configure=function(){ac.alloc=kf._Buffer_allocUnsafe,ac.writeBytesBuffer=kf.Buffer&&kf.Buffer.prototype instanceof Uint8Array&&kf.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};ac.prototype.bytes=function(e){kf.isString(e)&&(e=kf._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(ac.writeBytesBuffer,t,e),this};function kSe(r,e,t){r.length<40?kf.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}ac.prototype.string=function(e){var t=kf.Buffer.byteLength(e);return this.uint32(t),t&&this._push(kSe,t,e),this};ac._configure()});var nne=P(Uy=>{l();(function(){var r,e,t,n,i,s,o,a;a=function(c){var u,f,h,p;return u=(c&255<<24)>>>24,f=(c&255<<16)>>>16,h=(c&255<<8)>>>8,p=c&255,[u,f,h,p].join(".")},o=function(c){var u,f,h,p,d,m;for(u=[],h=p=0;p<=3&&c.length!==0;h=++p){if(h>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}m=e(c),d=m[0],f=m[1],c=c.substring(f),u.push(d)}if(c.length!==0)throw new Error("Invalid IP");switch(u.length){case 1:if(u[0]>4294967295)throw new Error("Invalid IP");return u[0]>>>0;case 2:if(u[0]>255||u[1]>16777215)throw new Error("Invalid IP");return(u[0]<<24|u[1])>>>0;case 3:if(u[0]>255||u[1]>255||u[2]>65535)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2])>>>0;case 4:if(u[0]>255||u[1]>255||u[2]>255||u[3]>255)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2]<<8|u[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),s=t("a"),i=t("A"),e=function(c){var u,f,h,p,d;for(p=0,u=10,f="9",h=0,c.length>1&&c[h]==="0"&&(c[h+1]==="x"||c[h+1]==="X"?(h+=2,u=16):"0"<=c[h+1]&&c[h+1]<="9"&&(h++,u=8,f="7")),d=h;h<c.length;){if("0"<=c[h]&&c[h]<=f)p=p*u+(t(c[h])-n)>>>0;else if(u===16)if("a"<=c[h]&&c[h]<="f")p=p*u+(10+t(c[h])-s)>>>0;else if("A"<=c[h]&&c[h]<="F")p=p*u+(10+t(c[h])-i)>>>0;else break;else break;if(p>4294967295)throw new Error("too large");h++}if(h===d)throw new Error("empty octet");return[p,h]},r=function(){function c(u,f){var h,p,d,m;if(typeof u!="string")throw new Error("Missing `net' parameter");if(f||(m=u.split("/",2),u=m[0],f=m[1]),f||(f=32),typeof f=="string"&&f.indexOf(".")>-1){try{this.maskLong=o(f)}catch(g){throw h=g,new Error("Invalid mask: "+f)}for(p=d=32;d>=0;p=--d)if(this.maskLong===4294967295<<32-p>>>0){this.bitmask=p;break}}else if(f||f===0)this.bitmask=parseInt(f,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(u)&this.maskLong)>>>0}catch(g){throw h=g,new Error("Invalid net address: "+u)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+f);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(u){return typeof u=="string"&&(u.indexOf("/")>0||u.split(".").length!==4)&&(u=new c(u)),u instanceof c?this.contains(u.base)&&this.contains(u.broadcast||u.last):(o(u)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(u){return u==null&&(u=1),new c(a(this.netLong+this.size*u),this.mask)},c.prototype.forEach=function(u){var f,h,p;for(p=o(this.first),h=o(this.last),f=0;p<=h;)u(a(p),p,f),f++,p++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),Uy.ip2long=o,Uy.long2ip=a,Uy.Netmask=r}).call(Uy)});var ane=P((one,Rb)=>{l();(function(r){"use strict";let e="(0?\\d+|0x[a-f0-9]+)",t={fourOctet:new RegExp(`^${e}\\.${e}\\.${e}\\.${e}$`,"i"),threeOctet:new RegExp(`^${e}\\.${e}\\.${e}$`,"i"),twoOctet:new RegExp(`^${e}\\.${e}$`,"i"),longValue:new RegExp(`^${e}$`,"i")},n=new RegExp("^0[0-7]+$","i"),i=new RegExp("^0x[a-f0-9]+$","i"),s="%[0-9a-z]{1,}",o="(?:[0-9a-f]+::?)+",a={zoneIndex:new RegExp(s,"i"),native:new RegExp(`^(::)?(${o})?([0-9a-f]+)?(::)?(${s})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${e}\\.${e}\\.${e}\\.${e}(${s})?)$`,"i"),transitional:new RegExp(`^((?:${o})|(?:::)(?:${o})?)${e}\\.${e}\\.${e}\\.${e}(${s})?$`,"i")};function c(d,m){if(d.indexOf("::")!==d.lastIndexOf("::"))return null;let g=0,y=-1,w=(d.match(a.zoneIndex)||[])[0],b,_;for(w&&(w=w.substring(1),d=d.replace(/%.+$/,""));(y=d.indexOf(":",y+1))>=0;)g++;if(d.substr(0,2)==="::"&&g--,d.substr(-2,2)==="::"&&g--,g>m)return null;for(_=m-g,b=":";_--;)b+="0:";return d=d.replace("::",b),d[0]===":"&&(d=d.slice(1)),d[d.length-1]===":"&&(d=d.slice(0,-1)),m=function(){let v=d.split(":"),I=[];for(let x=0;x<v.length;x++)I.push(parseInt(v[x],16));return I}(),{parts:m,zoneId:w}}function u(d,m,g,y){if(d.length!==m.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let w=0,b;for(;y>0;){if(b=g-y,b<0&&(b=0),d[w]>>b!==m[w]>>b)return!1;y-=g,w+=1}return!0}function f(d){if(i.test(d))return parseInt(d,16);if(d[0]==="0"&&!isNaN(parseInt(d[1],10))){if(n.test(d))return parseInt(d,8);throw new Error(`ipaddr: cannot parse ${d} as octal`)}return parseInt(d,10)}function h(d,m){for(;d.length<m;)d=`0${d}`;return d}let p={};p.IPv4=function(){function d(m){if(m.length!==4)throw new Error("ipaddr: ipv4 octet count should be 4");let g,y;for(g=0;g<m.length;g++)if(y=m[g],!(0<=y&&y<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=m}return d.prototype.SpecialRanges={unspecified:[[new d([0,0,0,0]),8]],broadcast:[[new d([255,255,255,255]),32]],multicast:[[new d([224,0,0,0]),4]],linkLocal:[[new d([169,254,0,0]),16]],loopback:[[new d([127,0,0,0]),8]],carrierGradeNat:[[new d([100,64,0,0]),10]],private:[[new d([10,0,0,0]),8],[new d([172,16,0,0]),12],[new d([192,168,0,0]),16]],reserved:[[new d([192,0,0,0]),24],[new d([192,0,2,0]),24],[new d([192,88,99,0]),24],[new d([198,51,100,0]),24],[new d([203,0,113,0]),24],[new d([240,0,0,0]),4]]},d.prototype.kind=function(){return"ipv4"},d.prototype.match=function(m,g){let y;if(g===void 0&&(y=m,m=y[0],g=y[1]),m.kind()!=="ipv4")throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return u(this.octets,m.octets,8,g)},d.prototype.prefixLengthFromSubnetMask=function(){let m=0,g=!1,y={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0},w,b,_;for(w=3;w>=0;w-=1)if(b=this.octets[w],b in y){if(_=y[b],g&&_!==0)return null;_!==8&&(g=!0),m+=_}else return null;return 32-m},d.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},d.prototype.toByteArray=function(){return this.octets.slice(0)},d.prototype.toIPv4MappedAddress=function(){return p.IPv6.parse(`::ffff:${this.toString()}`)},d.prototype.toNormalizedString=function(){return this.toString()},d.prototype.toString=function(){return this.octets.join(".")},d}(),p.IPv4.broadcastAddressFromCIDR=function(d){try{let m=this.parseCIDR(d),g=m[0].toByteArray(),y=this.subnetMaskFromPrefixLength(m[1]).toByteArray(),w=[],b=0;for(;b<4;)w.push(parseInt(g[b],10)|parseInt(y[b],10)^255),b++;return new this(w)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.isIPv4=function(d){return this.parser(d)!==null},p.IPv4.isValid=function(d){try{return new this(this.parser(d)),!0}catch{return!1}},p.IPv4.isValidFourPartDecimal=function(d){return!!(p.IPv4.isValid(d)&&d.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},p.IPv4.networkAddressFromCIDR=function(d){let m,g,y,w,b;try{for(m=this.parseCIDR(d),y=m[0].toByteArray(),b=this.subnetMaskFromPrefixLength(m[1]).toByteArray(),w=[],g=0;g<4;)w.push(parseInt(y[g],10)&parseInt(b[g],10)),g++;return new this(w)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.parse=function(d){let m=this.parser(d);if(m===null)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(m)},p.IPv4.parseCIDR=function(d){let m;if(m=d.match(/^(.+)\/(\d+)$/)){let g=parseInt(m[2]);if(g>=0&&g<=32){let y=[this.parse(m[1]),g];return Object.defineProperty(y,"toString",{value:function(){return this.join("/")}}),y}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},p.IPv4.parser=function(d){let m,g,y;if(m=d.match(t.fourOctet))return function(){let w=m.slice(1,6),b=[];for(let _=0;_<w.length;_++)g=w[_],b.push(f(g));return b}();if(m=d.match(t.longValue)){if(y=f(m[1]),y>4294967295||y<0)throw new Error("ipaddr: address outside defined range");return function(){let w=[],b;for(b=0;b<=24;b+=8)w.push(y>>b&255);return w}().reverse()}else return(m=d.match(t.twoOctet))?function(){let w=m.slice(1,4),b=[];if(y=f(w[1]),y>16777215||y<0)throw new Error("ipaddr: address outside defined range");return b.push(f(w[0])),b.push(y>>16&255),b.push(y>>8&255),b.push(y&255),b}():(m=d.match(t.threeOctet))?function(){let w=m.slice(1,5),b=[];if(y=f(w[2]),y>65535||y<0)throw new Error("ipaddr: address outside defined range");return b.push(f(w[0])),b.push(f(w[1])),b.push(y>>8&255),b.push(y&255),b}():null},p.IPv4.subnetMaskFromPrefixLength=function(d){if(d=parseInt(d),d<0||d>32)throw new Error("ipaddr: invalid IPv4 prefix length");let m=[0,0,0,0],g=0,y=Math.floor(d/8);for(;g<y;)m[g]=255,g++;return y<4&&(m[y]=Math.pow(2,d%8)-1<<8-d%8),new this(m)},p.IPv6=function(){function d(m,g){let y,w;if(m.length===16)for(this.parts=[],y=0;y<=14;y+=2)this.parts.push(m[y]<<8|m[y+1]);else if(m.length===8)this.parts=m;else throw new Error("ipaddr: ipv6 part count should be 8 or 16");for(y=0;y<this.parts.length;y++)if(w=this.parts[y],!(0<=w&&w<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");g&&(this.zoneId=g)}return d.prototype.SpecialRanges={unspecified:[new d([0,0,0,0,0,0,0,0]),128],linkLocal:[new d([65152,0,0,0,0,0,0,0]),10],multicast:[new d([65280,0,0,0,0,0,0,0]),8],loopback:[new d([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new d([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new d([0,0,0,0,0,65535,0,0]),96],rfc6145:[new d([0,0,0,0,65535,0,0,0]),96],rfc6052:[new d([100,65435,0,0,0,0,0,0]),96],"6to4":[new d([8194,0,0,0,0,0,0,0]),16],teredo:[new d([8193,0,0,0,0,0,0,0]),32],reserved:[[new d([8193,3512,0,0,0,0,0,0]),32]]},d.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"},d.prototype.kind=function(){return"ipv6"},d.prototype.match=function(m,g){let y;if(g===void 0&&(y=m,m=y[0],g=y[1]),m.kind()!=="ipv6")throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return u(this.parts,m.parts,16,g)},d.prototype.prefixLengthFromSubnetMask=function(){let m=0,g=!1,y={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0},w,b;for(let _=7;_>=0;_-=1)if(w=this.parts[_],w in y){if(b=y[w],g&&b!==0)return null;b!==16&&(g=!0),m+=b}else return null;return 128-m},d.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},d.prototype.toByteArray=function(){let m,g=[],y=this.parts;for(let w=0;w<y.length;w++)m=y[w],g.push(m>>8),g.push(m&255);return g},d.prototype.toFixedLengthString=function(){let m=function(){let y=[];for(let w=0;w<this.parts.length;w++)y.push(h(this.parts[w].toString(16),4));return y}.call(this).join(":"),g="";return this.zoneId&&(g=`%${this.zoneId}`),m+g},d.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");let m=this.parts.slice(-2),g=m[0],y=m[1];return new p.IPv4([g>>8,g&255,y>>8,y&255])},d.prototype.toNormalizedString=function(){let m=function(){let y=[];for(let w=0;w<this.parts.length;w++)y.push(this.parts[w].toString(16));return y}.call(this).join(":"),g="";return this.zoneId&&(g=`%${this.zoneId}`),m+g},d.prototype.toRFC5952String=function(){let m=/((^|:)(0(:|$)){2,})/g,g=this.toNormalizedString(),y=0,w=-1,b;for(;b=m.exec(g);)b[0].length>w&&(y=b.index,w=b[0].length);return w<0?g:`${g.substring(0,y)}::${g.substring(y+w)}`},d.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},d}(),p.IPv6.broadcastAddressFromCIDR=function(d){try{let m=this.parseCIDR(d),g=m[0].toByteArray(),y=this.subnetMaskFromPrefixLength(m[1]).toByteArray(),w=[],b=0;for(;b<16;)w.push(parseInt(g[b],10)|parseInt(y[b],10)^255),b++;return new this(w)}catch(m){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${m})`)}},p.IPv6.isIPv6=function(d){return this.parser(d)!==null},p.IPv6.isValid=function(d){if(typeof d=="string"&&d.indexOf(":")===-1)return!1;try{let m=this.parser(d);return new this(m.parts,m.zoneId),!0}catch{return!1}},p.IPv6.networkAddressFromCIDR=function(d){let m,g,y,w,b;try{for(m=this.parseCIDR(d),y=m[0].toByteArray(),b=this.subnetMaskFromPrefixLength(m[1]).toByteArray(),w=[],g=0;g<16;)w.push(parseInt(y[g],10)&parseInt(b[g],10)),g++;return new this(w)}catch(_){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${_})`)}},p.IPv6.parse=function(d){let m=this.parser(d);if(m.parts===null)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(m.parts,m.zoneId)},p.IPv6.parseCIDR=function(d){let m,g,y;if((g=d.match(/^(.+)\/(\d+)$/))&&(m=parseInt(g[2]),m>=0&&m<=128))return y=[this.parse(g[1]),m],Object.defineProperty(y,"toString",{value:function(){return this.join("/")}}),y;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},p.IPv6.parser=function(d){let m,g,y,w,b,_;if(y=d.match(a.deprecatedTransitional))return this.parser(`::ffff:${y[1]}`);if(a.native.test(d))return c(d,8);if((y=d.match(a.transitional))&&(_=y[6]||"",m=c(y[1].slice(0,-1)+_,6),m.parts)){for(b=[parseInt(y[2]),parseInt(y[3]),parseInt(y[4]),parseInt(y[5])],g=0;g<b.length;g++)if(w=b[g],!(0<=w&&w<=255))return null;return m.parts.push(b[0]<<8|b[1]),m.parts.push(b[2]<<8|b[3]),{parts:m.parts,zoneId:m.zoneId}}return null},p.IPv6.subnetMaskFromPrefixLength=function(d){if(d=parseInt(d),d<0||d>128)throw new Error("ipaddr: invalid IPv6 prefix length");let m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=0,y=Math.floor(d/8);for(;g<y;)m[g]=255,g++;return y<16&&(m[y]=Math.pow(2,d%8)-1<<8-d%8),new this(m)},p.fromByteArray=function(d){let m=d.length;if(m===4)return new p.IPv4(d);if(m===16)return new p.IPv6(d);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},p.isValid=function(d){return p.IPv6.isValid(d)||p.IPv4.isValid(d)},p.parse=function(d){if(p.IPv6.isValid(d))return p.IPv6.parse(d);if(p.IPv4.isValid(d))return p.IPv4.parse(d);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},p.parseCIDR=function(d){try{return p.IPv6.parseCIDR(d)}catch{try{return p.IPv4.parseCIDR(d)}catch{throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},p.process=function(d){let m=this.parse(d);return m.kind()==="ipv6"&&m.isIPv4MappedAddress()?m.toIPv4Address():m},p.subnetMatch=function(d,m,g){let y,w,b,_;g==null&&(g="unicast");for(w in m)if(Object.prototype.hasOwnProperty.call(m,w)){for(b=m[w],b[0]&&!(b[0]instanceof Array)&&(b=[b]),y=0;y<b.length;y++)if(_=b[y],d.kind()===_[0].kind()&&d.match.apply(d,_))return w}return g},typeof Rb<"u"&&Rb.exports?Rb.exports=p:r.ipaddr=p})(one)});var pne=P((LMt,dne)=>{"use strict";l();function jSe(r){return r>=55296&&r<=56319}function WSe(r){return r>=56320&&r<=57343}dne.exports=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var i=t.length,s=0,o,a,c=0;c<i;c+=1){if(o=t.charCodeAt(c),a=t[c],jSe(o)&&WSe(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),s+=e(a),s===n)return t.slice(0,c+1);if(s>n)return t.slice(0,c-a.length+1)}return t}});var gne=P((UMt,mne)=>{"use strict";l();function YSe(r){return r>=55296&&r<=56319}function QSe(r){return r>=56320&&r<=57343}mne.exports=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,i=null,s=null,o=0;o<t;o++)i=e.charCodeAt(o),QSe(i)?s!=null&&YSe(s)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),s=i;return n}});var wne=P((FMt,yne)=>{"use strict";l();var XSe=pne(),ZSe=gne();yne.exports=XSe.bind(null,ZSe)});var _ne=P((zMt,Ene)=>{"use strict";l();var JSe=wne(),exe=/[\/\?<>\\:\*\|"]/g,txe=/[\x00-\x1f\x80-\x9f]/g,rxe=/^\.+$/,nxe=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,ixe=/[\. ]+$/;function bne(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(exe,e).replace(txe,e).replace(rxe,e).replace(nxe,e).replace(ixe,e);return JSe(t,255)}Ene.exports=function(r,e){var t=e&&e.replacement||"",n=bne(r,t);return t===""?n:bne(n,"")}});var Tne=P((WMt,Ane)=>{l();var M1=Je();wu();hr();var fe=M1.asn1,F1=Ane.exports=M1.pkcs7asn1=M1.pkcs7asn1||{};M1.pkcs7=M1.pkcs7||{};M1.pkcs7.asn1=F1;var Sne={name:"ContentInfo",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:fe.Class.UNIVERSAL,type:fe.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:fe.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};F1.contentInfoValidator=Sne;var xne={name:"EncryptedContentInfo",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:fe.Class.UNIVERSAL,type:fe.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:fe.Class.UNIVERSAL,type:fe.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:fe.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:fe.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};F1.envelopedDataValidator={name:"EnvelopedData",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:fe.Class.UNIVERSAL,type:fe.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(xne)};F1.encryptedDataValidator={name:"EncryptedData",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:fe.Class.UNIVERSAL,type:fe.Type.INTEGER,constructed:!1,capture:"version"}].concat(xne)};var cxe={name:"SignerInfo",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:fe.Class.UNIVERSAL,type:fe.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:fe.Class.UNIVERSAL,type:fe.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:fe.Class.UNIVERSAL,type:fe.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:fe.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:fe.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:fe.Class.UNIVERSAL,type:fe.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:fe.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};F1.signedDataValidator={name:"SignedData",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:fe.Class.UNIVERSAL,type:fe.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},Sne,{name:"SignedData.Certificates",tagClass:fe.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:fe.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SET,capture:"signerInfos",optional:!0,value:[cxe]}]};F1.recipientInfoValidator={name:"RecipientInfo",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:fe.Class.UNIVERSAL,type:fe.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:fe.Class.UNIVERSAL,type:fe.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:fe.Class.UNIVERSAL,type:fe.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:fe.Class.UNIVERSAL,type:fe.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:fe.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:fe.Class.UNIVERSAL,type:fe.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}});var Rne=P((QMt,Ine)=>{l();var Fd=Je();hr();Fd.mgf=Fd.mgf||{};var lxe=Ine.exports=Fd.mgf.mgf1=Fd.mgf1=Fd.mgf1||{};lxe.create=function(r){var e={generate:function(t,n){for(var i=new Fd.util.ByteBuffer,s=Math.ceil(n/r.digestLength),o=0;o<s;o++){var a=new Fd.util.ByteBuffer;a.putInt32(o),r.start(),r.update(t+a.getBytes()),i.putBuffer(r.digest())}return i.truncate(i.length()-n),i.getBytes()}};return e}});var Pne=P((ZMt,Cne)=>{l();var Nb=Je();Rne();Cne.exports=Nb.mgf=Nb.mgf||{};Nb.mgf.mgf1=Nb.mgf1});var One=P((eFt,kne)=>{l();var Vd=Je();mh();hr();var uxe=kne.exports=Vd.pss=Vd.pss||{};uxe.create=function(r){arguments.length===3&&(r={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var e=r.md,t=r.mgf,n=e.digestLength,i=r.salt||null;typeof i=="string"&&(i=Vd.util.createBuffer(i));var s;if("saltLength"in r)s=r.saltLength;else if(i!==null)s=i.length();else throw new Error("Salt length not specified or specific salt not given.");if(i!==null&&i.length()!==s)throw new Error("Given salt length does not match length of given salt.");var o=r.prng||Vd.random,a={};return a.encode=function(c,u){var f,h=u-1,p=Math.ceil(h/8),d=c.digest().getBytes();if(p<n+s+2)throw new Error("Message is too long to encrypt.");var m;i===null?m=o.getBytesSync(s):m=i.bytes();var g=new Vd.util.ByteBuffer;g.fillWithByte(0,8),g.putBytes(d),g.putBytes(m),e.start(),e.update(g.getBytes());var y=e.digest().getBytes(),w=new Vd.util.ByteBuffer;w.fillWithByte(0,p-s-n-2),w.putByte(1),w.putBytes(m);var b=w.getBytes(),_=p-n-1,v=t.generate(y,_),I="";for(f=0;f<_;f++)I+=String.fromCharCode(b.charCodeAt(f)^v.charCodeAt(f));var x=65280>>8*p-h&255;return I=String.fromCharCode(I.charCodeAt(0)&~x)+I.substr(1),I+y+String.fromCharCode(188)},a.verify=function(c,u,f){var h,p=f-1,d=Math.ceil(p/8);if(u=u.substr(-d),d<n+s+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(u.charCodeAt(d-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var m=d-n-1,g=u.substr(0,m),y=u.substr(m,n),w=65280>>8*d-p&255;if(g.charCodeAt(0)&w)throw new Error("Bits beyond keysize not zero as expected.");var b=t.generate(y,m),_="";for(h=0;h<m;h++)_+=String.fromCharCode(g.charCodeAt(h)^b.charCodeAt(h));_=String.fromCharCode(_.charCodeAt(0)&~w)+_.substr(1);var v=d-n-s-2;for(h=0;h<v;h++)if(_.charCodeAt(h)!==0)throw new Error("Leftmost octets not zero as expected");if(_.charCodeAt(v)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var I=_.substr(-s),x=new Vd.util.ByteBuffer;x.fillWithByte(0,8),x.putBytes(c),x.putBytes(I),e.start(),e.update(x.getBytes());var A=e.digest().getBytes();return y===A},a}});var SC=P((rFt,Une)=>{l();var Ne=Je();Gp();wu();sw();bu();Pne();qp();lw();One();o2();hr();var E=Ne.asn1,ie=Une.exports=Ne.pki=Ne.pki||{},_t=ie.oids,jr={};jr.CN=_t.commonName;jr.commonName="CN";jr.C=_t.countryName;jr.countryName="C";jr.L=_t.localityName;jr.localityName="L";jr.ST=_t.stateOrProvinceName;jr.stateOrProvinceName="ST";jr.O=_t.organizationName;jr.organizationName="O";jr.OU=_t.organizationalUnitName;jr.organizationalUnitName="OU";jr.E=_t.emailAddress;jr.emailAddress="E";var Dne=Ne.pki.rsa.publicKeyValidator,fxe={name:"Certificate",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:E.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:E.Class.UNIVERSAL,type:E.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:E.Class.UNIVERSAL,type:E.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:E.Class.UNIVERSAL,type:E.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:E.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:E.Class.UNIVERSAL,type:E.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:E.Class.UNIVERSAL,type:E.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:E.Class.UNIVERSAL,type:E.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:E.Class.UNIVERSAL,type:E.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},Dne,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:E.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:E.Class.UNIVERSAL,type:E.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:E.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:E.Class.UNIVERSAL,type:E.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:E.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:E.Class.UNIVERSAL,type:E.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:E.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:E.Class.UNIVERSAL,type:E.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},hxe={name:"rsapss",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:E.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:E.Class.UNIVERSAL,type:E.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:E.Class.UNIVERSAL,type:E.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:E.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:E.Class.UNIVERSAL,type:E.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:E.Class.UNIVERSAL,type:E.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:E.Class.UNIVERSAL,type:E.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:E.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:E.Class.UNIVERSAL,type:E.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:E.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:E.Class.UNIVERSAL,type:E.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},dxe={name:"CertificationRequestInfo",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:E.Class.UNIVERSAL,type:E.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},Dne,{name:"CertificationRequestInfo.attributes",tagClass:E.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:E.Class.UNIVERSAL,type:E.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:E.Class.UNIVERSAL,type:E.Type.SET,constructed:!0}]}]}]},pxe={name:"CertificationRequest",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[dxe,{name:"CertificationRequest.signatureAlgorithm",tagClass:E.Class.UNIVERSAL,type:E.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:E.Class.UNIVERSAL,type:E.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:E.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:E.Class.UNIVERSAL,type:E.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};ie.RDNAttributesAsArray=function(r,e){for(var t=[],n,i,s,o=0;o<r.value.length;++o){n=r.value[o];for(var a=0;a<n.value.length;++a)s={},i=n.value[a],s.type=E.derToOid(i.value[0].value),s.value=i.value[1].value,s.valueTagClass=i.value[1].type,s.type in _t&&(s.name=_t[s.type],s.name in jr&&(s.shortName=jr[s.name])),e&&(e.update(s.type),e.update(s.value)),t.push(s)}return t};ie.CRIAttributesAsArray=function(r){for(var e=[],t=0;t<r.length;++t)for(var n=r[t],i=E.derToOid(n.value[0].value),s=n.value[1].value,o=0;o<s.length;++o){var a={};if(a.type=i,a.value=s[o].value,a.valueTagClass=s[o].type,a.type in _t&&(a.name=_t[a.type],a.name in jr&&(a.shortName=jr[a.name])),a.type===_t.extensionRequest){a.extensions=[];for(var c=0;c<a.value.length;++c)a.extensions.push(ie.certificateExtensionFromAsn1(a.value[c]))}e.push(a)}return e};function Nf(r,e){typeof e=="string"&&(e={shortName:e});for(var t=null,n,i=0;t===null&&i<r.attributes.length;++i)n=r.attributes[i],(e.type&&e.type===n.type||e.name&&e.name===n.name||e.shortName&&e.shortName===n.shortName)&&(t=n);return t}var Db=function(r,e,t){var n={};if(r!==_t["RSASSA-PSS"])return n;t&&(n={hash:{algorithmOid:_t.sha1},mgf:{algorithmOid:_t.mgf1,hash:{algorithmOid:_t.sha1}},saltLength:20});var i={},s=[];if(!E.validate(e,hxe,i,s)){var o=new Error("Cannot read RSASSA-PSS parameter block.");throw o.errors=s,o}return i.hashOid!==void 0&&(n.hash=n.hash||{},n.hash.algorithmOid=E.derToOid(i.hashOid)),i.maskGenOid!==void 0&&(n.mgf=n.mgf||{},n.mgf.algorithmOid=E.derToOid(i.maskGenOid),n.mgf.hash=n.mgf.hash||{},n.mgf.hash.algorithmOid=E.derToOid(i.maskGenHashOid)),i.saltLength!==void 0&&(n.saltLength=i.saltLength.charCodeAt(0)),n},Lb=function(r){switch(_t[r.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return Ne.md.sha1.create();case"md5WithRSAEncryption":return Ne.md.md5.create();case"sha256WithRSAEncryption":return Ne.md.sha256.create();case"sha384WithRSAEncryption":return Ne.md.sha384.create();case"sha512WithRSAEncryption":return Ne.md.sha512.create();case"RSASSA-PSS":return Ne.md.sha256.create();default:var e=new Error("Could not compute "+r.type+" digest. Unknown signature OID.");throw e.signatureOid=r.signatureOid,e}},Lne=function(r){var e=r.certificate,t;switch(e.signatureOid){case _t.sha1WithRSAEncryption:case _t.sha1WithRSASignature:break;case _t["RSASSA-PSS"]:var n,i;if(n=_t[e.signatureParameters.mgf.hash.algorithmOid],n===void 0||Ne.md[n]===void 0){var s=new Error("Unsupported MGF hash function.");throw s.oid=e.signatureParameters.mgf.hash.algorithmOid,s.name=n,s}if(i=_t[e.signatureParameters.mgf.algorithmOid],i===void 0||Ne.mgf[i]===void 0){var s=new Error("Unsupported MGF function.");throw s.oid=e.signatureParameters.mgf.algorithmOid,s.name=i,s}if(i=Ne.mgf[i].create(Ne.md[n].create()),n=_t[e.signatureParameters.hash.algorithmOid],n===void 0||Ne.md[n]===void 0){var s=new Error("Unsupported RSASSA-PSS hash function.");throw s.oid=e.signatureParameters.hash.algorithmOid,s.name=n,s}t=Ne.pss.create(Ne.md[n].create(),i,e.signatureParameters.saltLength);break}return e.publicKey.verify(r.md.digest().getBytes(),r.signature,t)};ie.certificateFromPem=function(r,e,t){var n=Ne.pem.decode(r)[0];if(n.type!=="CERTIFICATE"&&n.type!=="X509 CERTIFICATE"&&n.type!=="TRUSTED CERTIFICATE"){var i=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw i.headerType=n.type,i}if(n.procType&&n.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var s=E.fromDer(n.body,t);return ie.certificateFromAsn1(s,e)};ie.certificateToPem=function(r,e){var t={type:"CERTIFICATE",body:E.toDer(ie.certificateToAsn1(r)).getBytes()};return Ne.pem.encode(t,{maxline:e})};ie.publicKeyFromPem=function(r){var e=Ne.pem.decode(r)[0];if(e.type!=="PUBLIC KEY"&&e.type!=="RSA PUBLIC KEY"){var t=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var n=E.fromDer(e.body);return ie.publicKeyFromAsn1(n)};ie.publicKeyToPem=function(r,e){var t={type:"PUBLIC KEY",body:E.toDer(ie.publicKeyToAsn1(r)).getBytes()};return Ne.pem.encode(t,{maxline:e})};ie.publicKeyToRSAPublicKeyPem=function(r,e){var t={type:"RSA PUBLIC KEY",body:E.toDer(ie.publicKeyToRSAPublicKey(r)).getBytes()};return Ne.pem.encode(t,{maxline:e})};ie.getPublicKeyFingerprint=function(r,e){e=e||{};var t=e.md||Ne.md.sha1.create(),n=e.type||"RSAPublicKey",i;switch(n){case"RSAPublicKey":i=E.toDer(ie.publicKeyToRSAPublicKey(r)).getBytes();break;case"SubjectPublicKeyInfo":i=E.toDer(ie.publicKeyToAsn1(r)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+e.type+'".')}t.start(),t.update(i);var s=t.digest();if(e.encoding==="hex"){var o=s.toHex();return e.delimiter?o.match(/.{2}/g).join(e.delimiter):o}else{if(e.encoding==="binary")return s.getBytes();if(e.encoding)throw new Error('Unknown encoding "'+e.encoding+'".')}return s};ie.certificationRequestFromPem=function(r,e,t){var n=Ne.pem.decode(r)[0];if(n.type!=="CERTIFICATE REQUEST"){var i=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw i.headerType=n.type,i}if(n.procType&&n.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var s=E.fromDer(n.body,t);return ie.certificationRequestFromAsn1(s,e)};ie.certificationRequestToPem=function(r,e){var t={type:"CERTIFICATE REQUEST",body:E.toDer(ie.certificationRequestToAsn1(r)).getBytes()};return Ne.pem.encode(t,{maxline:e})};ie.createCertificate=function(){var r={};return r.version=2,r.serialNumber="00",r.signatureOid=null,r.signature=null,r.siginfo={},r.siginfo.algorithmOid=null,r.validity={},r.validity.notBefore=new Date,r.validity.notAfter=new Date,r.issuer={},r.issuer.getField=function(e){return Nf(r.issuer,e)},r.issuer.addField=function(e){mo([e]),r.issuer.attributes.push(e)},r.issuer.attributes=[],r.issuer.hash=null,r.subject={},r.subject.getField=function(e){return Nf(r.subject,e)},r.subject.addField=function(e){mo([e]),r.subject.attributes.push(e)},r.subject.attributes=[],r.subject.hash=null,r.extensions=[],r.publicKey=null,r.md=null,r.setSubject=function(e,t){mo(e),r.subject.attributes=e,delete r.subject.uniqueId,t&&(r.subject.uniqueId=t),r.subject.hash=null},r.setIssuer=function(e,t){mo(e),r.issuer.attributes=e,delete r.issuer.uniqueId,t&&(r.issuer.uniqueId=t),r.issuer.hash=null},r.setExtensions=function(e){for(var t=0;t<e.length;++t)Bne(e[t],{cert:r});r.extensions=e},r.getExtension=function(e){typeof e=="string"&&(e={name:e});for(var t=null,n,i=0;t===null&&i<r.extensions.length;++i)n=r.extensions[i],(e.id&&n.id===e.id||e.name&&n.name===e.name)&&(t=n);return t},r.sign=function(e,t){r.md=t||Ne.md.sha1.create();var n=_t[r.md.algorithm+"WithRSAEncryption"];if(!n){var i=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw i.algorithm=r.md.algorithm,i}r.signatureOid=r.siginfo.algorithmOid=n,r.tbsCertificate=ie.getTBSCertificate(r);var s=E.toDer(r.tbsCertificate);r.md.update(s.getBytes()),r.signature=e.sign(r.md)},r.verify=function(e){var t=!1;if(!r.issued(e)){var n=e.issuer,i=r.subject,s=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw s.expectedIssuer=i.attributes,s.actualIssuer=n.attributes,s}var o=e.md;if(o===null){o=Lb({signatureOid:e.signatureOid,type:"certificate"});var a=e.tbsCertificate||ie.getTBSCertificate(e),c=E.toDer(a);o.update(c.getBytes())}return o!==null&&(t=Lne({certificate:r,md:o,signature:e.signature})),t},r.isIssuer=function(e){var t=!1,n=r.issuer,i=e.subject;if(n.hash&&i.hash)t=n.hash===i.hash;else if(n.attributes.length===i.attributes.length){t=!0;for(var s,o,a=0;t&&a<n.attributes.length;++a)s=n.attributes[a],o=i.attributes[a],(s.type!==o.type||s.value!==o.value)&&(t=!1)}return t},r.issued=function(e){return e.isIssuer(r)},r.generateSubjectKeyIdentifier=function(){return ie.getPublicKeyFingerprint(r.publicKey,{type:"RSAPublicKey"})},r.verifySubjectKeyIdentifier=function(){for(var e=_t.subjectKeyIdentifier,t=0;t<r.extensions.length;++t){var n=r.extensions[t];if(n.id===e){var i=r.generateSubjectKeyIdentifier().getBytes();return Ne.util.hexToBytes(n.subjectKeyIdentifier)===i}}return!1},r};ie.certificateFromAsn1=function(r,e){var t={},n=[];if(!E.validate(r,fxe,t,n)){var i=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw i.errors=n,i}var s=E.derToOid(t.publicKeyOid);if(s!==ie.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var o=ie.createCertificate();o.version=t.certVersion?t.certVersion.charCodeAt(0):0;var a=Ne.util.createBuffer(t.certSerialNumber);o.serialNumber=a.toHex(),o.signatureOid=Ne.asn1.derToOid(t.certSignatureOid),o.signatureParameters=Db(o.signatureOid,t.certSignatureParams,!0),o.siginfo.algorithmOid=Ne.asn1.derToOid(t.certinfoSignatureOid),o.siginfo.parameters=Db(o.siginfo.algorithmOid,t.certinfoSignatureParams,!1),o.signature=t.certSignature;var c=[];if(t.certValidity1UTCTime!==void 0&&c.push(E.utcTimeToDate(t.certValidity1UTCTime)),t.certValidity2GeneralizedTime!==void 0&&c.push(E.generalizedTimeToDate(t.certValidity2GeneralizedTime)),t.certValidity3UTCTime!==void 0&&c.push(E.utcTimeToDate(t.certValidity3UTCTime)),t.certValidity4GeneralizedTime!==void 0&&c.push(E.generalizedTimeToDate(t.certValidity4GeneralizedTime)),c.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(c.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(o.validity.notBefore=c[0],o.validity.notAfter=c[1],o.tbsCertificate=t.tbsCertificate,e){o.md=Lb({signatureOid:o.signatureOid,type:"certificate"});var u=E.toDer(o.tbsCertificate);o.md.update(u.getBytes())}var f=Ne.md.sha1.create(),h=E.toDer(t.certIssuer);f.update(h.getBytes()),o.issuer.getField=function(m){return Nf(o.issuer,m)},o.issuer.addField=function(m){mo([m]),o.issuer.attributes.push(m)},o.issuer.attributes=ie.RDNAttributesAsArray(t.certIssuer),t.certIssuerUniqueId&&(o.issuer.uniqueId=t.certIssuerUniqueId),o.issuer.hash=f.digest().toHex();var p=Ne.md.sha1.create(),d=E.toDer(t.certSubject);return p.update(d.getBytes()),o.subject.getField=function(m){return Nf(o.subject,m)},o.subject.addField=function(m){mo([m]),o.subject.attributes.push(m)},o.subject.attributes=ie.RDNAttributesAsArray(t.certSubject),t.certSubjectUniqueId&&(o.subject.uniqueId=t.certSubjectUniqueId),o.subject.hash=p.digest().toHex(),t.certExtensions?o.extensions=ie.certificateExtensionsFromAsn1(t.certExtensions):o.extensions=[],o.publicKey=ie.publicKeyFromAsn1(t.subjectPublicKeyInfo),o};ie.certificateExtensionsFromAsn1=function(r){for(var e=[],t=0;t<r.value.length;++t)for(var n=r.value[t],i=0;i<n.value.length;++i)e.push(ie.certificateExtensionFromAsn1(n.value[i]));return e};ie.certificateExtensionFromAsn1=function(r){var e={};if(e.id=E.derToOid(r.value[0].value),e.critical=!1,r.value[1].type===E.Type.BOOLEAN?(e.critical=r.value[1].value.charCodeAt(0)!==0,e.value=r.value[2].value):e.value=r.value[1].value,e.id in _t){if(e.name=_t[e.id],e.name==="keyUsage"){var t=E.fromDer(e.value),n=0,i=0;t.value.length>1&&(n=t.value.charCodeAt(1),i=t.value.length>2?t.value.charCodeAt(2):0),e.digitalSignature=(n&128)===128,e.nonRepudiation=(n&64)===64,e.keyEncipherment=(n&32)===32,e.dataEncipherment=(n&16)===16,e.keyAgreement=(n&8)===8,e.keyCertSign=(n&4)===4,e.cRLSign=(n&2)===2,e.encipherOnly=(n&1)===1,e.decipherOnly=(i&128)===128}else if(e.name==="basicConstraints"){var t=E.fromDer(e.value);t.value.length>0&&t.value[0].type===E.Type.BOOLEAN?e.cA=t.value[0].value.charCodeAt(0)!==0:e.cA=!1;var s=null;t.value.length>0&&t.value[0].type===E.Type.INTEGER?s=t.value[0].value:t.value.length>1&&(s=t.value[1].value),s!==null&&(e.pathLenConstraint=E.derToInteger(s))}else if(e.name==="extKeyUsage")for(var t=E.fromDer(e.value),o=0;o<t.value.length;++o){var a=E.derToOid(t.value[o].value);a in _t?e[_t[a]]=!0:e[a]=!0}else if(e.name==="nsCertType"){var t=E.fromDer(e.value),n=0;t.value.length>1&&(n=t.value.charCodeAt(1)),e.client=(n&128)===128,e.server=(n&64)===64,e.email=(n&32)===32,e.objsign=(n&16)===16,e.reserved=(n&8)===8,e.sslCA=(n&4)===4,e.emailCA=(n&2)===2,e.objCA=(n&1)===1}else if(e.name==="subjectAltName"||e.name==="issuerAltName"){e.altNames=[];for(var c,t=E.fromDer(e.value),u=0;u<t.value.length;++u){c=t.value[u];var f={type:c.type,value:c.value};switch(e.altNames.push(f),c.type){case 1:case 2:case 6:break;case 7:f.ip=Ne.util.bytesToIP(c.value);break;case 8:f.oid=E.derToOid(c.value);break;default:}}}else if(e.name==="subjectKeyIdentifier"){var t=E.fromDer(e.value);e.subjectKeyIdentifier=Ne.util.bytesToHex(t.value)}}return e};ie.certificationRequestFromAsn1=function(r,e){var t={},n=[];if(!E.validate(r,pxe,t,n)){var i=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw i.errors=n,i}var s=E.derToOid(t.publicKeyOid);if(s!==ie.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var o=ie.createCertificationRequest();if(o.version=t.csrVersion?t.csrVersion.charCodeAt(0):0,o.signatureOid=Ne.asn1.derToOid(t.csrSignatureOid),o.signatureParameters=Db(o.signatureOid,t.csrSignatureParams,!0),o.siginfo.algorithmOid=Ne.asn1.derToOid(t.csrSignatureOid),o.siginfo.parameters=Db(o.siginfo.algorithmOid,t.csrSignatureParams,!1),o.signature=t.csrSignature,o.certificationRequestInfo=t.certificationRequestInfo,e){o.md=Lb({signatureOid:o.signatureOid,type:"certification request"});var a=E.toDer(o.certificationRequestInfo);o.md.update(a.getBytes())}var c=Ne.md.sha1.create();return o.subject.getField=function(u){return Nf(o.subject,u)},o.subject.addField=function(u){mo([u]),o.subject.attributes.push(u)},o.subject.attributes=ie.RDNAttributesAsArray(t.certificationRequestInfoSubject,c),o.subject.hash=c.digest().toHex(),o.publicKey=ie.publicKeyFromAsn1(t.subjectPublicKeyInfo),o.getAttribute=function(u){return Nf(o,u)},o.addAttribute=function(u){mo([u]),o.attributes.push(u)},o.attributes=ie.CRIAttributesAsArray(t.certificationRequestInfoAttributes||[]),o};ie.createCertificationRequest=function(){var r={};return r.version=0,r.signatureOid=null,r.signature=null,r.siginfo={},r.siginfo.algorithmOid=null,r.subject={},r.subject.getField=function(e){return Nf(r.subject,e)},r.subject.addField=function(e){mo([e]),r.subject.attributes.push(e)},r.subject.attributes=[],r.subject.hash=null,r.publicKey=null,r.attributes=[],r.getAttribute=function(e){return Nf(r,e)},r.addAttribute=function(e){mo([e]),r.attributes.push(e)},r.md=null,r.setSubject=function(e){mo(e),r.subject.attributes=e,r.subject.hash=null},r.setAttributes=function(e){mo(e),r.attributes=e},r.sign=function(e,t){r.md=t||Ne.md.sha1.create();var n=_t[r.md.algorithm+"WithRSAEncryption"];if(!n){var i=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw i.algorithm=r.md.algorithm,i}r.signatureOid=r.siginfo.algorithmOid=n,r.certificationRequestInfo=ie.getCertificationRequestInfo(r);var s=E.toDer(r.certificationRequestInfo);r.md.update(s.getBytes()),r.signature=e.sign(r.md)},r.verify=function(){var e=!1,t=r.md;if(t===null){t=Lb({signatureOid:r.signatureOid,type:"certification request"});var n=r.certificationRequestInfo||ie.getCertificationRequestInfo(r),i=E.toDer(n);t.update(i.getBytes())}return t!==null&&(e=Lne({certificate:r,md:t,signature:r.signature})),e},r};function V1(r){for(var e=E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[]),t,n,i=r.attributes,s=0;s<i.length;++s){t=i[s];var o=t.value,a=E.Type.PRINTABLESTRING;"valueTagClass"in t&&(a=t.valueTagClass,a===E.Type.UTF8&&(o=Ne.util.encodeUtf8(o))),n=E.create(E.Class.UNIVERSAL,E.Type.SET,!0,[E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[E.create(E.Class.UNIVERSAL,E.Type.OID,!1,E.oidToDer(t.type).getBytes()),E.create(E.Class.UNIVERSAL,a,!1,o)])]),e.value.push(n)}return e}function mo(r){for(var e,t=0;t<r.length;++t){if(e=r[t],typeof e.name>"u"&&(e.type&&e.type in ie.oids?e.name=ie.oids[e.type]:e.shortName&&e.shortName in jr&&(e.name=ie.oids[jr[e.shortName]])),typeof e.type>"u")if(e.name&&e.name in ie.oids)e.type=ie.oids[e.name];else{var n=new Error("Attribute type not specified.");throw n.attribute=e,n}if(typeof e.shortName>"u"&&e.name&&e.name in jr&&(e.shortName=jr[e.name]),e.type===_t.extensionRequest&&(e.valueConstructed=!0,e.valueTagClass=E.Type.SEQUENCE,!e.value&&e.extensions)){e.value=[];for(var i=0;i<e.extensions.length;++i)e.value.push(ie.certificateExtensionToAsn1(Bne(e.extensions[i])))}if(typeof e.value>"u"){var n=new Error("Attribute value not specified.");throw n.attribute=e,n}}}function Bne(r,e){if(e=e||{},typeof r.name>"u"&&r.id&&r.id in ie.oids&&(r.name=ie.oids[r.id]),typeof r.id>"u")if(r.name&&r.name in ie.oids)r.id=ie.oids[r.name];else{var t=new Error("Extension ID not specified.");throw t.extension=r,t}if(typeof r.value<"u")return r;if(r.name==="keyUsage"){var n=0,i=0,s=0;r.digitalSignature&&(i|=128,n=7),r.nonRepudiation&&(i|=64,n=6),r.keyEncipherment&&(i|=32,n=5),r.dataEncipherment&&(i|=16,n=4),r.keyAgreement&&(i|=8,n=3),r.keyCertSign&&(i|=4,n=2),r.cRLSign&&(i|=2,n=1),r.encipherOnly&&(i|=1,n=0),r.decipherOnly&&(s|=128,n=7);var o=String.fromCharCode(n);s!==0?o+=String.fromCharCode(i)+String.fromCharCode(s):i!==0&&(o+=String.fromCharCode(i)),r.value=E.create(E.Class.UNIVERSAL,E.Type.BITSTRING,!1,o)}else if(r.name==="basicConstraints")r.value=E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[]),r.cA&&r.value.value.push(E.create(E.Class.UNIVERSAL,E.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in r&&r.value.value.push(E.create(E.Class.UNIVERSAL,E.Type.INTEGER,!1,E.integerToDer(r.pathLenConstraint).getBytes()));else if(r.name==="extKeyUsage"){r.value=E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[]);var a=r.value.value;for(var c in r)r[c]===!0&&(c in _t?a.push(E.create(E.Class.UNIVERSAL,E.Type.OID,!1,E.oidToDer(_t[c]).getBytes())):c.indexOf(".")!==-1&&a.push(E.create(E.Class.UNIVERSAL,E.Type.OID,!1,E.oidToDer(c).getBytes())))}else if(r.name==="nsCertType"){var n=0,i=0;r.client&&(i|=128,n=7),r.server&&(i|=64,n=6),r.email&&(i|=32,n=5),r.objsign&&(i|=16,n=4),r.reserved&&(i|=8,n=3),r.sslCA&&(i|=4,n=2),r.emailCA&&(i|=2,n=1),r.objCA&&(i|=1,n=0);var o=String.fromCharCode(n);i!==0&&(o+=String.fromCharCode(i)),r.value=E.create(E.Class.UNIVERSAL,E.Type.BITSTRING,!1,o)}else if(r.name==="subjectAltName"||r.name==="issuerAltName"){r.value=E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[]);for(var u,f=0;f<r.altNames.length;++f){u=r.altNames[f];var o=u.value;if(u.type===7&&u.ip){if(o=Ne.util.bytesFromIP(u.ip),o===null){var t=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw t.extension=r,t}}else u.type===8&&(u.oid?o=E.oidToDer(E.oidToDer(u.oid)):o=E.oidToDer(o));r.value.value.push(E.create(E.Class.CONTEXT_SPECIFIC,u.type,!1,o))}}else if(r.name==="nsComment"&&e.cert){if(!/^[\x00-\x7F]*$/.test(r.comment)||r.comment.length<1||r.comment.length>128)throw new Error('Invalid "nsComment" content.');r.value=E.create(E.Class.UNIVERSAL,E.Type.IA5STRING,!1,r.comment)}else if(r.name==="subjectKeyIdentifier"&&e.cert){var h=e.cert.generateSubjectKeyIdentifier();r.subjectKeyIdentifier=h.toHex(),r.value=E.create(E.Class.UNIVERSAL,E.Type.OCTETSTRING,!1,h.getBytes())}else if(r.name==="authorityKeyIdentifier"&&e.cert){r.value=E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[]);var a=r.value.value;if(r.keyIdentifier){var p=r.keyIdentifier===!0?e.cert.generateSubjectKeyIdentifier().getBytes():r.keyIdentifier;a.push(E.create(E.Class.CONTEXT_SPECIFIC,0,!1,p))}if(r.authorityCertIssuer){var d=[E.create(E.Class.CONTEXT_SPECIFIC,4,!0,[V1(r.authorityCertIssuer===!0?e.cert.issuer:r.authorityCertIssuer)])];a.push(E.create(E.Class.CONTEXT_SPECIFIC,1,!0,d))}if(r.serialNumber){var m=Ne.util.hexToBytes(r.serialNumber===!0?e.cert.serialNumber:r.serialNumber);a.push(E.create(E.Class.CONTEXT_SPECIFIC,2,!1,m))}}else if(r.name==="cRLDistributionPoints"){r.value=E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[]);for(var a=r.value.value,g=E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[]),y=E.create(E.Class.CONTEXT_SPECIFIC,0,!0,[]),u,f=0;f<r.altNames.length;++f){u=r.altNames[f];var o=u.value;if(u.type===7&&u.ip){if(o=Ne.util.bytesFromIP(u.ip),o===null){var t=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw t.extension=r,t}}else u.type===8&&(u.oid?o=E.oidToDer(E.oidToDer(u.oid)):o=E.oidToDer(o));y.value.push(E.create(E.Class.CONTEXT_SPECIFIC,u.type,!1,o))}g.value.push(E.create(E.Class.CONTEXT_SPECIFIC,0,!0,[y])),a.push(g)}if(typeof r.value>"u"){var t=new Error("Extension value not specified.");throw t.extension=r,t}return r}function vC(r,e){switch(r){case _t["RSASSA-PSS"]:var t=[];return e.hash.algorithmOid!==void 0&&t.push(E.create(E.Class.CONTEXT_SPECIFIC,0,!0,[E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[E.create(E.Class.UNIVERSAL,E.Type.OID,!1,E.oidToDer(e.hash.algorithmOid).getBytes()),E.create(E.Class.UNIVERSAL,E.Type.NULL,!1,"")])])),e.mgf.algorithmOid!==void 0&&t.push(E.create(E.Class.CONTEXT_SPECIFIC,1,!0,[E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[E.create(E.Class.UNIVERSAL,E.Type.OID,!1,E.oidToDer(e.mgf.algorithmOid).getBytes()),E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[E.create(E.Class.UNIVERSAL,E.Type.OID,!1,E.oidToDer(e.mgf.hash.algorithmOid).getBytes()),E.create(E.Class.UNIVERSAL,E.Type.NULL,!1,"")])])])),e.saltLength!==void 0&&t.push(E.create(E.Class.CONTEXT_SPECIFIC,2,!0,[E.create(E.Class.UNIVERSAL,E.Type.INTEGER,!1,E.integerToDer(e.saltLength).getBytes())])),E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,t);default:return E.create(E.Class.UNIVERSAL,E.Type.NULL,!1,"")}}function mxe(r){var e=E.create(E.Class.CONTEXT_SPECIFIC,0,!0,[]);if(r.attributes.length===0)return e;for(var t=r.attributes,n=0;n<t.length;++n){var i=t[n],s=i.value,o=E.Type.UTF8;"valueTagClass"in i&&(o=i.valueTagClass),o===E.Type.UTF8&&(s=Ne.util.encodeUtf8(s));var a=!1;"valueConstructed"in i&&(a=i.valueConstructed);var c=E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[E.create(E.Class.UNIVERSAL,E.Type.OID,!1,E.oidToDer(i.type).getBytes()),E.create(E.Class.UNIVERSAL,E.Type.SET,!0,[E.create(E.Class.UNIVERSAL,o,a,s)])]);e.value.push(c)}return e}var gxe=new Date("1950-01-01T00:00:00Z"),yxe=new Date("2050-01-01T00:00:00Z");function Nne(r){return r>=gxe&&r<yxe?E.create(E.Class.UNIVERSAL,E.Type.UTCTIME,!1,E.dateToUtcTime(r)):E.create(E.Class.UNIVERSAL,E.Type.GENERALIZEDTIME,!1,E.dateToGeneralizedTime(r))}ie.getTBSCertificate=function(r){var e=Nne(r.validity.notBefore),t=Nne(r.validity.notAfter),n=E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[E.create(E.Class.CONTEXT_SPECIFIC,0,!0,[E.create(E.Class.UNIVERSAL,E.Type.INTEGER,!1,E.integerToDer(r.version).getBytes())]),E.create(E.Class.UNIVERSAL,E.Type.INTEGER,!1,Ne.util.hexToBytes(r.serialNumber)),E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[E.create(E.Class.UNIVERSAL,E.Type.OID,!1,E.oidToDer(r.siginfo.algorithmOid).getBytes()),vC(r.siginfo.algorithmOid,r.siginfo.parameters)]),V1(r.issuer),E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[e,t]),V1(r.subject),ie.publicKeyToAsn1(r.publicKey)]);return r.issuer.uniqueId&&n.value.push(E.create(E.Class.CONTEXT_SPECIFIC,1,!0,[E.create(E.Class.UNIVERSAL,E.Type.BITSTRING,!1,String.fromCharCode(0)+r.issuer.uniqueId)])),r.subject.uniqueId&&n.value.push(E.create(E.Class.CONTEXT_SPECIFIC,2,!0,[E.create(E.Class.UNIVERSAL,E.Type.BITSTRING,!1,String.fromCharCode(0)+r.subject.uniqueId)])),r.extensions.length>0&&n.value.push(ie.certificateExtensionsToAsn1(r.extensions)),n};ie.getCertificationRequestInfo=function(r){var e=E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[E.create(E.Class.UNIVERSAL,E.Type.INTEGER,!1,E.integerToDer(r.version).getBytes()),V1(r.subject),ie.publicKeyToAsn1(r.publicKey),mxe(r)]);return e};ie.distinguishedNameToAsn1=function(r){return V1(r)};ie.certificateToAsn1=function(r){var e=r.tbsCertificate||ie.getTBSCertificate(r);return E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[e,E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[E.create(E.Class.UNIVERSAL,E.Type.OID,!1,E.oidToDer(r.signatureOid).getBytes()),vC(r.signatureOid,r.signatureParameters)]),E.create(E.Class.UNIVERSAL,E.Type.BITSTRING,!1,String.fromCharCode(0)+r.signature)])};ie.certificateExtensionsToAsn1=function(r){var e=E.create(E.Class.CONTEXT_SPECIFIC,3,!0,[]),t=E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[]);e.value.push(t);for(var n=0;n<r.length;++n)t.value.push(ie.certificateExtensionToAsn1(r[n]));return e};ie.certificateExtensionToAsn1=function(r){var e=E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[]);e.value.push(E.create(E.Class.UNIVERSAL,E.Type.OID,!1,E.oidToDer(r.id).getBytes())),r.critical&&e.value.push(E.create(E.Class.UNIVERSAL,E.Type.BOOLEAN,!1,String.fromCharCode(255)));var t=r.value;return typeof r.value!="string"&&(t=E.toDer(t).getBytes()),e.value.push(E.create(E.Class.UNIVERSAL,E.Type.OCTETSTRING,!1,t)),e};ie.certificationRequestToAsn1=function(r){var e=r.certificationRequestInfo||ie.getCertificationRequestInfo(r);return E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[e,E.create(E.Class.UNIVERSAL,E.Type.SEQUENCE,!0,[E.create(E.Class.UNIVERSAL,E.Type.OID,!1,E.oidToDer(r.signatureOid).getBytes()),vC(r.signatureOid,r.signatureParameters)]),E.create(E.Class.UNIVERSAL,E.Type.BITSTRING,!1,String.fromCharCode(0)+r.signature)])};ie.createCaStore=function(r){var e={certs:{}};e.getIssuer=function(o){var a=t(o.issuer);return a},e.addCertificate=function(o){if(typeof o=="string"&&(o=Ne.pki.certificateFromPem(o)),n(o.subject),!e.hasCertificate(o))if(o.subject.hash in e.certs){var a=e.certs[o.subject.hash];Ne.util.isArray(a)||(a=[a]),a.push(o),e.certs[o.subject.hash]=a}else e.certs[o.subject.hash]=o},e.hasCertificate=function(o){typeof o=="string"&&(o=Ne.pki.certificateFromPem(o));var a=t(o.subject);if(!a)return!1;Ne.util.isArray(a)||(a=[a]);for(var c=E.toDer(ie.certificateToAsn1(o)).getBytes(),u=0;u<a.length;++u){var f=E.toDer(ie.certificateToAsn1(a[u])).getBytes();if(c===f)return!0}return!1},e.listAllCertificates=function(){var o=[];for(var a in e.certs)if(e.certs.hasOwnProperty(a)){var c=e.certs[a];if(!Ne.util.isArray(c))o.push(c);else for(var u=0;u<c.length;++u)o.push(c[u])}return o},e.removeCertificate=function(o){var a;if(typeof o=="string"&&(o=Ne.pki.certificateFromPem(o)),n(o.subject),!e.hasCertificate(o))return null;var c=t(o.subject);if(!Ne.util.isArray(c))return a=e.certs[o.subject.hash],delete e.certs[o.subject.hash],a;for(var u=E.toDer(ie.certificateToAsn1(o)).getBytes(),f=0;f<c.length;++f){var h=E.toDer(ie.certificateToAsn1(c[f])).getBytes();u===h&&(a=c[f],c.splice(f,1))}return c.length===0&&delete e.certs[o.subject.hash],a};function t(o){return n(o),e.certs[o.hash]||null}function n(o){if(!o.hash){var a=Ne.md.sha1.create();o.attributes=ie.RDNAttributesAsArray(V1(o),a),o.hash=a.digest().toHex()}}if(r)for(var i=0;i<r.length;++i){var s=r[i];e.addCertificate(s)}return e};ie.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"};ie.verifyCertificateChain=function(r,e,t){typeof t=="function"&&(t={verify:t}),t=t||{},e=e.slice(0);var n=e.slice(0),i=t.validityCheckDate;typeof i>"u"&&(i=new Date);var s=!0,o=null,a=0;do{var c=e.shift(),u=null,f=!1;if(i&&(i<c.validity.notBefore||i>c.validity.notAfter)&&(o={message:"Certificate is not valid yet or has expired.",error:ie.certificateError.certificate_expired,notBefore:c.validity.notBefore,notAfter:c.validity.notAfter,now:i}),o===null){if(u=e[0]||r.getIssuer(c),u===null&&c.isIssuer(c)&&(f=!0,u=c),u){var h=u;Ne.util.isArray(h)||(h=[h]);for(var p=!1;!p&&h.length>0;){u=h.shift();try{p=u.verify(c)}catch{}}p||(o={message:"Certificate signature is invalid.",error:ie.certificateError.bad_certificate})}o===null&&(!u||f)&&!r.hasCertificate(c)&&(o={message:"Certificate is not trusted.",error:ie.certificateError.unknown_ca})}if(o===null&&u&&!c.isIssuer(u)&&(o={message:"Certificate issuer is invalid.",error:ie.certificateError.bad_certificate}),o===null)for(var d={keyUsage:!0,basicConstraints:!0},m=0;o===null&&m<c.extensions.length;++m){var g=c.extensions[m];g.critical&&!(g.name in d)&&(o={message:"Certificate has an unsupported critical extension.",error:ie.certificateError.unsupported_certificate})}if(o===null&&(!s||e.length===0&&(!u||f))){var y=c.getExtension("basicConstraints"),w=c.getExtension("keyUsage");if(w!==null&&(!w.keyCertSign||y===null)&&(o={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:ie.certificateError.bad_certificate}),o===null&&y!==null&&!y.cA&&(o={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:ie.certificateError.bad_certificate}),o===null&&w!==null&&"pathLenConstraint"in y){var b=a-1;b>y.pathLenConstraint&&(o={message:"Certificate basicConstraints pathLenConstraint violated.",error:ie.certificateError.bad_certificate})}}var _=o===null?!0:o.error,v=t.verify?t.verify(_,a,n):_;if(v===!0)o=null;else throw _===!0&&(o={message:"The application rejected the certificate.",error:ie.certificateError.bad_certificate}),(v||v===0)&&(typeof v=="object"&&!Ne.util.isArray(v)?(v.message&&(o.message=v.message),v.error&&(o.error=v.error)):typeof v=="string"&&(o.error=v)),o;s=!1,++a}while(e.length>0);return!0}});var Vne=P((iFt,Fne)=>{l();var ce=Je();Gp();wu();sw();qp();lw();Tne();mh();hr();SC();var D=ce.asn1,Ui=Fne.exports=ce.pkcs7=ce.pkcs7||{};Ui.messageFromPem=function(r){var e=ce.pem.decode(r)[0];if(e.type!=="PKCS7"){var t=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var n=D.fromDer(e.body);return Ui.messageFromAsn1(n)};Ui.messageToPem=function(r,e){var t={type:"PKCS7",body:D.toDer(r.toAsn1()).getBytes()};return ce.pem.encode(t,{maxline:e})};Ui.messageFromAsn1=function(r){var e={},t=[];if(!D.validate(r,Ui.asn1.contentInfoValidator,e,t)){var n=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw n.errors=t,n}var i=D.derToOid(e.contentType),s;switch(i){case ce.pki.oids.envelopedData:s=Ui.createEnvelopedData();break;case ce.pki.oids.encryptedData:s=Ui.createEncryptedData();break;case ce.pki.oids.signedData:s=Ui.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+i+" is not (yet) supported.")}return s.fromAsn1(e.content.value[0]),s};Ui.createSignedData=function(){var r=null;return r={type:ce.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(n){if(AC(r,n,Ui.asn1.signedDataValidator),r.certificates=[],r.crls=[],r.digestAlgorithmIdentifiers=[],r.contentInfo=null,r.signerInfos=[],r.rawCapture.certificates)for(var i=r.rawCapture.certificates.value,s=0;s<i.length;++s)r.certificates.push(ce.pki.certificateFromAsn1(i[s]))},toAsn1:function(){r.contentInfo||r.sign();for(var n=[],i=0;i<r.certificates.length;++i)n.push(ce.pki.certificateToAsn1(r.certificates[i]));var s=[],o=D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,D.integerToDer(r.version).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.SET,!0,r.digestAlgorithmIdentifiers),r.contentInfo])]);return n.length>0&&o.value[0].value.push(D.create(D.Class.CONTEXT_SPECIFIC,0,!0,n)),s.length>0&&o.value[0].value.push(D.create(D.Class.CONTEXT_SPECIFIC,1,!0,s)),o.value[0].value.push(D.create(D.Class.UNIVERSAL,D.Type.SET,!0,r.signerInfos)),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(r.type).getBytes()),o])},addSigner:function(n){var i=n.issuer,s=n.serialNumber;if(n.certificate){var o=n.certificate;typeof o=="string"&&(o=ce.pki.certificateFromPem(o)),i=o.issuer.attributes,s=o.serialNumber}var a=n.key;if(!a)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof a=="string"&&(a=ce.pki.privateKeyFromPem(a));var c=n.digestAlgorithm||ce.pki.oids.sha1;switch(c){case ce.pki.oids.sha1:case ce.pki.oids.sha256:case ce.pki.oids.sha384:case ce.pki.oids.sha512:case ce.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+c)}var u=n.authenticatedAttributes||[];if(u.length>0){for(var f=!1,h=!1,p=0;p<u.length;++p){var d=u[p];if(!f&&d.type===ce.pki.oids.contentType){if(f=!0,h)break;continue}if(!h&&d.type===ce.pki.oids.messageDigest){if(h=!0,f)break;continue}}if(!f||!h)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}r.signers.push({key:a,version:1,issuer:i,serialNumber:s,digestAlgorithm:c,signatureAlgorithm:ce.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:u,unauthenticatedAttributes:[]})},sign:function(n){if(n=n||{},(typeof r.content!="object"||r.contentInfo===null)&&(r.contentInfo=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(ce.pki.oids.data).getBytes())]),"content"in r)){var i;r.content instanceof ce.util.ByteBuffer?i=r.content.bytes():typeof r.content=="string"&&(i=ce.util.encodeUtf8(r.content)),n.detached?r.detachedContent=D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,i):r.contentInfo.value.push(D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,i)]))}if(r.signers.length!==0){var s=e();t(s)}},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(n){typeof n=="string"&&(n=ce.pki.certificateFromPem(n)),r.certificates.push(n)},addCertificateRevokationList:function(n){throw new Error("PKCS#7 CRL support not yet implemented.")}},r;function e(){for(var n={},i=0;i<r.signers.length;++i){var s=r.signers[i],o=s.digestAlgorithm;o in n||(n[o]=ce.md[ce.pki.oids[o]].create()),s.authenticatedAttributes.length===0?s.md=n[o]:s.md=ce.md[ce.pki.oids[o]].create()}r.digestAlgorithmIdentifiers=[];for(var o in n)r.digestAlgorithmIdentifiers.push(D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(o).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.NULL,!1,"")]));return n}function t(n){var i;if(r.detachedContent?i=r.detachedContent:(i=r.contentInfo.value[1],i=i.value[0]),!i)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var s=D.derToOid(r.contentInfo.value[0].value),o=D.toDer(i);o.getByte(),D.getBerValueLength(o),o=o.getBytes();for(var a in n)n[a].start().update(o);for(var c=new Date,u=0;u<r.signers.length;++u){var f=r.signers[u];if(f.authenticatedAttributes.length===0){if(s!==ce.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{f.authenticatedAttributesAsn1=D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var h=D.create(D.Class.UNIVERSAL,D.Type.SET,!0,[]),p=0;p<f.authenticatedAttributes.length;++p){var d=f.authenticatedAttributes[p];d.type===ce.pki.oids.messageDigest?d.value=n[f.digestAlgorithm].digest():d.type===ce.pki.oids.signingTime&&(d.value||(d.value=c)),h.value.push(xC(d)),f.authenticatedAttributesAsn1.value.push(xC(d))}o=D.toDer(h).getBytes(),f.md.start().update(o)}f.signature=f.key.sign(f.md,"RSASSA-PKCS1-V1_5")}r.signerInfos=Sxe(r.signers)}};Ui.createEncryptedData=function(){var r=null;return r={type:ce.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:ce.pki.oids["aes256-CBC"]},fromAsn1:function(e){AC(r,e,Ui.asn1.encryptedDataValidator)},decrypt:function(e){e!==void 0&&(r.encryptedContent.key=e),Mne(r)}},r};Ui.createEnvelopedData=function(){var r=null;return r={type:ce.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:ce.pki.oids["aes256-CBC"]},fromAsn1:function(e){var t=AC(r,e,Ui.asn1.envelopedDataValidator);r.recipients=Exe(t.recipientInfos.value)},toAsn1:function(){return D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(r.type).getBytes()),D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,D.integerToDer(r.version).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.SET,!0,_xe(r.recipients)),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,xxe(r.encryptedContent))])])])},findRecipient:function(e){for(var t=e.issuer.attributes,n=0;n<r.recipients.length;++n){var i=r.recipients[n],s=i.issuer;if(i.serialNumber===e.serialNumber&&s.length===t.length){for(var o=!0,a=0;a<t.length;++a)if(s[a].type!==t[a].type||s[a].value!==t[a].value){o=!1;break}if(o)return i}}return null},decrypt:function(e,t){if(r.encryptedContent.key===void 0&&e!==void 0&&t!==void 0)switch(e.encryptedContent.algorithm){case ce.pki.oids.rsaEncryption:case ce.pki.oids.desCBC:var n=t.decrypt(e.encryptedContent.content);r.encryptedContent.key=ce.util.createBuffer(n);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}Mne(r)},addRecipient:function(e){r.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:ce.pki.oids.rsaEncryption,key:e.publicKey}})},encrypt:function(e,t){if(r.encryptedContent.content===void 0){t=t||r.encryptedContent.algorithm,e=e||r.encryptedContent.key;var n,i,s;switch(t){case ce.pki.oids["aes128-CBC"]:n=16,i=16,s=ce.aes.createEncryptionCipher;break;case ce.pki.oids["aes192-CBC"]:n=24,i=16,s=ce.aes.createEncryptionCipher;break;case ce.pki.oids["aes256-CBC"]:n=32,i=16,s=ce.aes.createEncryptionCipher;break;case ce.pki.oids["des-EDE3-CBC"]:n=24,i=8,s=ce.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+t)}if(e===void 0)e=ce.util.createBuffer(ce.random.getBytes(n));else if(e.length()!=n)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+n+".");r.encryptedContent.algorithm=t,r.encryptedContent.key=e,r.encryptedContent.parameter=ce.util.createBuffer(ce.random.getBytes(i));var o=s(e);if(o.start(r.encryptedContent.parameter.copy()),o.update(r.content),!o.finish())throw new Error("Symmetric encryption failed.");r.encryptedContent.content=o.output}for(var a=0;a<r.recipients.length;++a){var c=r.recipients[a];if(c.encryptedContent.content===void 0)switch(c.encryptedContent.algorithm){case ce.pki.oids.rsaEncryption:c.encryptedContent.content=c.encryptedContent.key.encrypt(r.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+c.encryptedContent.algorithm)}}}},r};function wxe(r){var e={},t=[];if(!D.validate(r,Ui.asn1.recipientInfoValidator,e,t)){var n=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw n.errors=t,n}return{version:e.version.charCodeAt(0),issuer:ce.pki.RDNAttributesAsArray(e.issuer),serialNumber:ce.util.createBuffer(e.serial).toHex(),encryptedContent:{algorithm:D.derToOid(e.encAlgorithm),parameter:e.encParameter?e.encParameter.value:void 0,content:e.encKey}}}function bxe(r){return D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,D.integerToDer(r.version).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[ce.pki.distinguishedNameToAsn1({attributes:r.issuer}),D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,ce.util.hexToBytes(r.serialNumber))]),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(r.encryptedContent.algorithm).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.NULL,!1,"")]),D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,r.encryptedContent.content)])}function Exe(r){for(var e=[],t=0;t<r.length;++t)e.push(wxe(r[t]));return e}function _xe(r){for(var e=[],t=0;t<r.length;++t)e.push(bxe(r[t]));return e}function vxe(r){var e=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,D.integerToDer(r.version).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[ce.pki.distinguishedNameToAsn1({attributes:r.issuer}),D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,ce.util.hexToBytes(r.serialNumber))]),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(r.digestAlgorithm).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.NULL,!1,"")])]);if(r.authenticatedAttributesAsn1&&e.value.push(r.authenticatedAttributesAsn1),e.value.push(D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(r.signatureAlgorithm).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.NULL,!1,"")])),e.value.push(D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,r.signature)),r.unauthenticatedAttributes.length>0){for(var t=D.create(D.Class.CONTEXT_SPECIFIC,1,!0,[]),n=0;n<r.unauthenticatedAttributes.length;++n){var i=r.unauthenticatedAttributes[n];t.values.push(xC(i))}e.value.push(t)}return e}function Sxe(r){for(var e=[],t=0;t<r.length;++t)e.push(vxe(r[t]));return e}function xC(r){var e;if(r.type===ce.pki.oids.contentType)e=D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(r.value).getBytes());else if(r.type===ce.pki.oids.messageDigest)e=D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,r.value.bytes());else if(r.type===ce.pki.oids.signingTime){var t=new Date("1950-01-01T00:00:00Z"),n=new Date("2050-01-01T00:00:00Z"),i=r.value;if(typeof i=="string"){var s=Date.parse(i);isNaN(s)?i.length===13?i=D.utcTimeToDate(i):i=D.generalizedTimeToDate(i):i=new Date(s)}i>=t&&i<n?e=D.create(D.Class.UNIVERSAL,D.Type.UTCTIME,!1,D.dateToUtcTime(i)):e=D.create(D.Class.UNIVERSAL,D.Type.GENERALIZEDTIME,!1,D.dateToGeneralizedTime(i))}return D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(r.type).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.SET,!0,[e])])}function xxe(r){return[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(ce.pki.oids.data).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(r.algorithm).getBytes()),r.parameter?D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,r.parameter.getBytes()):void 0]),D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,r.content.getBytes())])]}function AC(r,e,t){var n={},i=[];if(!D.validate(e,t,n,i)){var s=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw s.errors=s,s}var o=D.derToOid(n.contentType);if(o!==ce.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(n.encryptedContent){var a="";if(ce.util.isArray(n.encryptedContent))for(var c=0;c<n.encryptedContent.length;++c){if(n.encryptedContent[c].type!==D.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");a+=n.encryptedContent[c].value}else a=n.encryptedContent;r.encryptedContent={algorithm:D.derToOid(n.encAlgorithm),parameter:ce.util.createBuffer(n.encParameter.value),content:ce.util.createBuffer(a)}}if(n.content){var a="";if(ce.util.isArray(n.content))for(var c=0;c<n.content.length;++c){if(n.content[c].type!==D.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");a+=n.content[c].value}else a=n.content;r.content=ce.util.createBuffer(a)}return r.version=n.version.charCodeAt(0),r.rawCapture=n,n}function Mne(r){if(r.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(r.content===void 0){var e;switch(r.encryptedContent.algorithm){case ce.pki.oids["aes128-CBC"]:case ce.pki.oids["aes192-CBC"]:case ce.pki.oids["aes256-CBC"]:e=ce.aes.createDecryptionCipher(r.encryptedContent.key);break;case ce.pki.oids.desCBC:case ce.pki.oids["des-EDE3-CBC"]:e=ce.des.createDecryptionCipher(r.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+r.encryptedContent.algorithm)}if(e.start(r.encryptedContent.parameter),e.update(r.encryptedContent.content),!e.finish())throw new Error("Symmetric decryption failed.");r.content=e.output}}});var Mie=P((E$t,Uie)=>{"use strict";l();Uie.exports=Bie;var Xxe=h_(),Lf=Bie.prototype,Zxe=new Date%1e9;function Jxe(){return(Math.random()*1e9>>>0)+Zxe++}function Bie(r){r=r||{},this.id=r.id||Jxe(),this.max=r.max||1/0,this.items=r.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(r.lastModified||new Date);for(var e,t,n=this.items.length;n--;)e=this.items[n],t=new Date(e.expires)-new Date,this._lookup[e.key]=e,t>0?this.expire(e.key,t):t<=0&&this.delete(e.key)}Lf.has=function(r){return r in this._lookup};Lf.get=function(r){if(!this.has(r))return null;var e=this._lookup[r];return e.refresh&&this.expire(r,e.refresh),this.items.splice(this.items.indexOf(e),1),this.items.push(e),e.value};Lf.meta=function(r){if(!this.has(r))return null;var e=this._lookup[r];return"meta"in e?e.meta:null};Lf.set=function(r,e,t){var n=this._lookup[r],i=this._lookup[r]={key:r,value:e};return this.lastModified=new Date,n?(clearTimeout(n.timeout),this.items.splice(this.items.indexOf(n),1,i)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(i),this.size++),t&&("ttl"in t&&this.expire(r,t.ttl),"meta"in t&&(i.meta=t.meta),t.refresh&&(i.refresh=t.ttl)),this};Lf.delete=function(r){var e=this._lookup[r];return e?(this.lastModified=new Date,this.items.splice(this.items.indexOf(e),1),clearTimeout(e.timeout),delete this._lookup[r],this.size--,this):!1};Lf.expire=function(r,e){var t=e||0,n=this._lookup[r];if(!n)return this;if(typeof t=="string"&&(t=Xxe(e)),typeof t!="number")throw new TypeError("Expiration time must be a string or number.");return clearTimeout(n.timeout),n.timeout=setTimeout(this.delete.bind(this,n.key),t),n.expires=Number(new Date)+t,this};Lf.clear=function(){for(var r=this.items.length;r--;)this.delete(this.items[r].key);return this};Lf.toJSON=function(){for(var r=new Array(this.items.length),e,t=r.length;t--;)e=this.items[t],r[t]={key:e.key,meta:e.meta,value:e.value,expires:e.expires,refresh:e.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:r}}});var Yie=P((hHt,Wie)=>{l();Wie.exports=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}}});var Zie=P((mHt,Xie)=>{l();var Qie=Yie();Xie.exports=class{constructor(e){this.hwm=e||16,this.head=new Qie(this.hwm),this.tail=this.head,this.length=0}push(e){if(this.length++,!this.head.push(e)){let t=this.head;this.head=t.next=new Qie(2*this.head.buffer.length),this.head.push(e)}}shift(){this.length!==0&&this.length--;let e=this.tail.shift();if(e===void 0&&this.tail.next){let t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}});var ese=P((yHt,Jie)=>{"use strict";l();var aAe=()=>{let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r};Jie.exports=aAe});var ise=P((EHt,nse)=>{l();var tse=Zie(),rse=ese();nse.exports=class{constructor(){this._buffer=new tse,this._waitingConsumers=new tse}push(e){let{promise:t,resolve:n}=rse();return this._buffer.push({chunk:e,resolve:n}),this._consume(),t}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){let e=this._waitingConsumers.shift(),t=this._buffer.shift();e.resolve(t.chunk),t.resolve()}}shift(){let{promise:e,resolve:t}=rse();return this._waitingConsumers.push({resolve:t}),this._consume(),e}isEmpty(){return this._buffer.isEmpty()}}});var mse=P((iP,pse)=>{l();var _E=fp(),Ul=_E.Buffer;function dse(r,e){for(var t in r)e[t]=r[t]}Ul.from&&Ul.alloc&&Ul.allocUnsafe&&Ul.allocUnsafeSlow?pse.exports=_E:(dse(_E,iP),iP.Buffer=j1);function j1(r,e,t){return Ul(r,e,t)}dse(Ul,j1);j1.from=function(r,e,t){if(typeof r=="number")throw new TypeError("Argument must not be a number");return Ul(r,e,t)};j1.alloc=function(r,e,t){if(typeof r!="number")throw new TypeError("Argument must be a number");var n=Ul(r);return e!==void 0?typeof t=="string"?n.fill(e,t):n.fill(e):n.fill(0),n};j1.allocUnsafe=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return Ul(r)};j1.allocUnsafeSlow=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return _E.SlowBuffer(r)}});var gse=P((AGt,oP)=>{"use strict";l();var sP=65536,uAe=4294967295;function fAe(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var hAe=mse().Buffer,vE=globalThis.crypto||globalThis.msCrypto;vE&&vE.getRandomValues?oP.exports=dAe:oP.exports=fAe;function dAe(r,e){if(r>uAe)throw new RangeError("requested too many random bytes");var t=hAe.allocUnsafe(r);if(r>0)if(r>sP)for(var n=0;n<r;n+=sP)vE.getRandomValues(t.slice(n,n+sP));else vE.getRandomValues(t);return typeof e=="function"?process.nextTick(function(){e(null,t)}):t}});var bse=P((IGt,wse)=>{"use strict";l();var pAe=gse(),{EventEmitter:mAe}=ri();function yse(r,e){if(r===e)return!0;if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;++t)if(r[t]!==e[t])return!1;return!0}function aP(){return{contacts:[],dontSplit:!1,left:null,right:null}}function e3(r,e){if(!(e instanceof Uint8Array))throw new TypeError(r+" is not a Uint8Array")}var W1=class extends mAe{constructor(e={}){super(),this.localNodeId=e.localNodeId||pAe(20),this.numberOfNodesPerKBucket=e.numberOfNodesPerKBucket||20,this.numberOfNodesToPing=e.numberOfNodesToPing||3,this.distance=e.distance||W1.distance,this.arbiter=e.arbiter||W1.arbiter,this.metadata=Object.assign({},e.metadata),e3("option.localNodeId as parameter 1",this.localNodeId),this.root=aP()}static arbiter(e,t){return e.vectorClock>t.vectorClock?e:t}static distance(e,t){let n=0,i=0,s=Math.min(e.length,t.length),o=Math.max(e.length,t.length);for(;i<s;++i)n=n*256+(e[i]^t[i]);for(;i<o;++i)n=n*256+255;return n}add(e){e3("contact.id",(e||{}).id);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e.id,t++);let i=this._indexOf(n,e.id);return i>=0?(this._update(n,i,e),this):n.contacts.length<this.numberOfNodesPerKBucket?(n.contacts.push(e),this.emit("added",e),this):n.dontSplit?(this.emit("ping",n.contacts.slice(0,this.numberOfNodesToPing),e),this):(this._split(n,t),this.add(e))}closest(e,t=1/0){if(e3("id",e),!Number.isInteger(t)&&t!==1/0||t<=0)throw new TypeError("n is not positive number");let n=[];for(let i=[this.root],s=0;i.length>0&&n.length<t;){let o=i.pop();if(o.contacts===null){let a=this._determineNode(o,e,s++);i.push(o.left===a?o.right:o.left),i.push(a)}else n=n.concat(o.contacts)}return n.map(i=>[this.distance(i.id,e),i]).sort((i,s)=>i[0]-s[0]).slice(0,t).map(i=>i[1])}count(){let e=0;for(let t=[this.root];t.length>0;){let n=t.pop();n.contacts===null?t.push(n.right,n.left):e+=n.contacts.length}return e}_determineNode(e,t,n){let i=n>>3,s=n%8;return t.length<=i&&s!==0?e.left:t[i]&1<<7-s?e.right:e.left}get(e){e3("id",e);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e,t++);let i=this._indexOf(n,e);return i>=0?n.contacts[i]:null}_indexOf(e,t){for(let n=0;n<e.contacts.length;++n)if(yse(e.contacts[n].id,t))return n;return-1}remove(e){e3("the id as parameter 1",e);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e,t++);let i=this._indexOf(n,e);if(i>=0){let s=n.contacts.splice(i,1)[0];this.emit("removed",s)}return this}_split(e,t){e.left=aP(),e.right=aP();for(let s of e.contacts)this._determineNode(e,s.id,t).contacts.push(s);e.contacts=null;let n=this._determineNode(e,this.localNodeId,t),i=e.left===n?e.right:e.left;i.dontSplit=!0}toArray(){let e=[];for(let t=[this.root];t.length>0;){let n=t.pop();n.contacts===null?t.push(n.right,n.left):e=e.concat(n.contacts)}return e}*toIterable(){for(let e=[this.root];e.length>0;){let t=e.pop();t.contacts===null?e.push(t.right,t.left):yield*t.contacts}}_update(e,t,n){if(!yse(e.contacts[t].id,n.id))throw new Error("wrong index for _update");let i=e.contacts[t],s=this.arbiter(i,n);s===i&&i!==n||(e.contacts.splice(t,1),e.contacts.push(s),this.emit("updated",i,s))}};wse.exports=W1});var Coe=P(JE=>{"use strict";l();Object.defineProperty(JE,"__esModule",{value:!0});var CP=class{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;let t={value:e,done:!1};if(this.pullQueue.length){let n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(let e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(let t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{let t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{let t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,i)=>{this.pullQueue.push({resolve:n,reject:i})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}},ZE=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){let i=new CP;i.highWaterMark=t,i.lowWaterMark=n,i.removeCallback=e({push:s=>i.push(s),stop:()=>i.stop(),fail:s=>i.fail(s),on:(s,o)=>{i.eventHandlers[s]=o}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}};JE.EventIterator=ZE;JE.default=ZE});var Poe=P(f3=>{"use strict";l();Object.defineProperty(f3,"__esModule",{value:!0});var PP=Coe();f3.EventIterator=PP.EventIterator;function yTe(r,e,t){return new PP.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}f3.subscribe=yTe;f3.default=PP.EventIterator});var Cae=P(tk=>{"use strict";l();Object.defineProperty(tk,"__esModule",{value:!0});function fIe(r){return typeof r.saveState<"u"&&typeof r.restoreState<"u"&&typeof r.cleanSavedState<"u"}tk.isSerializableHash=fIe});var d7=P(am=>{"use strict";l();Object.defineProperty(am,"__esModule",{value:!0});function hIe(r,e,t){return~(r-1)&e|r-1&t}am.select=hIe;function dIe(r,e){return(r|0)-(e|0)-1>>>31&1}am.lessOrEqual=dIe;function Pae(r,e){if(r.length!==e.length)return 0;for(var t=0,n=0;n<r.length;n++)t|=r[n]^e[n];return 1&t-1>>>8}am.compare=Pae;function pIe(r,e){return r.length===0||e.length===0?!1:Pae(r,e)!==0}am.equal=pIe});var mc=P(rk=>{"use strict";l();Object.defineProperty(rk,"__esModule",{value:!0});function mIe(r){for(var e=0;e<r.length;e++)r[e]=0;return r}rk.wipe=mIe});var Oae=P(p3=>{"use strict";l();Object.defineProperty(p3,"__esModule",{value:!0});var gc=Cae(),gIe=d7(),yIe=mc(),kae=function(){function r(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var n=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(n).clean():n.set(t);for(var i=0;i<n.length;i++)n[i]^=54;this._inner.update(n);for(var i=0;i<n.length;i++)n[i]^=106;this._outer.update(n),gc.isSerializableHash(this._inner)&&gc.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),yIe.wipe(n)}return r.prototype.reset=function(){if(!gc.isSerializableHash(this._inner)||!gc.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.clean=function(){gc.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),gc.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},r.prototype.update=function(e){return this._inner.update(e),this},r.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(!gc.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},r.prototype.restoreState=function(e){if(!gc.isSerializableHash(this._inner)||!gc.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.cleanSavedState=function(e){if(!gc.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},r}();p3.HMAC=kae;function wIe(r,e,t){var n=new kae(r,e);n.update(t);var i=n.digest();return n.clean(),i}p3.hmac=wIe;p3.equal=gIe.equal});var Lae=P(nk=>{"use strict";l();Object.defineProperty(nk,"__esModule",{value:!0});var Nae=Oae(),Dae=mc(),bIe=function(){function r(e,t,n,i){n===void 0&&(n=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=i;var s=Nae.hmac(this._hash,n,t);this._hmac=new Nae.HMAC(e,s),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return r.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},r.prototype.expand=function(e){for(var t=new Uint8Array(e),n=0;n<t.length;n++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[n]=this._buffer[this._bufpos++];return t},r.prototype.clean=function(){this._hmac.clean(),Dae.wipe(this._buffer),Dae.wipe(this._counter),this._bufpos=0},r}();nk.HKDF=bIe});var Uae=P(p7=>{"use strict";l();Object.defineProperty(p7,"__esModule",{value:!0});p7.BrowserRandomSource=void 0;var Bae=65536,ik=class{constructor(){this.isAvailable=!1,this.isInstantiated=!1;let e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");let t=new Uint8Array(e);for(let n=0;n<t.length;n+=Bae)this._crypto.getRandomValues(t.subarray(n,n+Math.min(t.length-n,Bae)));return t}};p7.BrowserRandomSource=ik});var Mae=P(m7=>{"use strict";l();Object.defineProperty(m7,"__esModule",{value:!0});m7.NodeRandomSource=void 0;var EIe=mc(),sk=class{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof op<"u"){let e=Eu();e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");let n=new Uint8Array(e);for(let i=0;i<n.length;i++)n[i]=t[i];return(0,EIe.wipe)(t),n}};m7.NodeRandomSource=sk});var Fae=P(g7=>{"use strict";l();Object.defineProperty(g7,"__esModule",{value:!0});g7.SystemRandomSource=void 0;var _Ie=Uae(),vIe=Mae(),ok=class{constructor(){if(this.isAvailable=!1,this.name="",this._source=new _Ie.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new vIe.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}};g7.SystemRandomSource=ok});var Vae=P(Ds=>{"use strict";l();Object.defineProperty(Ds,"__esModule",{value:!0});function SIe(r,e){var t=r>>>16&65535,n=r&65535,i=e>>>16&65535,s=e&65535;return n*s+(t*s+n*i<<16>>>0)|0}Ds.mul=Math.imul||SIe;function xIe(r,e){return r+e|0}Ds.add=xIe;function AIe(r,e){return r-e|0}Ds.sub=AIe;function TIe(r,e){return r<<e|r>>>32-e}Ds.rotl=TIe;function IIe(r,e){return r<<32-e|r>>>e}Ds.rotr=IIe;function RIe(r){return typeof r=="number"&&isFinite(r)&&Math.floor(r)===r}Ds.isInteger=Number.isInteger||RIe;Ds.MAX_SAFE_INTEGER=9007199254740991;Ds.isSafeInteger=function(r){return Ds.isInteger(r)&&r>=-Ds.MAX_SAFE_INTEGER&&r<=Ds.MAX_SAFE_INTEGER}});var m3=P(Xe=>{"use strict";l();Object.defineProperty(Xe,"__esModule",{value:!0});var zae=Vae();function CIe(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])<<16>>16}Xe.readInt16BE=CIe;function PIe(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])>>>0}Xe.readUint16BE=PIe;function kIe(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])<<16>>16}Xe.readInt16LE=kIe;function OIe(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])>>>0}Xe.readUint16LE=OIe;function Kae(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>8,e[t+1]=r>>>0,e}Xe.writeUint16BE=Kae;Xe.writeInt16BE=Kae;function qae(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e}Xe.writeUint16LE=qae;Xe.writeInt16LE=qae;function ak(r,e){return e===void 0&&(e=0),r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}Xe.readInt32BE=ak;function ck(r,e){return e===void 0&&(e=0),(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}Xe.readUint32BE=ck;function lk(r,e){return e===void 0&&(e=0),r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e]}Xe.readInt32LE=lk;function uk(r,e){return e===void 0&&(e=0),(r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e])>>>0}Xe.readUint32LE=uk;function y7(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>24,e[t+1]=r>>>16,e[t+2]=r>>>8,e[t+3]=r>>>0,e}Xe.writeUint32BE=y7;Xe.writeInt32BE=y7;function w7(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e[t+2]=r>>>16,e[t+3]=r>>>24,e}Xe.writeUint32LE=w7;Xe.writeInt32LE=w7;function NIe(r,e){e===void 0&&(e=0);var t=ak(r,e),n=ak(r,e+4);return t*4294967296+n-(n>>31)*4294967296}Xe.readInt64BE=NIe;function DIe(r,e){e===void 0&&(e=0);var t=ck(r,e),n=ck(r,e+4);return t*4294967296+n}Xe.readUint64BE=DIe;function LIe(r,e){e===void 0&&(e=0);var t=lk(r,e),n=lk(r,e+4);return n*4294967296+t-(t>>31)*4294967296}Xe.readInt64LE=LIe;function BIe(r,e){e===void 0&&(e=0);var t=uk(r,e),n=uk(r,e+4);return n*4294967296+t}Xe.readUint64LE=BIe;function $ae(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),y7(r/4294967296>>>0,e,t),y7(r>>>0,e,t+4),e}Xe.writeUint64BE=$ae;Xe.writeInt64BE=$ae;function Hae(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),w7(r>>>0,e,t),w7(r/4294967296>>>0,e,t+4),e}Xe.writeUint64LE=Hae;Xe.writeInt64LE=Hae;function UIe(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,i=1,s=r/8+t-1;s>=t;s--)n+=e[s]*i,i*=256;return n}Xe.readUintBE=UIe;function MIe(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,i=1,s=t;s<t+r/8;s++)n+=e[s]*i,i*=256;return n}Xe.readUintLE=MIe;function FIe(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!zae.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var i=1,s=r/8+n-1;s>=n;s--)t[s]=e/i&255,i*=256;return t}Xe.writeUintBE=FIe;function VIe(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!zae.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var i=1,s=n;s<n+r/8;s++)t[s]=e/i&255,i*=256;return t}Xe.writeUintLE=VIe;function zIe(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e)}Xe.readFloat32BE=zIe;function KIe(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e,!0)}Xe.readFloat32LE=KIe;function qIe(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e)}Xe.readFloat64BE=qIe;function $Ie(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e,!0)}Xe.readFloat64LE=$Ie;function HIe(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r),e}Xe.writeFloat32BE=HIe;function GIe(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r,!0),e}Xe.writeFloat32LE=GIe;function jIe(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r),e}Xe.writeFloat64BE=jIe;function WIe(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r,!0),e}Xe.writeFloat64LE=WIe});var Yae=P(Ti=>{"use strict";l();Object.defineProperty(Ti,"__esModule",{value:!0});Ti.randomStringForEntropy=Ti.randomString=Ti.randomUint32=Ti.randomBytes=Ti.defaultRandomSource=void 0;var YIe=Fae(),QIe=m3(),Gae=mc();Ti.defaultRandomSource=new YIe.SystemRandomSource;function fk(r,e=Ti.defaultRandomSource){return e.randomBytes(r)}Ti.randomBytes=fk;function XIe(r=Ti.defaultRandomSource){let e=fk(4,r),t=(0,QIe.readUint32LE)(e);return(0,Gae.wipe)(e),t}Ti.randomUint32=XIe;var jae="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function Wae(r,e=jae,t=Ti.defaultRandomSource){if(e.length<2)throw new Error("randomString charset is too short");if(e.length>256)throw new Error("randomString charset is too long");let n="",i=e.length,s=256-256%i;for(;r>0;){let o=fk(Math.ceil(r*256/s),t);for(let a=0;a<o.length&&r>0;a++){let c=o[a];c<s&&(n+=e.charAt(c%i),r--)}(0,Gae.wipe)(o)}return n}Ti.randomString=Wae;function ZIe(r,e=jae,t=Ti.defaultRandomSource){let n=Math.ceil(r/(Math.log(e.length)/Math.LN2));return Wae(n,e,t)}Ti.randomStringForEntropy=ZIe});var Jae=P(Wr=>{"use strict";l();Object.defineProperty(Wr,"__esModule",{value:!0});Wr.sharedKey=Wr.generateKeyPair=Wr.generateKeyPairFromSeed=Wr.scalarMultBase=Wr.scalarMult=Wr.SHARED_KEY_LENGTH=Wr.SECRET_KEY_LENGTH=Wr.PUBLIC_KEY_LENGTH=void 0;var JIe=Yae(),eRe=mc();Wr.PUBLIC_KEY_LENGTH=32;Wr.SECRET_KEY_LENGTH=32;Wr.SHARED_KEY_LENGTH=32;function yc(r){let e=new Float64Array(16);if(r)for(let t=0;t<r.length;t++)e[t]=r[t];return e}var Qae=new Uint8Array(32);Qae[0]=9;var tRe=yc([56129,1]);function hk(r){let e=1;for(let t=0;t<16;t++){let n=r[t]+e+65535;e=Math.floor(n/65536),r[t]=n-e*65536}r[0]+=e-1+37*(e-1)}function g3(r,e,t){let n=~(t-1);for(let i=0;i<16;i++){let s=n&(r[i]^e[i]);r[i]^=s,e[i]^=s}}function rRe(r,e){let t=yc(),n=yc();for(let i=0;i<16;i++)n[i]=e[i];hk(n),hk(n),hk(n);for(let i=0;i<2;i++){t[0]=n[0]-65517;for(let o=1;o<15;o++)t[o]=n[o]-65535-(t[o-1]>>16&1),t[o-1]&=65535;t[15]=n[15]-32767-(t[14]>>16&1);let s=t[15]>>16&1;t[14]&=65535,g3(n,t,1-s)}for(let i=0;i<16;i++)r[2*i]=n[i]&255,r[2*i+1]=n[i]>>8}function nRe(r,e){for(let t=0;t<16;t++)r[t]=e[2*t]+(e[2*t+1]<<8);r[15]&=32767}function b7(r,e,t){for(let n=0;n<16;n++)r[n]=e[n]+t[n]}function E7(r,e,t){for(let n=0;n<16;n++)r[n]=e[n]-t[n]}function ql(r,e,t){let n,i,s=0,o=0,a=0,c=0,u=0,f=0,h=0,p=0,d=0,m=0,g=0,y=0,w=0,b=0,_=0,v=0,I=0,x=0,A=0,R=0,O=0,V=0,$=0,Y=0,Q=0,pe=0,re=0,he=0,H=0,ve=0,St=0,nt=t[0],it=t[1],ct=t[2],Dt=t[3],Lt=t[4],Bt=t[5],Ut=t[6],Mt=t[7],si=t[8],oi=t[9],ai=t[10],ci=t[11],li=t[12],ui=t[13],fi=t[14],hi=t[15];n=e[0],s+=n*nt,o+=n*it,a+=n*ct,c+=n*Dt,u+=n*Lt,f+=n*Bt,h+=n*Ut,p+=n*Mt,d+=n*si,m+=n*oi,g+=n*ai,y+=n*ci,w+=n*li,b+=n*ui,_+=n*fi,v+=n*hi,n=e[1],o+=n*nt,a+=n*it,c+=n*ct,u+=n*Dt,f+=n*Lt,h+=n*Bt,p+=n*Ut,d+=n*Mt,m+=n*si,g+=n*oi,y+=n*ai,w+=n*ci,b+=n*li,_+=n*ui,v+=n*fi,I+=n*hi,n=e[2],a+=n*nt,c+=n*it,u+=n*ct,f+=n*Dt,h+=n*Lt,p+=n*Bt,d+=n*Ut,m+=n*Mt,g+=n*si,y+=n*oi,w+=n*ai,b+=n*ci,_+=n*li,v+=n*ui,I+=n*fi,x+=n*hi,n=e[3],c+=n*nt,u+=n*it,f+=n*ct,h+=n*Dt,p+=n*Lt,d+=n*Bt,m+=n*Ut,g+=n*Mt,y+=n*si,w+=n*oi,b+=n*ai,_+=n*ci,v+=n*li,I+=n*ui,x+=n*fi,A+=n*hi,n=e[4],u+=n*nt,f+=n*it,h+=n*ct,p+=n*Dt,d+=n*Lt,m+=n*Bt,g+=n*Ut,y+=n*Mt,w+=n*si,b+=n*oi,_+=n*ai,v+=n*ci,I+=n*li,x+=n*ui,A+=n*fi,R+=n*hi,n=e[5],f+=n*nt,h+=n*it,p+=n*ct,d+=n*Dt,m+=n*Lt,g+=n*Bt,y+=n*Ut,w+=n*Mt,b+=n*si,_+=n*oi,v+=n*ai,I+=n*ci,x+=n*li,A+=n*ui,R+=n*fi,O+=n*hi,n=e[6],h+=n*nt,p+=n*it,d+=n*ct,m+=n*Dt,g+=n*Lt,y+=n*Bt,w+=n*Ut,b+=n*Mt,_+=n*si,v+=n*oi,I+=n*ai,x+=n*ci,A+=n*li,R+=n*ui,O+=n*fi,V+=n*hi,n=e[7],p+=n*nt,d+=n*it,m+=n*ct,g+=n*Dt,y+=n*Lt,w+=n*Bt,b+=n*Ut,_+=n*Mt,v+=n*si,I+=n*oi,x+=n*ai,A+=n*ci,R+=n*li,O+=n*ui,V+=n*fi,$+=n*hi,n=e[8],d+=n*nt,m+=n*it,g+=n*ct,y+=n*Dt,w+=n*Lt,b+=n*Bt,_+=n*Ut,v+=n*Mt,I+=n*si,x+=n*oi,A+=n*ai,R+=n*ci,O+=n*li,V+=n*ui,$+=n*fi,Y+=n*hi,n=e[9],m+=n*nt,g+=n*it,y+=n*ct,w+=n*Dt,b+=n*Lt,_+=n*Bt,v+=n*Ut,I+=n*Mt,x+=n*si,A+=n*oi,R+=n*ai,O+=n*ci,V+=n*li,$+=n*ui,Y+=n*fi,Q+=n*hi,n=e[10],g+=n*nt,y+=n*it,w+=n*ct,b+=n*Dt,_+=n*Lt,v+=n*Bt,I+=n*Ut,x+=n*Mt,A+=n*si,R+=n*oi,O+=n*ai,V+=n*ci,$+=n*li,Y+=n*ui,Q+=n*fi,pe+=n*hi,n=e[11],y+=n*nt,w+=n*it,b+=n*ct,_+=n*Dt,v+=n*Lt,I+=n*Bt,x+=n*Ut,A+=n*Mt,R+=n*si,O+=n*oi,V+=n*ai,$+=n*ci,Y+=n*li,Q+=n*ui,pe+=n*fi,re+=n*hi,n=e[12],w+=n*nt,b+=n*it,_+=n*ct,v+=n*Dt,I+=n*Lt,x+=n*Bt,A+=n*Ut,R+=n*Mt,O+=n*si,V+=n*oi,$+=n*ai,Y+=n*ci,Q+=n*li,pe+=n*ui,re+=n*fi,he+=n*hi,n=e[13],b+=n*nt,_+=n*it,v+=n*ct,I+=n*Dt,x+=n*Lt,A+=n*Bt,R+=n*Ut,O+=n*Mt,V+=n*si,$+=n*oi,Y+=n*ai,Q+=n*ci,pe+=n*li,re+=n*ui,he+=n*fi,H+=n*hi,n=e[14],_+=n*nt,v+=n*it,I+=n*ct,x+=n*Dt,A+=n*Lt,R+=n*Bt,O+=n*Ut,V+=n*Mt,$+=n*si,Y+=n*oi,Q+=n*ai,pe+=n*ci,re+=n*li,he+=n*ui,H+=n*fi,ve+=n*hi,n=e[15],v+=n*nt,I+=n*it,x+=n*ct,A+=n*Dt,R+=n*Lt,O+=n*Bt,V+=n*Ut,$+=n*Mt,Y+=n*si,Q+=n*oi,pe+=n*ai,re+=n*ci,he+=n*li,H+=n*ui,ve+=n*fi,St+=n*hi,s+=38*I,o+=38*x,a+=38*A,c+=38*R,u+=38*O,f+=38*V,h+=38*$,p+=38*Y,d+=38*Q,m+=38*pe,g+=38*re,y+=38*he,w+=38*H,b+=38*ve,_+=38*St,i=1,n=s+i+65535,i=Math.floor(n/65536),s=n-i*65536,n=o+i+65535,i=Math.floor(n/65536),o=n-i*65536,n=a+i+65535,i=Math.floor(n/65536),a=n-i*65536,n=c+i+65535,i=Math.floor(n/65536),c=n-i*65536,n=u+i+65535,i=Math.floor(n/65536),u=n-i*65536,n=f+i+65535,i=Math.floor(n/65536),f=n-i*65536,n=h+i+65535,i=Math.floor(n/65536),h=n-i*65536,n=p+i+65535,i=Math.floor(n/65536),p=n-i*65536,n=d+i+65535,i=Math.floor(n/65536),d=n-i*65536,n=m+i+65535,i=Math.floor(n/65536),m=n-i*65536,n=g+i+65535,i=Math.floor(n/65536),g=n-i*65536,n=y+i+65535,i=Math.floor(n/65536),y=n-i*65536,n=w+i+65535,i=Math.floor(n/65536),w=n-i*65536,n=b+i+65535,i=Math.floor(n/65536),b=n-i*65536,n=_+i+65535,i=Math.floor(n/65536),_=n-i*65536,n=v+i+65535,i=Math.floor(n/65536),v=n-i*65536,s+=i-1+37*(i-1),i=1,n=s+i+65535,i=Math.floor(n/65536),s=n-i*65536,n=o+i+65535,i=Math.floor(n/65536),o=n-i*65536,n=a+i+65535,i=Math.floor(n/65536),a=n-i*65536,n=c+i+65535,i=Math.floor(n/65536),c=n-i*65536,n=u+i+65535,i=Math.floor(n/65536),u=n-i*65536,n=f+i+65535,i=Math.floor(n/65536),f=n-i*65536,n=h+i+65535,i=Math.floor(n/65536),h=n-i*65536,n=p+i+65535,i=Math.floor(n/65536),p=n-i*65536,n=d+i+65535,i=Math.floor(n/65536),d=n-i*65536,n=m+i+65535,i=Math.floor(n/65536),m=n-i*65536,n=g+i+65535,i=Math.floor(n/65536),g=n-i*65536,n=y+i+65535,i=Math.floor(n/65536),y=n-i*65536,n=w+i+65535,i=Math.floor(n/65536),w=n-i*65536,n=b+i+65535,i=Math.floor(n/65536),b=n-i*65536,n=_+i+65535,i=Math.floor(n/65536),_=n-i*65536,n=v+i+65535,i=Math.floor(n/65536),v=n-i*65536,s+=i-1+37*(i-1),r[0]=s,r[1]=o,r[2]=a,r[3]=c,r[4]=u,r[5]=f,r[6]=h,r[7]=p,r[8]=d,r[9]=m,r[10]=g,r[11]=y,r[12]=w,r[13]=b,r[14]=_,r[15]=v}function y3(r,e){ql(r,e,e)}function iRe(r,e){let t=yc();for(let n=0;n<16;n++)t[n]=e[n];for(let n=253;n>=0;n--)y3(t,t),n!==2&&n!==4&&ql(t,t,e);for(let n=0;n<16;n++)r[n]=t[n]}function dk(r,e){let t=new Uint8Array(32),n=new Float64Array(80),i=yc(),s=yc(),o=yc(),a=yc(),c=yc(),u=yc();for(let d=0;d<31;d++)t[d]=r[d];t[31]=r[31]&127|64,t[0]&=248,nRe(n,e);for(let d=0;d<16;d++)s[d]=n[d];i[0]=a[0]=1;for(let d=254;d>=0;--d){let m=t[d>>>3]>>>(d&7)&1;g3(i,s,m),g3(o,a,m),b7(c,i,o),E7(i,i,o),b7(o,s,a),E7(s,s,a),y3(a,c),y3(u,i),ql(i,o,i),ql(o,s,c),b7(c,i,o),E7(i,i,o),y3(s,i),E7(o,a,u),ql(i,o,tRe),b7(i,i,a),ql(o,o,i),ql(i,a,u),ql(a,s,n),y3(s,c),g3(i,s,m),g3(o,a,m)}for(let d=0;d<16;d++)n[d+16]=i[d],n[d+32]=o[d],n[d+48]=s[d],n[d+64]=a[d];let f=n.subarray(32),h=n.subarray(16);iRe(f,f),ql(h,h,f);let p=new Uint8Array(32);return rRe(p,h),p}Wr.scalarMult=dk;function Xae(r){return dk(r,Qae)}Wr.scalarMultBase=Xae;function Zae(r){if(r.length!==Wr.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${Wr.SECRET_KEY_LENGTH} bytes`);let e=new Uint8Array(r);return{publicKey:Xae(e),secretKey:e}}Wr.generateKeyPairFromSeed=Zae;function sRe(r){let e=(0,JIe.randomBytes)(32,r),t=Zae(e);return(0,eRe.wipe)(e),t}Wr.generateKeyPair=sRe;function oRe(r,e,t=!1){if(r.length!==Wr.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(e.length!==Wr.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");let n=dk(r,e);if(t){let i=0;for(let s=0;s<n.length;s++)i|=n[s];if(i===0)throw new Error("X25519: invalid shared key")}return n}Wr.sharedKey=oRe});var tce=P(Kf=>{"use strict";l();Object.defineProperty(Kf,"__esModule",{value:!0});var v7=m3(),_7=mc();Kf.DIGEST_LENGTH=32;Kf.BLOCK_SIZE=64;var ece=function(){function r(){this.digestLength=Kf.DIGEST_LENGTH,this.blockSize=Kf.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return r.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},r.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},r.prototype.clean=function(){_7.wipe(this._buffer),_7.wipe(this._temp),this.reset()},r.prototype.update=function(e,t){if(t===void 0&&(t=e.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var n=0;if(this._bytesHashed+=t,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&t>0;)this._buffer[this._bufferLength++]=e[n++],t--;this._bufferLength===this.blockSize&&(pk(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(t>=this.blockSize&&(n=pk(this._temp,this._state,e,n,t),t%=this.blockSize);t>0;)this._buffer[this._bufferLength++]=e[n++],t--;return this},r.prototype.finish=function(e){if(!this._finished){var t=this._bytesHashed,n=this._bufferLength,i=t/536870912|0,s=t<<3,o=t%64<56?64:128;this._buffer[n]=128;for(var a=n+1;a<o-8;a++)this._buffer[a]=0;v7.writeUint32BE(i,this._buffer,o-8),v7.writeUint32BE(s,this._buffer,o-4),pk(this._temp,this._state,this._buffer,0,o),this._finished=!0}for(var a=0;a<this.digestLength/4;a++)v7.writeUint32BE(this._state[a],e,a*4);return this},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},r.prototype.restoreState=function(e){return this._state.set(e.state),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},r.prototype.cleanSavedState=function(e){_7.wipe(e.state),e.buffer&&_7.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},r}();Kf.SHA256=ece;var aRe=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function pk(r,e,t,n,i){for(;i>=64;){for(var s=e[0],o=e[1],a=e[2],c=e[3],u=e[4],f=e[5],h=e[6],p=e[7],d=0;d<16;d++){var m=n+d*4;r[d]=v7.readUint32BE(t,m)}for(var d=16;d<64;d++){var g=r[d-2],y=(g>>>17|g<<32-17)^(g>>>19|g<<32-19)^g>>>10;g=r[d-15];var w=(g>>>7|g<<32-7)^(g>>>18|g<<32-18)^g>>>3;r[d]=(y+r[d-7]|0)+(w+r[d-16]|0)}for(var d=0;d<64;d++){var y=(((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))+(u&f^~u&h)|0)+(p+(aRe[d]+r[d]|0)|0)|0,w=((s>>>2|s<<32-2)^(s>>>13|s<<32-13)^(s>>>22|s<<32-22))+(s&o^s&a^o&a)|0;p=h,h=f,f=u,u=c+y|0,c=a,a=o,o=s,s=y+w|0}e[0]+=s,e[1]+=o,e[2]+=a,e[3]+=c,e[4]+=u,e[5]+=f,e[6]+=h,e[7]+=p,n+=64,i-=64}return n}function cRe(r){var e=new ece;e.update(r);var t=e.digest();return e.clean(),t}Kf.hash=cRe});var nce=P(S7=>{"use strict";l();Object.defineProperty(S7,"__esModule",{value:!0});var Ii=m3(),mk=mc(),lRe=20;function uRe(r,e,t){for(var n=1634760805,i=857760878,s=2036477234,o=1797285236,a=t[3]<<24|t[2]<<16|t[1]<<8|t[0],c=t[7]<<24|t[6]<<16|t[5]<<8|t[4],u=t[11]<<24|t[10]<<16|t[9]<<8|t[8],f=t[15]<<24|t[14]<<16|t[13]<<8|t[12],h=t[19]<<24|t[18]<<16|t[17]<<8|t[16],p=t[23]<<24|t[22]<<16|t[21]<<8|t[20],d=t[27]<<24|t[26]<<16|t[25]<<8|t[24],m=t[31]<<24|t[30]<<16|t[29]<<8|t[28],g=e[3]<<24|e[2]<<16|e[1]<<8|e[0],y=e[7]<<24|e[6]<<16|e[5]<<8|e[4],w=e[11]<<24|e[10]<<16|e[9]<<8|e[8],b=e[15]<<24|e[14]<<16|e[13]<<8|e[12],_=n,v=i,I=s,x=o,A=a,R=c,O=u,V=f,$=h,Y=p,Q=d,pe=m,re=g,he=y,H=w,ve=b,St=0;St<lRe;St+=2)_=_+A|0,re^=_,re=re>>>32-16|re<<16,$=$+re|0,A^=$,A=A>>>32-12|A<<12,v=v+R|0,he^=v,he=he>>>32-16|he<<16,Y=Y+he|0,R^=Y,R=R>>>32-12|R<<12,I=I+O|0,H^=I,H=H>>>32-16|H<<16,Q=Q+H|0,O^=Q,O=O>>>32-12|O<<12,x=x+V|0,ve^=x,ve=ve>>>32-16|ve<<16,pe=pe+ve|0,V^=pe,V=V>>>32-12|V<<12,I=I+O|0,H^=I,H=H>>>32-8|H<<8,Q=Q+H|0,O^=Q,O=O>>>32-7|O<<7,x=x+V|0,ve^=x,ve=ve>>>32-8|ve<<8,pe=pe+ve|0,V^=pe,V=V>>>32-7|V<<7,v=v+R|0,he^=v,he=he>>>32-8|he<<8,Y=Y+he|0,R^=Y,R=R>>>32-7|R<<7,_=_+A|0,re^=_,re=re>>>32-8|re<<8,$=$+re|0,A^=$,A=A>>>32-7|A<<7,_=_+R|0,ve^=_,ve=ve>>>32-16|ve<<16,Q=Q+ve|0,R^=Q,R=R>>>32-12|R<<12,v=v+O|0,re^=v,re=re>>>32-16|re<<16,pe=pe+re|0,O^=pe,O=O>>>32-12|O<<12,I=I+V|0,he^=I,he=he>>>32-16|he<<16,$=$+he|0,V^=$,V=V>>>32-12|V<<12,x=x+A|0,H^=x,H=H>>>32-16|H<<16,Y=Y+H|0,A^=Y,A=A>>>32-12|A<<12,I=I+V|0,he^=I,he=he>>>32-8|he<<8,$=$+he|0,V^=$,V=V>>>32-7|V<<7,x=x+A|0,H^=x,H=H>>>32-8|H<<8,Y=Y+H|0,A^=Y,A=A>>>32-7|A<<7,v=v+O|0,re^=v,re=re>>>32-8|re<<8,pe=pe+re|0,O^=pe,O=O>>>32-7|O<<7,_=_+R|0,ve^=_,ve=ve>>>32-8|ve<<8,Q=Q+ve|0,R^=Q,R=R>>>32-7|R<<7;Ii.writeUint32LE(_+n|0,r,0),Ii.writeUint32LE(v+i|0,r,4),Ii.writeUint32LE(I+s|0,r,8),Ii.writeUint32LE(x+o|0,r,12),Ii.writeUint32LE(A+a|0,r,16),Ii.writeUint32LE(R+c|0,r,20),Ii.writeUint32LE(O+u|0,r,24),Ii.writeUint32LE(V+f|0,r,28),Ii.writeUint32LE($+h|0,r,32),Ii.writeUint32LE(Y+p|0,r,36),Ii.writeUint32LE(Q+d|0,r,40),Ii.writeUint32LE(pe+m|0,r,44),Ii.writeUint32LE(re+g|0,r,48),Ii.writeUint32LE(he+y|0,r,52),Ii.writeUint32LE(H+w|0,r,56),Ii.writeUint32LE(ve+b|0,r,60)}function rce(r,e,t,n,i){if(i===void 0&&(i=0),r.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(n.length<t.length)throw new Error("ChaCha: destination is shorter than source");var s,o;if(i===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");s=new Uint8Array(16),o=s.length-e.length,s.set(e,o)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");s=e,o=i}for(var a=new Uint8Array(64),c=0;c<t.length;c+=64){uRe(a,s,r);for(var u=c;u<c+64&&u<t.length;u++)n[u]=t[u]^a[u-c];hRe(s,0,o)}return mk.wipe(a),i===0&&mk.wipe(s),n}S7.streamXOR=rce;function fRe(r,e,t,n){return n===void 0&&(n=0),mk.wipe(t),rce(r,e,t,t,n)}S7.stream=fRe;function hRe(r,e,t){for(var n=1;t--;)n=n+(r[e]&255)|0,r[e]=n&255,n>>>=8,e++;if(n>0)throw new Error("ChaCha: counter overflow")}});var sce=P($l=>{"use strict";l();Object.defineProperty($l,"__esModule",{value:!0});var dRe=d7(),x7=mc();$l.DIGEST_LENGTH=16;var ice=function(){function r(e){this.digestLength=$l.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var t=e[0]|e[1]<<8;this._r[0]=t&8191;var n=e[2]|e[3]<<8;this._r[1]=(t>>>13|n<<3)&8191;var i=e[4]|e[5]<<8;this._r[2]=(n>>>10|i<<6)&7939;var s=e[6]|e[7]<<8;this._r[3]=(i>>>7|s<<9)&8191;var o=e[8]|e[9]<<8;this._r[4]=(s>>>4|o<<12)&255,this._r[5]=o>>>1&8190;var a=e[10]|e[11]<<8;this._r[6]=(o>>>14|a<<2)&8191;var c=e[12]|e[13]<<8;this._r[7]=(a>>>11|c<<5)&8065;var u=e[14]|e[15]<<8;this._r[8]=(c>>>8|u<<8)&8191,this._r[9]=u>>>5&127,this._pad[0]=e[16]|e[17]<<8,this._pad[1]=e[18]|e[19]<<8,this._pad[2]=e[20]|e[21]<<8,this._pad[3]=e[22]|e[23]<<8,this._pad[4]=e[24]|e[25]<<8,this._pad[5]=e[26]|e[27]<<8,this._pad[6]=e[28]|e[29]<<8,this._pad[7]=e[30]|e[31]<<8}return r.prototype._blocks=function(e,t,n){for(var i=this._fin?0:2048,s=this._h[0],o=this._h[1],a=this._h[2],c=this._h[3],u=this._h[4],f=this._h[5],h=this._h[6],p=this._h[7],d=this._h[8],m=this._h[9],g=this._r[0],y=this._r[1],w=this._r[2],b=this._r[3],_=this._r[4],v=this._r[5],I=this._r[6],x=this._r[7],A=this._r[8],R=this._r[9];n>=16;){var O=e[t+0]|e[t+1]<<8;s+=O&8191;var V=e[t+2]|e[t+3]<<8;o+=(O>>>13|V<<3)&8191;var $=e[t+4]|e[t+5]<<8;a+=(V>>>10|$<<6)&8191;var Y=e[t+6]|e[t+7]<<8;c+=($>>>7|Y<<9)&8191;var Q=e[t+8]|e[t+9]<<8;u+=(Y>>>4|Q<<12)&8191,f+=Q>>>1&8191;var pe=e[t+10]|e[t+11]<<8;h+=(Q>>>14|pe<<2)&8191;var re=e[t+12]|e[t+13]<<8;p+=(pe>>>11|re<<5)&8191;var he=e[t+14]|e[t+15]<<8;d+=(re>>>8|he<<8)&8191,m+=he>>>5|i;var H=0,ve=H;ve+=s*g,ve+=o*(5*R),ve+=a*(5*A),ve+=c*(5*x),ve+=u*(5*I),H=ve>>>13,ve&=8191,ve+=f*(5*v),ve+=h*(5*_),ve+=p*(5*b),ve+=d*(5*w),ve+=m*(5*y),H+=ve>>>13,ve&=8191;var St=H;St+=s*y,St+=o*g,St+=a*(5*R),St+=c*(5*A),St+=u*(5*x),H=St>>>13,St&=8191,St+=f*(5*I),St+=h*(5*v),St+=p*(5*_),St+=d*(5*b),St+=m*(5*w),H+=St>>>13,St&=8191;var nt=H;nt+=s*w,nt+=o*y,nt+=a*g,nt+=c*(5*R),nt+=u*(5*A),H=nt>>>13,nt&=8191,nt+=f*(5*x),nt+=h*(5*I),nt+=p*(5*v),nt+=d*(5*_),nt+=m*(5*b),H+=nt>>>13,nt&=8191;var it=H;it+=s*b,it+=o*w,it+=a*y,it+=c*g,it+=u*(5*R),H=it>>>13,it&=8191,it+=f*(5*A),it+=h*(5*x),it+=p*(5*I),it+=d*(5*v),it+=m*(5*_),H+=it>>>13,it&=8191;var ct=H;ct+=s*_,ct+=o*b,ct+=a*w,ct+=c*y,ct+=u*g,H=ct>>>13,ct&=8191,ct+=f*(5*R),ct+=h*(5*A),ct+=p*(5*x),ct+=d*(5*I),ct+=m*(5*v),H+=ct>>>13,ct&=8191;var Dt=H;Dt+=s*v,Dt+=o*_,Dt+=a*b,Dt+=c*w,Dt+=u*y,H=Dt>>>13,Dt&=8191,Dt+=f*g,Dt+=h*(5*R),Dt+=p*(5*A),Dt+=d*(5*x),Dt+=m*(5*I),H+=Dt>>>13,Dt&=8191;var Lt=H;Lt+=s*I,Lt+=o*v,Lt+=a*_,Lt+=c*b,Lt+=u*w,H=Lt>>>13,Lt&=8191,Lt+=f*y,Lt+=h*g,Lt+=p*(5*R),Lt+=d*(5*A),Lt+=m*(5*x),H+=Lt>>>13,Lt&=8191;var Bt=H;Bt+=s*x,Bt+=o*I,Bt+=a*v,Bt+=c*_,Bt+=u*b,H=Bt>>>13,Bt&=8191,Bt+=f*w,Bt+=h*y,Bt+=p*g,Bt+=d*(5*R),Bt+=m*(5*A),H+=Bt>>>13,Bt&=8191;var Ut=H;Ut+=s*A,Ut+=o*x,Ut+=a*I,Ut+=c*v,Ut+=u*_,H=Ut>>>13,Ut&=8191,Ut+=f*b,Ut+=h*w,Ut+=p*y,Ut+=d*g,Ut+=m*(5*R),H+=Ut>>>13,Ut&=8191;var Mt=H;Mt+=s*R,Mt+=o*A,Mt+=a*x,Mt+=c*I,Mt+=u*v,H=Mt>>>13,Mt&=8191,Mt+=f*_,Mt+=h*b,Mt+=p*w,Mt+=d*y,Mt+=m*g,H+=Mt>>>13,Mt&=8191,H=(H<<2)+H|0,H=H+ve|0,ve=H&8191,H=H>>>13,St+=H,s=ve,o=St,a=nt,c=it,u=ct,f=Dt,h=Lt,p=Bt,d=Ut,m=Mt,t+=16,n-=16}this._h[0]=s,this._h[1]=o,this._h[2]=a,this._h[3]=c,this._h[4]=u,this._h[5]=f,this._h[6]=h,this._h[7]=p,this._h[8]=d,this._h[9]=m},r.prototype.finish=function(e,t){t===void 0&&(t=0);var n=new Uint16Array(10),i,s,o,a;if(this._leftover){for(a=this._leftover,this._buffer[a++]=1;a<16;a++)this._buffer[a]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(i=this._h[1]>>>13,this._h[1]&=8191,a=2;a<10;a++)this._h[a]+=i,i=this._h[a]>>>13,this._h[a]&=8191;for(this._h[0]+=i*5,i=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=i,i=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=i,n[0]=this._h[0]+5,i=n[0]>>>13,n[0]&=8191,a=1;a<10;a++)n[a]=this._h[a]+i,i=n[a]>>>13,n[a]&=8191;for(n[9]-=1<<13,s=(i^1)-1,a=0;a<10;a++)n[a]&=s;for(s=~s,a=0;a<10;a++)this._h[a]=this._h[a]&s|n[a];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,o=this._h[0]+this._pad[0],this._h[0]=o&65535,a=1;a<8;a++)o=(this._h[a]+this._pad[a]|0)+(o>>>16)|0,this._h[a]=o&65535;return e[t+0]=this._h[0]>>>0,e[t+1]=this._h[0]>>>8,e[t+2]=this._h[1]>>>0,e[t+3]=this._h[1]>>>8,e[t+4]=this._h[2]>>>0,e[t+5]=this._h[2]>>>8,e[t+6]=this._h[3]>>>0,e[t+7]=this._h[3]>>>8,e[t+8]=this._h[4]>>>0,e[t+9]=this._h[4]>>>8,e[t+10]=this._h[5]>>>0,e[t+11]=this._h[5]>>>8,e[t+12]=this._h[6]>>>0,e[t+13]=this._h[6]>>>8,e[t+14]=this._h[7]>>>0,e[t+15]=this._h[7]>>>8,this._finished=!0,this},r.prototype.update=function(e){var t=0,n=e.length,i;if(this._leftover){i=16-this._leftover,i>n&&(i=n);for(var s=0;s<i;s++)this._buffer[this._leftover+s]=e[t+s];if(n-=i,t+=i,this._leftover+=i,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(n>=16&&(i=n-n%16,this._blocks(e,t,i),t+=i,n-=i),n){for(var s=0;s<n;s++)this._buffer[this._leftover+s]=e[t+s];this._leftover+=n}return this},r.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var e=new Uint8Array(16);return this.finish(e),e},r.prototype.clean=function(){return x7.wipe(this._buffer),x7.wipe(this._r),x7.wipe(this._h),x7.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},r}();$l.Poly1305=ice;function pRe(r,e){var t=new ice(r);t.update(e);var n=t.digest();return t.clean(),n}$l.oneTimeAuth=pRe;function mRe(r,e){return r.length!==$l.DIGEST_LENGTH||e.length!==$l.DIGEST_LENGTH?!1:dRe.equal(r,e)}$l.equal=mRe});var gk=P(Hl=>{"use strict";l();Object.defineProperty(Hl,"__esModule",{value:!0});var A7=nce(),gRe=sce(),w3=mc(),oce=m3(),yRe=d7();Hl.KEY_LENGTH=32;Hl.NONCE_LENGTH=12;Hl.TAG_LENGTH=16;var ace=new Uint8Array(16),wRe=function(){function r(e){if(this.nonceLength=Hl.NONCE_LENGTH,this.tagLength=Hl.TAG_LENGTH,e.length!==Hl.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(e)}return r.prototype.seal=function(e,t,n,i){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var s=new Uint8Array(16);s.set(e,s.length-e.length);var o=new Uint8Array(32);A7.stream(this._key,s,o,4);var a=t.length+this.tagLength,c;if(i){if(i.length!==a)throw new Error("ChaCha20Poly1305: incorrect destination length");c=i}else c=new Uint8Array(a);return A7.streamXOR(this._key,s,t,c,4),this._authenticate(c.subarray(c.length-this.tagLength,c.length),o,c.subarray(0,c.length-this.tagLength),n),w3.wipe(s),c},r.prototype.open=function(e,t,n,i){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(t.length<this.tagLength)return null;var s=new Uint8Array(16);s.set(e,s.length-e.length);var o=new Uint8Array(32);A7.stream(this._key,s,o,4);var a=new Uint8Array(this.tagLength);if(this._authenticate(a,o,t.subarray(0,t.length-this.tagLength),n),!yRe.equal(a,t.subarray(t.length-this.tagLength,t.length)))return null;var c=t.length-this.tagLength,u;if(i){if(i.length!==c)throw new Error("ChaCha20Poly1305: incorrect destination length");u=i}else u=new Uint8Array(c);return A7.streamXOR(this._key,s,t.subarray(0,t.length-this.tagLength),u,4),w3.wipe(s),u},r.prototype.clean=function(){return w3.wipe(this._key),this},r.prototype._authenticate=function(e,t,n,i){var s=new gRe.Poly1305(t);i&&(s.update(i),i.length%16>0&&s.update(ace.subarray(i.length%16))),s.update(n),n.length%16>0&&s.update(ace.subarray(n.length%16));var o=new Uint8Array(8);i&&oce.writeUint64LE(i.length,o),s.update(o),oce.writeUint64LE(n.length,o),s.update(o);for(var a=s.digest(),c=0;c<a.length;c++)e[c]=a[c];s.clean(),w3.wipe(a),w3.wipe(o)},r}();Hl.ChaCha20Poly1305=wRe});var Nce=P((_nr,Oce)=>{l();Oce.exports=kce;var Pce=128,kRe=127,ORe=~kRe,NRe=Math.pow(2,31);function kce(r,e,t){e=e||[],t=t||0;for(var n=t;r>=NRe;)e[t++]=r&255|Pce,r/=128;for(;r&ORe;)e[t++]=r&255|Pce,r>>>=7;return e[t]=r|0,kce.bytes=t-n+1,e}});var Bce=P((Snr,Lce)=>{l();Lce.exports=Ak;var DRe=128,Dce=127;function Ak(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Ak.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Dce)<<i:(o&Dce)*Math.pow(2,i),i+=7}while(o>=DRe);return Ak.bytes=s-n,t}});var Mce=P((Anr,Uce)=>{l();var LRe=Math.pow(2,7),BRe=Math.pow(2,14),URe=Math.pow(2,21),MRe=Math.pow(2,28),FRe=Math.pow(2,35),VRe=Math.pow(2,42),zRe=Math.pow(2,49),KRe=Math.pow(2,56),qRe=Math.pow(2,63);Uce.exports=function(r){return r<LRe?1:r<BRe?2:r<URe?3:r<MRe?4:r<FRe?5:r<VRe?6:r<zRe?7:r<KRe?8:r<qRe?9:10}});var Vce=P((Inr,Fce)=>{l();Fce.exports={encode:Nce(),decode:Bce(),encodingLength:Mce()}});var qce=P((Cnr,Kce)=>{"use strict";l();var zce=Vce();Kce.exports=r=>{if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");let e=[];for(;r.length>0;){let t=zce.decode(r);e.push(t),r=r.slice(zce.decode.bytes)}return e}});var Gce=P((Bnr,Hce)=>{"use strict";l();Hce.exports=Wn;var I3=$f();function Wn(r,e){this.lo=r>>>0,this.hi=e>>>0}var ip=Wn.zero=new Wn(0,0);ip.toNumber=function(){return 0};ip.zzEncode=ip.zzDecode=function(){return this};ip.length=function(){return 1};var HRe=Wn.zeroHash="\0\0\0\0\0\0\0\0";Wn.fromNumber=function(e){if(e===0)return ip;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Wn(n,i)};Wn.from=function(e){if(typeof e=="number")return Wn.fromNumber(e);if(I3.isString(e))if(I3.Long)e=I3.Long.fromString(e);else return Wn.fromNumber(parseInt(e,10));return e.low||e.high?new Wn(e.low>>>0,e.high>>>0):ip};Wn.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};Wn.prototype.toLong=function(e){return I3.Long?new I3.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var qf=String.prototype.charCodeAt;Wn.fromHash=function(e){return e===HRe?ip:new Wn((qf.call(e,0)|qf.call(e,1)<<8|qf.call(e,2)<<16|qf.call(e,3)<<24)>>>0,(qf.call(e,4)|qf.call(e,5)<<8|qf.call(e,6)<<16|qf.call(e,7)<<24)>>>0)};Wn.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Wn.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Wn.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Wn.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var $f=P(Tk=>{"use strict";l();var Pe=Tk;Pe.asPromise=Xl();Pe.base64=Zl();Pe.EventEmitter=Jl();Pe.float=eu();Pe.inquire=tu();Pe.utf8=ru();Pe.pool=nu();Pe.LongBits=Gce();Pe.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);Pe.global=Pe.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||Tk;Pe.emptyArray=Object.freeze?Object.freeze([]):[];Pe.emptyObject=Object.freeze?Object.freeze({}):{};Pe.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Pe.isString=function(e){return typeof e=="string"||e instanceof String};Pe.isObject=function(e){return e&&typeof e=="object"};Pe.isset=Pe.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};Pe.Buffer=function(){try{var r=Pe.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();Pe._Buffer_from=null;Pe._Buffer_allocUnsafe=null;Pe.newBuffer=function(e){return typeof e=="number"?Pe.Buffer?Pe._Buffer_allocUnsafe(e):new Pe.Array(e):Pe.Buffer?Pe._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Pe.Array=typeof Uint8Array<"u"?Uint8Array:Array;Pe.Long=Pe.global.dcodeIO&&Pe.global.dcodeIO.Long||Pe.global.Long||Pe.inquire("long");Pe.key2Re=/^true|false|0|1$/;Pe.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Pe.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Pe.longToHash=function(e){return e?Pe.LongBits.from(e).toHash():Pe.LongBits.zeroHash};Pe.longFromHash=function(e,t){var n=Pe.LongBits.fromHash(e);return Pe.Long?Pe.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function jce(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}Pe.merge=jce;Pe.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Wce(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&jce(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Pe.newError=Wce;Pe.ProtocolError=Wce("ProtocolError");Pe.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Pe.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};Pe.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Pe._configure=function(){var r=Pe.Buffer;if(!r){Pe._Buffer_from=Pe._Buffer_allocUnsafe=null;return}Pe._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},Pe._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var Nk=P((Vnr,Zce)=>{"use strict";l();Zce.exports=Nt;var Eo=$f(),Ik,N7=Eo.LongBits,Yce=Eo.base64,Qce=Eo.utf8;function R3(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function Ck(){}function GRe(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function Nt(){this.len=0,this.head=new R3(Ck,0,0),this.tail=this.head,this.states=null}var Xce=function(){return Eo.Buffer?function(){return(Nt.create=function(){return new Ik})()}:function(){return new Nt}};Nt.create=Xce();Nt.alloc=function(e){return new Eo.Array(e)};Eo.Array!==Array&&(Nt.alloc=Eo.pool(Nt.alloc,Eo.Array.prototype.subarray));Nt.prototype._push=function(e,t,n){return this.tail=this.tail.next=new R3(e,t,n),this.len+=t,this};function Pk(r,e,t){e[t]=r&255}function jRe(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function kk(r,e){this.len=r,this.next=void 0,this.val=e}kk.prototype=Object.create(R3.prototype);kk.prototype.fn=jRe;Nt.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new kk((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Nt.prototype.int32=function(e){return e<0?this._push(Ok,10,N7.fromNumber(e)):this.uint32(e)};Nt.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Ok(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}Nt.prototype.uint64=function(e){var t=N7.from(e);return this._push(Ok,t.length(),t)};Nt.prototype.int64=Nt.prototype.uint64;Nt.prototype.sint64=function(e){var t=N7.from(e).zzEncode();return this._push(Ok,t.length(),t)};Nt.prototype.bool=function(e){return this._push(Pk,1,e?1:0)};function Rk(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}Nt.prototype.fixed32=function(e){return this._push(Rk,4,e>>>0)};Nt.prototype.sfixed32=Nt.prototype.fixed32;Nt.prototype.fixed64=function(e){var t=N7.from(e);return this._push(Rk,4,t.lo)._push(Rk,4,t.hi)};Nt.prototype.sfixed64=Nt.prototype.fixed64;Nt.prototype.float=function(e){return this._push(Eo.float.writeFloatLE,4,e)};Nt.prototype.double=function(e){return this._push(Eo.float.writeDoubleLE,8,e)};var WRe=Eo.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Nt.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Pk,1,0);if(Eo.isString(e)){var n=Nt.alloc(t=Yce.length(e));Yce.decode(e,n,0),e=n}return this.uint32(t)._push(WRe,t,e)};Nt.prototype.string=function(e){var t=Qce.length(e);return t?this.uint32(t)._push(Qce.write,t,e):this._push(Pk,1,0)};Nt.prototype.fork=function(){return this.states=new GRe(this),this.head=this.tail=new R3(Ck,0,0),this.len=0,this};Nt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new R3(Ck,0,0),this.len=0),this};Nt.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};Nt.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};Nt._configure=function(r){Ik=r,Nt.create=Xce(),Ik._configure()}});var tle=P((Knr,ele)=>{"use strict";l();ele.exports=wc;var Jce=Nk();(wc.prototype=Object.create(Jce.prototype)).constructor=wc;var Hf=$f();function wc(){Jce.call(this)}wc._configure=function(){wc.alloc=Hf._Buffer_allocUnsafe,wc.writeBytesBuffer=Hf.Buffer&&Hf.Buffer.prototype instanceof Uint8Array&&Hf.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};wc.prototype.bytes=function(e){Hf.isString(e)&&(e=Hf._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(wc.writeBytesBuffer,t,e),this};function YRe(r,e,t){r.length<40?Hf.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}wc.prototype.string=function(e){var t=Hf.Buffer.byteLength(e);return this.uint32(t),t&&this._push(YRe,t,e),this};wc._configure()});var Bk=P(($nr,ole)=>{"use strict";l();ole.exports=ln;var bc=$f(),Lk,ile=bc.LongBits,QRe=bc.utf8;function ia(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function ln(r){this.buf=r,this.pos=0,this.len=r.length}var rle=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new ln(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new ln(e);throw Error("illegal buffer")},sle=function(){return bc.Buffer?function(t){return(ln.create=function(i){return bc.Buffer.isBuffer(i)?new Lk(i):rle(i)})(t)}:rle};ln.create=sle();ln.prototype._slice=bc.Array.prototype.subarray||bc.Array.prototype.slice;ln.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,ia(this,10);return e}}();ln.prototype.int32=function(){return this.uint32()|0};ln.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Dk(){var r=new ile(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw ia(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw ia(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}ln.prototype.bool=function(){return this.uint32()!==0};function D7(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}ln.prototype.fixed32=function(){if(this.pos+4>this.len)throw ia(this,4);return D7(this.buf,this.pos+=4)};ln.prototype.sfixed32=function(){if(this.pos+4>this.len)throw ia(this,4);return D7(this.buf,this.pos+=4)|0};function nle(){if(this.pos+8>this.len)throw ia(this,8);return new ile(D7(this.buf,this.pos+=4),D7(this.buf,this.pos+=4))}ln.prototype.float=function(){if(this.pos+4>this.len)throw ia(this,4);var e=bc.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};ln.prototype.double=function(){if(this.pos+8>this.len)throw ia(this,4);var e=bc.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};ln.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw ia(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};ln.prototype.string=function(){var e=this.bytes();return QRe.read(e,0,e.length)};ln.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw ia(this,e);this.pos+=e}else do if(this.pos>=this.len)throw ia(this);while(this.buf[this.pos++]&128);return this};ln.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};ln._configure=function(r){Lk=r,ln.create=sle(),Lk._configure();var e=bc.Long?"toLong":"toNumber";bc.merge(ln.prototype,{int64:function(){return Dk.call(this)[e](!1)},uint64:function(){return Dk.call(this)[e](!0)},sint64:function(){return Dk.call(this).zzDecode()[e](!1)},fixed64:function(){return nle.call(this)[e](!0)},sfixed64:function(){return nle.call(this)[e](!1)}})}});var ule=P((Gnr,lle)=>{"use strict";l();lle.exports=sp;var cle=Bk();(sp.prototype=Object.create(cle.prototype)).constructor=sp;var ale=$f();function sp(r){cle.call(this,r)}sp._configure=function(){ale.Buffer&&(sp.prototype._slice=ale.Buffer.prototype.slice)};sp.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};sp._configure()});var hle=P((Wnr,fle)=>{"use strict";l();fle.exports=C3;var Uk=$f();(C3.prototype=Object.create(Uk.EventEmitter.prototype)).constructor=C3;function C3(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");Uk.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(t)}C3.prototype.rpcCall=function r(e,t,n,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return Uk.asPromise(r,o,e,t,n,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(c,u){if(c)return o.emit("error",c,e),s(c);if(u===null){o.end(!0);return}if(!(u instanceof n))try{u=n[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(f){return o.emit("error",f,e),s(f)}return o.emit("data",u,e),s(null,u)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};C3.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var ple=P(dle=>{"use strict";l();var XRe=dle;XRe.Service=hle()});var gle=P((Znr,mle)=>{"use strict";l();mle.exports={}});var ble=P(wle=>{"use strict";l();var rs=wle;rs.build="minimal";rs.Writer=Nk();rs.BufferWriter=tle();rs.Reader=Bk();rs.BufferReader=ule();rs.util=$f();rs.rpc=ple();rs.roots=gle();rs.configure=yle;function yle(){rs.util._configure(),rs.Writer._configure(rs.BufferWriter),rs.Reader._configure(rs.BufferReader)}yle()});var _le=P((rir,Ele)=>{"use strict";l();Ele.exports=ble()});var Ble=P((Dle,Lle)=>{"use strict";l();var lCe=Math.exp;Dle=Lle.exports=function(e){if(typeof e!="number")throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let t,n=0,i=0,s=0,o,a={};function c(u,f){return 1-lCe(-(u-f)/e)}return a.push=function(f,h){if(o){let p=c(f,o),d=h-t,m=p*d;t=p*h+(1-p)*t,n=(1-p)*(n+d*m),i=Math.sqrt(n),s=t+p*d}else t=h;o=f},a.movingAverage=function(){return t},a.variance=function(){return n},a.deviation=function(){return i},a.forecast=function(){return s},a}});var SCe={};jt(SCe,{create:()=>bCe,globSource:()=>ECe,path:()=>vCe,urlSource:()=>_Ce});l();l();l();l();var TO=S(u_(),1),Ve=TO.default;var tue=S(K3(),1);l();var Fs=S(Us(),1);var E_={};jt(E_,{base58btc:()=>le,base58flickr:()=>Ofe});l();l();l();function xfe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function h(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var g=0,y=0,w=0,b=m.length;w!==b&&m[w]===0;)w++,g++;for(var _=(b-w)*f+1>>>0,v=new Uint8Array(_);w!==b;){for(var I=m[w],x=0,A=_-1;(I!==0||x<y)&&A!==-1;A--,x++)I+=256*v[A]>>>0,v[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");y=x,w++}for(var R=_-y;R!==_&&v[R]===0;)R++;for(var O=c.repeat(g);R<_;++R)O+=r.charAt(v[R]);return O}function p(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var g=0;if(m[g]!==" "){for(var y=0,w=0;m[g]===c;)y++,g++;for(var b=(m.length-g)*u+1>>>0,_=new Uint8Array(b);m[g];){var v=t[m.charCodeAt(g)];if(v===255)return;for(var I=0,x=b-1;(v!==0||I<w)&&x!==-1;x--,I++)v+=a*_[x]>>>0,_[x]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");w=I,g++}if(m[g]!==" "){for(var A=b-w;A!==b&&_[A]===0;)A++;for(var R=new Uint8Array(y+(b-A)),O=y;A!==b;)R[O++]=_[A++];return R}}}function d(m){var g=p(m);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:d}}var Afe=xfe,Tfe=Afe,OO=Tfe;var Zf={};jt(Zf,{coerce:()=>Ms,empty:()=>NO,equals:()=>d_,fromHex:()=>Rfe,fromString:()=>p_,isBinary:()=>Cfe,toHex:()=>Ife,toString:()=>m_});l();var NO=new Uint8Array(0),Ife=r=>r.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),Rfe=r=>{let e=r.match(/../g);return e?new Uint8Array(e.map(t=>parseInt(t,16))):NO},d_=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},Ms=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Cfe=r=>r instanceof ArrayBuffer||ArrayBuffer.isView(r),p_=r=>new TextEncoder().encode(r),m_=r=>new TextDecoder().decode(r);l();var g_=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},y_=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return DO(this,e)}},w_=class{constructor(e){this.decoders=e}or(e){return DO(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},DO=(r,e)=>new w_({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),b_=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new g_(e,t,n),this.decoder=new y_(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},wp=({name:r,prefix:e,encode:t,decode:n})=>new b_(r,e,t,n),Yl=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:i}=OO(t,e);return wp({prefix:r,name:e,encode:n,decode:s=>Ms(i(s))})},Pfe=(r,e,t,n)=>{let i={};for(let f=0;f<e.length;++f)i[e[f]]=f;let s=r.length;for(;r[s-1]==="=";)--s;let o=new Uint8Array(s*t/8|0),a=0,c=0,u=0;for(let f=0;f<s;++f){let h=i[r[f]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},kfe=(r,e,t)=>{let n=e[e.length-1]==="=",i=(1<<t)-1,s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s},Kr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>wp({prefix:e,name:r,encode(i){return kfe(i,n,t)},decode(i){return Pfe(i,n,t,r)}});var le=Yl({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ofe=Yl({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var S_={};jt(S_,{base32:()=>De,base32hex:()=>Dfe,base32hexpad:()=>Bfe,base32hexpadupper:()=>Ufe,base32hexupper:()=>Lfe,base32pad:()=>v_,base32padupper:()=>Nfe,base32upper:()=>__,base32z:()=>Mfe});l();var De=Kr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),__=Kr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),v_=Kr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Nfe=Kr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Dfe=Kr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Lfe=Kr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Bfe=Kr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ufe=Kr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Mfe=Kr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var x_={};jt(x_,{base64:()=>fa,base64pad:()=>Ffe,base64url:()=>Ql,base64urlpad:()=>Vfe});l();var fa=Kr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ffe=Kr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ql=Kr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Vfe=Kr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});Fs.default.formatters.b=r=>r==null?"undefined":le.baseEncode(r);Fs.default.formatters.t=r=>r==null?"undefined":De.baseEncode(r);Fs.default.formatters.m=r=>r==null?"undefined":fa.baseEncode(r);Fs.default.formatters.p=r=>r==null?"undefined":r.toString();Fs.default.formatters.c=r=>r==null?"undefined":r.toString();Fs.default.formatters.k=r=>r==null?"undefined":r.toString();function zfe(r){let e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function k(r){let e=zfe(`${r}:trace`);return Fs.default.enabled(`${r}:trace`)&&Fs.default.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=(0,Fs.default)(`${r}:trace`)),Object.assign((0,Fs.default)(r),{error:(0,Fs.default)(`${r}:error`),trace:e})}var Y7=S(W(),1);l();var Y3=S(W(),1);l();var xc=S(TN(),1),Ep=xc.default.Reader,M_=xc.default.Writer,Be=xc.default.util,Yn=xc.default.roots["ipfs-unixfs"]||(xc.default.roots["ipfs-unixfs"]={}),IN=Yn.Data=(()=>{function r(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.Type=0,r.prototype.Data=Be.newBuffer([]),r.prototype.filesize=Be.Long?Be.Long.fromBits(0,0,!0):0,r.prototype.blocksizes=Be.emptyArray,r.prototype.hashType=Be.Long?Be.Long.fromBits(0,0,!0):0,r.prototype.fanout=Be.Long?Be.Long.fromBits(0,0,!0):0,r.prototype.mode=0,r.prototype.mtime=null,r.encode=function(t,n){if(n||(n=M_.create()),n.uint32(8).int32(t.Type),t.Data!=null&&Object.hasOwnProperty.call(t,"Data")&&n.uint32(18).bytes(t.Data),t.filesize!=null&&Object.hasOwnProperty.call(t,"filesize")&&n.uint32(24).uint64(t.filesize),t.blocksizes!=null&&t.blocksizes.length)for(var i=0;i<t.blocksizes.length;++i)n.uint32(32).uint64(t.blocksizes[i]);return t.hashType!=null&&Object.hasOwnProperty.call(t,"hashType")&&n.uint32(40).uint64(t.hashType),t.fanout!=null&&Object.hasOwnProperty.call(t,"fanout")&&n.uint32(48).uint64(t.fanout),t.mode!=null&&Object.hasOwnProperty.call(t,"mode")&&n.uint32(56).uint32(t.mode),t.mtime!=null&&Object.hasOwnProperty.call(t,"mtime")&&Yn.UnixTime.encode(t.mtime,n.uint32(66).fork()).ldelim(),n},r.decode=function(t,n){t instanceof Ep||(t=Ep.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new Yn.Data;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.Type=t.int32();break;case 2:s.Data=t.bytes();break;case 3:s.filesize=t.uint64();break;case 4:if(s.blocksizes&&s.blocksizes.length||(s.blocksizes=[]),(o&7)===2)for(var a=t.uint32()+t.pos;t.pos<a;)s.blocksizes.push(t.uint64());else s.blocksizes.push(t.uint64());break;case 5:s.hashType=t.uint64();break;case 6:s.fanout=t.uint64();break;case 7:s.mode=t.uint32();break;case 8:s.mtime=Yn.UnixTime.decode(t,t.uint32());break;default:t.skipType(o&7);break}}if(!s.hasOwnProperty("Type"))throw Be.ProtocolError("missing required 'Type'",{instance:s});return s},r.fromObject=function(t){if(t instanceof Yn.Data)return t;var n=new Yn.Data;switch(t.Type){case"Raw":case 0:n.Type=0;break;case"Directory":case 1:n.Type=1;break;case"File":case 2:n.Type=2;break;case"Metadata":case 3:n.Type=3;break;case"Symlink":case 4:n.Type=4;break;case"HAMTShard":case 5:n.Type=5;break}if(t.Data!=null&&(typeof t.Data=="string"?Be.base64.decode(t.Data,n.Data=Be.newBuffer(Be.base64.length(t.Data)),0):t.Data.length&&(n.Data=t.Data)),t.filesize!=null&&(Be.Long?(n.filesize=Be.Long.fromValue(t.filesize)).unsigned=!0:typeof t.filesize=="string"?n.filesize=parseInt(t.filesize,10):typeof t.filesize=="number"?n.filesize=t.filesize:typeof t.filesize=="object"&&(n.filesize=new Be.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0))),t.blocksizes){if(!Array.isArray(t.blocksizes))throw TypeError(".Data.blocksizes: array expected");n.blocksizes=[];for(var i=0;i<t.blocksizes.length;++i)Be.Long?(n.blocksizes[i]=Be.Long.fromValue(t.blocksizes[i])).unsigned=!0:typeof t.blocksizes[i]=="string"?n.blocksizes[i]=parseInt(t.blocksizes[i],10):typeof t.blocksizes[i]=="number"?n.blocksizes[i]=t.blocksizes[i]:typeof t.blocksizes[i]=="object"&&(n.blocksizes[i]=new Be.LongBits(t.blocksizes[i].low>>>0,t.blocksizes[i].high>>>0).toNumber(!0))}if(t.hashType!=null&&(Be.Long?(n.hashType=Be.Long.fromValue(t.hashType)).unsigned=!0:typeof t.hashType=="string"?n.hashType=parseInt(t.hashType,10):typeof t.hashType=="number"?n.hashType=t.hashType:typeof t.hashType=="object"&&(n.hashType=new Be.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0))),t.fanout!=null&&(Be.Long?(n.fanout=Be.Long.fromValue(t.fanout)).unsigned=!0:typeof t.fanout=="string"?n.fanout=parseInt(t.fanout,10):typeof t.fanout=="number"?n.fanout=t.fanout:typeof t.fanout=="object"&&(n.fanout=new Be.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0))),t.mode!=null&&(n.mode=t.mode>>>0),t.mtime!=null){if(typeof t.mtime!="object")throw TypeError(".Data.mtime: object expected");n.mtime=Yn.UnixTime.fromObject(t.mtime)}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.blocksizes=[]),n.defaults){if(i.Type=n.enums===String?"Raw":0,n.bytes===String?i.Data="":(i.Data=[],n.bytes!==Array&&(i.Data=Be.newBuffer(i.Data))),Be.Long){var s=new Be.Long(0,0,!0);i.filesize=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else i.filesize=n.longs===String?"0":0;if(Be.Long){var s=new Be.Long(0,0,!0);i.hashType=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else i.hashType=n.longs===String?"0":0;if(Be.Long){var s=new Be.Long(0,0,!0);i.fanout=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else i.fanout=n.longs===String?"0":0;i.mode=0,i.mtime=null}if(t.Type!=null&&t.hasOwnProperty("Type")&&(i.Type=n.enums===String?Yn.Data.DataType[t.Type]:t.Type),t.Data!=null&&t.hasOwnProperty("Data")&&(i.Data=n.bytes===String?Be.base64.encode(t.Data,0,t.Data.length):n.bytes===Array?Array.prototype.slice.call(t.Data):t.Data),t.filesize!=null&&t.hasOwnProperty("filesize")&&(typeof t.filesize=="number"?i.filesize=n.longs===String?String(t.filesize):t.filesize:i.filesize=n.longs===String?Be.Long.prototype.toString.call(t.filesize):n.longs===Number?new Be.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0):t.filesize),t.blocksizes&&t.blocksizes.length){i.blocksizes=[];for(var o=0;o<t.blocksizes.length;++o)typeof t.blocksizes[o]=="number"?i.blocksizes[o]=n.longs===String?String(t.blocksizes[o]):t.blocksizes[o]:i.blocksizes[o]=n.longs===String?Be.Long.prototype.toString.call(t.blocksizes[o]):n.longs===Number?new Be.LongBits(t.blocksizes[o].low>>>0,t.blocksizes[o].high>>>0).toNumber(!0):t.blocksizes[o]}return t.hashType!=null&&t.hasOwnProperty("hashType")&&(typeof t.hashType=="number"?i.hashType=n.longs===String?String(t.hashType):t.hashType:i.hashType=n.longs===String?Be.Long.prototype.toString.call(t.hashType):n.longs===Number?new Be.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0):t.hashType),t.fanout!=null&&t.hasOwnProperty("fanout")&&(typeof t.fanout=="number"?i.fanout=n.longs===String?String(t.fanout):t.fanout:i.fanout=n.longs===String?Be.Long.prototype.toString.call(t.fanout):n.longs===Number?new Be.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0):t.fanout),t.mode!=null&&t.hasOwnProperty("mode")&&(i.mode=t.mode),t.mtime!=null&&t.hasOwnProperty("mtime")&&(i.mtime=Yn.UnixTime.toObject(t.mtime,n)),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,xc.default.util.toJSONOptions)},r.DataType=function(){let e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),r})(),JPe=Yn.UnixTime=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.Seconds=Be.Long?Be.Long.fromBits(0,0,!1):0,r.prototype.FractionalNanoseconds=0,r.encode=function(t,n){return n||(n=M_.create()),n.uint32(8).int64(t.Seconds),t.FractionalNanoseconds!=null&&Object.hasOwnProperty.call(t,"FractionalNanoseconds")&&n.uint32(21).fixed32(t.FractionalNanoseconds),n},r.decode=function(t,n){t instanceof Ep||(t=Ep.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new Yn.UnixTime;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.Seconds=t.int64();break;case 2:s.FractionalNanoseconds=t.fixed32();break;default:t.skipType(o&7);break}}if(!s.hasOwnProperty("Seconds"))throw Be.ProtocolError("missing required 'Seconds'",{instance:s});return s},r.fromObject=function(t){if(t instanceof Yn.UnixTime)return t;var n=new Yn.UnixTime;return t.Seconds!=null&&(Be.Long?(n.Seconds=Be.Long.fromValue(t.Seconds)).unsigned=!1:typeof t.Seconds=="string"?n.Seconds=parseInt(t.Seconds,10):typeof t.Seconds=="number"?n.Seconds=t.Seconds:typeof t.Seconds=="object"&&(n.Seconds=new Be.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber())),t.FractionalNanoseconds!=null&&(n.FractionalNanoseconds=t.FractionalNanoseconds>>>0),n},r.toObject=function(t,n){n||(n={});var i={};if(n.defaults){if(Be.Long){var s=new Be.Long(0,0,!1);i.Seconds=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else i.Seconds=n.longs===String?"0":0;i.FractionalNanoseconds=0}return t.Seconds!=null&&t.hasOwnProperty("Seconds")&&(typeof t.Seconds=="number"?i.Seconds=n.longs===String?String(t.Seconds):t.Seconds:i.Seconds=n.longs===String?Be.Long.prototype.toString.call(t.Seconds):n.longs===Number?new Be.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber():t.Seconds),t.FractionalNanoseconds!=null&&t.hasOwnProperty("FractionalNanoseconds")&&(i.FractionalNanoseconds=t.FractionalNanoseconds),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,xc.default.util.toJSONOptions)},r})(),eke=Yn.Metadata=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.MimeType="",r.encode=function(t,n){return n||(n=M_.create()),t.MimeType!=null&&Object.hasOwnProperty.call(t,"MimeType")&&n.uint32(10).string(t.MimeType),n},r.decode=function(t,n){t instanceof Ep||(t=Ep.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new Yn.Metadata;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.MimeType=t.string();break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof Yn.Metadata)return t;var n=new Yn.Metadata;return t.MimeType!=null&&(n.MimeType=String(t.MimeType)),n},r.toObject=function(t,n){n||(n={});var i={};return n.defaults&&(i.MimeType=""),t.MimeType!=null&&t.hasOwnProperty("MimeType")&&(i.MimeType=t.MimeType),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,xc.default.util.toJSONOptions)},r})();var Ac=IN,RN=["raw","directory","file","metadata","symlink","hamt-sharded-directory"],Jfe=["directory","hamt-sharded-directory"],CN=parseInt("0644",8),PN=parseInt("0755",8);function Tc(r){if(r!=null)return typeof r=="number"?r&4095:(r=r.toString(),r.substring(0,1)==="0"?parseInt(r,8)&4095:parseInt(r,10)&4095)}function au(r){if(r==null)return;let e;if(r.secs!=null&&(e={secs:r.secs,nsecs:r.nsecs}),r.Seconds!=null&&(e={secs:r.Seconds,nsecs:r.FractionalNanoseconds}),Array.isArray(r)&&(e={secs:r[0],nsecs:r[1]}),r instanceof Date){let t=r.getTime(),n=Math.floor(t/1e3);e={secs:n,nsecs:(t-n*1e3)*1e3}}if(Object.prototype.hasOwnProperty.call(e,"secs")){if(e!=null&&e.nsecs!=null&&(e.nsecs<0||e.nsecs>999999999))throw(0,Y3.default)(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return e}}var Ke=class{static unmarshal(e){let t=Ac.decode(e),n=Ac.toObject(t,{defaults:!1,arrays:!0,longs:Number,objects:!1}),i=new Ke({type:RN[n.Type],data:n.Data,blockSizes:n.blocksizes,mode:n.mode,mtime:n.mtime?{secs:n.mtime.Seconds,nsecs:n.mtime.FractionalNanoseconds}:void 0});return i._originalMode=n.mode||0,i}constructor(e={type:"file"}){let{type:t,data:n,blockSizes:i,hashType:s,fanout:o,mtime:a,mode:c}=e;if(t&&!RN.includes(t))throw(0,Y3.default)(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t||"file",this.data=n,this.hashType=s,this.fanout=o,this.blockSizes=i||[],this._originalMode=0,this.mode=Tc(c),a&&(this.mtime=au(a),this.mtime&&!this.mtime.nsecs&&(this.mtime.nsecs=0))}set mode(e){this._mode=this.isDirectory()?PN:CN;let t=Tc(e);t!==void 0&&(this._mode=t)}get mode(){return this._mode}isDirectory(){return Boolean(this.type&&Jfe.includes(this.type))}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0;let e=0;return this.blockSizes.forEach(t=>{e+=t}),this.data&&(e+=this.data.length),e}marshal(){let e;switch(this.type){case"raw":e=Ac.DataType.Raw;break;case"directory":e=Ac.DataType.Directory;break;case"file":e=Ac.DataType.File;break;case"metadata":e=Ac.DataType.Metadata;break;case"symlink":e=Ac.DataType.Symlink;break;case"hamt-sharded-directory":e=Ac.DataType.HAMTShard;break;default:throw(0,Y3.default)(new Error("Type: "+e+" is not valid"),"ERR_INVALID_TYPE")}let t=this.data;(!this.data||!this.data.length)&&(t=void 0);let n;this.mode!=null&&(n=this._originalMode&4294963200|(Tc(this.mode)||0),n===CN&&!this.isDirectory()&&(n=void 0),n===PN&&this.isDirectory()&&(n=void 0));let i;if(this.mtime!=null){let o=au(this.mtime);o&&(i={Seconds:o.secs,FractionalNanoseconds:o.nsecs},i.FractionalNanoseconds===0&&delete i.FractionalNanoseconds)}let s={Type:e,Data:t,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:n,mtime:i};return Ac.encode(s).finish()}};var ut={};jt(ut,{code:()=>We,createLink:()=>jN,createNode:()=>GN,decode:()=>lt,encode:()=>ze,name:()=>Nhe,prepare:()=>Pn,validate:()=>q_});l();l();l();l();var ehe=NN,kN=128,the=127,rhe=~the,nhe=Math.pow(2,31);function NN(r,e,t){e=e||[],t=t||0;for(var n=t;r>=nhe;)e[t++]=r&255|kN,r/=128;for(;r&rhe;)e[t++]=r&255|kN,r>>>=7;return e[t]=r|0,NN.bytes=t-n+1,e}var ihe=F_,she=128,ON=127;function F_(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw F_.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&ON)<<i:(o&ON)*Math.pow(2,i),i+=7}while(o>=she);return F_.bytes=s-n,t}var ohe=Math.pow(2,7),ahe=Math.pow(2,14),che=Math.pow(2,21),lhe=Math.pow(2,28),uhe=Math.pow(2,35),fhe=Math.pow(2,42),hhe=Math.pow(2,49),dhe=Math.pow(2,56),phe=Math.pow(2,63),mhe=function(r){return r<ohe?1:r<ahe?2:r<che?3:r<lhe?4:r<uhe?5:r<fhe?6:r<hhe?7:r<dhe?8:r<phe?9:10},ghe={encode:ehe,decode:ihe,encodingLength:mhe},yhe=ghe,bm=yhe;var Em=(r,e=0)=>[bm.decode(r,e),bm.decode.bytes],_p=(r,e,t=0)=>(bm.encode(r,e,t),e),vp=r=>bm.encodingLength(r);l();var pa=(r,e)=>{let t=e.byteLength,n=vp(r),i=n+vp(t),s=new Uint8Array(i+t);return _p(r,s,0),_p(t,s,n),s.set(e,i),new Sp(r,t,e,s)},Ze=r=>{let e=Ms(r),[t,n]=Em(e),[i,s]=Em(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Sp(t,i,o,e)},DN=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&d_(r.bytes,t.bytes)}},Sp=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};l();var LN=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return bhe(t,V_(r),e||le.encoder);default:return Ehe(t,V_(r),e||De.encoder)}};var BN=new WeakMap,V_=r=>{let e=BN.get(r);if(e==null){let t=new Map;return BN.set(r,t),t}return e},T=class{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==_m)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==_he)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return T.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=pa(e,t);return T.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return T.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&DN(e.multihash,n.multihash)}toString(e){return LN(this,e)}toJSON(){return{"/":LN(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof T)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:i,multihash:s,bytes:o}=t;return new T(n,i,s,o||UN(n,i,s.bytes))}else if(t[vhe]===!0){let{version:n,multihash:i,code:s}=t,o=Ze(i);return T.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==_m)throw new Error(`Version 0 CID must use dag-pb (code: ${_m}) block encoding`);return new T(e,t,n,n.bytes)}case 1:{let i=UN(e,t,n.bytes);return new T(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return T.create(0,_m,e)}static createV1(e,t){return T.create(1,e,t)}static decode(e){let[t,n]=T.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=T.inspectBytes(e),n=t.size-t.multihashSize,i=Ms(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");let s=i.subarray(t.multihashSize-t.digestSize),o=new Sp(t.multihashCode,t.digestSize,s,i);return[t.version===0?T.createV0(o):T.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[h,p]=Em(e.subarray(t));return t+=p,h},i=n(),s=_m;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let o=t,a=n(),c=n(),u=t+c,f=u-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:f,size:u}}static parse(e,t){let[n,i]=whe(e,t),s=T.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return V_(s).set(n,e),s}},whe=(r,e)=>{switch(r[0]){case"Q":{let t=e||le;return[le.prefix,t.decode(`${le.prefix}${r}`)]}case le.prefix:{let t=e||le;return[le.prefix,t.decode(r)]}case De.prefix:{let t=e||De;return[De.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},bhe=(r,e,t)=>{let{prefix:n}=t;if(n!==le.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let i=e.get(n);if(i==null){let s=t.encode(r).slice(1);return e.set(n,s),s}else return i},Ehe=(r,e,t)=>{let{prefix:n}=t,i=e.get(n);if(i==null){let s=t.encode(r);return e.set(n,s),s}else return i},_m=112,_he=18,UN=(r,e,t)=>{let n=vp(r),i=n+vp(e),s=new Uint8Array(i+t.byteLength);return _p(r,s,0),_p(e,s,n),s.set(t,i),s},vhe=Symbol.for("@ipld/js-cid/CID");l();var She=new TextDecoder;function z_(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");let i=r[e++];if(t+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[t,e]}function X3(r,e){let t;[t,e]=z_(r,e);let n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function MN(r,e){let t;return[t,e]=z_(r,e),[t&7,t>>3,e]}function xhe(r){let e={},t=r.length,n=0;for(;n<t;){let i,s;if([i,s,n]=MN(r,n),s===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=X3(r,n)}else if(s===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=X3(r,n),e.Name=She.decode(o)}else if(s===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[e.Tsize,n]=z_(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function FN(r){let e=r.length,t=0,n,i=!1,s;for(;t<e;){let a,c;if([a,c,t]=MN(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(s)throw new Error("protobuf: (PBNode) duplicate Data section");[s,t]=X3(r,t),n&&(i=!0)}else if(c===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let u;[u,t]=X3(r,t),n.push(xhe(u))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");let o={};return s&&(o.Data=s),o.Links=n||[],o}l();var zN=new TextEncoder,VN=2**32,Ahe=2**31;function The(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=vm(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){let n=zN.encode(r.Name);t-=n.length,e.set(n,t),t=vm(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=vm(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function KN(r){let e=Rhe(r),t=new Uint8Array(e),n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=vm(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let i=r.Links.length-1;i>=0;i--){let s=The(r.Links[i],t.subarray(0,n));n-=s,n=vm(t,n,s)-1,t[n]=18}return t}function Ihe(r){let e=0;if(r.Hash){let t=r.Hash.length;e+=1+t+xp(t)}if(typeof r.Name=="string"){let t=zN.encode(r.Name).length;e+=1+t+xp(t)}return typeof r.Tsize=="number"&&(e+=1+xp(r.Tsize)),e}function Rhe(r){let e=0;if(r.Data){let t=r.Data.length;e+=1+t+xp(t)}if(r.Links)for(let t of r.Links){let n=Ihe(t);e+=1+n+xp(n)}return e}function vm(r,e,t){e-=xp(t);let n=e;for(;t>=Ahe;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function xp(r){return r%2===0&&r++,Math.floor((Che(r)+6)/7)}function Che(r){let e=0;return r>=VN&&(r=Math.floor(r/VN),e=32),r>=1<<16&&(r>>>=16,e+=16),r>=1<<8&&(r>>>=8,e+=8),e+Phe[r]}var Phe=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];l();var khe=["Data","Links"],Ohe=["Hash","Name","Tsize"],K_=new TextEncoder;function $N(r,e){if(r===e)return 0;let t=r.Name?K_.encode(r.Name):[],n=e.Name?K_.encode(e.Name):[],i=t.length,s=n.length;for(let o=0,a=Math.min(i,s);o<a;++o)if(t[o]!==n[o]){i=t[o],s=n[o];break}return i<s?-1:s<i?1:0}function qN(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function HN(r){if(typeof r.asCID=="object"){let t=T.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let e={};if(r.Hash){let t=T.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=T.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=T.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function Pn(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=K_.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(HN),e.Links.sort($N);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function q_(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!qN(r,khe))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){let t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!qN(t,Ohe))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&$N(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function GN(r,e=[]){return Pn({Data:r,Links:e})}function jN(r,e,t){return HN({Hash:t,Name:r,Tsize:e})}var Nhe="dag-pb",We=112;function ze(r){q_(r);let e={};return r.Links&&(e.Links=r.Links.map(t=>{let n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),KN(e)}function lt(r){let e=FN(r),t={};return e.Data&&(t.Data=e.Data),e.Links&&(t.Links=e.Links.map(n=>{let i={};try{i.Hash=T.decode(n.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return n.Name!==void 0&&(i.Name=n.Name),n.Tsize!==void 0&&(i.Tsize=n.Tsize),i})),t}var Cc={};jt(Cc,{code:()=>Pm,decode:()=>rh,encode:()=>km,name:()=>hde});l();l();l();l();var Dhe=["string","number","bigint","symbol"],Lhe=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function WN(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";let e=typeof r;if(Dhe.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(Bhe(r))return"Buffer";let t=Uhe(r);return t||"Object"}function Bhe(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function Uhe(r){let e=Object.prototype.toString.call(r).slice(8,-1);if(Lhe.includes(e))return e}l();var M=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};M.uint=new M(0,"uint",!0);M.negint=new M(1,"negint",!0);M.bytes=new M(2,"bytes",!0);M.string=new M(3,"string",!0);M.array=new M(4,"array",!1);M.map=new M(5,"map",!1);M.tag=new M(6,"tag",!1);M.float=new M(7,"float",!0);M.false=new M(7,"false",!0);M.true=new M(7,"true",!0);M.null=new M(7,"null",!0);M.undefined=new M(7,"undefined",!0);M.break=new M(7,"break",!0);var ee=class{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};l();l();var Ap=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",Mhe=new TextDecoder,Fhe=new TextEncoder;function Z3(r){return Ap&&globalThis.Buffer.isBuffer(r)}function Sm(r){return r instanceof Uint8Array?Z3(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}var ZN=Ap?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):QN(r,e,t):(r,e,t)=>t-e>64?Mhe.decode(r.subarray(e,t)):QN(r,e,t),J3=Ap?r=>r.length>64?globalThis.Buffer.from(r):YN(r):r=>r.length>64?Fhe.encode(r):YN(r),ma=r=>Uint8Array.from(r),Tp=Ap?(r,e,t)=>Z3(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),JN=Ap?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),Sm(globalThis.Buffer.concat(r,e))):(r,e)=>{let t=new Uint8Array(e),n=0;for(let i of r)n+i.length>t.length&&(i=i.subarray(0,t.length-n)),t.set(i,n),n+=i.length;return t},eD=Ap?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function tD(r,e){if(Z3(r)&&Z3(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function YN(r,e=1/0){let t,n=r.length,i=null,s=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function QN(r,e,t){let n=[];for(;e<t;){let i=r[e],s=null,o=i>239?4:i>223?3:i>191?2:1;if(e+o<=t){let a,c,u,f;switch(o){case 1:i<128&&(s=i);break;case 2:a=r[e+1],(a&192)===128&&(f=(i&31)<<6|a&63,f>127&&(s=f));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(f=(i&15)<<12|(a&63)<<6|c&63,f>2047&&(f<55296||f>57343)&&(s=f));break;case 4:a=r[e+1],c=r[e+2],u=r[e+3],(a&192)===128&&(c&192)===128&&(u&192)===128&&(f=(i&15)<<18|(a&63)<<12|(c&63)<<6|u&63,f>65535&&f<1114112&&(s=f))}}s===null?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),e+=o}return $_(n)}var XN=4096;function $_(r){let e=r.length;if(e<=XN)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=XN));return t}var Vhe=256,xm=class{constructor(e=Vhe){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){let i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=eD(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=Tp(n,0,this.cursor)}else t=JN(this.chunks,this.cursor);return e&&this.reset(),t}};l();var we="CBOR decode error:",Ic="CBOR encode error:",Am=[];Am[23]=1;Am[24]=2;Am[25]=3;Am[26]=5;Am[27]=9;function Rc(r,e,t){if(r.length-e<t)throw new Error(`${we} not enough data for type`)}l();l();var kn=[24,256,65536,4294967296,BigInt("18446744073709551616")];function is(r,e,t){Rc(r,e,1);let n=r[e];if(t.strict===!0&&n<kn[0])throw new Error(`${we} integer encoded in more bytes than necessary (strict decode)`);return n}function ss(r,e,t){Rc(r,e,2);let n=r[e]<<8|r[e+1];if(t.strict===!0&&n<kn[1])throw new Error(`${we} integer encoded in more bytes than necessary (strict decode)`);return n}function os(r,e,t){Rc(r,e,4);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<kn[2])throw new Error(`${we} integer encoded in more bytes than necessary (strict decode)`);return n}function as(r,e,t){Rc(r,e,8);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],i=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(t.strict===!0&&s<kn[3])throw new Error(`${we} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(t.allowBigInt===!0)return s;throw new Error(`${we} integers outside of the safe integer range are not supported`)}function rD(r,e,t,n){return new ee(M.uint,is(r,e+1,n),2)}function nD(r,e,t,n){return new ee(M.uint,ss(r,e+1,n),3)}function iD(r,e,t,n){return new ee(M.uint,os(r,e+1,n),5)}function sD(r,e,t,n){return new ee(M.uint,as(r,e+1,n),9)}function zs(r,e){return Qn(r,0,e.value)}function Qn(r,e,t){if(t<kn[0]){let n=Number(t);r.push([e|n])}else if(t<kn[1]){let n=Number(t);r.push([e|24,n])}else if(t<kn[2]){let n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<kn[3]){let n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(t);if(n<kn[4]){let i=[e|27,0,0,0,0,0,0,0],s=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=s&255,s=s>>8,i[7]=s&255,s=s>>8,i[6]=s&255,s=s>>8,i[5]=s&255,i[4]=o&255,o=o>>8,i[3]=o&255,o=o>>8,i[2]=o&255,o=o>>8,i[1]=o&255,r.push(i)}else throw new Error(`${we} encountered BigInt larger than allowable range`)}}zs.encodedSize=function(e){return Qn.encodedSize(e.value)};Qn.encodedSize=function(e){return e<kn[0]?1:e<kn[1]?2:e<kn[2]?3:e<kn[3]?5:9};zs.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};l();function oD(r,e,t,n){return new ee(M.negint,-1-is(r,e+1,n),2)}function aD(r,e,t,n){return new ee(M.negint,-1-ss(r,e+1,n),3)}function cD(r,e,t,n){return new ee(M.negint,-1-os(r,e+1,n),5)}var H_=BigInt(-1),lD=BigInt(1);function uD(r,e,t,n){let i=as(r,e+1,n);if(typeof i!="bigint"){let s=-1-i;if(s>=Number.MIN_SAFE_INTEGER)return new ee(M.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${we} integers outside of the safe integer range are not supported`);return new ee(M.negint,H_-BigInt(i),9)}function e4(r,e){let t=e.value,n=typeof t=="bigint"?t*H_-lD:t*-1-1;Qn(r,e.type.majorEncoded,n)}e4.encodedSize=function(e){let t=e.value,n=typeof t=="bigint"?t*H_-lD:t*-1-1;return n<kn[0]?1:n<kn[1]?2:n<kn[2]?3:n<kn[3]?5:9};e4.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};l();function Tm(r,e,t,n){Rc(r,e,t+n);let i=Tp(r,e+t,e+t+n);return new ee(M.bytes,i,t+n)}function fD(r,e,t,n){return Tm(r,e,1,t)}function hD(r,e,t,n){return Tm(r,e,2,is(r,e+1,n))}function dD(r,e,t,n){return Tm(r,e,3,ss(r,e+1,n))}function pD(r,e,t,n){return Tm(r,e,5,os(r,e+1,n))}function mD(r,e,t,n){let i=as(r,e+1,n);if(typeof i=="bigint")throw new Error(`${we} 64-bit integer bytes lengths not supported`);return Tm(r,e,9,i)}function t4(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===M.string?J3(r.value):r.value),r.encodedBytes}function Ip(r,e){let t=t4(e);Qn(r,e.type.majorEncoded,t.length),r.push(t)}Ip.encodedSize=function(e){let t=t4(e);return Qn.encodedSize(t.length)+t.length};Ip.compareTokens=function(e,t){return Khe(t4(e),t4(t))};function Khe(r,e){return r.length<e.length?-1:r.length>e.length?1:tD(r,e)}l();function Im(r,e,t,n,i){let s=t+n;Rc(r,e,s);let o=new ee(M.string,ZN(r,e+t,e+s),s);return i.retainStringBytes===!0&&(o.byteValue=Tp(r,e+t,e+s)),o}function gD(r,e,t,n){return Im(r,e,1,t,n)}function yD(r,e,t,n){return Im(r,e,2,is(r,e+1,n),n)}function wD(r,e,t,n){return Im(r,e,3,ss(r,e+1,n),n)}function bD(r,e,t,n){return Im(r,e,5,os(r,e+1,n),n)}function ED(r,e,t,n){let i=as(r,e+1,n);if(typeof i=="bigint")throw new Error(`${we} 64-bit integer string lengths not supported`);return Im(r,e,9,i,n)}var _D=Ip;l();function Rp(r,e,t,n){return new ee(M.array,n,t)}function vD(r,e,t,n){return Rp(r,e,1,t)}function SD(r,e,t,n){return Rp(r,e,2,is(r,e+1,n))}function xD(r,e,t,n){return Rp(r,e,3,ss(r,e+1,n))}function AD(r,e,t,n){return Rp(r,e,5,os(r,e+1,n))}function TD(r,e,t,n){let i=as(r,e+1,n);if(typeof i=="bigint")throw new Error(`${we} 64-bit integer array lengths not supported`);return Rp(r,e,9,i)}function ID(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${we} indefinite length items not allowed`);return Rp(r,e,1,1/0)}function r4(r,e){Qn(r,M.array.majorEncoded,e.value)}r4.compareTokens=zs.compareTokens;r4.encodedSize=function(e){return Qn.encodedSize(e.value)};l();function Cp(r,e,t,n){return new ee(M.map,n,t)}function RD(r,e,t,n){return Cp(r,e,1,t)}function CD(r,e,t,n){return Cp(r,e,2,is(r,e+1,n))}function PD(r,e,t,n){return Cp(r,e,3,ss(r,e+1,n))}function kD(r,e,t,n){return Cp(r,e,5,os(r,e+1,n))}function OD(r,e,t,n){let i=as(r,e+1,n);if(typeof i=="bigint")throw new Error(`${we} 64-bit integer map lengths not supported`);return Cp(r,e,9,i)}function ND(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${we} indefinite length items not allowed`);return Cp(r,e,1,1/0)}function n4(r,e){Qn(r,M.map.majorEncoded,e.value)}n4.compareTokens=zs.compareTokens;n4.encodedSize=function(e){return Qn.encodedSize(e.value)};l();function DD(r,e,t,n){return new ee(M.tag,t,1)}function LD(r,e,t,n){return new ee(M.tag,is(r,e+1,n),2)}function BD(r,e,t,n){return new ee(M.tag,ss(r,e+1,n),3)}function UD(r,e,t,n){return new ee(M.tag,os(r,e+1,n),5)}function MD(r,e,t,n){return new ee(M.tag,as(r,e+1,n),9)}function i4(r,e){Qn(r,M.tag.majorEncoded,e.value)}i4.compareTokens=zs.compareTokens;i4.encodedSize=function(e){return Qn.encodedSize(e.value)};l();var Whe=20,Yhe=21,Qhe=22,Xhe=23;function FD(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${we} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new ee(M.null,null,1):new ee(M.undefined,void 0,1)}function VD(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${we} indefinite length items not allowed`);return new ee(M.break,void 0,1)}function G_(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${we} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${we} Infinity values are not supported`)}return new ee(M.float,r,e)}function zD(r,e,t,n){return G_(j_(r,e+1),3,n)}function KD(r,e,t,n){return G_(W_(r,e+1),5,n)}function qD(r,e,t,n){return G_(jD(r,e+1),9,n)}function s4(r,e,t){let n=e.value;if(n===!1)r.push([M.float.majorEncoded|Whe]);else if(n===!0)r.push([M.float.majorEncoded|Yhe]);else if(n===null)r.push([M.float.majorEncoded|Qhe]);else if(n===void 0)r.push([M.float.majorEncoded|Xhe]);else{let i,s=!1;(!t||t.float64!==!0)&&(HD(n),i=j_(xo,1),n===i||Number.isNaN(n)?(xo[0]=249,r.push(xo.slice(0,3)),s=!0):(GD(n),i=W_(xo,1),n===i&&(xo[0]=250,r.push(xo.slice(0,5)),s=!0))),s||(Zhe(n),i=jD(xo,1),xo[0]=251,r.push(xo.slice(0,9)))}}s4.encodedSize=function(e,t){let n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){HD(n);let i=j_(xo,1);if(n===i||Number.isNaN(n))return 3;if(GD(n),i=W_(xo,1),n===i)return 5}return 9};var $D=new ArrayBuffer(9),Ks=new DataView($D,1),xo=new Uint8Array($D,0);function HD(r){if(r===1/0)Ks.setUint16(0,31744,!1);else if(r===-1/0)Ks.setUint16(0,64512,!1);else if(Number.isNaN(r))Ks.setUint16(0,32256,!1);else{Ks.setFloat32(0,r);let e=Ks.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)Ks.setUint16(0,31744,!1);else if(t===0)Ks.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{let i=t-127;i<-24?Ks.setUint16(0,0):i<-14?Ks.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):Ks.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function j_(r,e){if(r.length-e<2)throw new Error(`${we} not enough data for float16`);let t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;let n=t>>10&31,i=t&1023,s;return n===0?s=i*2**-24:n!==31?s=(i+1024)*2**(n-25):s=i===0?1/0:NaN,t&32768?-s:s}function GD(r){Ks.setFloat32(0,r,!1)}function W_(r,e){if(r.length-e<4)throw new Error(`${we} not enough data for float32`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function Zhe(r){Ks.setFloat64(0,r,!1)}function jD(r,e){if(r.length-e<8)throw new Error(`${we} not enough data for float64`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}s4.compareTokens=zs.compareTokens;function Ft(r,e,t){throw new Error(`${we} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function o4(r){return()=>{throw new Error(`${we} ${r}`)}}var oe=[];for(let r=0;r<=23;r++)oe[r]=Ft;oe[24]=rD;oe[25]=nD;oe[26]=iD;oe[27]=sD;oe[28]=Ft;oe[29]=Ft;oe[30]=Ft;oe[31]=Ft;for(let r=32;r<=55;r++)oe[r]=Ft;oe[56]=oD;oe[57]=aD;oe[58]=cD;oe[59]=uD;oe[60]=Ft;oe[61]=Ft;oe[62]=Ft;oe[63]=Ft;for(let r=64;r<=87;r++)oe[r]=fD;oe[88]=hD;oe[89]=dD;oe[90]=pD;oe[91]=mD;oe[92]=Ft;oe[93]=Ft;oe[94]=Ft;oe[95]=o4("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)oe[r]=gD;oe[120]=yD;oe[121]=wD;oe[122]=bD;oe[123]=ED;oe[124]=Ft;oe[125]=Ft;oe[126]=Ft;oe[127]=o4("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)oe[r]=vD;oe[152]=SD;oe[153]=xD;oe[154]=AD;oe[155]=TD;oe[156]=Ft;oe[157]=Ft;oe[158]=Ft;oe[159]=ID;for(let r=160;r<=183;r++)oe[r]=RD;oe[184]=CD;oe[185]=PD;oe[186]=kD;oe[187]=OD;oe[188]=Ft;oe[189]=Ft;oe[190]=Ft;oe[191]=ND;for(let r=192;r<=215;r++)oe[r]=DD;oe[216]=LD;oe[217]=BD;oe[218]=UD;oe[219]=MD;oe[220]=Ft;oe[221]=Ft;oe[222]=Ft;oe[223]=Ft;for(let r=224;r<=243;r++)oe[r]=o4("simple values are not supported");oe[244]=Ft;oe[245]=Ft;oe[246]=Ft;oe[247]=FD;oe[248]=o4("simple values are not supported");oe[249]=zD;oe[250]=KD;oe[251]=qD;oe[252]=Ft;oe[253]=Ft;oe[254]=Ft;oe[255]=VD;var Ao=[];for(let r=0;r<24;r++)Ao[r]=new ee(M.uint,r,1);for(let r=-1;r>=-24;r--)Ao[31-r]=new ee(M.negint,r,1);Ao[64]=new ee(M.bytes,new Uint8Array(0),1);Ao[96]=new ee(M.string,"",1);Ao[128]=new ee(M.array,0,1);Ao[160]=new ee(M.map,0,1);Ao[244]=new ee(M.false,!1,1);Ao[245]=new ee(M.true,!0,1);Ao[246]=new ee(M.null,null,1);function WD(r){switch(r.type){case M.false:return ma([244]);case M.true:return ma([245]);case M.null:return ma([246]);case M.bytes:return r.value.length?void 0:ma([64]);case M.string:return r.value===""?ma([96]):void 0;case M.array:return r.value===0?ma([128]):void 0;case M.map:return r.value===0?ma([160]):void 0;case M.uint:return r.value<24?ma([Number(r.value)]):void 0;case M.negint:if(r.value>=-24)return ma([31-Number(r.value)])}}var ede={float64:!1,mapSorter:nde,quickEncodeToken:WD};function tde(){let r=[];return r[M.uint.major]=zs,r[M.negint.major]=e4,r[M.bytes.major]=Ip,r[M.string.major]=_D,r[M.array.major]=r4,r[M.map.major]=n4,r[M.tag.major]=i4,r[M.float.major]=s4,r}var YD=tde(),Y_=new xm,Pp=class{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${Ic} object contains circular references`);return new Pp(t,e)}},cu={null:new ee(M.null,null),undefined:new ee(M.undefined,void 0),true:new ee(M.true,!0),false:new ee(M.false,!1),emptyArray:new ee(M.array,0),emptyMap:new ee(M.map,0)},lu={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new ee(M.float,r):r>=0?new ee(M.uint,r):new ee(M.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new ee(M.uint,r):new ee(M.negint,r)},Uint8Array(r,e,t,n){return new ee(M.bytes,r)},string(r,e,t,n){return new ee(M.string,r)},boolean(r,e,t,n){return r?cu.true:cu.false},null(r,e,t,n){return cu.null},undefined(r,e,t,n){return cu.undefined},ArrayBuffer(r,e,t,n){return new ee(M.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new ee(M.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[cu.emptyArray,new ee(M.break)]:cu.emptyArray;n=Pp.createCheck(n,r);let i=[],s=0;for(let o of r)i[s++]=a4(o,t,n);return t.addBreakTokens?[new ee(M.array,r.length),i,new ee(M.break)]:[new ee(M.array,r.length),i]},Object(r,e,t,n){let i=e!=="Object",s=i?r.keys():Object.keys(r),o=i?r.size:s.length;if(!o)return t.addBreakTokens===!0?[cu.emptyMap,new ee(M.break)]:cu.emptyMap;n=Pp.createCheck(n,r);let a=[],c=0;for(let u of s)a[c++]=[a4(u,t,n),a4(i?r.get(u):r[u],t,n)];return rde(a,t),t.addBreakTokens?[new ee(M.map,o),a,new ee(M.break)]:[new ee(M.map,o),a]}};lu.Map=lu.Object;lu.Buffer=lu.Uint8Array;for(let r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))lu[`${r}Array`]=lu.DataView;function a4(r,e={},t){let n=WN(r),i=e&&e.typeEncoders&&e.typeEncoders[n]||lu[n];if(typeof i=="function"){let o=i(r,n,e,t);if(o!=null)return o}let s=lu[n];if(!s)throw new Error(`${Ic} unsupported type: ${n}`);return s(r,n,e,t)}function rde(r,e){e.mapSorter&&r.sort(e.mapSorter)}function nde(r,e){let t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);let i=t.type.major,s=YD[i].compareTokens(t,n);return s===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function QD(r,e,t,n){if(Array.isArray(e))for(let i of e)QD(r,i,t,n);else t[e.type.major](r,e,n)}function Q_(r,e,t){let n=a4(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){let i=t.quickEncodeToken(n);if(i)return i;let s=e[n.type.major];if(s.encodedSize){let o=s.encodedSize(n,t),a=new xm(o);if(s(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return Sm(a.chunks[0])}}return Y_.reset(),QD(Y_,n,e,t),Y_.toBytes(!0)}function To(r,e){return e=Object.assign({},ede,e),Q_(r,YD,e)}l();var ide={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},X_=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){let e=this.data[this.pos],t=Ao[e];if(t===void 0){let n=oe[e];if(!n)throw new Error(`${we} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let i=e&31;t=n(this.data,this.pos,i,this.options)}return this.pos+=t.encodedLength,t}},Rm=Symbol.for("DONE"),c4=Symbol.for("BREAK");function sde(r,e,t){let n=[];for(let i=0;i<r.value;i++){let s=Cm(e,t);if(s===c4){if(r.value===1/0)break;throw new Error(`${we} got unexpected break to lengthed array`)}if(s===Rm)throw new Error(`${we} found array but not enough entries (got ${i}, expected ${r.value})`);n[i]=s}return n}function ode(r,e,t){let n=t.useMaps===!0,i=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<r.value;o++){let a=Cm(e,t);if(a===c4){if(r.value===1/0)break;throw new Error(`${we} got unexpected break to lengthed map`)}if(a===Rm)throw new Error(`${we} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${we} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&s.has(a)||!n&&a in i))throw new Error(`${we} found repeat map key "${a}"`);let c=Cm(e,t);if(c===Rm)throw new Error(`${we} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?s.set(a,c):i[a]=c}return n?s:i}function Cm(r,e){if(r.done())return Rm;let t=r.next();if(t.type===M.break)return c4;if(t.type.terminal)return t.value;if(t.type===M.array)return sde(t,r,e);if(t.type===M.map)return ode(t,r,e);if(t.type===M.tag){if(e.tags&&typeof e.tags[t.value]=="function"){let n=Cm(r,e);return e.tags[t.value](n)}throw new Error(`${we} tag not supported (${t.value})`)}throw new Error("unsupported")}function di(r,e){if(!(r instanceof Uint8Array))throw new Error(`${we} data to decode must be a Uint8Array`);e=Object.assign({},ide,e);let t=e.tokenizer||new X_(r,e),n=Cm(t,e);if(n===Rm)throw new Error(`${we} did not find any content to decode`);if(n===c4)throw new Error(`${we} got unexpected break`);if(!t.done())throw new Error(`${we} too many terminals, data makes no sense`);return n}var XD=42;function ade(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let e=T.asCID(r);if(!e)return null;let t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new ee(M.tag,XD),new ee(M.bytes,t)]}function cde(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function lde(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var ude={float64:!0,typeEncoders:{Object:ade,undefined:cde,number:lde}};function fde(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return T.decode(r.subarray(1))}var ZD={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};ZD.tags[XD]=fde;var hde="dag-cbor",Pm=113,km=r=>To(r,ude),rh=r=>di(r,ZD);var Op={};jt(Op,{code:()=>i9,decode:()=>tL,encode:()=>eL,format:()=>vde,name:()=>_de,parse:()=>xde,stringify:()=>vde});l();l();l();var Z_=class extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===M.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===M.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[M.uint.major](e,t){this.prefix(e);let n=String(t.value),i=[];for(let s=0;s<n.length;s++)i[s]=n.charCodeAt(s);e.push(i)}[M.negint.major](e,t){this[M.uint.major](e,t)}[M.bytes.major](e,t){throw new Error(`${Ic} unsupported type: Uint8Array`)}[M.string.major](e,t){this.prefix(e);let n=J3(JSON.stringify(t.value));e.push(n.length>32?Sm(n):n)}[M.array.major](e,t){this.prefix(e),this.inRecursive.push({type:M.array,elements:0}),e.push([91])}[M.map.major](e,t){this.prefix(e),this.inRecursive.push({type:M.map,elements:0}),e.push([123])}[M.tag.major](e,t){}[M.float.major](e,t){if(t.type.name==="break"){let o=this.inRecursive.pop();if(o){if(o.type===M.array)e.push([93]);else if(o.type===M.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${Ic} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}let n=String(t.value),i=[],s=!1;for(let o=0;o<n.length;o++)i[o]=n.charCodeAt(o),!s&&(i[o]===46||i[o]===101||i[o]===69)&&(s=!0);s||(i.push(46),i.push(48)),e.push(i)}};function dde(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${Ic} complex map keys are not supported`);let t=r[0],n=e[0];if(t.type!==M.string||n.type!==M.string)throw new Error(`${Ic} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${Ic} unexpected duplicate map keys, this is not supported`)}var pde={addBreakTokens:!0,mapSorter:dde};function J_(r,e){return e=Object.assign({},pde,e),Q_(r,new Z_,e)}l();var kp=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`${we} unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`${we} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this.pos,t=!1,n=!1,i=a=>{for(;!this.done();){let c=this.ch();if(a.includes(c))this.pos++;else break}};if(this.ch()===45&&(t=!0,this.pos++),this.ch()===48)if(this.pos++,this.ch()===46)this.pos++,n=!0;else return new ee(M.uint,0,this.pos-e);if(i([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`${we} unexpected token at position ${this.pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${we} unexpected token at position ${this.pos}`);n=!0,this.pos++,i([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this.pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this.pos++,i([48,49,50,51,52,53,54,55,56,57]));let s=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),o=parseFloat(s);return n?new ee(M.float,o,this.pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(o)?new ee(o>=0?M.uint:M.negint,o,this.pos-e):new ee(o>=0?M.uint:M.negint,BigInt(s),this.pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${we} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let s=this.pos,o=0;s<this.data.length&&o<65536;s++,o++){let a=this.data[s];if(a===92||a<32||a>=128)break;if(a===34){let c=String.fromCharCode.apply(null,this.data.subarray(this.pos,s));return this.pos=s+1,new ee(M.string,c,o)}}let e=this.pos,t=[],n=()=>{if(this.pos+4>=this.data.length)throw new Error(`${we} unexpected end of unicode escape sequence at position ${this.pos}`);let s=0;for(let o=0;o<4;o++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${we} unexpected unicode escape character at position ${this.pos}`);s=s*16+a,this.pos++}return s},i=()=>{let s=this.ch(),o=null,a=s>239?4:s>223?3:s>191?2:1;if(this.pos+a>this.data.length)throw new Error(`${we} unexpected unicode sequence at position ${this.pos}`);let c,u,f,h;switch(a){case 1:s<128&&(o=s);break;case 2:c=this.data[this.pos+1],(c&192)===128&&(h=(s&31)<<6|c&63,h>127&&(o=h));break;case 3:c=this.data[this.pos+1],u=this.data[this.pos+2],(c&192)===128&&(u&192)===128&&(h=(s&15)<<12|(c&63)<<6|u&63,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:c=this.data[this.pos+1],u=this.data[this.pos+2],f=this.data[this.pos+3],(c&192)===128&&(u&192)===128&&(f&192)===128&&(h=(s&15)<<18|(c&63)<<12|(u&63)<<6|f&63,h>65535&&h<1114112&&(o=h))}o===null?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|o&1023),t.push(o),this.pos+=a};for(;!this.done();){let s=this.ch(),o;switch(s){case 92:if(this.pos++,this.done())throw new Error(`${we} unexpected string termination at position ${this.pos}`);switch(o=this.ch(),this.pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${we} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new ee(M.string,$_(t),this.pos-e);default:if(s<32)throw new Error(`${we} invalid control character at position ${this.pos}`);s<128?(t.push(s),this.pos++):i()}}throw new Error(`${we} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new ee(M.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new ee(M.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new ee(M.null,null,4);case 102:return this.expect([102,97,108,115,101]),new ee(M.false,!1,5);case 116:return this.expect([116,114,117,101]),new ee(M.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${we} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this.pos++,this.skipWhitespace(),new ee(M.break,void 0,1);if(this.ch()!==44)throw new Error(`${we} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this.pos++,this.skipWhitespace(),new ee(M.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new ee(M.break,void 0,1);if(this.ch()!==44)throw new Error(`${we} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this.pos++,this.skipWhitespace(),new ee(M.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${we} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${we} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}};function e9(r,e){return e=Object.assign({tokenizer:new kp(r,e)},e),di(r,e)}l();l();var nh=({name:r,code:e,encode:t})=>new t9(r,e,t),t9=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?pa(this.code,t):t.then(n=>pa(this.code,n))}else throw Error("Unknown type, must be binary type")}};l();function gde(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let e=T.asCID(r);if(!e)return null;let t=e.toString();return[new ee(M.map,1/0,1),new ee(M.string,"/",1),new ee(M.string,t,t.length),new ee(M.break,void 0,1)]}function u4(r){let e=fa.encode(r).slice(1);return[new ee(M.map,1/0,1),new ee(M.string,"/",1),new ee(M.map,1/0,1),new ee(M.string,"bytes",5),new ee(M.string,e,e.length),new ee(M.break,void 0,1),new ee(M.break,void 0,1)]}function Io(r){return u4(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function yde(r){return u4(new Uint8Array(r))}function wde(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function bde(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var Ede={typeEncoders:{Object:gde,Buffer:u4,Uint8Array:u4,Int8Array:Io,Uint16Array:Io,Int16Array:Io,Uint32Array:Io,Int32Array:Io,Float32Array:Io,Float64Array:Io,Uint8ClampedArray:Io,BigInt64Array:Io,BigUint64Array:Io,DataView:Io,ArrayBuffer:yde,undefined:wde,number:bde}},r9=class extends kp{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===M.map){let t=this._next();if(t.type===M.string&&t.value==="/"){let n=this._next();if(n.type===M.string){if(this._next().type!==M.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new ee(M.tag,42,0)}if(n.type===M.map){let i=this._next();if(i.type===M.string&&i.value==="bytes"){let s=this._next();if(s.type===M.string){for(let a=0;a<2;a++)if(this._next().type!==M.break)throw new Error("Invalid encoded Bytes form");let o=fa.decode(`m${s.value}`);return new ee(M.bytes,o,s.value.length)}this.tokenBuffer.push(s)}this.tokenBuffer.push(i)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}},n9={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};n9.tags[42]=T.parse;var _de="dag-json",i9=297,eL=r=>J_(r,Ede),tL=r=>{let e=Object.assign(n9,{tokenizer:new r9(r,n9)});return e9(r,e)},vde=r=>Sde.decode(eL(r));var Sde=new TextDecoder,xde=r=>tL(Ade.encode(r)),Ade=new TextEncoder;var Om={};jt(Om,{code:()=>Nde,decode:()=>Ude,encode:()=>Bde,name:()=>Ode,toGeneral:()=>uL});l();l();l();function Ro(r){return Ql.encode(r).slice(1)}function qs(r){return Ql.decode(`u${r}`)}function rL(r){let[e,t,n]=r;return{payload:t,signatures:[{protected:e,signature:n}],link:T.decode(qs(t))}}function Tde(r){let e={signature:qs(r.signature)};return r.header&&(e.header=r.header),r.protected&&(e.protected=qs(r.protected)),e}function nL(r){let e=qs(r.payload);try{T.decode(e)}catch{throw new Error("Not a valid DagJWS")}return{payload:e,signatures:r.signatures.map(Tde)}}function Ide(r){let e={signature:Ro(r.signature)};return r.header&&(e.header=r.header),r.protected&&(e.protected=Ro(r.protected)),e}function iL(r){let e={payload:Ro(r.payload),signatures:r.signatures.map(Ide)};return e.link=T.decode(new Uint8Array(r.payload)),e}l();function sL(r){let[e,t,n,i,s]=r,o={ciphertext:i,iv:n,protected:e,tag:s};return t&&(o.recipients=[{encrypted_key:t}]),o}function Cde(r){let e={};return r.encrypted_key&&(e.encrypted_key=qs(r.encrypted_key)),r.header&&(e.header=r.header),e}function oL(r){let e={ciphertext:qs(r.ciphertext),protected:qs(r.protected),iv:qs(r.iv),tag:qs(r.tag)};return r.aad&&(e.aad=qs(r.aad)),r.recipients&&(e.recipients=r.recipients.map(Cde)),r.unprotected&&(e.unprotected=r.unprotected),e}function Pde(r){let e={};return r.encrypted_key&&(e.encrypted_key=Ro(r.encrypted_key)),r.header&&(e.header=r.header),e}function aL(r){let e={ciphertext:Ro(r.ciphertext),protected:Ro(r.protected),iv:Ro(r.iv),tag:Ro(r.tag)};return r.aad&&(e.aad=Ro(r.aad)),r.recipients&&(e.recipients=r.recipients.map(Pde)),r.unprotected&&(e.unprotected=r.unprotected),e}var Ode="dag-jose",Nde=133;function cL(r){return"payload"in r&&typeof r.payload=="string"&&"signatures"in r&&Array.isArray(r.signatures)}function Dde(r){return"payload"in r&&r.payload instanceof Uint8Array&&"signatures"in r&&Array.isArray(r.signatures)}function Lde(r){return"ciphertext"in r&&r.ciphertext instanceof Uint8Array&&"iv"in r&&r.iv instanceof Uint8Array&&"protected"in r&&r.protected instanceof Uint8Array&&"tag"in r&&r.tag instanceof Uint8Array}function lL(r){return"ciphertext"in r&&typeof r.ciphertext=="string"&&"iv"in r&&typeof r.iv=="string"&&"protected"in r&&typeof r.protected=="string"&&"tag"in r&&typeof r.tag=="string"}function uL(r){if(typeof r=="string"){let e=r.split(".");if(e.length===3)return rL(e);if(e.length===5)return sL(e);throw new Error("Not a valid JOSE string")}if(cL(r)||lL(r))return r;throw new Error("Not a valid unencoded JOSE object")}function Bde(r){typeof r=="string"&&(r=uL(r));let e;if(cL(r))e=nL(r);else if(lL(r))e=oL(r);else throw new Error("Not a valid JOSE object");return new Uint8Array(km(e))}function Ude(r){let e;try{e=rh(r)}catch{throw new Error("Not a valid DAG-JOSE object")}if(Dde(e))return iL(e);if(Lde(e))return aL(e);throw new Error("Not a valid DAG-JOSE object")}var s9={};jt(s9,{identity:()=>un});l();var fL=0,Mde="identity",hL=Ms,Fde=r=>pa(fL,hL(r)),un={code:fL,name:Mde,encode:hL,digest:Fde};l();var o9={};jt(o9,{identity:()=>Vde});l();var Vde=wp({prefix:"\0",name:"identity",encode:r=>m_(r),decode:r=>p_(r)});var a9={};jt(a9,{base2:()=>zde});l();var zde=Kr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var c9={};jt(c9,{base8:()=>Kde});l();var Kde=Kr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var l9={};jt(l9,{base10:()=>qde});l();var qde=Yl({prefix:"9",name:"base10",alphabet:"0123456789"});var u9={};jt(u9,{base16:()=>$de,base16upper:()=>Hde});l();var $de=Kr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Hde=Kr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var f9={};jt(f9,{base36:()=>Np,base36upper:()=>Gde});l();var Np=Yl({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Gde=Yl({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var h9={};jt(h9,{base256emoji:()=>Xde});l();var dL=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),jde=dL.reduce((r,e,t)=>(r[t]=e,r),[]),Wde=dL.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Yde(r){return r.reduce((e,t)=>(e+=jde[t],e),"")}function Qde(r){let e=[];for(let t of r){let n=Wde[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var Xde=wp({prefix:"\u{1F680}",name:"base256emoji",encode:Yde,decode:Qde});var d9={};jt(d9,{sha256:()=>Le,sha512:()=>Zde});l();var pL=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Le=nh({name:"sha2-256",code:18,encode:pL("SHA-256")}),Zde=nh({name:"sha2-512",code:19,encode:pL("SHA-512")});var zi={};jt(zi,{code:()=>On,decode:()=>tpe,encode:()=>epe,name:()=>Jde});l();var Jde="raw",On=85,epe=r=>Ms(r),tpe=r=>Ms(r);var f4={};jt(f4,{code:()=>p9,decode:()=>ope,encode:()=>spe,name:()=>ipe});l();var rpe=new TextEncoder,npe=new TextDecoder,ipe="json",p9=512,spe=r=>rpe.encode(JSON.stringify(r)),ope=r=>JSON.parse(npe.decode(r));var Ar={...o9,...a9,...c9,...l9,...u9,...S_,...f9,...E_,...x_,...h9},h4={...d9,...s9},d4={raw:zi,json:f4};l();l();var Pc=class extends Error{constructor(e="not initialized"){super(e),this.name="NotInitializedError",this.code=Pc.code}};Pc.code="ERR_NOT_INITIALIZED";var m9=class extends Error{constructor(e="cannot initialize an initializing node"){super(e),this.name="AlreadyInitializingError",this.code=Co.code}};m9.code="ERR_ALREADY_INITIALIZING";var Co=class extends Error{constructor(e="cannot re-initialize an initialized node"){super(e),this.name="AlreadyInitializedError",this.code=Co.code}};Co.code="ERR_ALREADY_INITIALIZED";var kc=class extends Error{constructor(e="not started"){super(e),this.name="NotStartedError",this.code=kc.code}};kc.code="ERR_NOT_STARTED";var ih=class extends Error{constructor(e="cannot start, already startin"){super(e),this.name="AlreadyStartingError",this.code=ih.code}};ih.code="ERR_ALREADY_STARTING";var sh=class extends Error{constructor(e="cannot start, already started"){super(e),this.name="AlreadyStartedError",this.code=sh.code}};sh.code="ERR_ALREADY_STARTED";var Po=class extends Error{constructor(e="not enabled"){super(e),this.name="NotEnabledError",this.code=Po.code}};Po.code="ERR_NOT_ENABLED";l();l();l();l();function Oc(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function Nc(r=0){return globalThis.Buffer?.alloc!=null?Oc(globalThis.Buffer.alloc(r)):new Uint8Array(r)}function Ri(r=0){return globalThis.Buffer?.allocUnsafe!=null?Oc(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function gL(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var mL=gL("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),g9=gL("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=Ri(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),ape={utf8:mL,"utf-8":mL,hex:Ar.base16,latin1:g9,ascii:g9,binary:g9,...Ar},p4=ape;function U(r,e="utf8"){let t=p4[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Oc(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}var rue=S(_n(),1);l();l();l();l();l();l();l();l();l();l();l();var g4=class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,i){return this.readAtomically(()=>{let s=0,o=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",u=2**(8*i)-1;for(;;){let f=this.readAtomically(()=>{let h=this.readChar();if(h===void 0)return;let p=Number.parseInt(h,e);if(!Number.isNaN(p))return p});if(f===void 0)break;if(s*=e,s+=f,s>u||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!n&&c&&o>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){let e=t=>{for(let n=0;n<t.length/2;n++){let i=n*2;if(n<t.length-3){let o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],[i+4,!0]}let s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[i,!1];t[i]=s>>8,t[i+1]=s&255}return[t.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[n,i]=e(t);if(n===16)return t;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let s=new Uint8Array(14),o=16-(n+2),[a]=e(s.subarray(0,o));return t.set(s.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var vL=45,upe=15,Dp=new g4;function b9(r){if(!(r.length>upe))return Dp.new(r).parseWith(()=>Dp.readIPv4Addr())}function E9(r){if(!(r.length>vL))return Dp.new(r).parseWith(()=>Dp.readIPv6Addr())}function y4(r){if(!(r.length>vL))return Dp.new(r).parseWith(()=>Dp.readIPAddr())}function cs(r){return Boolean(b9(r))}function ls(r){return Boolean(E9(r))}function Xt(r){return Boolean(y4(r))}l();function C(r,e="utf8"){let t=p4[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var SL=cs,fpe=ls,_9=function(r){let e=0;if(r=r.toString().trim(),SL(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(fpe(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let s=SL(t[n]),o;s&&(o=_9(t[n]),t[n]=C(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,C(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}let i=new Uint8Array(e+16);for(n=0;n<t.length;n++){let s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},xL=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){let i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};l();var Dm={},v9={},dpe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[281,0,"webrtc-w3c"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];dpe.forEach(r=>{let e=ppe(...r);v9[e.code]=e,Dm[e.name]=e});function ppe(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:Boolean(n),path:Boolean(i)}}function Kt(r){if(typeof r=="number"){if(v9[r]!=null)return v9[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(Dm[r]!=null)return Dm[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var ga=S(ur(),1);l();function Z(r,e){e==null&&(e=r.reduce((i,s)=>i+s.length,0));let t=Ri(e),n=0;for(let i of r)t.set(i,n),n+=i.length;return Oc(t)}function ML(r,e){switch(Kt(r).code){case 4:case 41:return Cpe(e);case 42:return BL(e);case 6:case 273:case 33:case 132:return VL(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return BL(e);case 421:return Npe(e);case 444:return UL(e);case 445:return UL(e);case 466:return Ope(e);default:return C(e,"base16")}}function FL(r,e){switch(Kt(r).code){case 4:return DL(e);case 41:return DL(e);case 42:return LL(e);case 6:case 273:case 33:case 132:return T9(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return LL(e);case 421:return Ppe(e);case 444:return Dpe(e);case 445:return Lpe(e);case 466:return kpe(e);default:return U(e,"base16")}}var A9=Object.values(Ar).map(r=>r.decoder),Rpe=function(){let r=A9[0].or(A9[1]);return A9.slice(2).forEach(e=>r=r.or(e)),r}();function DL(r){if(!Xt(r))throw new Error("invalid ip address");return _9(r)}function Cpe(r){let e=xL(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Xt(e))throw new Error("invalid ip address");return e}function T9(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function VL(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function LL(r){let e=U(r),t=Uint8Array.from(ga.default.encode(e.length));return Z([t,e],t.length+e.length)}function BL(r){let e=ga.default.decode(r);if(r=r.slice(ga.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return C(r)}function Ppe(r){let e;r[0]==="Q"||r[0]==="1"?e=Ze(le.decode(`z${r}`)).bytes:e=T.parse(r).multihash.bytes;let t=Uint8Array.from(ga.default.encode(e.length));return Z([t,e],t.length+e.length)}function kpe(r){let e=Rpe.decode(r),t=Uint8Array.from(ga.default.encode(e.length));return Z([t,e],t.length+e.length)}function Ope(r){let e=ga.default.decode(r),t=r.slice(ga.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+C(t,"base64url")}function Npe(r){let e=ga.default.decode(r),t=r.slice(ga.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return C(t,"base58btc")}function Dpe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=De.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=T9(n);return Z([t,i],t.length+i.length)}function Lpe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=De.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=T9(n);return Z([t,i],t.length+i.length)}function UL(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=C(e,"base32"),i=VL(t);return`${n}:${i}`}var Lp=S(ur(),1);function Bpe(r){let e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){let i=t[n],s=Kt(i);if(s.size===0){e.push([i]);continue}if(n++,n>=t.length)throw KL("invalid address: "+r);if(s.path===!0){e.push([i,k9(t.slice(n).join("/"))]);break}e.push([i,t[n]])}return e}function Upe(r){let e=[];return r.map(t=>{let n=E4(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),k9(e.join("/"))}function Mpe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);let t=E4(e);return e.length>1?[t.code,FL(t.code,e[1])]:[t.code]})}function I9(r){return r.map(e=>{let t=E4(e);return e[1]!=null?[t.code,ML(t.code,e[1])]:[t.code]})}function R9(r){return b4(Z(r.map(e=>{let t=E4(e),n=Uint8Array.from(Lp.default.encode(t.code));return e.length>1&&e[1]!=null&&(n=Z([n,e[1]])),n})))}function C9(r,e){return r.size>0?r.size/8:r.size===0?0:Lp.default.decode(e)+(Lp.default.decode.bytes??0)}function w4(r){let e=[],t=0;for(;t<r.length;){let n=Lp.default.decode(r,t),i=Lp.default.decode.bytes??0,s=Kt(n),o=C9(s,r.slice(t+i));if(o===0){e.push([n]),t+=i;continue}let a=r.slice(t+i,t+i+o);if(t+=o+i,t>r.length)throw KL("Invalid address Uint8Array: "+C(r,"base16"));e.push([n,a])}return e}function P9(r){let e=w4(r),t=I9(e);return Upe(t)}function Fpe(r){r=k9(r);let e=Bpe(r),t=Mpe(e);return R9(t)}function zL(r){return Fpe(r)}function b4(r){let e=Vpe(r);if(e!=null)throw e;return Uint8Array.from(r)}function Vpe(r){try{w4(r)}catch(e){return e}}function k9(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function KL(r){return new Error("Error parsing address: "+r)}function E4(r){return Kt(r[0])}var N9=S(ur(),1);var $L=S(W(),1);l();function be(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}var Bp=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},O9=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},Lm,Bm,Um,qL,Kpe=Symbol.for("nodejs.util.inspect.custom"),qpe=[Kt("dns").code,Kt("dns4").code,Kt("dns6").code,Kt("dnsaddr").code],D9=new Map,HL=Symbol.for("@multiformats/js-multiaddr/multiaddr");function GL(r,e){if(r==null)throw new Error("requires node address object");if(e==null)throw new Error("requires transport protocol");let t,n=r.address;switch(r.family){case 4:t="ip4";break;case 6:if(t="ip6",n.includes("%")){let i=n.split("%");if(i.length!==2)throw Error("Multiple ip6 zones in multiaddr");n=i[0],t=`/ip6zone/${i[1]}/ip6`}break;default:throw Error("Invalid addr family, should be 4 or 6.")}return new ya("/"+[t,n,e,r.port].join("/"))}function jL(r){return pi(r)?r.protos().some(e=>e.resolvable):!1}function pi(r){return Boolean(r?.[HL])}var ya=class{constructor(e){if(Lm.set(this,void 0),Bm.set(this,void 0),Um.set(this,void 0),this[qL]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=b4(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=zL(e)}else if(pi(e))this.bytes=b4(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return Bp(this,Lm,"f")==null&&O9(this,Lm,P9(this.bytes),"f"),Bp(this,Lm,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="",o=Kt("tcp"),a=Kt("udp"),c=Kt("ip4"),u=Kt("ip6"),f=Kt("dns6"),h=Kt("ip6zone");for(let[d,m]of this.stringTuples())d===h.code&&(s=`%${m??""}`),qpe.includes(d)&&(t=o.name,i=443,n=`${m??""}${s}`,e=d===f.code?6:4),(d===o.code||d===a.code)&&(t=Kt(d).name,i=parseInt(m??"")),(d===c.code||d===u.code)&&(t=Kt(d).name,n=`${m??""}${s}`,e=d===u.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return this.protoCodes().map(e=>Object.assign({},Kt(e)))}protoCodes(){let e=[],t=this.bytes,n=0;for(;n<t.length;){let i=N9.default.decode(t,n),s=N9.default.decode.bytes??0,o=Kt(i),a=C9(o,t.slice(n+s));n+=a+s,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return Bp(this,Bm,"f")==null&&O9(this,Bm,w4(this.bytes),"f"),Bp(this,Bm,"f")}stringTuples(){return Bp(this,Um,"f")==null&&O9(this,Um,I9(this.tuples()),"f"),Bp(this,Um,"f")}encapsulate(e){return e=new ya(e),new ya(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new ya(n.slice(0,i))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new ya(R9(t.slice(0,n)));return this}getPeerId(){try{let t=this.stringTuples().filter(n=>n[0]===Dm.ipfs.code).pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?C(le.decode(`z${n}`),"base58btc"):C(T.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>Kt(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return be(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(s=>s.resolvable);if(t==null)return[this];let n=D9.get(t.name);if(n==null)throw(0,$L.default)(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(s=>new ya(s))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(Lm=new WeakMap,Bm=new WeakMap,Um=new WeakMap,qL=HL,Kpe)](){return`Multiaddr(${P9(this.bytes)})`}};function se(r){return new ya(r)}l();l();l();var _4=class extends Error{code;type;constructor(e="The operation was aborted"){super(e),this.code=_4.code,this.type=_4.type}},oh=_4;Q7(oh,"code","ABORT_ERR"),Q7(oh,"type","aborted");var F=class extends Error{code;props;constructor(e,t,n){super(e),this.code=t,this.name=n?.name??"CodeError",this.props=n??{}}};var $9=S(ur(),1);l();var Up=S(ur(),1);l();l();l();l();l();l();var CLe=parseInt("0xFFFF",16),PLe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);var wa=S(ur(),1);l();var YL=cs,Wpe=ls,L9=function(r){let e=0;if(r=r.toString().trim(),YL(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(Wpe(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let s=YL(t[n]),o;s&&(o=L9(t[n]),t[n]=C(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,C(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}let i=new Uint8Array(e+16);for(n=0;n<t.length;n++){let s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},QL=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){let i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};l();var Mm={},B9={},Qpe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];Qpe.forEach(r=>{let e=Xpe(...r);B9[e.code]=e,Mm[e.name]=e});function Xpe(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:Boolean(n),path:Boolean(i)}}function fr(r){if(typeof r=="number"){if(B9[r]!=null)return B9[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(Mm[r]!=null)return Mm[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var yBe=fr("ip4"),wBe=fr("ip6"),bBe=fr("ipcidr");function tB(r,e){switch(fr(r).code){case 4:case 41:return Jpe(e);case 42:return JL(e);case 6:case 273:case 33:case 132:return nB(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return JL(e);case 421:return n0e(e);case 444:return eB(e);case 445:return eB(e);case 466:return r0e(e);default:return C(e,"base16")}}function rB(r,e){switch(fr(r).code){case 4:return XL(e);case 41:return XL(e);case 42:return ZL(e);case 6:case 273:case 33:case 132:return M9(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return ZL(e);case 421:return e0e(e);case 444:return i0e(e);case 445:return s0e(e);case 466:return t0e(e);default:return U(e,"base16")}}var U9=Object.values(Ar).map(r=>r.decoder),Zpe=function(){let r=U9[0].or(U9[1]);return U9.slice(2).forEach(e=>r=r.or(e)),r}();function XL(r){if(!Xt(r))throw new Error("invalid ip address");return L9(r)}function Jpe(r){let e=QL(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Xt(e))throw new Error("invalid ip address");return e}function M9(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function nB(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function ZL(r){let e=U(r),t=Uint8Array.from(wa.default.encode(e.length));return Z([t,e],t.length+e.length)}function JL(r){let e=wa.default.decode(r);if(r=r.slice(wa.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return C(r)}function e0e(r){let e;r[0]==="Q"||r[0]==="1"?e=Ze(le.decode(`z${r}`)).bytes:e=T.parse(r).multihash.bytes;let t=Uint8Array.from(wa.default.encode(e.length));return Z([t,e],t.length+e.length)}function t0e(r){let e=Zpe.decode(r),t=Uint8Array.from(wa.default.encode(e.length));return Z([t,e],t.length+e.length)}function r0e(r){let e=wa.default.decode(r),t=r.slice(wa.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+C(t,"base64url")}function n0e(r){let e=wa.default.decode(r),t=r.slice(wa.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return C(t,"base58btc")}function i0e(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=De.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=M9(n);return Z([t,i],t.length+i.length)}function s0e(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=De.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=M9(n);return Z([t,i],t.length+i.length)}function eB(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=C(e,"base32"),i=nB(t);return`${n}:${i}`}function o0e(r){let e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){let i=t[n],s=fr(i);if(s.size===0){e.push([i]);continue}if(n++,n>=t.length)throw sB("invalid address: "+r);if(s.path===!0){e.push([i,q9(t.slice(n).join("/"))]);break}e.push([i,t[n]])}return e}function a0e(r){let e=[];return r.map(t=>{let n=x4(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),q9(e.join("/"))}function c0e(r){return r.map(e=>{Array.isArray(e)||(e=[e]);let t=x4(e);return e.length>1?[t.code,rB(t.code,e[1])]:[t.code]})}function F9(r){return r.map(e=>{let t=x4(e);return e[1]!=null?[t.code,tB(t.code,e[1])]:[t.code]})}function V9(r){return S4(Z(r.map(e=>{let t=x4(e),n=Uint8Array.from(Up.default.encode(t.code));return e.length>1&&e[1]!=null&&(n=Z([n,e[1]])),n})))}function z9(r,e){return r.size>0?r.size/8:r.size===0?0:Up.default.decode(e)+(Up.default.decode.bytes??0)}function v4(r){let e=[],t=0;for(;t<r.length;){let n=Up.default.decode(r,t),i=Up.default.decode.bytes??0,s=fr(n),o=z9(s,r.slice(t+i));if(o===0){e.push([n]),t+=i;continue}let a=r.slice(t+i,t+i+o);if(t+=o+i,t>r.length)throw sB("Invalid address Uint8Array: "+C(r,"base16"));e.push([n,a])}return e}function K9(r){let e=v4(r),t=F9(e);return a0e(t)}function l0e(r){r=q9(r);let e=o0e(r),t=c0e(e);return V9(t)}function iB(r){return l0e(r)}function S4(r){let e=u0e(r);if(e!=null)throw e;return Uint8Array.from(r)}function u0e(r){try{v4(r)}catch(e){return e}}function q9(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function sB(r){return new Error("Error parsing address: "+r)}function x4(r){return fr(r[0])}l();var h0e=Symbol.for("nodejs.util.inspect.custom"),d0e=[fr("dns").code,fr("dns4").code,fr("dns6").code,fr("dnsaddr").code],p0e=new Map,oB=Symbol.for("@multiformats/js-multiaddr/multiaddr");function m0e(r){return Boolean(r?.[oB])}var Dc=class{bytes;#e;#r;#n;#t;[oB]=!0;constructor(e){if(e==null&&(e=""),e instanceof Uint8Array)this.bytes=S4(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=iB(e)}else if(m0e(e))this.bytes=S4(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return this.#e==null&&(this.#e=K9(this.bytes)),this.#e}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="",o=fr("tcp"),a=fr("udp"),c=fr("ip4"),u=fr("ip6"),f=fr("dns6"),h=fr("ip6zone");for(let[d,m]of this.stringTuples())d===h.code&&(s=`%${m??""}`),d0e.includes(d)&&(t=o.name,i=443,n=`${m??""}${s}`,e=d===f.code?6:4),(d===o.code||d===a.code)&&(t=fr(d).name,i=parseInt(m??"")),(d===c.code||d===u.code)&&(t=fr(d).name,n=`${m??""}${s}`,e=d===u.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return this.protoCodes().map(e=>Object.assign({},fr(e)))}protoCodes(){let e=[],t=this.bytes,n=0;for(;n<t.length;){let i=$9.default.decode(t,n),s=$9.default.decode.bytes??0,o=fr(i),a=z9(o,t.slice(n+s));n+=a+s,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return this.#r==null&&(this.#r=v4(this.bytes)),this.#r}stringTuples(){return this.#n==null&&(this.#n=F9(this.tuples())),this.#n}encapsulate(e){return e=new Dc(e),new Dc(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Dc(n.slice(0,i))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Dc(V9(t.slice(0,n)));return this}getPeerId(){try{let t=this.stringTuples().filter(n=>n[0]===Mm.ipfs.code).pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?C(le.decode(`z${n}`),"base58btc"):C(T.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){if(this.#t===void 0)try{this.#t=this.stringTuples().filter(e=>fr(e[0]).path===!0)[0][1],this.#t==null&&(this.#t=null)}catch{this.#t=null}return this.#t}equals(e){return be(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(s=>s.resolvable);if(t==null)return[this];let n=p0e.get(t.name);if(n==null)throw new F(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(s=>new Dc(s))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[h0e](){return`Multiaddr(${K9(this.bytes)})`}};function A4(r){return new Dc(r)}var g0e=xe("dns4"),y0e=xe("dns6"),w0e=xe("dnsaddr"),lh=Xn(xe("dns"),w0e,g0e,y0e),T4=Xn(xe("ip4"),xe("ip6")),Mp=Xn(qe(T4,xe("tcp")),qe(lh,xe("tcp"))),j9=qe(T4,xe("udp")),b0e=qe(j9,xe("utp")),E0e=qe(j9,xe("quic")),Fm=Xn(qe(Mp,xe("ws")),qe(lh,xe("ws"))),Vm=Xn(qe(Mp,xe("wss")),qe(lh,xe("wss")),qe(Mp,xe("tls"),xe("ws")),qe(lh,xe("tls"),xe("ws"))),H9=Xn(qe(Mp,xe("http")),qe(T4,xe("http")),qe(lh,xe("http"))),G9=Xn(qe(Mp,xe("https")),qe(T4,xe("https")),qe(lh,xe("https"))),aB=qe(j9,xe("webrtc"),xe("certhash")),lB=Xn(qe(aB,xe("p2p")),aB),I4=Xn(qe(Fm,xe("p2p-webrtc-star"),xe("p2p")),qe(Vm,xe("p2p-webrtc-star"),xe("p2p")),qe(Fm,xe("p2p-webrtc-star")),qe(Vm,xe("p2p-webrtc-star"))),qBe=Xn(qe(Fm,xe("p2p-websocket-star"),xe("p2p")),qe(Vm,xe("p2p-websocket-star"),xe("p2p")),qe(Fm,xe("p2p-websocket-star")),qe(Vm,xe("p2p-websocket-star"))),uB=Xn(qe(H9,xe("p2p-webrtc-direct"),xe("p2p")),qe(G9,xe("p2p-webrtc-direct"),xe("p2p")),qe(H9,xe("p2p-webrtc-direct")),qe(G9,xe("p2p-webrtc-direct"))),zm=Xn(Fm,Vm,H9,G9,I4,uB,Mp,b0e,E0e,lh,lB),$Be=Xn(qe(zm,xe("p2p-stardust"),xe("p2p")),qe(zm,xe("p2p-stardust"))),uu=Xn(qe(zm,xe("p2p")),I4,uB,lB,xe("p2p")),cB=Xn(qe(uu,xe("p2p-circuit"),uu),qe(uu,xe("p2p-circuit")),qe(xe("p2p-circuit"),uu),qe(zm,xe("p2p-circuit")),qe(xe("p2p-circuit"),zm),xe("p2p-circuit")),fB=()=>Xn(qe(cB,fB),cB),ch=fB(),hB=Xn(qe(ch,uu,ch),qe(uu,ch),qe(ch,uu),ch,uu),dB=hB;function pB(r){function e(t){let n;try{n=A4(t)}catch{return!1}let i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function qe(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:pB(e),partialMatch:e}}function Xn(...r){function e(n){let i=null;return r.some(s=>{let o=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);return o!=null?(i=o,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:pB(e),partialMatch:e}}function xe(r){let e=r;function t(i){let s;try{s=A4(i)}catch{return!1}let o=s.protoNames();return o.length===1&&o[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}var _B=S(R4(),1);var C4=/^\/(ip[fn]s)\/([^/?#]+)/,vB=1,SB=2,xB=/^https?:\/\/([^/]+)\.(ip[fn]s)\.[^/?]+/;var P0e=/^(([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])\.)+([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])$/;function P4(r){try{return IB(r)?Boolean(T.parse(r)):r instanceof Uint8Array?Boolean(T.decode(r)):Boolean(T.asCID(r))}catch{return!1}}function AB(r,e,t=vB,n=SB){let i=RB(r);if(i===!1)return!1;let s=i.match(e);if(s==null||s[t]!=="ipfs")return!1;let o=s[n];return o!=null&&e===xB&&(o=o.toLowerCase()),P4(o)}function TB(r,e,t=vB,n=SB){let i=RB(r);if(i===!1)return!1;let s=i.match(e);if(s==null||s[t]!=="ipns")return!1;let o=s[n];if(o!=null&&e===xB){if(o=o.toLowerCase(),P4(o))return!0;try{!o.includes(".")&&o.includes("-")&&(o=o.replace(/--/g,"@").replace(/-/g,".").replace(/@/g,"-"));let{hostname:a}=new _B.URL(`http://${o}`);return P0e.test(a)}catch{return!1}}return!0}function IB(r){return typeof r=="string"}function RB(r){return r instanceof Uint8Array?C(r,"base58btc"):IB(r)?r:!1}var k4=r=>AB(r,C4)||TB(r,C4);var CB=r=>AB(r,C4),O4=r=>TB(r,C4);l();l();var Tr=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");var Lc="/",PB=new TextEncoder().encode(Lc),D4=PB[0],fn=class{constructor(e,t){if(typeof e=="string")this._buf=U(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==D4)throw new Error("Invalid key")}toString(e="utf8"){return C(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new fn(e.join(Lc))}static random(){return new fn(Tr().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new fn(e):typeof e.uint8Array=="function"?new fn(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=PB),this._buf[0]!==D4){let e=new Uint8Array(this._buf.byteLength+1);e.fill(D4,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===D4;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return fn.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Lc).slice(1)}type(){return k0e(this.baseNamespace())}name(){return O0e(this.baseNamespace())}instance(e){return new fn(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Lc)||(e+=Lc),e+=this.type(),new fn(e)}parent(){let e=this.list();return e.length===1?new fn(Lc):new fn(e.slice(0,-1).join(Lc))}child(e){return this.toString()===Lc?e:e.toString()===Lc?this:new fn(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return fn.withNamespaces([...this.namespaces(),...N0e(e.map(t=>t.namespaces()))])}};function k0e(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function O0e(r){let e=r.split(":");return e[e.length-1]}function N0e(r){return[].concat(...r)}var L4=S(W(),1);l();var NB=S(_n(),1),DB=S(us(),1);l();var D0e=/(-?(?:\d+\.?\d*|\d*\.?\d+)(?:e[-+]?\d+)?)\s*([\p{L}]*)/uig;Ye.nanosecond=Ye.ns=1/1e6;Ye.\u00B5s=Ye.\u03BCs=Ye.us=Ye.microsecond=1/1e3;Ye.millisecond=Ye.ms=Ye[""]=1;Ye.second=Ye.sec=Ye.s=Ye.ms*1e3;Ye.minute=Ye.min=Ye.m=Ye.s*60;Ye.hour=Ye.hr=Ye.h=Ye.m*60;Ye.day=Ye.d=Ye.h*24;Ye.week=Ye.wk=Ye.w=Ye.d*7;Ye.month=Ye.b=Ye.d*(365.25/12);Ye.year=Ye.yr=Ye.y=Ye.d*365.25;function Ye(r="",e="ms"){var t=null;return r=(r+"").replace(/(\d)[,_](\d)/g,"$1$2"),r.replace(D0e,function(n,i,s){s=OB(s),s&&(t=(t||0)+parseFloat(i,10)*s)}),t&&t/(OB(e)||1)}function OB(r){return Ye[r]||Ye[r.toLowerCase().replace(/s$/,"")]}var fu=Ye;l();var Bc=class extends Error{constructor(e="request timed out"){super(e),this.name="TimeoutError",this.code=Bc.code}};Bc.code="ERR_TIMEOUT";function z(r,e){return(...t)=>{let n=t[e??t.length-1];if(!n||!n.timeout)return r(...t);let i=typeof n.timeout=="string"?fu(n.timeout):n.timeout,s=new NB.TimeoutController(i);n.signal=(0,DB.anySignal)([n.signal,s.signal]);let o=r(...t),a=new Promise((f,h)=>{s.signal.addEventListener("abort",()=>{h(new Bc)})}),c=Date.now(),u=()=>{if(s.signal.aborted)throw new Bc;if(Date.now()-c>i)throw s.abort(),new Bc};return o[Symbol.asyncIterator]?async function*(){let f=o[Symbol.asyncIterator]();try{for(;;){let{value:h,done:p}=await Promise.race([f.next(),a]);if(p)break;u(),yield h}}catch(h){throw u(),h}finally{s.clear(),f.return&&f.return()}}():(async()=>{try{let f=await Promise.race([o,a]);return u(),f}catch(f){throw u(),f}finally{s.clear()}})()}}l();var Z9=S(W(),1),LB="/ipfs/";function Uc(r){if(r instanceof Uint8Array)try{r=T.decode(r)}catch(i){throw(0,Z9.default)(i,"ERR_INVALID_CID")}let e=T.asCID(r);if(e)return{cid:e,path:void 0};r=r.toString(),r.startsWith(LB)&&(r=r.substring(LB.length));let t=r.split("/"),n;try{e=T.parse(t.shift()||"")}catch(i){throw(0,Z9.default)(i,"ERR_INVALID_CID")}return t.length&&(n=`/${t.join("/")}`),{cid:e,path:n}}var L0e="ERR_BAD_PATH",B4="This command must be run in online mode. Try running 'ipfs daemon' first.",qm=new fn("/local/filesroot"),BB=262144;var UB=r=>{if(T.asCID(r))return`/ipfs/${r}`;let t=r.toString();try{return`/ipfs/${T.parse(t)}`}catch{}if(k4(t))return t;throw(0,L4.default)(new Error(`invalid path: ${r}`),L0e)},Fp=r=>r instanceof Uint8Array?T.decode(r).toString():(r=r.toString(),r.indexOf("/ipfs/")===0&&(r=r.substring(6)),r.charAt(r.length-1)==="/"&&(r=r.substring(0,r.length-1)),r),hu=async function(r,e,t,n={}){let{cid:i,path:s}=Uc(t);s&&(n.path=s);let o=i,a=n.path||"";if(a.startsWith("/")&&(a=a.substring(1)),n.path)try{for await(let{value:c,remainderPath:u}of du(i,n.path,e,r,{signal:n.signal})){if(!T.asCID(c))break;a=u,o=c}}catch(c){throw c.message.startsWith("Object has no property")&&(c.message=`no link named "${a.split("/")[0]}" under ${o}`,c.code="ERR_NO_LINK"),c}return{cid:o,remainderPath:a||""}},J9=r=>{if(r.type!=="file"&&r.type!=="directory"&&r.type!=="raw")throw new Error(`Unknown node type '${r.type}'`);let e={cid:r.cid,path:r.path,name:r.name,size:r.size,type:"file"};return r.type==="directory"&&(e.type="dir"),r.type==="file"&&(e.size=r.unixfs.fileSize()),(r.type==="file"||r.type==="directory")&&(e.mode=r.unixfs.mode,r.unixfs.mtime!==void 0&&(e.mtime=r.unixfs.mtime)),e},MB=z(async(r,e)=>await r),du=async function*(r,e,t,n,i){let s=async u=>{let f=await t.getCodec(u.code),h=await n.blocks.get(u,i);return f.decode(h)},o=e.split("/").filter(Boolean),a=await s(r),c=r;for(;o.length;){let u=o.shift();if(!u)throw(0,L4.default)(new Error(`Could not resolve path "${e}"`),"ERR_INVALID_PATH");if(r.code===We&&Array.isArray(a.Links)){let f=a.Links.find(h=>h.Name===u);if(f){yield{value:f.Hash,remainderPath:o.join("/")},a=await s(f.Hash),c=f.Hash;continue}}if(Object.prototype.hasOwnProperty.call(a,u))a=a[u],yield{value:a,remainderPath:o.join("/")};else throw(0,L4.default)(new Error(`no link named "${u}" under ${c}`),"ERR_NO_LINK");T.asCID(a)&&(c=a,a=await s(a))}yield{value:a,remainderPath:""}};var mi=class{static create({start:e,stop:t}){return new mi(e,t)}static async start(e,t){let{state:n,activate:i}=e;switch(n.status){case"stopped":try{let s=i(t);e.state={status:"starting",ready:s};let o=await s;return e.state={status:"started",value:o},o}catch(s){throw e.state={status:"stopped"},s}case"starting":throw new ih;case"started":throw new sh;case"stopping":return await n.ready,await mi.start(e,t);default:return mi.panic(e)}}static async stop(e){let{state:t,deactivate:n}=e;switch(t.status){case"stopped":break;case"starting":{try{await t.ready}catch{}return await mi.stop(e)}case"stopping":return await t.ready;case"started":{n&&await n(t.value),e.state={status:"stopped"};break}default:mi.panic(t)}}static try({state:e}){switch(e.status){case"started":return e.value;default:return null}}static async use({state:e},t){switch(e.status){case"started":return e.value;case"starting":return await MB(e.ready,t);default:throw new kc}}static panic({state:e}){let t=JSON.stringify({status:e.status});throw RangeError(`Service in invalid state ${t}, should never happen if you see this please report a bug`)}constructor(e,t){this.activate=e,this.deactivate=t,this.state={status:"stopped"}}async use(e){return await mi.use(this,e)}try(){return mi.try(this)}};function FB({network:r,preload:e,peerId:t,keychain:n,repo:i,ipns:s,mfsPreload:o,print:a,hashers:c,options:u}){return async()=>{let{libp2p:h}=await mi.start(r,{peerId:t,repo:i,print:a,hashers:c,options:u});await Promise.all([s.startOnline({keychain:n,libp2p:h,peerId:t,repo:i}),e.start(),o.start()])}}l();function VB({network:r,preload:e,ipns:t,repo:n,mfsPreload:i}){return async()=>{await Promise.all([e.stop(),t.stop(),i.stop()]),await mi.stop(r),await n.close()}}l();l();l();var KB=S($m(),1),U4=class{constructor(e){this.lru=(0,KB.default)(e)}get(e){let t=this.lru.get(e);if(t){if(t.expire&&t.expire<Date.now()){this.lru.remove(e);return}return t.value}}set(e,t,n){this.lru.set(e,{value:t,expire:Date.now()+n})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}};l();var JB=S($B(),1);l();var Gm=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},tv=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},HB=r=>globalThis.DOMException===void 0?new tv(r):new DOMException(r),GB=r=>{let e=r.reason===void 0?HB("This operation was aborted."):r.reason;return e instanceof Error?e:HB(e)};function rv(r,e,t,n){let i,s=new Promise((o,a)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){o(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){let{signal:c}=n;c.aborted&&a(GB(c)),c.addEventListener("abort",()=>{a(GB(c))})}i=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{o(t())}catch(f){a(f)}return}let c=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,u=t instanceof Error?t:new Gm(c);typeof r.cancel=="function"&&r.cancel(),a(u)},e),(async()=>{try{o(await r)}catch(c){a(c)}finally{n.customTimers.clearTimeout.call(void 0,i)}})()});return s.clear=()=>{clearTimeout(i),i=void 0},s}l();l();function nv(r,e,t){let n=0,i=r.length;for(;i>0;){let s=Math.trunc(i/2),o=n+s;t(r[o],e)<=0?(n=++o,i-=s+1):i=s}return n}var uh=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Mc,jm=class{constructor(){Mc.set(this,[])}enqueue(e,t){t={priority:0,...t};let n={priority:t.priority,run:e};if(this.size&&uh(this,Mc,"f")[this.size-1].priority>=t.priority){uh(this,Mc,"f").push(n);return}let i=nv(uh(this,Mc,"f"),n,(s,o)=>o.priority-s.priority);uh(this,Mc,"f").splice(i,0,n)}dequeue(){let e=uh(this,Mc,"f").shift();return e?.run}filter(e){return uh(this,Mc,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return uh(this,Mc,"f").length}};Mc=new WeakMap;var Lr=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},Ee=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Xr,Ym,Qm,mu,$4,Xm,F4,ko,Wm,fs,V4,hs,Zm,pu,z4,jB,WB,XB,YB,QB,K4,iv,sv,H4,ZB,q4,G4=class extends Error{},qt=class extends JB.default{constructor(e){var t,n,i,s;if(super(),Xr.add(this),Ym.set(this,void 0),Qm.set(this,void 0),mu.set(this,0),$4.set(this,void 0),Xm.set(this,void 0),F4.set(this,0),ko.set(this,void 0),Wm.set(this,void 0),fs.set(this,void 0),V4.set(this,void 0),hs.set(this,0),Zm.set(this,void 0),pu.set(this,void 0),z4.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:jm,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);Lr(this,Ym,e.carryoverConcurrencyCount,"f"),Lr(this,Qm,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),Lr(this,$4,e.intervalCap,"f"),Lr(this,Xm,e.interval,"f"),Lr(this,fs,new e.queueClass,"f"),Lr(this,V4,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,Lr(this,z4,e.throwOnTimeout===!0,"f"),Lr(this,pu,e.autoStart===!1,"f")}get concurrency(){return Ee(this,Zm,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);Lr(this,Zm,e,"f"),Ee(this,Xr,"m",H4).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:Ee(this,z4,"f"),...t},new Promise((n,i)=>{Ee(this,fs,"f").enqueue(async()=>{var s,o,a;Lr(this,hs,(o=Ee(this,hs,"f"),o++,o),"f"),Lr(this,mu,(a=Ee(this,mu,"f"),a++,a),"f");try{if(!((s=t.signal)===null||s===void 0)&&s.aborted)throw new G4("The task was aborted.");let c=e({signal:t.signal});t.timeout&&(c=rv(Promise.resolve(c),t.timeout)),t.signal&&(c=Promise.race([c,Ee(this,Xr,"m",ZB).call(this,t.signal)]));let u=await c;n(u),this.emit("completed",u)}catch(c){if(c instanceof Gm&&!t.throwOnTimeout){n();return}i(c),this.emit("error",c)}finally{Ee(this,Xr,"m",XB).call(this)}},t),this.emit("add"),Ee(this,Xr,"m",K4).call(this)})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return Ee(this,pu,"f")?(Lr(this,pu,!1,"f"),Ee(this,Xr,"m",H4).call(this),this):this}pause(){Lr(this,pu,!0,"f")}clear(){Lr(this,fs,new(Ee(this,V4,"f")),"f")}async onEmpty(){Ee(this,fs,"f").size!==0&&await Ee(this,Xr,"m",q4).call(this,"empty")}async onSizeLessThan(e){Ee(this,fs,"f").size<e||await Ee(this,Xr,"m",q4).call(this,"next",()=>Ee(this,fs,"f").size<e)}async onIdle(){Ee(this,hs,"f")===0&&Ee(this,fs,"f").size===0||await Ee(this,Xr,"m",q4).call(this,"idle")}get size(){return Ee(this,fs,"f").size}sizeBy(e){return Ee(this,fs,"f").filter(e).length}get pending(){return Ee(this,hs,"f")}get isPaused(){return Ee(this,pu,"f")}};Ym=new WeakMap,Qm=new WeakMap,mu=new WeakMap,$4=new WeakMap,Xm=new WeakMap,F4=new WeakMap,ko=new WeakMap,Wm=new WeakMap,fs=new WeakMap,V4=new WeakMap,hs=new WeakMap,Zm=new WeakMap,pu=new WeakMap,z4=new WeakMap,Xr=new WeakSet,jB=function(){return Ee(this,Qm,"f")||Ee(this,mu,"f")<Ee(this,$4,"f")},WB=function(){return Ee(this,hs,"f")<Ee(this,Zm,"f")},XB=function(){var e;Lr(this,hs,(e=Ee(this,hs,"f"),e--,e),"f"),Ee(this,Xr,"m",K4).call(this),this.emit("next")},YB=function(){Ee(this,Xr,"m",sv).call(this),Ee(this,Xr,"m",iv).call(this),Lr(this,Wm,void 0,"f")},QB=function(){let e=Date.now();if(Ee(this,ko,"f")===void 0){let t=Ee(this,F4,"f")-e;if(t<0)Lr(this,mu,Ee(this,Ym,"f")?Ee(this,hs,"f"):0,"f");else return Ee(this,Wm,"f")===void 0&&Lr(this,Wm,setTimeout(()=>{Ee(this,Xr,"m",YB).call(this)},t),"f"),!0}return!1},K4=function(){if(Ee(this,fs,"f").size===0)return Ee(this,ko,"f")&&clearInterval(Ee(this,ko,"f")),Lr(this,ko,void 0,"f"),this.emit("empty"),Ee(this,hs,"f")===0&&this.emit("idle"),!1;if(!Ee(this,pu,"f")){let e=!Ee(this,Xr,"a",QB);if(Ee(this,Xr,"a",jB)&&Ee(this,Xr,"a",WB)){let t=Ee(this,fs,"f").dequeue();return t?(this.emit("active"),t(),e&&Ee(this,Xr,"m",iv).call(this),!0):!1}}return!1},iv=function(){Ee(this,Qm,"f")||Ee(this,ko,"f")!==void 0||(Lr(this,ko,setInterval(()=>{Ee(this,Xr,"m",sv).call(this)},Ee(this,Xm,"f")),"f"),Lr(this,F4,Date.now()+Ee(this,Xm,"f"),"f"))},sv=function(){Ee(this,mu,"f")===0&&Ee(this,hs,"f")===0&&Ee(this,ko,"f")&&(clearInterval(Ee(this,ko,"f")),Lr(this,ko,void 0,"f")),Lr(this,mu,Ee(this,Ym,"f")?Ee(this,hs,"f"):0,"f"),Ee(this,Xr,"m",H4).call(this)},H4=function(){for(;Ee(this,Xr,"m",K4).call(this););},ZB=async function(e){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(new G4("The task was aborted."))},{once:!0})})},q4=async function(e,t){return new Promise(n=>{let i=()=>{t&&!t()||(this.off(e,i),n())};this.on(e,i)})};var yU=S(Vp(),1),pv=new U4(1e3),c1e=60*1e3,l1e=qt.default?qt.default:qt,u1e=new l1e({concurrency:4}),gU=r=>{if(r.Path)return r.Path;throw new Error(r.Message)};async function wU(r,e){return(async(n,i={})=>{let s=new URLSearchParams(i);s.set("arg",n);let o=s.toString();if(!i.nocache&&pv.has(o)){let c=pv.get(o);return gU(c)}let a=await u1e.add(async()=>{let c=await yU.default.get("https://ipfs.io/api/v0/dns",{searchParams:s}),u=new URL(c.url).search.slice(1),f=await c.json();return pv.set(u,f,c1e),f});return gU(a)})(r,e)}function f1e(r){return r.endsWith(".eth")&&(r=r.replace(/.eth$/,".eth.link")),r}function bU(){return z(async(e,t={recursive:!0})=>{if(typeof e!="string")throw new Error("Invalid arguments, domain must be a string");return e=f1e(e),wU(e,t)})}l();function EU({network:r}){return()=>{let e=r.try();return e!=null&&Boolean(e.libp2p.isStarted())}}l();l();l();var mv=Symbol.for("@libp2p/peer-id");function Pi(r){return r!=null&&Boolean(r[mv])}var h1e=Symbol.for("nodejs.util.inspect.custom"),_U=Object.values(Ar).map(r=>r.decoder).reduce((r,e)=>r.or(e),Ar.identity.decoder),vU=114,gv=36,yv=37,e2=class{constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[mv](){return!0}toString(){return this.string==null&&(this.string=le.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return T.createV1(vU,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return be(this.multihash.bytes,e);if(typeof e=="string")return ae(e).equals(this);if(e?.multihash?.bytes!=null)return be(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[h1e](){return`PeerId(${this.toString()})`}},fh=class extends e2{constructor(e){super({...e,type:"RSA"}),this.type="RSA",this.publicKey=e.publicKey}},hh=class extends e2{constructor(e){super({...e,type:"Ed25519"}),this.type="Ed25519",this.publicKey=e.multihash.digest}},dh=class extends e2{constructor(e){super({...e,type:"secp256k1"}),this.type="secp256k1",this.publicKey=e.multihash.digest}};function Zr(r){if(r.type==="RSA")return new fh(r);if(r.type==="Ed25519")return new hh(r);if(r.type==="secp256k1")return new dh(r);throw new F("Not a PeerId","ERR_INVALID_PARAMETERS")}function ae(r,e){if(e=e??_U,r.charAt(0)==="1"||r.charAt(0)==="Q"){let t=Ze(le.decode(`z${r}`));return r.startsWith("12D")?new hh({multihash:t}):r.startsWith("16U")?new dh({multihash:t}):new fh({multihash:t})}return Br(_U.decode(r))}function Br(r){try{let e=Ze(r);if(e.code===un.code){if(e.digest.length===gv)return new hh({multihash:e});if(e.digest.length===yv)return new dh({multihash:e})}if(e.code===Le.code)return new fh({multihash:e})}catch{return d1e(T.decode(r))}throw new Error("Supplied PeerID CID is invalid")}function d1e(r){if(r==null||r.multihash==null||r.version==null||r.version===1&&r.code!==vU)throw new Error("Supplied PeerID CID is invalid");let e=r.multihash;if(e.code===Le.code)return new fh({multihash:r.multihash});if(e.code===un.code){if(e.digest.length===gv)return new hh({multihash:r.multihash});if(e.digest.length===yv)return new dh({multihash:r.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function Ur(r,e){return r.length===gv?new hh({multihash:pa(un.code,r),privateKey:e}):r.length===yv?new dh({multihash:pa(un.code,r),privateKey:e}):new fh({multihash:await Le.digest(r),publicKey:r,privateKey:e})}function SU({repo:r,codecs:e,bases:t,name:n}){async function i(s,o={}){if(!k4(s))throw new Error("invalid argument "+s);if(O4(s))for await(let y of n.resolve(s,o))s=y;let[,a,c,...u]=s.split("/"),f=o.cidBase?await t.getBase(o.cidBase):void 0,h=p1e(c);if(u.length===0){let y=f?f.encoder.encode(h):c;return`/${a}/${y}`}let p=T.decode(h);s=u.join("/");let d=du(p,s,e,r,o),m=p,g=s;for await(let y of d)T.asCID(y.value)&&(m=y.value,g=y.remainderPath);return`/ipfs/${m.toString(f&&f.encoder)}${g?"/"+g:""}`}return z(i)}function p1e(r){try{return ae(r).toBytes()}catch{return T.parse(r).bytes}}l();l();l();async function ir(r){let e;for await(let t of r)e=t;return e}function xU({addAll:r}){return(e,t={})=>{let n,i=T.asCID(e);return i?n=r([{cid:i,...t}],t):n=r([{path:e.toString(),...t}],t),ir(n)}}l();l();var zp=S(W(),1);function m1e(r){return Symbol.iterator in r}function g1e(r){return Symbol.asyncIterator in r}function AU(r){return T.asCID(r)!=null}async function*ba(r){if(r==null)throw(0,zp.default)(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT");let e=T.asCID(r);if(e){yield ki({cid:e});return}if(r instanceof String||typeof r=="string"){yield ki({path:r});return}if(r.cid!=null||r.path!=null)return yield ki(r);if(m1e(r)){let t=r[Symbol.iterator](),n=t.next();if(n.done)return t;if(AU(n.value)){yield ki({cid:n.value});for(let i of t)yield ki({cid:i});return}if(n.value instanceof String||typeof n.value=="string"){yield ki({path:n.value});for(let i of t)yield ki({path:i});return}if(n.value.cid!=null||n.value.path!=null){yield ki(n.value);for(let i of t)yield ki(i);return}throw(0,zp.default)(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}if(g1e(r)){let t=r[Symbol.asyncIterator](),n=await t.next();if(n.done)return t;if(AU(n.value)){yield ki({cid:n.value});for await(let i of t)yield ki({cid:i});return}if(n.value instanceof String||typeof n.value=="string"){yield ki({path:n.value});for await(let i of t)yield ki({path:i});return}if(n.value.cid!=null||n.value.path!=null){yield ki(n.value);for await(let i of t)yield ki(i);return}throw(0,zp.default)(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}throw(0,zp.default)(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}function ki(r){let e=r.cid||`${r.path}`;if(!e)throw(0,zp.default)(new Error("Unexpected input: Please path either a CID or an IPFS path"),"ERR_UNEXPECTED_INPUT");let t={path:e,recursive:r.recursive!==!1};return r.metadata!=null&&(t.metadata=r.metadata),t}l();var st={direct:"direct",recursive:"recursive",indirect:"indirect",all:"all"};function TU({repo:r,codecs:e}){async function*t(n,i={}){let s=async function*(){for await(let{path:c,recursive:u,metadata:f}of ba(n)){let{cid:h}=await hu(r,e,c),{reason:p}=await r.pins.isPinnedWithType(h,[st.recursive,st.direct]);if(p==="recursive"&&!u)throw new Error(`${h} already pinned recursively`);u?await r.pins.pinRecursively(h,{metadata:f}):await r.pins.pinDirectly(h,{metadata:f}),yield h}};if(!Boolean(i.lock)){yield*s();return}let a=await r.gcLock.readLock();try{yield*s()}finally{a()}}return z(t)}l();var wv=S(W(),1);function t2(r,e,t){let n={type:r,cid:e};return t&&(n.metadata=t),n}function IU({repo:r,codecs:e}){async function*t(n={}){let i=st.all;if(n.type&&(i=n.type,!Object.keys(st).includes(i)))throw(0,wv.default)(new Error("Invalid pin type"),"ERR_INVALID_PIN_TYPE");if(n.paths){let s=!1;for await(let{path:o}of ba(n.paths)){let{cid:a}=await hu(r,e,o),{reason:c,pinned:u,parent:f,metadata:h}=await r.pins.isPinnedWithType(a,i);if(!u)throw(0,wv.default)(new Error(`path '${o}' is not pinned`),"ERR_NOT_PINNED");switch(c){case st.direct:case st.recursive:s=!0,yield t2(c,a,h);break;default:s=!0,yield t2(`${st.indirect} through ${f}`,a,h)}}if(!s)throw new Error("No match found");return}if(i===st.recursive||i===st.all)for await(let{cid:s,metadata:o}of r.pins.recursiveKeys())yield t2(st.recursive,s,o);if(i===st.indirect||i===st.all)for await(let s of r.pins.indirectKeys(n))yield t2(st.indirect,s);if(i===st.direct||i===st.all)for await(let{cid:s,metadata:o}of r.pins.directKeys())yield t2(st.direct,s,o)}return z(t)}l();function RU({rmAll:r}){async function e(t,n={}){let i=await ir(r([{path:t,...n}],n));if(!i)throw new Error("CID expected");return i}return e}l();function CU({repo:r,codecs:e}){async function*t(n,i={}){let s=await r.gcLock.readLock();try{for await(let{path:o,recursive:a}of ba(n)){let{cid:c}=await hu(r,e,o),{pinned:u,reason:f}=await r.pins.isPinnedWithType(c,st.all);if(!u)throw new Error(`${c} is not pinned`);switch(f){case st.recursive:if(!a)throw new Error(`${c} is pinned recursively`);await r.pins.unpin(c),yield c;break;case st.direct:await r.pins.unpin(c),yield c;break;default:throw new Error(`${c} is pinned indirectly under ${f}`)}}}finally{s()}}return z(t)}var W4=class{constructor({codecs:e,repo:t}){let n=TU({codecs:e,repo:t});this.addAll=n,this.add=xU({addAll:n});let i=CU({codecs:e,repo:t});this.rmAll=i,this.rm=RU({rmAll:i}),this.ls=IU({codecs:e,repo:t}),this.remote={add:(s,o={})=>Promise.reject(new Error("Not implemented")),ls:async function*(s,o={}){return Promise.reject(new Error("Not implemented"))},rm:(s,o={})=>Promise.reject(new Error("Not implemented")),rmAll:(s,o={})=>Promise.reject(new Error("Not implemented")),service:{add:(s,o)=>Promise.reject(new Error("Not implemented")),rm:(s,o={})=>Promise.reject(new Error("Not implemented")),ls:(s={})=>Promise.reject(new Error("Not implemented"))}}}};l();l();var mz=S(W(),1);l();var ds={};jt(ds,{abortedError:()=>y1e,dbDeleteFailedError:()=>Q4,dbOpenFailedError:()=>Y4,dbWriteFailedError:()=>X4,notFoundError:()=>vn});l();var Kp=S(W(),1);function Y4(r){return r=r||new Error("Cannot open database"),(0,Kp.default)(r,"ERR_DB_OPEN_FAILED")}function Q4(r){return r=r||new Error("Delete failed"),(0,Kp.default)(r,"ERR_DB_DELETE_FAILED")}function X4(r){return r=r||new Error("Write failed"),(0,Kp.default)(r,"ERR_DB_WRITE_FAILED")}function vn(r){return r=r||new Error("Not Found"),(0,Kp.default)(r,"ERR_NOT_FOUND")}function y1e(r){return r=r||new Error("Aborted"),(0,Kp.default)(r,"ERR_ABORTED")}var Qs=S(W(),1);l();var iz=S(PU(),1);l();var Fc="/",kU=new TextEncoder().encode(Fc),Z4=kU[0],wi=class{constructor(e,t){if(typeof e=="string")this._buf=U(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Z4)throw new Error("Invalid key")}toString(e="utf8"){return C(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new wi(e.join(Fc))}static random(){return new wi(Tr().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new wi(e):typeof e.uint8Array=="function"?new wi(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=kU),this._buf[0]!==Z4){let e=new Uint8Array(this._buf.byteLength+1);e.fill(Z4,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Z4;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return wi.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Fc).slice(1)}type(){return w1e(this.baseNamespace())}name(){return b1e(this.baseNamespace())}instance(e){return new wi(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Fc)||(e+=Fc),e+=this.type(),new wi(e)}parent(){let e=this.list();return e.length===1?new wi(Fc):new wi(e.slice(0,-1).join(Fc))}child(e){return this.toString()===Fc?e:e.toString()===Fc?this:new wi(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return wi.withNamespaces([...this.namespaces(),...E1e(e.map(t=>t.namespaces()))])}};function w1e(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function b1e(r){let e=r.split(":");return e[e.length-1]}function E1e(r){return[].concat(...r)}var Dw={};jt(Dw,{generateEphemeralKeyPair:()=>DF,generateKeyPair:()=>c0,generateKeyPairFromSeed:()=>rye,importKey:()=>ka,keyStretcher:()=>VF,keysPBM:()=>Jp,marshalPrivateKey:()=>OS,marshalPublicKey:()=>S2,supportedKeys:()=>Pa,unmarshalPrivateKey:()=>Mn,unmarshalPublicKey:()=>Hi});l();var nqe=S(wu(),1),iqe=S(Kv(),1);var Nw=S(Je(),1);var mS={};jt(mS,{Ed25519PrivateKey:()=>Sh,Ed25519PublicKey:()=>d2,generateKeyPair:()=>Ege,generateKeyPairFromSeed:()=>pS,unmarshalEd25519PrivateKey:()=>wge,unmarshalEd25519PublicKey:()=>bge});l();l();l();var H2e=S(Eu(),1);var Bn=BigInt(0),yt=BigInt(1),Au=BigInt(2),G2e=BigInt(8),$M=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),Er=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:$M,n:$M,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")});var YM=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),a2=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),UVe=BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),j2e=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),W2e=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Y2e=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Q2e=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),ft=class{constructor(e,t,n,i){this.x=e,this.y=t,this.z=n,this.t=i}static fromAffine(e){if(!(e instanceof Rr))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(Rr.ZERO)?ft.ZERO:new ft(e.x,e.y,yt,J(e.x*e.y))}static toAffineBatch(e){let t=J2e(e.map(n=>n.z));return e.map((n,i)=>n.toAffine(t[i]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){GM(e);let{x:t,y:n,z:i}=this,{x:s,y:o,z:a}=e,c=J(t*a),u=J(s*i),f=J(n*a),h=J(o*i);return c===u&&f===h}negate(){return new ft(J(-this.x),this.y,this.z,J(-this.t))}double(){let{x:e,y:t,z:n}=this,{a:i}=Er,s=J(e*e),o=J(t*t),a=J(Au*J(n*n)),c=J(i*s),u=e+t,f=J(J(u*u)-s-o),h=c+o,p=h-a,d=c-o,m=J(f*p),g=J(h*d),y=J(f*d),w=J(p*h);return new ft(m,g,w,y)}add(e){GM(e);let{x:t,y:n,z:i,t:s}=this,{x:o,y:a,z:c,t:u}=e,f=J((n-t)*(a+o)),h=J((n+t)*(a-o)),p=J(h-f);if(p===Bn)return this.double();let d=J(i*Au*u),m=J(s*Au*c),g=m+d,y=h+f,w=m-d,b=J(g*p),_=J(y*w),v=J(g*w),I=J(p*y);return new ft(b,_,I,v)}subtract(e){return this.add(e.negate())}precomputeWindow(e){let t=1+256/e,n=[],i=this,s=i;for(let o=0;o<t;o++){s=i,n.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(i),n.push(s);i=s.double()}return n}wNAF(e,t){!t&&this.equals(ft.BASE)&&(t=Rr.BASE);let n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=t&&jv.get(t);i||(i=this.precomputeWindow(n),t&&n!==1&&(i=ft.normalizeZ(i),jv.set(t,i)));let s=ft.ZERO,o=ft.BASE,a=1+256/n,c=2**(n-1),u=BigInt(2**n-1),f=2**n,h=BigInt(n);for(let p=0;p<a;p++){let d=p*c,m=Number(e&u);e>>=h,m>c&&(m-=f,e+=yt);let g=d,y=d+Math.abs(m)-1,w=p%2!==0,b=m<0;m===0?o=o.add(HM(w,i[g])):s=s.add(HM(b,i[y]))}return ft.normalizeZ([s,o])[0]}multiply(e,t){return this.wNAF(yw(e,Er.l),t)}multiplyUnsafe(e){let t=yw(e,Er.l,!1),n=ft.BASE,i=ft.ZERO;if(t===Bn)return i;if(this.equals(i)||t===yt)return this;if(this.equals(n))return this.wNAF(t);let s=i,o=this;for(;t>Bn;)t&yt&&(s=s.add(o)),o=o.double(),t>>=yt;return s}isSmallOrder(){return this.multiplyUnsafe(Er.h).equals(ft.ZERO)}isTorsionFree(){let e=this.multiplyUnsafe(Er.l/Au).double();return Er.l%Au&&(e=e.add(this)),e.equals(ft.ZERO)}toAffine(e){let{x:t,y:n,z:i}=this,s=this.equals(ft.ZERO);e==null&&(e=s?G2e:ww(i));let o=J(t*e),a=J(n*e),c=J(i*e);if(s)return Rr.ZERO;if(c!==yt)throw new Error("invZ was invalid");return new Rr(o,a)}fromRistrettoBytes(){$v()}toRistrettoBytes(){$v()}fromRistrettoHash(){$v()}};ft.BASE=new ft(Er.Gx,Er.Gy,yt,J(Er.Gx*Er.Gy));ft.ZERO=new ft(Bn,yt,yt,Bn);function HM(r,e){let t=e.negate();return r?t:e}function GM(r){if(!(r instanceof ft))throw new TypeError("ExtendedPoint expected")}function qv(r){if(!(r instanceof qi))throw new TypeError("RistrettoPoint expected")}function $v(){throw new Error("Legacy method: switch to RistrettoPoint")}var qi=class{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){let{d:t}=Er,n=J(a2*e*e),i=J((n+yt)*Y2e),s=BigInt(-1),o=J((s-t*n)*J(n+t)),{isValid:a,value:c}=Yv(i,o),u=J(c*e);xu(u)||(u=J(-u)),a||(c=u),a||(s=n);let f=J(s*(n-yt)*Q2e-o),h=c*c,p=J((c+c)*o),d=J(f*j2e),m=J(yt-h),g=J(yt+h);return new ft(J(p*g),J(m*d),J(d*g),J(p*m))}static hashToCurve(e){e=Tu(e,64);let t=Hv(e.slice(0,32)),n=this.calcElligatorRistrettoMap(t),i=Hv(e.slice(32,64)),s=this.calcElligatorRistrettoMap(i);return new qi(n.add(s))}static fromHex(e){e=Tu(e,32);let{a:t,d:n}=Er,i="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",s=Hv(e);if(!tge(c2(s),e)||xu(s))throw new Error(i);let o=J(s*s),a=J(yt+t*o),c=J(yt-t*o),u=J(a*a),f=J(c*c),h=J(t*n*u-f),{isValid:p,value:d}=WM(J(h*f)),m=J(d*c),g=J(d*m*h),y=J((s+s)*m);xu(y)&&(y=J(-y));let w=J(a*g),b=J(y*w);if(!p||xu(b)||w===Bn)throw new Error(i);return new qi(new ft(y,w,yt,b))}toRawBytes(){let{x:e,y:t,z:n,t:i}=this.ep,s=J(J(n+t)*J(n-t)),o=J(e*t),a=J(o*o),{value:c}=WM(J(s*a)),u=J(c*s),f=J(c*o),h=J(u*f*i),p;if(xu(i*h)){let m=J(t*a2),g=J(e*a2);e=m,t=g,p=J(u*W2e)}else p=f;xu(e*h)&&(t=J(-t));let d=J((n-t)*p);return xu(d)&&(d=J(-d)),c2(d)}toHex(){return l2(this.toRawBytes())}toString(){return this.toHex()}equals(e){qv(e);let t=this.ep,n=e.ep,i=J(t.x*n.y)===J(t.y*n.x),s=J(t.y*n.y)===J(t.x*n.x);return i||s}add(e){return qv(e),new qi(this.ep.add(e.ep))}subtract(e){return qv(e),new qi(this.ep.subtract(e.ep))}multiply(e){return new qi(this.ep.multiply(e))}multiplyUnsafe(e){return new qi(this.ep.multiplyUnsafe(e))}};qi.BASE=new qi(ft.BASE);qi.ZERO=new qi(ft.ZERO);var jv=new WeakMap,Rr=class{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,jv.delete(this)}static fromHex(e,t=!0){let{d:n,P:i}=Er;e=Tu(e,32);let s=e.slice();s[31]=e[31]&-129;let o=u2(s);if(t&&o>=i)throw new Error("Expected 0 < hex < P");if(!t&&o>=YM)throw new Error("Expected 0 < hex < 2**256");let a=J(o*o),c=J(a-yt),u=J(n*a+yt),{isValid:f,value:h}=Yv(c,u);if(!f)throw new Error("Point.fromHex: invalid y coordinate");let p=(h&yt)===yt;return(e[31]&128)!==0!==p&&(h=J(-h)),new Rr(h,o)}static async fromPrivateKey(e){return(await bw(e)).point}toRawBytes(){let e=c2(this.y);return e[31]|=this.x&yt?128:0,e}toHex(){return l2(this.toRawBytes())}toX25519(){let{y:e}=this,t=J((yt+e)*ww(yt-e));return c2(t)}isTorsionFree(){return ft.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Rr(J(-this.x),this.y)}add(e){return ft.fromAffine(this).add(ft.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return ft.fromAffine(this).multiply(e,this).toAffine()}};Rr.BASE=new Rr(Er.Gx,Er.Gy);Rr.ZERO=new Rr(Bn,yt);var bh=class{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){let t=Tu(e,64),n=Rr.fromHex(t.slice(0,32),!1),i=u2(t.slice(32,64));return new bh(n,i)}assertValidity(){let{r:e,s:t}=this;if(!(e instanceof Rr))throw new Error("Expected Point instance");return yw(t,Er.l,!1),this}toRawBytes(){let e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(c2(this.s),32),e}toHex(){return l2(this.toRawBytes())}};function jM(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(r.length===1)return r[0];let e=r.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){let s=r[n];t.set(s,i),i+=s.length}return t}var X2e=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function l2(r){if(!(r instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=X2e[r[t]];return e}function Wv(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex");let e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){let n=t*2,i=r.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[t]=s}return e}function QM(r){let t=r.toString(16).padStart(64,"0");return Wv(t)}function c2(r){return QM(r).reverse()}function xu(r){return(J(r)&yt)===yt}function u2(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+l2(Uint8Array.from(r).reverse()))}var Z2e=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function Hv(r){return J(u2(r)&Z2e)}function J(r,e=Er.P){let t=r%e;return t>=Bn?t:e+t}function ww(r,e=Er.P){if(r===Bn||e<=Bn)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=J(r,e),n=e,i=Bn,s=yt,o=yt,a=Bn;for(;t!==Bn;){let u=n/t,f=n%t,h=i-o*u,p=s-a*u;n=t,t=f,i=o,s=a,o=h,a=p}if(n!==yt)throw new Error("invert: does not exist");return J(i,e)}function J2e(r,e=Er.P){let t=new Array(r.length),n=r.reduce((s,o,a)=>o===Bn?s:(t[a]=s,J(s*o,e)),yt),i=ww(n,e);return r.reduceRight((s,o,a)=>o===Bn?s:(t[a]=J(s*t[a],e),J(s*o,e)),i),t}function Ta(r,e){let{P:t}=Er,n=r;for(;e-- >Bn;)n*=n,n%=t;return n}function ege(r){let{P:e}=Er,t=BigInt(5),n=BigInt(10),i=BigInt(20),s=BigInt(40),o=BigInt(80),c=r*r%e*r%e,u=Ta(c,Au)*c%e,f=Ta(u,yt)*r%e,h=Ta(f,t)*f%e,p=Ta(h,n)*h%e,d=Ta(p,i)*p%e,m=Ta(d,s)*d%e,g=Ta(m,o)*m%e,y=Ta(g,o)*m%e,w=Ta(y,n)*h%e;return{pow_p_5_8:Ta(w,Au)*r%e,b2:c}}function Yv(r,e){let t=J(e*e*e),n=J(t*t*e),i=ege(r*n).pow_p_5_8,s=J(r*t*i),o=J(e*s*s),a=s,c=J(s*a2),u=o===r,f=o===J(-r),h=o===J(-r*a2);return u&&(s=a),(f||h)&&(s=c),xu(s)&&(s=J(-s)),{isValid:u||f,value:s}}function WM(r){return Yv(yt,r)}function gw(r){return J(u2(r),Er.l)}function tge(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Tu(r,e){let t=r instanceof Uint8Array?Uint8Array.from(r):Wv(r);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function yw(r,e,t=!0){if(!e)throw new TypeError("Specify max value");if(typeof r=="number"&&Number.isSafeInteger(r)&&(r=BigInt(r)),typeof r=="bigint"&&r<e){if(t){if(Bn<r)return r}else if(Bn<=r)return r}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function rge(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function nge(r){if(r=typeof r=="bigint"||typeof r=="number"?QM(yw(r,YM)):Tu(r),r.length!==32)throw new Error("Expected 32 bytes");return r}function ige(r){let e=rge(r.slice(0,32)),t=r.slice(32,64),n=gw(e),i=Rr.BASE.multiply(n),s=i.toRawBytes();return{head:e,prefix:t,scalar:n,point:i,pointBytes:s}}var Gv;async function bw(r){return ige(await Iu.sha512(nge(r)))}async function Qv(r){return(await bw(r)).pointBytes}async function XM(r,e){r=Tu(r);let{prefix:t,scalar:n,pointBytes:i}=await bw(e),s=gw(await Iu.sha512(t,r)),o=Rr.BASE.multiply(s),a=gw(await Iu.sha512(o.toRawBytes(),i,r)),c=J(s+a*n,Er.l);return new bh(o,c).toRawBytes()}function sge(r,e,t){e=Tu(e),t instanceof Rr||(t=Rr.fromHex(t,!1));let{r:n,s:i}=r instanceof bh?r.assertValidity():bh.fromHex(r),s=ft.BASE.multiplyUnsafe(i);return{r:n,s:i,SB:s,pub:t,msg:e}}function oge(r,e,t,n){let i=gw(n),s=ft.fromAffine(r).multiplyUnsafe(i);return ft.fromAffine(e).add(s).subtract(t).multiplyUnsafe(Er.h).equals(ft.ZERO)}async function ZM(r,e,t){let{r:n,SB:i,msg:s,pub:o}=sge(r,e,t),a=await Iu.sha512(n.toRawBytes(),o.toRawBytes(),s);return oge(o,n,i,a)}Rr.BASE._setWindowSize(8);var Su={node:H2e,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Iu={bytesToHex:l2,hexToBytes:Wv,concatBytes:jM,getExtendedPublicKey:bw,mod:J,invert:ww,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:r=>{if(r=Tu(r),r.length<40||r.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return J(u2(r),Er.l-yt)+yt},randomBytes:(r=32)=>{if(Su.web)return Su.web.getRandomValues(new Uint8Array(r));if(Su.node){let{randomBytes:e}=Su.node;return new Uint8Array(e(r).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Iu.randomBytes(32),sha512:async(...r)=>{let e=jM(...r);if(Su.web){let t=await Su.web.subtle.digest("SHA-512",e.buffer);return new Uint8Array(t)}else{if(Su.node)return Uint8Array.from(Su.node.createHash("sha512").update(e).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(r=8,e=Rr.BASE){let t=e.equals(Rr.BASE)?e:new Rr(e.x,e.y);return t._setWindowSize(r),t.multiply(Au),t},sha512Sync:void 0};Object.defineProperties(Iu,{sha512Sync:{configurable:!1,get(){return Gv},set(r){Gv||(Gv=r)}}});var Yp=32,qc=64,Ew=32;async function JM(){let r=Iu.randomPrivateKey(),e=await Qv(r);return{privateKey:nF(r,e),publicKey:e}}async function eF(r){if(r.length!==Ew)throw new TypeError('"seed" must be 32 bytes in length.');if(!(r instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let e=r,t=await Qv(e);return{privateKey:nF(e,t),publicKey:t}}async function tF(r,e){let t=r.subarray(0,Ew);return XM(e,t)}async function rF(r,e,t){return ZM(e,t,r)}function nF(r,e){let t=new Uint8Array(qc);for(let n=0;n<Ew;n++)t[n]=r[n],t[Ew+n]=e[n];return t}l();l();l();var Jr={get(r=globalThis){let e=r.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}};var Xv={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function _w(r){let e=r?.algorithm??"AES-GCM",t=r?.keyLength??16,n=r?.nonceLength??12,i=r?.digest??"SHA-256",s=r?.saltLength??16,o=r?.iterations??32767,a=Jr.get();t*=8;async function c(h,p){let d=a.getRandomValues(new Uint8Array(s)),m=a.getRandomValues(new Uint8Array(n)),g={name:e,iv:m};typeof p=="string"&&(p=U(p));let y;if(p.length===0){y=await a.subtle.importKey("jwk",Xv,{name:"AES-GCM"},!0,["encrypt"]);try{let b={name:"PBKDF2",salt:d,iterations:o,hash:{name:i}},_=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(b,_,{name:e,length:t},!0,["encrypt"])}catch{y=await a.subtle.importKey("jwk",Xv,{name:"AES-GCM"},!0,["encrypt"])}}else{let b={name:"PBKDF2",salt:d,iterations:o,hash:{name:i}},_=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(b,_,{name:e,length:t},!0,["encrypt"])}let w=await a.subtle.encrypt(g,y,h);return Z([d,g.iv,new Uint8Array(w)])}async function u(h,p){let d=h.subarray(0,s),m=h.subarray(s,s+n),g=h.subarray(s+n),y={name:e,iv:m};typeof p=="string"&&(p=U(p));let w;if(p.length===0)try{let _={name:"PBKDF2",salt:d,iterations:o,hash:{name:i}},v=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(_,v,{name:e,length:t},!0,["decrypt"])}catch{w=await a.subtle.importKey("jwk",Xv,{name:"AES-GCM"},!0,["decrypt"])}else{let _={name:"PBKDF2",salt:d,iterations:o,hash:{name:i}},v=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(_,v,{name:e,length:t},!0,["decrypt"])}let b=await a.subtle.decrypt(y,w,g);return new Uint8Array(b)}return{encrypt:c,decrypt:u}}async function Qp(r,e){let n=await _w().encrypt(r,e);return fa.encode(n)}var Jp={};jt(Jp,{KeyType:()=>_r,PrivateKey:()=>Bo,PublicKey:()=>Lo});l();l();l();l();var lS=S(tS(),1),AF=S(yF(),1),TF=S(_h(),1),uS=S(cS(),1),IF=S(xF(),1);function mge(){TF.default._configure(),lS.default._configure(AF.default),uS.default._configure(IF.default)}mge();var RF=["uint64","int64","sint64","fixed64","sfixed64"];function gge(r){for(let e of RF){if(r[e]==null)continue;let t=r[e];r[e]=function(){return BigInt(t.call(this).toString())}}return r}function fS(r){return gge(new lS.default(r))}function yge(r){for(let e of RF){if(r[e]==null)continue;let t=r[e];r[e]=function(n){return t.call(this,n.toString())}}return r}function hS(){return yge(uS.default.create())}function sr(r,e){let t=fS(r instanceof Uint8Array?r:r.subarray());return e.decode(t)}l();function or(r,e){let t=hS();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}l();l();var Xp;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(Xp||(Xp={}));function xw(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function Zp(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}let t=function(s,o){let a=e(s);o.int32(a)},n=function(s){let o=s.int32();return e(o)};return xw("enum",Xp.VARINT,t,n)}l();function ar(r,e){return xw("message",Xp.LENGTH_DELIMITED,r,e)}var _r;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.Secp256k1="Secp256k1"})(_r||(_r={}));var dS;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.Secp256k1=2]="Secp256k1"})(dS||(dS={}));(function(r){r.codec=()=>Zp(dS)})(_r||(_r={}));var Lo;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),_r.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.Type=_r.codec().decode(t);break;case 2:i.Data=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(Lo||(Lo={}));var Bo;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),_r.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.Type=_r.codec().decode(t);break;case 2:i.Data=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(Bo||(Bo={}));var d2=class{_key;constructor(e){this._key=e0(e,Yp)}async verify(e,t){return rF(this._key,t,e)}marshal(){return this._key}get bytes(){return Lo.encode({Type:_r.Ed25519,Data:this.marshal()}).subarray()}equals(e){return be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Le.digest(this.bytes);return e}},Sh=class{_key;_publicKey;constructor(e,t){this._key=e0(e,qc),this._publicKey=e0(t,Yp)}async sign(e){return tF(this._key,e)}get public(){return new d2(this._publicKey)}marshal(){return this._key}get bytes(){return Bo.encode({Type:_r.Ed25519,Data:this.marshal()}).subarray()}equals(e){return be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Le.digest(this.bytes);return e}async id(){let e=un.digest(this.public.bytes);return le.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if(t==="libp2p-key")return Qp(this.bytes,e);throw new F(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function wge(r){if(r.length>qc){r=e0(r,qc+Yp);let n=r.subarray(0,qc),i=r.subarray(qc,r.length);return new Sh(n,i)}r=e0(r,qc);let e=r.subarray(0,qc),t=r.subarray(Yp);return new Sh(e,t)}function bge(r){return r=e0(r,Yp),new d2(r)}async function Ege(){let{privateKey:r,publicKey:e}=await JM();return new Sh(r,e)}async function pS(r){let{privateKey:e,publicKey:t}=await eF(r);return new Sh(e,t)}function e0(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new F(`Key must be a Uint8Array of length ${e}, got ${r.length}`,"ERR_INVALID_KEY_TYPE");return r}l();l();l();var Fze=S(hr(),1),Vze=S(dw(),1),CF=S(Je(),1);function Uo(r,e){let t=Uint8Array.from(r.abs().toByteArray());if(t=t[0]===0?t.subarray(1):t,e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=Z([new Uint8Array(e-t.length),t])}return C(t,"base64url")}function ps(r){let e=Aw(r);return new CF.default.jsbn.BigInteger(C(e,"base16"),16)}function Aw(r,e){let t=U(r,"base64urlpad");if(e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=Z([new Uint8Array(e-t.length),t])}return t}var PF={"P-256":256,"P-384":384,"P-521":521},_ge=Object.keys(PF),gS=_ge.join(" / ");async function kF(r){if(r!=="P-256"&&r!=="P-384"&&r!=="P-521")throw new F(`Unknown curve: ${r}. Must be ${gS}`,"ERR_INVALID_CURVE");let e=await Jr.get().subtle.generateKey({name:"ECDH",namedCurve:r},!0,["deriveBits"]),t=async(s,o)=>{let a;o!=null?a=await Jr.get().subtle.importKey("jwk",Sge(r,o),{name:"ECDH",namedCurve:r},!1,["deriveBits"]):a=e.privateKey;let c=await Jr.get().subtle.importKey("jwk",NF(r,s),{name:"ECDH",namedCurve:r},!1,[]),u=await Jr.get().subtle.deriveBits({name:"ECDH",namedCurve:r,public:c},a,PF[r]);return new Uint8Array(u,0,u.byteLength)},n=await Jr.get().subtle.exportKey("jwk",e.publicKey);return{key:vge(n),genSharedKey:t}}var OF={"P-256":32,"P-384":48,"P-521":66};function vge(r){if(r.crv==null||r.x==null||r.y==null)throw new F("JWK was missing components","ERR_INVALID_PARAMETERS");if(r.crv!=="P-256"&&r.crv!=="P-384"&&r.crv!=="P-521")throw new F(`Unknown curve: ${r.crv}. Must be ${gS}`,"ERR_INVALID_CURVE");let e=OF[r.crv];return Z([Uint8Array.from([4]),Aw(r.x,e),Aw(r.y,e)],1+e*2)}function NF(r,e){if(r!=="P-256"&&r!=="P-384"&&r!=="P-521")throw new F(`Unknown curve: ${r}. Must be ${gS}`,"ERR_INVALID_CURVE");let t=OF[r];if(!be(e.subarray(0,1),Uint8Array.from([4])))throw new F("Cannot unmarshal public key - invalid key format","ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:r,x:C(e.subarray(1,t+1),"base64url"),y:C(e.subarray(1+t),"base64url"),ext:!0}}var Sge=(r,e)=>({...NF(r,e.public),d:C(e.private,"base64url")});var DF=kF;l();async function LF(r,e){let t=fa.decode(r);return _w().decrypt(t,e)}l();l();l();var BF={SHA1:20,SHA256:32,SHA512:64};var xge={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},Age=async(r,e)=>{let t=await Jr.get().subtle.sign({name:"HMAC"},r,e);return new Uint8Array(t,0,t.byteLength)};async function UF(r,e){let t=xge[r],n=await Jr.get().subtle.importKey("raw",e,{name:"HMAC",hash:{name:t}},!1,["sign"]);return{async digest(i){return Age(n,i)},length:BF[r]}}var FF={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,keySize:32}};async function VF(r,e,t){let n=FF[r];if(n==null){let b=Object.keys(FF).join(" / ");throw new F(`unknown cipher type '${r}'. Must be ${b}`,"ERR_INVALID_CIPHER_TYPE")}if(e==null)throw new F("missing hash type","ERR_MISSING_HASH_TYPE");let i=n.keySize,s=n.ivSize,o=20,a=U("key expansion"),c=2*(s+i+o),u=await UF(e,t),f=await u.digest(a),h=[],p=0;for(;p<c;){let b=await u.digest(Z([f,a])),_=b.length;p+_>c&&(_=c-p),h.push(b),p+=_,f=await u.digest(f)}let d=c/2,m=Z(h),g=m.subarray(0,d),y=m.subarray(d,c),w=b=>({iv:b.subarray(0,s),cipherKey:b.subarray(s,s+i),macKey:b.subarray(s+i)});return{k1:w(g),k2:w(y)}}var IS={};jt(IS,{RsaPrivateKey:()=>a0,RsaPublicKey:()=>E2,fromJwk:()=>Qge,generateKeyPair:()=>Xge,unmarshalRsaPrivateKey:()=>Wge,unmarshalRsaPublicKey:()=>Yge});l();var b2=S(Je(),1);var $Ke=S(HF(),1);l();l();l();var Ige=S(Eu(),1);var wt=BigInt(0),Sr=BigInt(1),ku=BigInt(2),g2=BigInt(3),GF=BigInt(8),qr=Object.freeze({a:wt,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:Sr,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),jF=(r,e)=>(r+e/ku)/e,Tw={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(r){let{n:e}=qr,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Sr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=jF(s*r,e),c=jF(-n*r,e),u=me(r-a*t-c*i,e),f=me(-a*n-c*s,e),h=u>o,p=f>o;if(h&&(u=e-u),p&&(f=e-f),u>o||f>o)throw new Error("splitScalarEndo: Endomorphism failed, k="+r);return{k1neg:h,k1:u,k2neg:p,k2:f}}},Mo=32,n0=32,Rge=32,WF=Mo+1,YF=2*Mo+1;function QF(r){let{a:e,b:t}=qr,n=me(r*r),i=me(n*r);return me(i+e*r+t)}var Iw=qr.a===wt,Pw=class extends Error{constructor(e){super(e)}};function XF(r){if(!(r instanceof It))throw new TypeError("JacobianPoint expected")}var It=class{constructor(e,t,n){this.x=e,this.y=t,this.z=n}static fromAffine(e){if(!(e instanceof $t))throw new TypeError("JacobianPoint#fromAffine: expected Point");return e.equals($t.ZERO)?It.ZERO:new It(e.x,e.y,Sr)}static toAffineBatch(e){let t=Nge(e.map(n=>n.z));return e.map((n,i)=>n.toAffine(t[i]))}static normalizeZ(e){return It.toAffineBatch(e).map(It.fromAffine)}equals(e){XF(e);let{x:t,y:n,z:i}=this,{x:s,y:o,z:a}=e,c=me(i*i),u=me(a*a),f=me(t*u),h=me(s*c),p=me(me(n*a)*u),d=me(me(o*i)*c);return f===h&&p===d}negate(){return new It(this.x,me(-this.y),this.z)}double(){let{x:e,y:t,z:n}=this,i=me(e*e),s=me(t*t),o=me(s*s),a=e+s,c=me(ku*(me(a*a)-i-o)),u=me(g2*i),f=me(u*u),h=me(f-ku*c),p=me(u*(c-h)-GF*o),d=me(ku*t*n);return new It(h,p,d)}add(e){XF(e);let{x:t,y:n,z:i}=this,{x:s,y:o,z:a}=e;if(s===wt||o===wt)return this;if(t===wt||n===wt)return e;let c=me(i*i),u=me(a*a),f=me(t*u),h=me(s*c),p=me(me(n*a)*u),d=me(me(o*i)*c),m=me(h-f),g=me(d-p);if(m===wt)return g===wt?this.double():It.ZERO;let y=me(m*m),w=me(m*y),b=me(f*y),_=me(g*g-w-ku*b),v=me(g*(b-_)-p*w),I=me(i*a*m);return new It(_,v,I)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){let t=It.ZERO;if(typeof e=="bigint"&&e===wt)return t;let n=eV(e);if(n===Sr)return this;if(!Iw){let h=t,p=this;for(;n>wt;)n&Sr&&(h=h.add(p)),p=p.double(),n>>=Sr;return h}let{k1neg:i,k1:s,k2neg:o,k2:a}=Tw.splitScalar(n),c=t,u=t,f=this;for(;s>wt||a>wt;)s&Sr&&(c=c.add(f)),a&Sr&&(u=u.add(f)),f=f.double(),s>>=Sr,a>>=Sr;return i&&(c=c.negate()),o&&(u=u.negate()),u=new It(me(u.x*Tw.beta),u.y,u.z),c.add(u)}precomputeWindow(e){let t=Iw?128/e+1:256/e+1,n=[],i=this,s=i;for(let o=0;o<t;o++){s=i,n.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(i),n.push(s);i=s.double()}return n}wNAF(e,t){!t&&this.equals(It.BASE)&&(t=$t.BASE);let n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=t&&ES.get(t);i||(i=this.precomputeWindow(n),t&&n!==1&&(i=It.normalizeZ(i),ES.set(t,i)));let s=It.ZERO,o=It.BASE,a=1+(Iw?128/n:256/n),c=2**(n-1),u=BigInt(2**n-1),f=2**n,h=BigInt(n);for(let p=0;p<a;p++){let d=p*c,m=Number(e&u);e>>=h,m>c&&(m-=f,e+=Sr);let g=d,y=d+Math.abs(m)-1,w=p%2!==0,b=m<0;m===0?o=o.add(Rw(w,i[g])):s=s.add(Rw(b,i[y]))}return{p:s,f:o}}multiply(e,t){let n=eV(e),i,s;if(Iw){let{k1neg:o,k1:a,k2neg:c,k2:u}=Tw.splitScalar(n),{p:f,f:h}=this.wNAF(a,t),{p,f:d}=this.wNAF(u,t);f=Rw(o,f),p=Rw(c,p),p=new It(me(p.x*Tw.beta),p.y,p.z),i=f.add(p),s=h.add(d)}else{let{p:o,f:a}=this.wNAF(n,t);i=o,s=a}return It.normalizeZ([i,s])[0]}toAffine(e){let{x:t,y:n,z:i}=this,s=this.equals(It.ZERO);e==null&&(e=s?GF:o0(i));let o=e,a=me(o*o),c=me(a*o),u=me(t*a),f=me(n*c),h=me(i*o);if(s)return $t.ZERO;if(h!==Sr)throw new Error("invZ was invalid");return new $t(u,f)}};It.BASE=new It(qr.Gx,qr.Gy,Sr);It.ZERO=new It(wt,Sr,wt);function Rw(r,e){let t=e.negate();return r?t:e}var ES=new WeakMap,$t=class{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,ES.delete(this)}hasEvenY(){return this.y%ku===wt}static fromCompressedHex(e){let t=e.length===32,n=Ou(t?e:e.subarray(1));if(!bS(n))throw new Error("Point is not on curve");let i=QF(n),s=Oge(i),o=(s&Sr)===Sr;t?o&&(s=me(-s)):(e[0]&1)===1!==o&&(s=me(-s));let a=new $t(n,s);return a.assertValidity(),a}static fromUncompressedHex(e){let t=Ou(e.subarray(1,Mo+1)),n=Ou(e.subarray(Mo+1,Mo*2+1)),i=new $t(t,n);return i.assertValidity(),i}static fromHex(e){let t=s0(e),n=t.length,i=t[0];if(n===Mo)return this.fromCompressedHex(t);if(n===WF&&(i===2||i===3))return this.fromCompressedHex(t);if(n===YF&&i===4)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-${WF} compressed bytes or ${YF} uncompressed bytes, not ${n}`)}static fromPrivateKey(e){return $t.BASE.multiply(Ow(e))}static fromSignature(e,t,n){let{r:i,s}=tV(t);if(![0,1,2,3].includes(n))throw new Error("Cannot recover: invalid recovery bit");let o=SS(s0(e)),{n:a}=qr,c=n===2||n===3?i+a:i,u=o0(c,a),f=me(-o*u,a),h=me(s*u,a),p=n&1?"03":"02",d=$t.fromHex(p+t0(c)),m=$t.BASE.multiplyAndAddUnsafe(d,f,h);if(!m)throw new Error("Cannot recover signature: point at infinify");return m.assertValidity(),m}toRawBytes(e=!1){return Ah(this.toHex(e))}toHex(e=!1){let t=t0(this.x);return e?`${this.hasEvenY()?"02":"03"}${t}`:`04${t}${t0(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let e="Point is not on elliptic curve",{x:t,y:n}=this;if(!bS(t)||!bS(n))throw new Error(e);let i=me(n*n),s=QF(t);if(me(i-s)!==wt)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new $t(this.x,me(-this.y))}double(){return It.fromAffine(this).double().toAffine()}add(e){return It.fromAffine(this).add(It.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return It.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,n){let i=It.fromAffine(this),s=t===wt||t===Sr||this!==$t.BASE?i.multiplyUnsafe(t):i.multiply(t),o=It.fromAffine(e).multiplyUnsafe(n),a=s.add(o);return a.equals(It.ZERO)?void 0:a.toAffine()}};$t.BASE=new $t(qr.Gx,qr.Gy);$t.ZERO=new $t(wt,wt);function ZF(r){return Number.parseInt(r[0],16)>=8?"00"+r:r}function JF(r){if(r.length<2||r[0]!==2)throw new Error(`Invalid signature integer tag: ${i0(r)}`);let e=r[1],t=r.subarray(2,e+2);if(!e||t.length!==e)throw new Error("Invalid signature integer: wrong length");if(t[0]===0&&t[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:Ou(t),left:r.subarray(e+2)}}function Cge(r){if(r.length<2||r[0]!=48)throw new Error(`Invalid signature tag: ${i0(r)}`);if(r[1]!==r.length-2)throw new Error("Invalid signature: incorrect length");let{data:e,left:t}=JF(r.subarray(2)),{data:n,left:i}=JF(t);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${i0(i)}`);return{r:e,s:n}}var Ca=class{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){let t=e instanceof Uint8Array,n="Signature.fromCompact";if(typeof e!="string"&&!t)throw new TypeError(`${n}: Expected string or Uint8Array`);let i=t?i0(e):e;if(i.length!==128)throw new Error(`${n}: Expected 64-byte hex`);return new Ca(kw(i.slice(0,64)),kw(i.slice(64,128)))}static fromDER(e){let t=e instanceof Uint8Array;if(typeof e!="string"&&!t)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");let{r:n,s:i}=Cge(t?e:Ah(e));return new Ca(n,i)}static fromHex(e){return this.fromDER(e)}assertValidity(){let{r:e,s:t}=this;if(!w2(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!w2(t))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){let e=qr.n>>Sr;return this.s>e}normalizeS(){return this.hasHighS()?new Ca(this.r,me(-this.s,qr.n)):this}toDERRawBytes(){return Ah(this.toDERHex())}toDERHex(){let e=ZF(m2(this.s)),t=ZF(m2(this.r)),n=e.length/2,i=t.length/2,s=m2(n),o=m2(i);return`30${m2(i+n+4)}02${o}${t}02${s}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return Ah(this.toCompactHex())}toCompactHex(){return t0(this.r)+t0(this.s)}};function Pu(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Uint8Array list expected");if(r.length===1)return r[0];let e=r.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){let s=r[n];t.set(s,i),i+=s.length}return t}var Pge=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function i0(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let t=0;t<r.length;t++)e+=Pge[r[t]];return e}var kge=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function t0(r){if(typeof r!="bigint")throw new Error("Expected bigint");if(!(wt<=r&&r<kge))throw new Error("Expected number 0 <= n < 2^256");return r.toString(16).padStart(64,"0")}function _S(r){let e=Ah(t0(r));if(e.length!==32)throw new Error("Error: expected 32 bytes");return e}function m2(r){let e=r.toString(16);return e.length&1?`0${e}`:e}function kw(r){if(typeof r!="string")throw new TypeError("hexToNumber: expected string, got "+typeof r);return BigInt(`0x${r}`)}function Ah(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+r.length);let e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){let n=t*2,i=r.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[t]=s}return e}function Ou(r){return kw(i0(r))}function s0(r){return r instanceof Uint8Array?Uint8Array.from(r):Ah(r)}function eV(r){if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)return BigInt(r);if(typeof r=="bigint"&&w2(r))return r;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function me(r,e=qr.P){let t=r%e;return t>=wt?t:e+t}function js(r,e){let{P:t}=qr,n=r;for(;e-- >wt;)n*=n,n%=t;return n}function Oge(r){let{P:e}=qr,t=BigInt(6),n=BigInt(11),i=BigInt(22),s=BigInt(23),o=BigInt(44),a=BigInt(88),c=r*r*r%e,u=c*c*r%e,f=js(u,g2)*u%e,h=js(f,g2)*u%e,p=js(h,ku)*c%e,d=js(p,n)*p%e,m=js(d,i)*d%e,g=js(m,o)*m%e,y=js(g,a)*g%e,w=js(y,o)*m%e,b=js(w,g2)*u%e,_=js(b,s)*d%e,v=js(_,t)*c%e,I=js(v,ku);if(I*I%e!==r)throw new Error("Cannot find square root");return I}function o0(r,e=qr.P){if(r===wt||e<=wt)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=me(r,e),n=e,i=wt,s=Sr,o=Sr,a=wt;for(;t!==wt;){let u=n/t,f=n%t,h=i-o*u,p=s-a*u;n=t,t=f,i=o,s=a,o=h,a=p}if(n!==Sr)throw new Error("invert: does not exist");return me(i,e)}function Nge(r,e=qr.P){let t=new Array(r.length),n=r.reduce((s,o,a)=>o===wt?s:(t[a]=s,me(s*o,e)),Sr),i=o0(n,e);return r.reduceRight((s,o,a)=>o===wt?s:(t[a]=me(s*t[a],e),me(s*o,e)),i),t}function Dge(r){let e=r.length*8-n0*8,t=Ou(r);return e>0?t>>BigInt(e):t}function SS(r,e=!1){let t=Dge(r);if(e)return t;let{n}=qr;return t>=n?t-n:t}var r0,y2,vS=class{constructor(e,t){if(this.hashLen=e,this.qByteLen=t,typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(e).fill(1),this.k=new Uint8Array(e).fill(0),this.counter=0}hmac(...e){return Fo.hmacSha256(this.k,...e)}hmacSync(...e){return y2(this.k,...e)}checkSync(){if(typeof y2!="function")throw new Pw("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),e.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),e.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){this.incr();let e=0,t=[];for(;e<this.qByteLen;){this.v=await this.hmac(this.v);let n=this.v.slice();t.push(n),e+=this.v.length}return Pu(...t)}generateSync(){this.checkSync(),this.incr();let e=0,t=[];for(;e<this.qByteLen;){this.v=this.hmacSync(this.v);let n=this.v.slice();t.push(n),e+=this.v.length}return Pu(...t)}};function w2(r){return wt<r&&r<qr.n}function bS(r){return wt<r&&r<qr.P}function Lge(r,e,t,n=!0){let{n:i}=qr,s=SS(r,!0);if(!w2(s))return;let o=o0(s,i),a=$t.BASE.multiply(s),c=me(a.x,i);if(c===wt)return;let u=me(o*me(e+t*c,i),i);if(u===wt)return;let f=new Ca(c,u),h=(a.x===f.r?0:2)|Number(a.y&Sr);return n&&f.hasHighS()&&(f=f.normalizeS(),h^=1),{sig:f,recovery:h}}function Ow(r){let e;if(typeof r=="bigint")e=r;else if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)e=BigInt(r);else if(typeof r=="string"){if(r.length!==2*n0)throw new Error("Expected 32 bytes of private key");e=kw(r)}else if(r instanceof Uint8Array){if(r.length!==n0)throw new Error("Expected 32 bytes of private key");e=Ou(r)}else throw new TypeError("Expected valid private key");if(!w2(e))throw new Error("Expected private key: 0 < key < n");return e}function Bge(r){return r instanceof $t?(r.assertValidity(),r):$t.fromHex(r)}function tV(r){if(r instanceof Ca)return r.assertValidity(),r;try{return Ca.fromDER(r)}catch{return Ca.fromCompact(r)}}function xS(r,e=!1){return $t.fromPrivateKey(r).toRawBytes(e)}function rV(r){let e=r.length>Mo?r.slice(0,Mo):r;return Ou(e)}function Uge(r){let e=rV(r),t=me(e,qr.n);return nV(t<wt?e:t)}function nV(r){return _S(r)}function Mge(r,e,t){if(r==null)throw new Error(`sign: expected valid message hash, not "${r}"`);let n=s0(r),i=Ow(e),s=[nV(i),Uge(n)];if(t!=null){t===!0&&(t=Fo.randomBytes(Mo));let c=s0(t);if(c.length!==Mo)throw new Error(`sign: Expected ${Mo} bytes of extra data`);s.push(c)}let o=Pu(...s),a=rV(n);return{seed:o,m:a,d:i}}function Fge(r,e){let{sig:t,recovery:n}=r,{der:i,recovered:s}=Object.assign({canonical:!0,der:!0},e),o=i?t.toDERRawBytes():t.toCompactRawBytes();return s?[o,n]:o}async function iV(r,e,t={}){let{seed:n,m:i,d:s}=Mge(r,e,t.extraEntropy),o=new vS(Rge,n0);await o.reseed(n);let a;for(;!(a=Lge(await o.generate(),i,s,t.canonical));)await o.reseed();return Fge(a,t)}var Vge={strict:!0};function sV(r,e,t,n=Vge){let i;try{i=tV(r),e=s0(e)}catch{return!1}let{r:s,s:o}=i;if(n.strict&&i.hasHighS())return!1;let a=SS(e),c;try{c=Bge(t)}catch{return!1}let{n:u}=qr,f=o0(o,u),h=me(a*f,u),p=me(s*f,u),d=$t.BASE.multiplyAndAddUnsafe(c,h,p);return d?me(d.x,u)===s:!1}$t.BASE._setWindowSize(8);var ms={node:Ige,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var Cw={},Fo={bytesToHex:i0,hexToBytes:Ah,concatBytes:Pu,mod:me,invert:o0,isValidPrivateKey(r){try{return Ow(r),!0}catch{return!1}},_bigintTo32Bytes:_S,_normalizePrivateKey:Ow,hashToPrivateKey:r=>{r=s0(r);let e=n0+8;if(r.length<e||r.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");let t=me(Ou(r),qr.n-Sr)+Sr;return _S(t)},randomBytes:(r=32)=>{if(ms.web)return ms.web.getRandomValues(new Uint8Array(r));if(ms.node){let{randomBytes:e}=ms.node;return Uint8Array.from(e(r))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Fo.hashToPrivateKey(Fo.randomBytes(n0+8)),precompute(r=8,e=$t.BASE){let t=e===$t.BASE?e:new $t(e.x,e.y);return t._setWindowSize(r),t.multiply(g2),t},sha256:async(...r)=>{if(ms.web){let e=await ms.web.subtle.digest("SHA-256",Pu(...r));return new Uint8Array(e)}else if(ms.node){let{createHash:e}=ms.node,t=e("sha256");return r.forEach(n=>t.update(n)),Uint8Array.from(t.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(r,...e)=>{if(ms.web){let t=await ms.web.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=Pu(...e),i=await ms.web.subtle.sign("HMAC",t,n);return new Uint8Array(i)}else if(ms.node){let{createHmac:t}=ms.node,n=t("sha256",r);return e.forEach(i=>n.update(i)),Uint8Array.from(n.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(r,...e)=>{let t=Cw[r];if(t===void 0){let n=await Fo.sha256(Uint8Array.from(r,i=>i.charCodeAt(0)));t=Pu(n,n),Cw[r]=t}return Fo.sha256(t,...e)},taggedHashSync:(r,...e)=>{if(typeof r0!="function")throw new Pw("sha256Sync is undefined, you need to set it");let t=Cw[r];if(t===void 0){let n=r0(Uint8Array.from(r,i=>i.charCodeAt(0)));t=Pu(n,n),Cw[r]=t}return r0(t,...e)},_JacobianPoint:It};Object.defineProperties(Fo,{sha256Sync:{configurable:!1,get(){return r0},set(r){r0||(r0=r)}},hmacSha256Sync:{configurable:!1,get(){return y2},set(r){y2||(y2=r)}}});function $i(r){if(isNaN(r)||r<=0)throw new F("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return Fo.randomBytes(r)}l();var SKe=S(o2(),1),AS=S(Je(),1);function oV(r,e){return e.map(t=>ps(r[t]))}function aV(r){return AS.default.pki.setRsaPrivateKey(...oV(r,["n","e","d","p","q","dp","dq","qi"]))}function cV(r){return AS.default.pki.setRsaPublicKey(...oV(r,["n","e"]))}var Th={};jt(Th,{jwkToPkcs1:()=>qge,jwkToPkix:()=>Hge,pkcs1ToJwk:()=>Kge,pkixToJwk:()=>$ge});l();var IKe=S(wu(),1),RKe=S(o2(),1);var $c=S(Je(),1);function Kge(r){let e=$c.default.asn1.fromDer(C(r,"ascii")),t=$c.default.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:Uo(t.n),e:Uo(t.e),d:Uo(t.d),p:Uo(t.p),q:Uo(t.q),dp:Uo(t.dP),dq:Uo(t.dQ),qi:Uo(t.qInv),alg:"RS256"}}function qge(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new F("JWK was missing components","ERR_INVALID_PARAMETERS");let e=$c.default.pki.privateKeyToAsn1({n:ps(r.n),e:ps(r.e),d:ps(r.d),p:ps(r.p),q:ps(r.q),dP:ps(r.dp),dQ:ps(r.dq),qInv:ps(r.qi)});return U($c.default.asn1.toDer(e).getBytes(),"ascii")}function $ge(r){let e=$c.default.asn1.fromDer(C(r,"ascii")),t=$c.default.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:Uo(t.n),e:Uo(t.e)}}function Hge(r){if(r.n==null||r.e==null)throw new F("JWK was missing components","ERR_INVALID_PARAMETERS");let e=$c.default.pki.publicKeyToAsn1({n:ps(r.n),e:ps(r.e)});return U($c.default.asn1.toDer(e).getBytes(),"ascii")}async function lV(r){let e=await Jr.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await hV(e);return{privateKey:t[0],publicKey:t[1]}}async function TS(r){let t=[await Jr.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await Gge(r)],n=await hV({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function uV(r,e){let t=await Jr.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Jr.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,Uint8Array.from(e));return new Uint8Array(n,0,n.byteLength)}async function fV(r,e,t){let n=await Jr.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Jr.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t)}async function hV(r){if(r.privateKey==null||r.publicKey==null)throw new F("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Jr.get().subtle.exportKey("jwk",r.privateKey),Jr.get().subtle.exportKey("jwk",r.publicKey)])}async function Gge(r){return Jr.get().subtle.importKey("jwk",{kty:r.kty,n:r.n,e:r.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function dV(r,e,t,n){let i=e?cV(r):aV(r),s=C(Uint8Array.from(t),"ascii"),o=n(s,i);return U(o,"ascii")}function pV(r,e){return dV(r,!0,e,(t,n)=>n.encrypt(t))}function mV(r,e){return dV(r,!1,e,(t,n)=>n.decrypt(t))}var E2=class{_key;constructor(e){this._key=e}async verify(e,t){return fV(this._key,t,e)}marshal(){return Th.jwkToPkix(this._key)}get bytes(){return Lo.encode({Type:_r.RSA,Data:this.marshal()}).subarray()}encrypt(e){return pV(this._key,e)}equals(e){return be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Le.digest(this.bytes);return e}},a0=class{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return $i(16)}async sign(e){return uV(this._key,e)}get public(){if(this._publicKey==null)throw new F("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new E2(this._publicKey)}decrypt(e){return mV(this._key,e)}marshal(){return Th.jwkToPkcs1(this._key)}get bytes(){return Bo.encode({Type:_r.RSA,Data:this.marshal()}).subarray()}equals(e){return be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Le.digest(this.bytes);return e}async id(){let e=await this.public.hash();return C(e,"base58btc")}async export(e,t="pkcs-8"){if(t==="pkcs-8"){let n=new b2.default.util.ByteBuffer(this.marshal()),i=b2.default.asn1.fromDer(n),s=b2.default.pki.privateKeyFromAsn1(i),o={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return b2.default.pki.encryptRsaPrivateKey(s,e,o)}else{if(t==="libp2p-key")return Qp(this.bytes,e);throw new F(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}};async function Wge(r){let e=Th.pkcs1ToJwk(r),t=await TS(e);return new a0(t.privateKey,t.publicKey)}function Yge(r){let e=Th.pkixToJwk(r);return new E2(e)}async function Qge(r){let e=await TS(r);return new a0(e.privateKey,e.publicKey)}async function Xge(r){let e=await lV(r);return new a0(e.privateKey,e.publicKey)}var CS={};jt(CS,{Secp256k1PrivateKey:()=>v2,Secp256k1PublicKey:()=>_2,generateKeyPair:()=>tye,unmarshalSecp256k1PrivateKey:()=>Jge,unmarshalSecp256k1PublicKey:()=>eye});l();l();function gV(){return Fo.randomPrivateKey()}async function yV(r,e){let{digest:t}=await Le.digest(e);try{return await iV(t,r)}catch(n){throw new F(String(n),"ERR_INVALID_INPUT")}}async function wV(r,e,t){try{let{digest:n}=await Le.digest(t);return sV(e,n,r)}catch(n){throw new F(String(n),"ERR_INVALID_INPUT")}}function bV(r){return $t.fromHex(r).toRawBytes(!0)}function EV(r){try{xS(r,!0)}catch(e){throw new F(String(e),"ERR_INVALID_PRIVATE_KEY")}}function RS(r){try{$t.fromHex(r)}catch(e){throw new F(String(e),"ERR_INVALID_PUBLIC_KEY")}}function _V(r){try{return xS(r,!0)}catch(e){throw new F(String(e),"ERR_INVALID_PRIVATE_KEY")}}var _2=class{_key;constructor(e){RS(e),this._key=e}async verify(e,t){return wV(this._key,t,e)}marshal(){return bV(this._key)}get bytes(){return Lo.encode({Type:_r.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Le.digest(this.bytes);return e}},v2=class{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t??_V(e),EV(this._key),RS(this._publicKey)}async sign(e){return yV(this._key,e)}get public(){return new _2(this._publicKey)}marshal(){return this._key}get bytes(){return Bo.encode({Type:_r.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Le.digest(this.bytes);return e}async id(){let e=await this.public.hash();return C(e,"base58btc")}async export(e,t="libp2p-key"){if(t==="libp2p-key")return Qp(this.bytes,e);throw new F(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function Jge(r){return new v2(r)}function eye(r){return new _2(r)}async function tye(){let r=gV();return new v2(r)}var Pa={rsa:IS,ed25519:mS,secp256k1:CS};function PS(r){let e=Object.keys(Pa).join(" / ");return new F(`invalid or unsupported key type ${r}. Must be ${e}`,"ERR_UNSUPPORTED_KEY_TYPE")}function kS(r){if(r=r.toLowerCase(),r==="rsa"||r==="ed25519"||r==="secp256k1")return Pa[r];throw PS(r)}async function c0(r,e){return kS(r).generateKeyPair(e??2048)}async function rye(r,e,t){if(r.toLowerCase()!=="ed25519")throw new F("Seed key derivation is unimplemented for RSA or secp256k1","ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");return pS(e)}function Hi(r){let e=Lo.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case _r.RSA:return Pa.rsa.unmarshalRsaPublicKey(t);case _r.Ed25519:return Pa.ed25519.unmarshalEd25519PublicKey(t);case _r.Secp256k1:return Pa.secp256k1.unmarshalSecp256k1PublicKey(t);default:throw PS(e.Type??"RSA")}}function S2(r,e){return e=(e??"rsa").toLowerCase(),kS(e),r.bytes}async function Mn(r){let e=Bo.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case _r.RSA:return Pa.rsa.unmarshalRsaPrivateKey(t);case _r.Ed25519:return Pa.ed25519.unmarshalEd25519PrivateKey(t);case _r.Secp256k1:return Pa.secp256k1.unmarshalSecp256k1PrivateKey(t);default:throw PS(e.Type??"RSA")}}function OS(r,e){return e=(e??"rsa").toLowerCase(),kS(e),r.bytes}async function ka(r,e){try{let i=await LF(r,e);return await Mn(i)}catch{}let t=Nw.default.pki.decryptRsaPrivateKey(r,e);if(t===null)throw new F("Cannot read the key, most likely the password is wrong or not a RSA key","ERR_CANNOT_DECRYPT_PEM");let n=Nw.default.asn1.toDer(Nw.default.pki.privateKeyToAsn1(t));return n=U(n.getBytes(),"ascii"),Pa.rsa.unmarshalRsaPrivateKey(n)}var rx=S(W(),1);l();var u0=S(W(),1);l();var vV="ERR_IPNS_EXPIRED_RECORD",x2="ERR_UNRECOGNIZED_VALIDITY",SV="ERR_SIGNATURE_CREATION",Nu="ERR_SIGNATURE_VERIFICATION",xV="ERR_UNRECOGNIZED_FORMAT";var NS="ERR_UNDEFINED_PARAMETER",AV="ERR_INVALID_RECORD_DATA",TV="ERR_INVALID_EMBEDDED_KEY",IV="ERR_MISSING_PRIVATE_KEY";l();l();l();l();var GS=S(MS(),1),WV=S(VV(),1),jS=S(HS(),1),YV=S(jV(),1),QV=S(Rh(),1);function lye(){QV.default._configure(),GS.default._configure(WV.default),jS.default._configure(YV.default)}lye();var XV=["uint64","int64","sint64","fixed64","sfixed64"];function uye(r){for(let e of XV){if(r[e]==null)continue;let t=r[e];r[e]=function(){return BigInt(t.call(this).toString())}}return r}function WS(r){return uye(new GS.default(r))}function fye(r){for(let e of XV){if(r[e]==null)continue;let t=r[e];r[e]=function(n){return t.call(this,n.toString())}}return r}function YS(){return fye(jS.default.create())}function QS(r,e){let t=WS(r instanceof Uint8Array?r:r.subarray());return e.decode(t)}l();function XS(r,e){let t=YS();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}l();l();var l0;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(l0||(l0={}));function Uw(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function ZS(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}let t=function(s,o){let a=e(s);o.int32(a)},n=function(s){let o=s.int32();return e(o)};return Uw("enum",l0.VARINT,t,n)}l();function JS(r,e){return Uw("message",l0.LENGTH_DELIMITED,r,e)}var Gi;(function(r){let e;(function(i){i.EOL="EOL"})(e=r.ValidityType||(r.ValidityType={}));let t;(function(i){i[i.EOL=0]="EOL"})(t||(t={})),function(i){i.codec=()=>ZS(t)}(e=r.ValidityType||(r.ValidityType={}));let n;r.codec=()=>(n==null&&(n=JS((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.value!=null&&(s.uint32(10),s.bytes(i.value)),i.signature!=null&&(s.uint32(18),s.bytes(i.signature)),i.validityType!=null&&(s.uint32(24),r.ValidityType.codec().encode(i.validityType,s)),i.validity!=null&&(s.uint32(34),s.bytes(i.validity)),i.sequence!=null&&(s.uint32(40),s.uint64(i.sequence)),i.ttl!=null&&(s.uint32(48),s.uint64(i.ttl)),i.pubKey!=null&&(s.uint32(58),s.bytes(i.pubKey)),i.signatureV2!=null&&(s.uint32(66),s.bytes(i.signatureV2)),i.data!=null&&(s.uint32(74),s.bytes(i.data)),o.lengthDelimited!==!1&&s.ldelim()},(i,s)=>{let o={},a=s==null?i.len:i.pos+s;for(;i.pos<a;){let c=i.uint32();switch(c>>>3){case 1:o.value=i.bytes();break;case 2:o.signature=i.bytes();break;case 3:o.validityType=r.ValidityType.codec().decode(i);break;case 4:o.validity=i.bytes();break;case 5:o.sequence=i.uint64();break;case 6:o.ttl=i.uint64();break;case 7:o.pubKey=i.bytes();break;case 8:o.signatureV2=i.bytes();break;case 9:o.data=i.bytes();break;default:i.skipType(c&7);break}}return o})),n),r.encode=i=>XS(i,r.codec()),r.decode=i=>QS(i,r.codec())})(Gi||(Gi={}));var ZV=k("ipns:utils"),JV=U("/ipns/");function I2(r){let e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");let n=parseInt(t[1],10),i=parseInt(t[2],10)-1,s=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),u=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,c,u))}var ez=async(r,e)=>{if(e==null||r==null){let n=new Error("one or more of the provided parameters are not defined");throw ZV.error(n),(0,u0.default)(n,NS)}let t;if(e.pubKey!=null){try{t=Hi(e.pubKey)}catch(i){throw ZV.error(i),i}if(!(await Ur(e.pubKey)).equals(r))throw(0,u0.default)(new Error("Embedded public key did not match PeerID"),TV)}else r.publicKey!=null&&(t=Hi(r.publicKey));if(t!=null)return t;throw(0,u0.default)(new Error("no public key is available"),NS)},tz=(r,e,t)=>{let n=U(e);return Z([r,t,n])},Mw=r=>{let e=U("ipns-signature:");return Z([e,r])},ex=r=>Gi.encode(r),Hc=r=>{let e=Gi.decode(r);return e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),{value:e.value??new Uint8Array(0),signature:e.signature??new Uint8Array(0),validityType:e.validityType??Gi.ValidityType.EOL,validity:e.validity??new Uint8Array(0),sequence:e.sequence??0n,pubKey:e.pubKey,ttl:e.ttl??void 0,signatureV2:e.signatureV2,data:e.data}},Bu=r=>Z([JV,r.toBytes()]),tx=r=>Br(r.slice(JV.length)),rz=(r,e,t,n,i)=>{let s;if(t===Gi.ValidityType.EOL)s=0;else throw(0,u0.default)(new Error("Unknown validity type"),x2);return To({Value:r,Validity:e,ValidityType:s,Sequence:n,TTL:i})},nz=r=>{let e=di(r);if(e.ValidityType===0)e.ValidityType=Gi.ValidityType.EOL;else throw(0,u0.default)(new Error("Unknown validity type"),x2);return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e};var sz=k("ipns"),hye=un.code,R2="/ipns/",Fw=R2.length,oz=async(r,e,t,n)=>{let i=new iz.default(Date.now()+Number(n)),s=Gi.ValidityType.EOL,[o,a]=n.toString().split("."),c=BigInt(o)*BigInt(1e5)+BigInt(a??"0");return await dye(r,e,t,s,i,c)};var dye=async(r,e,t,n,i,s)=>{t=BigInt(t);let o=U(i.toString());if(r.privateKey==null)throw(0,rx.default)(new Error("Missing private key"),IV);let a=await Mn(r.privateKey),c=await mye(a,e,n,o),u=rz(e,o,n,t,s),f=Mw(u),h=await a.sign(f),p={value:e,signature:c,validityType:n,validity:o,sequence:t,ttl:s,signatureV2:h,data:u};if(r.publicKey!=null){let d=Ze(r.toBytes());(d.code!==hye||!be(r.publicKey,d.digest))&&(p.pubKey=r.publicKey)}return sz("ipns entry for %b created",e),p},pye=r=>__.encode(r).slice(1),C2=r=>new wi(`/ipns/${pye(r)}`),mye=async(r,e,t,n)=>{try{let i=tz(e,t,n);return await r.sign(i)}catch(i){throw sz.error("record signature creation failed",i),(0,rx.default)(new Error("record signature creation failed"),SV)}};var Ys=k("ipfs:ipns:publisher"),az=vn().code,cz=60*60*1e3,Ph=class{constructor(e,t){this._routing=e,this._datastore=t}async publishWithEOL(e,t,n,i){let s=await this._updateOrCreateRecord(e,t,n,i);return this._putRecordToRouting(s,e,i)}publish(e,t,n){return this.publishWithEOL(e,t,cz,n)}async _putRecordToRouting(e,t,n){if(!Pi(t)){let s="peerId received is not valid";throw Ys.error(s),(0,Qs.default)(new Error(s),"ERR_INVALID_PEER_ID")}if(t.publicKey==null)throw(0,Qs.default)(new Error("Public key was missing"),"ERR_MISSING_PUBLIC_KEY");let i=Bu(t);return await this._publishEntry(i,e,n),e}async _publishEntry(e,t,n){try{let i=await this._routing.put(e,t,n);return Ys(`ipns record for ${C(e,"base32")} was stored in the routing`),i}catch(i){let s=`ipns record for ${C(e,"base32")} could not be stored in the routing - ${i.stack}`;throw Ys.error(s),Ys.error(i),(0,Qs.default)(new Error(s),"ERR_PUTTING_TO_ROUTING")}}async _getPublished(e,t={}){if(!Pi(e)){let i="peerId received is not valid";throw Ys.error(i),(0,Qs.default)(new Error(i),"ERR_INVALID_PEER_ID")}let n=t.checkRouting!==!1;try{let i=await this._datastore.get(C2(e.toBytes()));return this._unmarshalData(i)}catch(i){if(i.code!==az){let s=`unexpected error getting the ipns record ${e.toString()} from datastore`;throw Ys.error(s),(0,Qs.default)(new Error(s),"ERR_UNEXPECTED_DATASTORE_RESPONSE")}if(!n)throw(0,Qs.default)(i,"ERR_NOT_FOUND_AND_CHECK_ROUTING_NOT_ENABLED");try{let s=Bu(e),o=await this._routing.get(s);return this._unmarshalData(o)}catch(s){throw Ys.error(s),s}}}_unmarshalData(e){try{return Hc(e)}catch(t){throw(0,Qs.default)(t,"ERR_INVALID_RECORD_DATA")}}async _updateOrCreateRecord(e,t,n,i){if(!Pi(e)){let u="peerId received is not valid";throw Ys.error(u),(0,Qs.default)(new Error(u),"ERR_INVALID_PEER_ID")}let s={checkRouting:!0},o;try{o=await this._getPublished(e,s)}catch(u){if(u.code!==az){let f=`unexpected error when determining the last published IPNS record for ${e.toString()} ${u.stack}`;throw Ys.error(f),(0,Qs.default)(new Error(f),"ERR_DETERMINING_PUBLISHED_RECORD")}}let a=0n;o&&o.sequence!==void 0&&(a=be(o.value,t)?o.sequence:o.sequence+BigInt(1));let c;try{c=await oz(e,t,a,n)}catch(u){let f=`ipns record for ${t} could not be created`;throw Ys.error(u),(0,Qs.default)(new Error(f),"ERR_CREATING_IPNS_RECORD")}try{let u=ex(c);return await this._datastore.put(C2(e.toBytes()),u,i),Ys(`ipns record for ${C(t,"base32")} was stored in the datastore`),u}catch{let f=`ipns record for ${t} could not be stored in the datastore`;throw Ys.error(f),(0,Qs.default)(new Error(f),"ERR_STORING_IN_DATASTORE")}}};Ph.defaultRecordLifetime=cz;l();var kh=S(W(),1);var lz=S(_n(),1),Vw=k("ipfs:ipns:republisher"),uz=60*1e3,fz=60*uz,gye=4*fz,yye=24*fz,zw=class{constructor(e,t,n,i,s={pass:""}){this._publisher=e,this._datastore=t,this._peerId=n,this._keychain=i,this._options=s,this._republishHandle=null}async start(){if(this._republishHandle)throw(0,kh.default)(new Error("republisher is already running"),"ERR_REPUBLISH_ALREADY_RUNNING");let e={_task:null,_inflightTask:null,_timeoutId:null,runPeriodically:i=>{e._timeoutId=setTimeout(async()=>{e._timeoutId=null;try{e._inflightTask=e._task(),await e._inflightTask,e._task&&e.runPeriodically(i)}catch(s){Vw.error(s)}},i())},cancel:async()=>{e._timeoutId!=null&&clearTimeout(e._timeoutId),e._task=null,await e._inflightTask}},{pass:t}=this._options,n=!0;e._task=async()=>{let i=new lz.TimeoutController(3e4);try{await this._republishEntries(this._peerId,t,{signal:i.signal})}finally{i.clear()}},e.runPeriodically(()=>n?(n=!1,this._options.initialBroadcastInterval||uz):this._options.broadcastInterval||gye),this._republishHandle=e}async stop(){let e=this._republishHandle;if(!e)throw(0,kh.default)(new Error("republisher is not running"),"ERR_REPUBLISH_NOT_RUNNING");this._republishHandle=null,await e.cancel()}async _republishEntries(e,t,n){try{await this._republishEntry(e,n)}catch{let s="cannot republish entry for the node's private key";Vw.error(s);return}if(t)try{let i=await this._keychain.listKeys();for(let s of i){if(s.name==="self")continue;let o=await this._keychain.exportKey(s.name,t),a=await ka(o,t),c=await Ur(a.public.bytes,a.bytes);await this._republishEntry(c,n)}}catch(i){Vw.error(i)}}async _republishEntry(e,t){try{let n=await this._getPreviousValue(e);await this._publisher.publishWithEOL(e,n,yye,t)}catch(n){if(n.code==="ERR_NO_ENTRY_FOUND")return;throw n}}async _getPreviousValue(e){if(!Pi(e))throw(0,kh.default)(new Error("invalid peer ID"),"ERR_INVALID_PEER_ID");try{let t=await this._datastore.get(C2(e.toBytes()));if(!(t instanceof Uint8Array))throw(0,kh.default)(new Error("found ipns record that we couldn't process"),"ERR_INVALID_IPNS_RECORD");try{return Hc(t).value}catch(n){throw Vw.error(n),(0,kh.default)(new Error("found ipns record that we couldn't convert to a value"),"ERR_INVALID_IPNS_RECORD")}}catch(t){throw t&&t.notFound?(0,kh.default)(new Error(`no previous entry for record with id: ${e.toString()}`),"ERR_NO_ENTRY_FOUND"):t}}};l();var h0=S(W(),1);l();var Xs=S(W(),1);var P2=k("ipns:validator"),wye=async(r,e)=>{let{value:t,validityType:n,validity:i}=e,s,o;if(e.signatureV2!=null&&e.data!=null)o=e.signatureV2,s=Mw(e.data),bye(e);else throw(0,Xs.default)(new Error("missing data or signatureV2"),Nu);let a;try{a=await r.verify(s,o)}catch{a=!1}if(!a)throw P2.error("record signature verification failed"),(0,Xs.default)(new Error("record signature verification failed"),Nu);if(i!=null&&n===Gi.ValidityType.EOL){let c;try{c=I2(C(i))}catch{throw P2.error("unrecognized validity format (not an rfc3339 format)"),(0,Xs.default)(new Error("unrecognized validity format (not an rfc3339 format)"),xV)}if(c.getTime()<Date.now())throw P2.error("record has expired"),(0,Xs.default)(new Error("record has expired"),vV)}else if(n!=null)throw P2.error("unrecognized validity type"),(0,Xs.default)(new Error("unrecognized validity type"),x2);P2("ipns entry for %b is valid",t)},bye=r=>{if(r.data==null)throw(0,Xs.default)(new Error("Record data is missing"),AV);let e=nz(r.data);if(!be(e.Value,r.value))throw(0,Xs.default)(new Error('Field "value" did not match between protobuf and CBOR'),Nu);if(!be(e.Validity,r.validity))throw(0,Xs.default)(new Error('Field "validity" did not match between protobuf and CBOR'),Nu);if(e.ValidityType!==r.validityType)throw(0,Xs.default)(new Error('Field "validityType" did not match between protobuf and CBOR'),Nu);if(e.Sequence!==r.sequence)throw(0,Xs.default)(new Error('Field "sequence" did not match between protobuf and CBOR'),Nu);if(e.TTL!==r.ttl)throw(0,Xs.default)(new Error('Field "ttl" did not match between protobuf and CBOR'),Nu)},f0=async(r,e)=>{let t=tx(r),n=Hc(e),i=await ez(t,n);await wye(i,n)};var ix=k("ipfs:ipns:resolver"),Eye=vn().code,hz=32,Kw=class{constructor(e){this._routing=e}async resolve(e,t={}){if(typeof e!="string")throw(0,h0.default)(new Error("invalid name"),"ERR_INVALID_NAME");let n=t.recursive&&t.recursive.toString()==="true",i=e.split("/");if(i.length!==3||i[0]!=="")throw(0,h0.default)(new Error("invalid name"),"ERR_INVALID_NAME");let s=i[2],o=1/0;n&&(o=hz);let a=await this.resolver(s,o,t);return ix(`${e} was locally resolved correctly`),a}async resolver(e,t,n){if(t===0){let o=`could not resolve name (recursion limit of ${hz} exceeded)`;throw ix.error(o),(0,h0.default)(new Error(o),"ERR_RESOLVE_RECURSION_LIMIT")}let i=await this._resolveName(e,n),s=i.split("/");return s[1]==="ipfs"||!t?i:this.resolver(s[2],t-1,n)}async _resolveName(e,t){let n=ae(e),i=Bu(n),s;try{s=await this._routing.get(i,t)}catch(o){throw ix.error("could not get record from routing",o),o.code===Eye?(0,h0.default)(new Error(`record requested for ${e} was not found in the network`),"ERR_NO_RECORD_FOUND"):(0,h0.default)(new Error(`unexpected error getting the ipns record ${n.toString()}`),"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}return this._validateRecord(n,s)}async _validateRecord(e,t){await f0(Z([U("/ipns/"),e.toBytes()]),t);let n=Hc(t);return C(n.value)}};l();var dz=S($m(),1),qw=class{constructor(e){this.lru=(0,dz.default)(e)}get(e){let t=this.lru.get(e);if(t){if(t.expire&&t.expire<Date.now()){this.lru.remove(e);return}return t.value}}set(e,t,n){this.lru.set(e,{value:t,expire:Date.now()+n})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}};var k2=k("ipfs:ipns"),pz=60*1e3,O2=class{constructor(e,t,n,i,s){this.publisher=new Ph(e,t),this.republisher=new zw(this.publisher,t,n,i,s),this.resolver=new Kw(e),this.cache=new qw(1e3),this.routing=e}async publish(e,t,n=Ph.defaultRecordLifetime,i){try{await this.publisher.publishWithEOL(e,t,n,i),k2(`IPNS value ${C(t,"base32")} was published correctly`);let s=e.toString(),o=parseFloat(n),a=o<pz?o:pz;return this.cache.set(s,t,a),k2(`IPNS value ${C(t,"base32")} was cached correctly`),{name:s,value:t}}catch(s){throw k2.error(s),s}}async resolve(e,t={}){if(typeof e!="string")throw(0,mz.default)(new Error("name received is not valid"),"ERR_INVALID_NAME");if(!t.nocache&&!t.recursive){let n=e.split("/")[2],i=this.cache.get(n);if(i)return i}try{let n=await this.resolver.resolve(e,t);return k2(`IPNS record from ${e} was resolved correctly`),n}catch(n){throw k2.error(n),n}}async initializeKeyspace(e,t,n){return this.publish(e,t,Ph.defaultRecordLifetime,n)}};l();l();l();l();l();async function Zn(r){let e=[];for await(let t of r)e.push(t);return e}var $w=(r,e)=>async function*(){yield*(await Zn(r)).sort(e)}();l();async function Ct(r){for await(let e of r);}l();async function*ht(r,e){for await(let t of r)await e(t)&&(yield t)}l();async function*gs(r,e){let t=0;if(!(e<1)){for await(let n of r)if(yield n,t++,t===e)return}}var ji=class{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(let{key:n,value:i}of e)await this.put(n,i,t),yield{key:n,value:i}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(let n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await Ct(this.putMany(e,n)),e=[],await Ct(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=ht(n,i=>i.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>ht(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>$w(i,s),n)),e.offset!=null){let i=0;n=ht(n,()=>i++>=e.offset)}return e.limit!=null&&(n=gs(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=ht(n,i=>i.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>ht(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>$w(i,s),n)),e.offset!=null){let i=0;n=ht(n,()=>i++>=e.offset)}return e.limit!=null&&(n=gs(n,e.limit)),n}};l();l();var Hw=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},d0=class{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Hw(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new Hw(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};function dt(r={}){return yz(t=>{let n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function gz(r={}){return yz(t=>{let n,i=[];for(;!t.isEmpty()&&(n=t.shift(),n!=null);){if(n.error!=null)throw n.error;n.done===!1&&i.push(n.value)}return n==null?{done:!0}:{done:n.done===!0,value:i}},r)}function yz(r,e){e=e??{};let t=e.onEnd,n=new d0,i,s,o,a=async()=>n.isEmpty()?o?{done:!0}:await new Promise((g,y)=>{s=w=>{s=null,n.push(w);try{g(r(n))}catch(b){y(b)}return i}}):r(n),c=g=>s!=null?s(g):(n.push(g),i),u=g=>(n=new d0,s!=null?s({error:g}):(n.push({error:g}),i)),f=g=>{if(o)return i;if(e?.objectMode!==!0&&g?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:g})},h=g=>o?i:(o=!0,g!=null?u(g):c({done:!0})),p=()=>(n=new d0,h(),{done:!0}),d=g=>(h(g),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:a,return:p,throw:d,push:f,end:h,get readableLength(){return n.size}},t==null)return i;let m=i;return i={[Symbol.asyncIterator](){return this},next(){return m.next()},throw(g){return m.throw(g),t!=null&&(t(g),t=void 0),{done:!0}},return(){return m.return(),t!=null&&(t(),t=void 0),{done:!0}},push:f,end(g){return m.end(g),t!=null&&(t(g),t=void 0),i},get readableLength(){return m.readableLength}},i}var _ye=k("datastore:core:tiered"),N2=class extends ji{constructor(e){super(),this.stores=e.slice()}async open(){try{await Promise.all(this.stores.map(e=>e.open()))}catch(e){throw Y4(e)}}async put(e,t,n){try{await Promise.all(this.stores.map(i=>i.put(e,t,n)))}catch(i){throw X4(i)}}async get(e,t){for(let n of this.stores)try{let i=await n.get(e,t);if(i)return i}catch(i){_ye.error(i)}throw vn()}async has(e,t){for(let n of this.stores)if(await n.has(e,t))return!0;return!1}async delete(e,t){try{await Promise.all(this.stores.map(n=>n.delete(e,t)))}catch(n){throw Q4(n)}}async*putMany(e,t={}){let n,i=this.stores.map(s=>{let o=dt({objectMode:!0});return Ct(s.putMany(o,t)).catch(a=>{n=a}),o});try{for await(let s of e){if(n)throw n;i.forEach(o=>o.push(s)),yield s}}finally{i.forEach(s=>s.end())}}async*deleteMany(e,t={}){let n,i=this.stores.map(s=>{let o=dt({objectMode:!0});return Ct(s.deleteMany(o,t)).catch(a=>{n=a}),o});try{for await(let s of e){if(n)throw n;i.forEach(o=>o.push(s)),yield s}}finally{i.forEach(s=>s.end())}}async close(){await Promise.all(this.stores.map(e=>e.close()))}batch(){let e=this.stores.map(t=>t.batch());return{put:(t,n)=>{e.forEach(i=>i.put(t,n))},delete:t=>{e.forEach(n=>n.delete(t))},commit:async t=>{for(let n of e)await n.commit(t)}}}query(e,t){return this.stores[this.stores.length-1].query(e,t)}queryKeys(e,t){return this.stores[this.stores.length-1].queryKeys(e,t)}};var U2=S(Gw(),1);l();l();var jw=(r,e)=>{let t=e.map((n,i)=>({entry:Gi.decode(n),index:i}));return t.sort((n,i)=>{if(n.entry.signatureV2!=null&&i.entry.signatureV2==null)return-1;if(n.entry.signatureV2==null&&i.entry.signatureV2!=null)return 1;let s=n.entry.sequence??0n,o=i.entry.sequence??0n;if(s>o)return-1;if(s<o)return 1;let a=n.entry.validity??new Uint8Array(0),c=i.entry.validity??new Uint8Array(0),u=I2(C(a)),f=I2(C(c));return u.getTime()>f.getTime()?-1:u.getTime()<f.getTime()?1:0}),t[0].index};l();l();l();var Gc="/",wz=new TextEncoder().encode(Gc),Ww=wz[0],Sn=class{constructor(e,t){if(typeof e=="string")this._buf=U(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Ww)throw new Error("Invalid key")}toString(e="utf8"){return C(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Sn(e.join(Gc))}static random(){return new Sn(Tr().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Sn(e):typeof e.uint8Array=="function"?new Sn(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=wz),this._buf[0]!==Ww){let e=new Uint8Array(this._buf.byteLength+1);e.fill(Ww,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Ww;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return Sn.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Gc).slice(1)}type(){return vye(this.baseNamespace())}name(){return Sye(this.baseNamespace())}instance(e){return new Sn(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Gc)||(e+=Gc),e+=this.type(),new Sn(e)}parent(){let e=this.list();return e.length===1?new Sn(Gc):new Sn(e.slice(0,-1).join(Gc))}child(e){return this.toString()===Gc?e:e.toString()===Gc?this:new Sn(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Sn.withNamespaces([...this.namespaces(),...xye(e.map(t=>t.namespaces()))])}};function vye(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Sye(r){let e=r.split(":");return e[e.length-1]}function xye(r){return[].concat(...r)}l();l();l();var jc="/",bz=new TextEncoder().encode(jc),Yw=bz[0],Mr=class{constructor(e,t){if(typeof e=="string")this._buf=U(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Yw)throw new Error("Invalid key")}toString(e="utf8"){return C(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Mr(e.join(jc))}static random(){return new Mr(Tr().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Mr(e):typeof e.uint8Array=="function"?new Mr(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=bz),this._buf[0]!==Yw){let e=new Uint8Array(this._buf.byteLength+1);e.fill(Yw,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Yw;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return Mr.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(jc).slice(1)}type(){return Aye(this.baseNamespace())}name(){return Tye(this.baseNamespace())}instance(e){return new Mr(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(jc)||(e+=jc),e+=this.type(),new Mr(e)}parent(){let e=this.list();return e.length===1?new Mr(jc):new Mr(e.slice(0,-1).join(jc))}child(e){return this.toString()===jc?e:e.toString()===jc?this:new Mr(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Mr.withNamespaces([...this.namespaces(),...Iye(e.map(t=>t.namespaces()))])}};function Aye(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Tye(r){let e=r.split(":");return e[e.length-1]}function Iye(r){return[].concat(...r)}l();var Ez="SHARDING",_z="_README";l();var D2=class extends ji{constructor(){super(),this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(e,t){this.data[e.toString()]=t}async get(e){if(!await this.has(e))throw vn();return this.data[e.toString()]}async has(e){return this.data[e.toString()]!==void 0}async delete(e){delete this.data[e.toString()]}async*_all(){yield*Object.entries(this.data).map(([e,t])=>({key:new Mr(e),value:t}))}async*_allKeys(){yield*Object.entries(this.data).map(([e])=>new Mr(e))}};l();l();async function*Zt(r,e){for await(let t of r)yield e(t)}l();l();async function*Fr(...r){let e=dt({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async t=>{for await(let n of t)e.push(n)})),e.end()}catch(t){e.end(t)}}),yield*e}var Pye=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},vz=r=>r!=null&&(typeof r[Symbol.asyncIterator]=="function"||typeof r[Symbol.iterator]=="function"||typeof r.next=="function"),ax=r=>r!=null&&typeof r.sink=="function"&&vz(r.source),kye=r=>e=>{let t=r.sink(e);if(t.then!=null){let n=dt({objectMode:!0});return t.then(()=>{n.end()},s=>{n.end(s)}),Fr(n,async function*(){yield*r.source,n.end()}())}return r.source};function _e(r,...e){if(ax(r)){let n=r;r=()=>n.source}else if(vz(r)){let n=r;r=()=>n}let t=[r,...e];if(t.length>1&&ax(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)ax(t[n])&&(t[n]=kye(t[n]));return Pye(...t)}l();l();var RGe=new Mr(Ez),CGe=new Mr(_z);l();l();l();var Qw="/record/";function cx(r){return C(r,"base32")}function L2(r){(typeof r=="string"||r instanceof String)&&(r=U(r.toString()));let e=C(r,"base64url");return`${Qw}${e}`}function xz(r){if(r.substring(0,Qw.length)!==Qw)throw new F("topic received is not from a record","ERR_TOPIC_IS_NOT_FROM_RECORD_NAMESPACE");let e=r.substring(Qw.length);return U(e,"base64url")}var Jn=k("datastore-pubsub:publisher"),Xw=class extends ji{constructor(e,t,n,i,s,o){if(super(),!i)throw new F("missing validator","ERR_INVALID_PARAMETERS");if(typeof i!="function")throw new F("missing validate function","ERR_INVALID_PARAMETERS");if(typeof s!="function")throw new F("missing select function","ERR_INVALID_PARAMETERS");if(o&&typeof o!="function")throw new F("invalid subscriptionKeyFn received","ERR_INVALID_PARAMETERS");this._pubsub=e,this._datastore=t,this._peerId=n,this._validator=i,this._selector=s,this._handleSubscriptionKeyFn=o,this._onMessage=this._onMessage.bind(this),this._pubsub.addEventListener("message",this._onMessage)}async put(e,t,n){if(!(e instanceof Uint8Array)){let s="datastore key does not have a valid format";throw Jn.error(s),new F(s,"ERR_INVALID_DATASTORE_KEY")}if(!(t instanceof Uint8Array)){let s="received value is not a Uint8Array";throw Jn.error(s),new F(s,"ERR_INVALID_VALUE_RECEIVED")}let i=L2(e);Jn(`publish value for topic ${i}`),await this._pubsub.publish(i,t)}async get(e,t){if(!(e instanceof Uint8Array)){let s="datastore key does not have a valid format";throw Jn.error(s),new F(s,"ERR_INVALID_DATASTORE_KEY")}let n=L2(e),i=await this._pubsub.getTopics();if(i&&Array.isArray(i)&&i.indexOf(n)>-1)return this._getLocal(e,t);try{await this._pubsub.subscribe(n)}catch{let o=`cannot subscribe topic ${n}`;throw Jn.error(o),new F(o,"ERR_SUBSCRIBING_TOPIC")}return Jn(`subscribed values for key ${n}`),this._getLocal(e)}unsubscribe(e){let t=L2(e);return this._pubsub.unsubscribe(t)}async _getLocal(e,t){let n=new Sn("/"+cx(e),!1),i;try{i=await this._datastore.get(n,t)}catch(s){if(s.code!=="ERR_NOT_FOUND"){let a=`unexpected error getting the ipns record for ${n.toString()}`;throw Jn.error(a),new F(a,"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}let o=`local record requested was not found for ${n.toString()}`;throw Jn.error(o),new F(o,"ERR_NOT_FOUND")}if(!(i instanceof Uint8Array)){let s="found record that we couldn't convert to a value";throw Jn.error(s),new F(s,"ERR_INVALID_RECORD_RECEIVED")}return i}async _onMessage(e){let t=e.detail;if(t.type!=="signed"){Jn.error("unsigned message received, this module can only work with signed messages");return}let{data:n,from:i,topic:s}=t,o;try{o=xz(s)}catch(a){Jn.error(a);return}if(Jn(`message received for topic ${s}`),this._peerId.equals(i)){Jn("message discarded as it is from the same peer");return}if(this._handleSubscriptionKeyFn){let a;try{a=await this._handleSubscriptionKeyFn(o)}catch{Jn.error("message discarded by the subscriptionKeyFn");return}o=a}try{await this._storeIfSubscriptionIsBetter(o,n)}catch(a){Jn.error(a)}}async _storeIfSubscriptionIsBetter(e,t,n){let i=!1;try{i=await this._isBetter(e,t)}catch(s){if(s.code!=="ERR_NOT_VALID_RECORD")throw s}i&&await this._storeRecord(e,t,n)}async _validateRecord(e,t){return this._validator(e,t)}async _selectRecord(e,t){return await this._selector(e,t)===0}async _isBetter(e,t){try{await this._validateRecord(e,t)}catch{let o="record received through pubsub is not valid";throw Jn.error(o),new F(o,"ERR_NOT_VALID_RECORD")}let n=new Sn(e),i;try{i=await this._getLocal(n.uint8Array())}catch{return!0}return be(i,t)?!1:this._selectRecord(e,[i,t])}async _storeRecord(e,t,n){let i=new Sn("/"+cx(e),!1);await this._datastore.put(i,t,n),Jn(`record for ${L2(e)} was stored in the datastore`)}};var lx=S(W(),1);var Zw=k("ipfs:ipns:pubsub"),Oh=class{constructor(e,t,n){this._subscriptions={},this._handleSubscriptionKey=this._handleSubscriptionKey.bind(this),this._pubsubDs=new Xw(e,t,n,f0,jw,this._handleSubscriptionKey)}async put(e,t,n){try{await this._pubsubDs.put(e,t,n)}catch(i){throw Zw.error(i),i}}async get(e,t){let n,i;try{n=await this._pubsubDs.get(e,t)}catch(o){i=o}let s=e.slice(0,Fw);if(C(s)===R2){let o=le.encode(e).substring(1),a=le.encode(e.slice(Fw)).substring(1);this._subscriptions[o]=a,Zw(`subscribed to pubsub topic ${o}, id ${a}`)}if(i)throw i;return n}_handleSubscriptionKey(e){e instanceof Uint8Array&&(e=C(e,"base58btc"));let t=this._subscriptions[e];if(!t)throw(0,lx.default)(new Error(`key ${e} does not correspond to a subscription`),"ERR_INVALID_KEY");try{return Bu(ae(t))}catch(n){throw Zw.error(n),n}}getSubscriptions(){return Object.values(this._subscriptions).filter(Boolean).map(t=>`${R2}${t}`)}async cancel(e){if(typeof e!="string")throw(0,lx.default)(new Error("invalid subscription name"),"ERR_INVALID_SUBSCRIPTION_NAME");e.startsWith(R2)&&(e=e.substring(Fw));let t=Object.keys(this._subscriptions).find(i=>this._subscriptions[i]===e);if(!t)return{canceled:!1};let n=U(t);return this._pubsubDs.unsubscribe(n),delete this._subscriptions[t],Zw(`unsubscribed pubsub ${t}: ${e}`),{canceled:!0}}};l();l();l();var B2;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={key:new Uint8Array(0),value:new Uint8Array(0),timeReceived:""},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.key=t.bytes();break;case 2:i.value=t.bytes();break;case 5:i.timeReceived=t.string();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(B2||(B2={}));l();function Az(r){let e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),i=String(r.getUTCHours()).padStart(2,"0"),s=String(r.getUTCMinutes()).padStart(2,"0"),o=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${i}:${s}:${o}.${c}Z`}function Tz(r){let e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");let n=parseInt(t[1],10),i=parseInt(t[2],10)-1,s=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),u=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,c,u))}var Vr=class{constructor(e,t,n){if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return B2.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:Az(this.timeReceived)}}static deserialize(e){let t=B2.decode(e);return new Vr(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){let t=Tz(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new Vr(e.key,e.value,t)}};var p0=S(W(),1);var ux=k("ipfs:ipns:offline-datastore"),m0=class{constructor(e){this._datastore=e,this.stores=[]}async put(e,t,n){if(!(e instanceof Uint8Array))throw(0,p0.default)(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");if(!(t instanceof Uint8Array))throw(0,p0.default)(new Error("Offline datastore value must be a Uint8Array"),"ERR_INVALID_VALUE");let i;try{i=this._routingKey(e)}catch(o){throw ux.error(o),(0,p0.default)(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}let s=new Vr(e,t,new Date);await this._datastore.put(i,s.serialize(),n)}async get(e,t){if(!(e instanceof Uint8Array))throw(0,p0.default)(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");let n;try{n=this._routingKey(e)}catch(o){throw ux.error(o),(0,p0.default)(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}let i=await this._datastore.get(n,t),s;try{s=Vr.deserialize(i)}catch(o){throw ux.error(o),o}return s.value}_routingKey(e){return new fn("/dht/record/"+C(e,"base32"),!1)}};l();var Nye=k("ipfs:ipns:dht-datastore"),Jw=class{constructor(e){this._dht=e}async put(e,t,n){try{await Ct(this._dht.put(e,t,n))}catch(i){throw Nye.error(i),i}}async get(e,t){for await(let n of this._dht.get(e,t))if(n.name==="VALUE")return n.value;throw vn()}};function Iz({libp2p:r,repo:e,peerId:t,options:n}){let i=[],s;if((0,U2.default)(n,"EXPERIMENTAL.ipnsPubsub",!1)&&(s=new Oh(r.pubsub,e.datastore,t),i.push(s)),(0,U2.default)(n,"offline",!1)!==!0&&["dht","dhtclient","dhtserver"].includes((0,U2.default)(n,"config.Routing.Type","none"))&&i.push(new Jw(r.dht)),(0,U2.default)(n,"offline",!1)||i.length===0){let o=new m0(e.datastore);i.push(o)}return new N2(i)}var Dye=k("ipfs:components:ipns"),e6=class{constructor(e={pass:""}){this.options=e,this.offline=null,this.online=null}getIPNS(){let e=this.online||this.offline;if(e)return e;throw new Pc}get routing(){return this.getIPNS().routing}startOffline({repo:e,peerId:t,keychain:n}){if(this.offline!=null)throw new Co;Dye("initializing IPNS keyspace (offline)");let i=new m0(e.datastore),s=new O2(i,e.datastore,t,n,this.options);this.offline=s}async startOnline({libp2p:e,repo:t,peerId:n,keychain:i}){if(this.online!=null)throw new Co;let s=Iz({libp2p:e,repo:t,peerId:n,options:this.options}),o=new O2(s,t.datastore,n,i,this.options);await o.republisher.start(),this.online=o}async stop(){let e=this.online;e&&(await e.republisher.stop(),this.online=null)}publish(e,t,n,i){return this.getIPNS().publish(e,t,n,i)}resolve(e,t){return this.getIPNS().resolve(e,t)}initializeKeyspace(e,t,n){return this.getIPNS().initializeKeyspace(e,t,n)}};l();l();var hx=S(W(),1);l();async function Rz({ipns:r,repo:e,codecs:t},n,i){if(O4(n))return r.resolve(n);let{cid:s,path:o}=Uc(n);await Ct(du(s,o||"",t,e,i))}var fx=k("ipfs:name:publish");function Cz({ipns:r,repo:e,codecs:t,peerId:n,isOnline:i,keychain:s}){let o=async c=>{let u;if(c==="self"&&n.privateKey!=null)u=await Mn(n.privateKey);else try{let f=await s.exportKey(c,"temp");u=await ka(f,"temp")}catch(f){throw fx.error(f),(0,hx.default)(f,"ERR_CANNOT_GET_KEY")}return Ur(u.public.bytes,u.bytes)};async function a(c,u={}){let f=u.resolve!==!1,h=u.lifetime||"24h",p=u.key||"self";if(!i())throw(0,hx.default)(new Error(B4),"OFFLINE_ERROR");try{c=UB(c)}catch(w){throw fx.error(w),w}let d=0;try{d=fu(h)||0,d=parseFloat(d.toFixed(6))}catch(w){throw fx.error(w),w}let m=await Promise.all([o(p),f?Rz({ipns:r,repo:e,codecs:t},c):Promise.resolve()]),g=U(c),y=await r.publish(m[0],g,d,u);return{name:y.name,value:C(y.value)}}return z(a)}l();var t6=S(W(),1);var Nz=S(kz(),1);var Bye=Ve.bind({ignoreUndefined:!0}),Uye=k("ipfs:name:resolve"),Oz=(r,e)=>e.length>0?r+"/"+e.join("/"):r;function Dz({dns:r,ipns:e,isOnline:t,options:{offline:n}}){async function*i(s,o={}){if(o=Bye({nocache:!1,recursive:!0},o),n&&o&&o.nocache)throw(0,t6.default)(new Error("cannot specify both offline and nocache"),"ERR_NOCACHE_AND_OFFLINE");if(!t()&&!n)throw(0,t6.default)(new Error(B4),"OFFLINE_ERROR");let a=s.toString();a.startsWith("/ipns/")||(a=`/ipns/${a}`);let[c,u,...f]=a.slice(1).split("/");try{if(u.substring(0,1)==="1"){let p=ae(u),d=Ze(p.toBytes());u=T.createV1(114,d).toString(Np)}else{let p=T.parse(u);p.version===1&&(u=p.toString(Np))}}catch(p){if((0,Nz.default)(u)){yield Oz(await r(u,o),f);return}throw Uye.error(p),(0,t6.default)(new Error("Invalid IPNS name"),"ERR_IPNS_INVALID_NAME")}let h=await e.resolve(`/${c}/${u}`,o);yield Oz(h instanceof Uint8Array?C(h):h,f)}return z(i)}l();l();l();var dx=S(W(),1);function g0(r,e){if(!r||!(e&&e.ipnsPubsub))throw(0,dx.default)(new Error("IPNS pubsub subsystem is not enabled"),"ERR_IPNS_PUBSUB_NOT_ENABLED");if(r.routing instanceof Oh)return r.routing;let t=(r.routing.stores||[]).find(n=>n instanceof Oh);if(!t)throw(0,dx.default)(new Error("IPNS pubsub datastore not found"),"ERR_PUBSUB_DATASTORE_NOT_FOUND");return t}function Lz({ipns:r,options:e}){let t=e.EXPERIMENTAL;async function n(i,s={}){return g0(r,t).cancel(i,s)}return z(n)}l();function Bz({ipns:r,options:e}){let t=e.EXPERIMENTAL;async function n(i={}){try{return{enabled:Boolean(g0(r,t))}}catch{return{enabled:!1}}}return z(n)}l();function Uz({ipns:r,options:e}){let t=e.EXPERIMENTAL;async function n(i={}){return g0(r,t).getSubscriptions(i)}return z(n)}var r6=class{constructor({ipns:e,options:t}){this.cancel=Lz({ipns:e,options:t}),this.state=Bz({ipns:e,options:t}),this.subs=Uz({ipns:e,options:t})}};var n6=class{constructor({dns:e,ipns:t,repo:n,codecs:i,peerId:s,isOnline:o,keychain:a,options:c}){this.publish=Cz({ipns:t,repo:n,codecs:i,peerId:s,isOnline:o,keychain:a}),this.resolve=Dz({dns:e,ipns:t,isOnline:o,options:c}),this.pubsub=new r6({ipns:t,options:c})}};l();var Mz=S(_n(),1),Fz=S(us(),1),Mye=vn().code,px={default:"<dst>",edges:"<src> -> <dst>"};function Vz({repo:r,codecs:e,resolve:t,preload:n}){async function*i(s,o={}){if(o.maxDepth===0)return;if(o.edges&&o.format&&o.format!==px.default)throw new Error("Cannot set edges to true and also specify format");if(o.format=o.edges?px.edges:o.format,typeof o.maxDepth!="number"&&(o.maxDepth=o.recursive?1/0:1),o.timeout){let f=[new Mz.TimeoutController(o.timeout).signal];o.signal&&f.push(o.signal),o.signal=(0,Fz.anySignal)(f)}let c=(Array.isArray(s)?s:[s]).map(u=>Fye(n,u,o));for(let u of c)try{yield*Vye(t,r,e,u,o)}catch(f){yield{ref:"",err:f.message}}}return i}function Fye(r,e,t){let{cid:n,path:i}=Uc(e);return t.preload!==!1&&r(n),`/ipfs/${n}${i||""}`}async function*Vye(r,e,t,n,i){let s=await r(n,i),{cid:o}=Uc(s),a=i.maxDepth!=null?i.maxDepth:1/0,c=i.unique||!1;for await(let u of Kye(e,t,o,a,c,i))u.parent&&(u.isDuplicate||(yield{ref:zye(u.parent.cid,u.node.cid,u.node.name,i.format)}))}function zye(r,e,t="",n=px.default){let i=n.replace(/<src>/g,r.toString());return i=i.replace(/<dst>/g,e.toString()),i=i.replace(/<linkname>/g,t),i}async function*Kye(r,e,t,n,i,s){let o=new Set;async function*a(c,u){let f=u+1;if(!(f>n))try{for await(let h of qye(r,e,c.cid,s))yield{parent:c,node:h,isDuplicate:i&&o.has(h.cid.toString())},i&&o.add(h.cid.toString()),yield*a(h,f)}catch(h){throw h.code===Mye&&(h.message=`Could not find object with CID: ${c.cid}`),h}}yield*a({cid:t},0)}async function*qye(r,e,t,n){let i=await r.blocks.get(t,n),o=(await e.getCodec(t.code)).decode(i),a=t.code===We,c=[];for(let[u,f]of mx(o,c)){if(a){let h=u.match(/^Links\/(\d+)\/Hash$/);if(h){let p=Number(h[1]);if(p<o.Links.length){yield{name:o.Links[p].Name,cid:f};continue}}}yield{name:u,cid:f}}}var mx=function*(r,e){if(r!=null&&!(r instanceof Uint8Array)){for(let[t,n]of Object.entries(r)){let i=[...e,t];if(n!=null&&typeof n=="object")if(Array.isArray(n))for(let[s,o]of n.entries()){let a=[...i,s],c=T.asCID(o);c?yield[a.join("/"),c]:typeof o=="object"&&(yield*mx(o,a))}else{let s=T.asCID(n);s?yield[i.join("/"),s]:yield*mx(n,i)}}return[]}};l();function zz({repo:r}){async function*e(t={}){for await(let n of r.blocks.queryKeys({},{signal:t.signal}))yield{ref:n.toString()}}return z(e)}l();l();function Kz({network:r}){async function e(t={}){let{bitswap:n}=await r.use(t),i=n.getWantlist();return Array.from(i).map(s=>s[1].cid)}return z(e)}l();function qz({network:r}){async function e(t,n={}){let{bitswap:i}=await r.use(n),s=i.wantlistForPeer(t);return Array.from(s).map(o=>o[1].cid)}return z(e)}l();function $z({network:r}){async function e(t,n={}){let{bitswap:i}=await r.use(n);return Array.isArray(t)||(t=[t]),i.unwant(t)}return z(e)}l();function i6({network:r}){async function e(t={}){let n=(await r.use(t)).bitswap,i=n.stat().snapshot;return{provideBufLen:parseInt(i.providesBufferLength.toString()),blocksReceived:BigInt(i.blocksReceived.toString()),wantlist:Array.from(n.getWantlist()).map(s=>s[1].cid),peers:n.peers(),dupBlksReceived:BigInt(i.dupBlksReceived.toString()),dupDataReceived:BigInt(i.dupDataReceived.toString()),dataReceived:BigInt(i.dataReceived.toString()),blocksSent:BigInt(i.blocksSent.toString()),dataSent:BigInt(i.dataSent.toString())}}return z(e)}var s6=class{constructor({network:e}){this.wantlist=Kz({network:e}),this.wantlistForPeer=qz({network:e}),this.unwant=$z({network:e}),this.stat=i6({network:e})}};l();l();l();function o6(r){try{return dB.matches(r)}catch{return!1}}function Hz({repo:r}){async function e(t,n={}){if(!o6(t))throw new Error(`${t} is not a valid Multiaddr`);let i=await r.config.getAll(n),s=i.Bootstrap||[];return s.push(t.toString()),i.Bootstrap=Array.from(new Set(s)).sort((o,a)=>o.localeCompare(a)),await r.config.replace(i),{Peers:[t]}}return z(e)}l();function Gz({repo:r}){async function e(t={}){let n=await r.config.getAll(t),i=n.Bootstrap||[];return n.Bootstrap=[],await r.config.replace(n),{Peers:i.map(s=>se(s))}}return z(e)}l();function jz({repo:r}){async function e(t={}){return{Peers:(await r.config.get("Bootstrap",t)||[]).map(i=>se(i))}}return z(e)}l();l();var Wc=()=>({Addresses:{Swarm:[],Announce:[],NoAnnounce:[],API:"",Gateway:"",RPC:"",Delegates:["/dns4/node0.delegate.ipfs.io/tcp/443/https","/dns4/node1.delegate.ipfs.io/tcp/443/https","/dns4/node2.delegate.ipfs.io/tcp/443/https","/dns4/node3.delegate.ipfs.io/tcp/443/https"]},Discovery:{MDNS:{Enabled:!1,Interval:10},webRTCStar:{Enabled:!0}},Bootstrap:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"],Pubsub:{Enabled:!0},Swarm:{ConnMgr:{LowWater:5,HighWater:20},DisableNatPortMap:!0},Routing:{Type:"dhtclient"}});function Wz({repo:r}){async function e(t={}){let n=await r.config.getAll(t);return n.Bootstrap=Wc().Bootstrap,await r.config.replace(n),{Peers:Wc().Bootstrap.map(i=>se(i))}}return z(e)}l();function Yz({repo:r}){async function e(t,n={}){if(!o6(t))throw new Error(`${t} is not a valid Multiaddr`);let i=await r.config.getAll(n);return i.Bootstrap=(i.Bootstrap||[]).filter(s=>s.toString()!==t.toString()),await r.config.replace(i),{Peers:[t]}}return z(e)}var a6=class{constructor({repo:e}){this.add=Hz({repo:e}),this.list=jz({repo:e}),this.rm=Yz({repo:e}),this.clear=Gz({repo:e}),this.reset=Wz({repo:e})}};l();l();function Qz({preload:r,repo:e}){async function t(n,i={}){return i.preload!==!1&&r(n),e.blocks.get(n,i)}return z(t)}l();function Xz({codecs:r,hashers:e,repo:t,preload:n}){async function i(s,o={}){let a=o.pin?await t.gcLock.readLock():null;try{let c=o.version!=null?o.version:0,u=o.format||(c===0?"dag-pb":"raw"),h=await(await e.getHasher(o.mhtype||"sha2-256")).digest(s),p=await r.getCodec(u),d=T.create(c,p.code,h);return await t.blocks.put(d,s,{signal:o.signal}),o.preload!==!1&&n(d),o.pin===!0&&await t.pins.pinRecursively(d,{signal:o.signal}),d}finally{a&&a()}}return z(i)}l();var Zz=S(W(),1);l();l();function bt(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var c6=globalThis.CustomEvent??Event;async function*Yc(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);let n=e.ordered==null?!1:e.ordered,i=new EventTarget,s=[],o=bt(),a=bt(),c=!1,u,f=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(let m of r){if(s.length===t&&(o=bt(),await o.promise),f)break;let g={done:!1};s.push(g),m().then(y=>{g.done=!0,g.ok=!0,g.value=y,i.dispatchEvent(new c6("task-complete"))},y=>{g.done=!0,g.err=y,i.dispatchEvent(new c6("task-complete"))})}c=!0,i.dispatchEvent(new c6("task-complete"))}catch(m){u=m,i.dispatchEvent(new c6("task-complete"))}});function h(){return n?s[0]?.done:Boolean(s.find(m=>m.done))}function*p(){for(;s.length>0&&s[0].done;){let m=s[0];if(s.shift(),m.ok)yield m.value;else throw f=!0,o.resolve(),m.err;o.resolve()}}function*d(){for(;h();)for(let m=0;m<s.length;m++)if(s[m].done){let g=s[m];if(s.splice(m,1),m--,g.ok)yield g.value;else throw f=!0,o.resolve(),g.err;o.resolve()}}for(;;){if(h()||(a=bt(),await a.promise),u!=null)throw u;if(n?yield*p():yield*d(),c&&s.length===0)break}}l();function l6(r){return r instanceof Uint8Array?T.decode(r):T.parse(r.toString())}var $ye=8;function Jz({repo:r}){async function*e(t,n={}){Array.isArray(t)||(t=[t]);let i=await r.gcLock.writeLock();try{yield*_e(t,s=>Zt(s,o=>async()=>{o=l6(o);let a={cid:o};try{if(!await r.blocks.has(o))throw(0,Zz.default)(new Error("block not found"),"ERR_BLOCK_NOT_FOUND");await r.blocks.delete(o)}catch(c){n.force||(c.message=`cannot remove ${o}: ${c.message}`,a.error=c)}return a}),s=>Yc(s,{concurrency:$ye}),s=>ht(s,()=>!n.quiet))}finally{i()}}return z(e)}l();function eK({repo:r,preload:e}){async function t(n,i={}){n=l6(n),i.preload!==!1&&e(n);let s=await r.blocks.get(n);return{cid:n,size:s.length}}return z(t)}var u6=class{constructor({codecs:e,hashers:t,preload:n,repo:i}){this.get=Qz({preload:n,repo:i}),this.put=Xz({codecs:e,hashers:t,preload:n,repo:i}),this.rm=Jz({repo:i}),this.stat=eK({preload:n,repo:i})}};l();l();l();l();var tK=S(W(),1);l();async function*Wi(r,e={}){let t=r.getReader();try{for(;;){let n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&await t.cancel(),t.releaseLock()}}l();function gx(r){return typeof r.stream=="function"?Wi(r.stream()):Wi(new Response(r).body)}l();function zo(r){let[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}l();function Zs(r){return ArrayBuffer.isView(r)||r instanceof ArrayBuffer}function Qc(r){return r.constructor&&(r.constructor.name==="Blob"||r.constructor.name==="File")&&typeof r.stream=="function"}function M2(r){return typeof r=="object"&&(r.path||r.content)}var Xc=r=>r&&typeof r.getReader=="function";async function*f6(r){yield r}async function h6(r){if(Zs(r))return f6(yx(r));if(typeof r=="string"||r instanceof String)return f6(yx(r.toString()));if(Qc(r))return gx(r);if(Xc(r)&&(r=Wi(r)),Symbol.iterator in r||Symbol.asyncIterator in r){let e=zo(r),{value:t,done:n}=await e.peek();if(n)return f6(new Uint8Array(0));if(e.push(t),Number.isInteger(t))return f6(Uint8Array.from(await Zn(e)));if(Zs(t)||typeof t=="string"||t instanceof String)return Zt(e,yx)}throw(0,tK.default)(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT")}function yx(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new Uint8Array(r):Array.isArray(r)?Uint8Array.from(r):U(r.toString())}l();var p6=S(W(),1);async function*rK(r,e){if(r==null)throw(0,p6.default)(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT");if(typeof r=="string"||r instanceof String){yield d6(r.toString(),e);return}if(Zs(r)||Qc(r)){yield d6(r,e);return}if(Xc(r)&&(r=Wi(r)),Symbol.iterator in r||Symbol.asyncIterator in r){let t=zo(r),{value:n,done:i}=await t.peek();if(i){yield{content:[]};return}if(t.push(n),Number.isInteger(n)||Zs(n)||typeof n=="string"||n instanceof String){yield d6(t,e);return}throw(0,p6.default)(new Error("Unexpected input: multiple items passed - if you are using ipfs.add, please use ipfs.addAll instead"),"ERR_UNEXPECTED_INPUT")}if(M2(r)){yield d6(r,e);return}throw(0,p6.default)(new Error('Unexpected input: cannot convert "'+typeof r+'" into ImportCandidate'),"ERR_UNEXPECTED_INPUT")}async function d6(r,e){let{path:t,mode:n,mtime:i,content:s}=r,o={path:t||"",mode:Tc(n),mtime:au(i)};return s?o.content=await e(s):t||(o.content=await e(r)),o}function m6(r){return rK(r,h6)}function nK({addAll:r}){async function e(t,n={}){let i=await ir(r(m6(t),n));if(i==null)throw Error("Failed to add a file, if you see this please report a bug");return i}return e}l();l();l();l();async function*Zc(r,e=1){let t=[];e<1&&(e=1);for await(let n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)}async function*F2(r,e=1){for await(let t of Zc(r,e)){let n=t.map(async i=>await i().then(s=>({ok:!0,value:s}),s=>({ok:!1,err:s})));for(let i=0;i<n.length;i++){let s=await n[i];if(s.ok)yield s.value;else throw s.err}}}l();l();var y6=S(oK(),1);function Hye(r){let e=new Array(4);for(let t=0;t<4;t++)e[t]=r&255,r=r>>8;return new Uint8Array(e)}var IXe=nh({name:"murmur3-32",code:35,encode:r=>Hye(y6.default.x86.hash32(r))}),Nh=nh({name:"murmur3-128",code:34,encode:r=>Zf.fromHex(y6.default.x64.hash128(r))}),RXe=nh({name:"murmur3-x64-64",code:34,encode:r=>Zf.fromHex(y6.default.x64.hash128(r)).subarray(0,8)});async function Gye(r){return(await Nh.encode(r)).slice(0,8).reverse()}var jye={chunker:"fixed",strategy:"balanced",rawLeaves:!1,onlyHash:!1,reduceSingleLeafToSelf:!0,hasher:Le,leafType:"file",cidVersion:0,progress:()=>()=>{},shardSplitThreshold:1e3,fileImportConcurrency:50,blockWriteConcurrency:10,minChunkSize:262144,maxChunkSize:262144,avgChunkSize:262144,window:16,polynomial:0x3df305dfb2a804,maxChildrenPerNode:174,layerRepeat:4,wrapWithDirectory:!1,recursive:!1,hidden:!1,timeout:void 0,hamtHashFn:Gye,hamtHashCode:34,hamtBucketBits:8},aK=(r={})=>Ve.bind({ignoreUndefined:!0})(jye,r);l();l();l();var Wye=async(r,e,t)=>{t.codec||(t.codec=ut),t.hasher||(t.hasher=Le),t.cidVersion===void 0&&(t.cidVersion=1),t.codec===ut&&t.hasher!==Le&&(t.cidVersion=1);let n=await t.hasher.digest(r),i=T.create(t.cidVersion,t.codec.code,n);return t.onlyHash||await e.put(i,r,{signal:t.signal}),i},Ko=Wye;var Yye=async(r,e,t)=>{let n=new Ke({type:"directory",mtime:r.mtime,mode:r.mode}),i=ze(Pn({Data:n.marshal()})),s=await Ko(i,e,t),o=r.path;return{cid:s,path:o,unixfs:n,size:i.length}},cK=Yye;l();var pK=S(W(),1);l();async function Qye(r,e){return e(await Zn(r))}var lK=Qye;l();function Xye(r,e,t){return uK(r,e,t)}async function uK(r,e,t){let n=[];for await(let i of Zc(r,t.maxChildrenPerNode))n.push(await e(i));return n.length>1?uK(n,e,t):n[0]}var fK=Xye;l();async function Zye(r,e,t){let n=new wx(t.layerRepeat),i=0,s=1,o=n;for await(let a of Zc(r,t.maxChildrenPerNode))o.isFull()&&(o!==n&&n.addChild(await o.reduce(e)),i&&i%t.layerRepeat===0&&s++,o=new w6(s,t.layerRepeat,i),i++),o.append(a);return o&&o!==n&&n.addChild(await o.reduce(e)),n.reduce(e)}var hK=Zye,w6=class{constructor(e,t,n=0){this.maxDepth=e,this.layerRepeat=t,this.currentDepth=1,this.iteration=n,this.root=this.node=this.parent={children:[],depth:this.currentDepth,maxDepth:e,maxChildren:(this.maxDepth-this.currentDepth)*this.layerRepeat}}isFull(){if(!this.root.data)return!1;if(this.currentDepth<this.maxDepth&&this.node.maxChildren)return this._addNextNodeToParent(this.node),!1;let e=this._findParent(this.node,this.currentDepth);return e?(this._addNextNodeToParent(e),!1):!0}_addNextNodeToParent(e){this.parent=e;let t={children:[],depth:e.depth+1,parent:e,maxDepth:this.maxDepth,maxChildren:Math.floor(e.children.length/this.layerRepeat)*this.layerRepeat};e.children.push(t),this.currentDepth=t.depth,this.node=t}append(e){this.node.data=e}reduce(e){return this._reduce(this.root,e)}async _reduce(e,t){let n=[];return e.children.length&&(n=await Promise.all(e.children.filter(i=>i.data).map(i=>this._reduce(i,t)))),t((e.data||[]).concat(n))}_findParent(e,t){let n=e.parent;if(!(!n||n.depth===0))return n.children.length===n.maxChildren||!n.maxChildren?this._findParent(n,t):n}},wx=class extends w6{constructor(e){super(0,e),this.root.depth=0,this.currentDepth=1}addChild(e){this.root.children.push(e)}reduce(e){return e((this.root.data||[]).concat(this.root.children))}};l();async function*Jye(r,e,t){for await(let n of r.content)yield async()=>{t.progress(n.length,r.path);let i,s={codec:ut,cidVersion:t.cidVersion,hasher:t.hasher,onlyHash:t.onlyHash};return t.rawLeaves?(s.codec=zi,s.cidVersion=1):(i=new Ke({type:t.leafType,data:n}),n=ze({Data:i.marshal(),Links:[]})),{cid:await Ko(n,e,s),unixfs:i,size:n.length}}}var dK=Jye;var e3e={flat:lK,balanced:fK,trickle:hK};async function*t3e(r,e,t){let n=-1,i,s;typeof t.bufferImporter=="function"?s=t.bufferImporter:s=dK;for await(let o of F2(s(r,e,t),t.blockWriteConcurrency)){if(n++,n===0){i=o;continue}else n===1&&i&&(yield i,i=null);yield o}i&&(i.single=!0,yield i)}var r3e=(r,e,t)=>{async function n(i){if(i.length===1&&i[0].single&&t.reduceSingleLeafToSelf){let f=i[0];if(r.mtime!==void 0||r.mode!==void 0){let h=await e.get(f.cid);f.unixfs=new Ke({type:"file",mtime:r.mtime,mode:r.mode,data:h}),h=ze(Pn({Data:f.unixfs.marshal()})),f.cid=await Ko(h,e,{...t,codec:ut,hasher:t.hasher,cidVersion:t.cidVersion}),f.size=h.length}return{cid:f.cid,path:r.path,unixfs:f.unixfs,size:f.size}}let s=new Ke({type:"file",mtime:r.mtime,mode:r.mode}),o=i.filter(f=>f.cid.code===On&&f.size||f.unixfs&&!f.unixfs.data&&f.unixfs.fileSize()?!0:Boolean(f.unixfs&&f.unixfs.data&&f.unixfs.data.length)).map(f=>f.cid.code===On?(s.addBlockSize(f.size),{Name:"",Tsize:f.size,Hash:f.cid}):(!f.unixfs||!f.unixfs.data?s.addBlockSize(f.unixfs&&f.unixfs.fileSize()||0):s.addBlockSize(f.unixfs.data.length),{Name:"",Tsize:f.size,Hash:f.cid})),a={Data:s.marshal(),Links:o},c=ze(Pn(a));return{cid:await Ko(c,e,t),path:r.path,unixfs:s,size:c.length+a.Links.reduce((f,h)=>f+h.Tsize,0)}}return n};function n3e(r,e,t){let n=e3e[t.strategy];if(!n)throw(0,pK.default)(new Error(`Unknown importer build strategy name: ${t.strategy}`),"ERR_BAD_STRATEGY");return n(t3e(r,e,t),r3e(r,e,t),t)}var mK=n3e;var Ax=S(W(),1);l();l();var yK=Symbol.for("@achingbrain/uint8arraylist");function gK(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(let n of r){let i=t+n.byteLength;if(e<i)return{buf:n,index:e-t};t=i}throw new RangeError("index is out of bounds")}function Da(r){return Boolean(r?.[yK])}var ke=class{constructor(...e){Object.defineProperty(this,yK,{value:!0}),this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(Da(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(Da(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=gK(this.bufs,e);return t.buf[t.index]}set(e,t){let n=gK(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(Da(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:n,length:i}=this._subList(e,t);return Z(n,i)}subarray(e,t){let{bufs:n,length:i}=this._subList(e,t);return n.length===1?n[0]:Z(n,i)}sublist(e,t){let{bufs:n,length:i}=this._subList(e,t),s=new ke;return s.length=i,s.bufs=n,s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:[...this.bufs],length:this.length};let n=[],i=0;for(let s=0;s<this.bufs.length;s++){let o=this.bufs[s],a=i,c=a+o.byteLength;if(i=c,e>=c)continue;let u=e>=a&&e<c,f=t>a&&t<=c;if(u&&f){if(e===a&&t===c){n.push(o);break}let h=e-a;n.push(o.subarray(h,h+(t-e)));break}if(u){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(f){if(t===c){n.push(o);break}n.push(o.subarray(0,t-a));break}n.push(o)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!Da(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;let i=n.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");let s=256,o=new Int32Array(s);for(let h=0;h<s;h++)o[h]=-1;for(let h=0;h<i;h++)o[n[h]]=h;let a=o,c=this.byteLength-n.byteLength,u=n.byteLength-1,f;for(let h=t;h<=c;h+=f){f=0;for(let p=u;p>=0;p--){let d=this.get(h+p);if(n[p]!==d){f=Math.max(1,p-a[d]);break}}if(f===0)return h}return-1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let n=Ri(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){let i=Nc(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,t,n),this.write(i,e)}getInt32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){let i=Nc(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,t,n),this.write(i,e)}getBigInt64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){let i=Nc(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,t,n),this.write(i,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let n=Ri(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){let i=Nc(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,t,n),this.write(i,e)}getUint32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){let i=Nc(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,t,n),this.write(i,e)}getBigUint64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){let i=Nc(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,t,n),this.write(i,e)}getFloat32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){let i=Nc(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,t,n),this.write(i,e)}getFloat64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){let i=Nc(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,t,n),this.write(i,e)}equals(e){if(e==null||!(e instanceof ke)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!be(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let n=new ke;return n.bufs=e,t==null&&(t=e.reduce((i,s)=>i+s.byteLength,0)),n.length=t,n}};var kK=S(PK(),1),Sx=S(W(),1);async function*l3e(r,e){let t,n,i;if(e.minChunkSize&&e.maxChunkSize&&e.avgChunkSize)i=e.avgChunkSize,t=e.minChunkSize,n=e.maxChunkSize;else if(e.avgChunkSize)i=e.avgChunkSize,t=i/3,n=i+i/2;else throw(0,Sx.default)(new Error("please specify an average chunk size"),"ERR_INVALID_AVG_CHUNK_SIZE");if(t<16)throw(0,Sx.default)(new Error("rabin min must be greater than 16"),"ERR_INVALID_MIN_CHUNK_SIZE");n<t&&(n=t),i<t&&(i=t);let s=Math.floor(Math.log2(i));for await(let o of u3e(r,{min:t,max:n,bits:s,window:e.window,polynomial:e.polynomial}))yield o}var OK=l3e;async function*u3e(r,e){let t=await(0,kK.create)(e.bits,e.min,e.max,e.window),n=new ke;for await(let i of r){n.append(i);let s=t.fingerprint(i);for(let o=0;o<s.length;o++){let a=s[o],c=n.slice(0,a);n.consume(a),yield c}}n.length&&(yield n.subarray(0))}l();async function*f3e(r,e){let t=new ke,n=0,i=!1,s=e.maxChunkSize;for await(let o of r)for(t.append(o),n+=o.length;n>=s;)if(yield t.slice(0,s),i=!0,s===t.length)t=new ke,n=0;else{let a=new ke;a.append(t.sublist(s)),t=a,n-=s}(!i||n)&&(yield t.subarray(0,n))}var NK=f3e;l();var xx=S(W(),1);async function*h3e(r){for await(let e of r){if(e.length===void 0)throw(0,xx.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if(typeof e=="string"||e instanceof String)yield U(e.toString());else if(Array.isArray(e))yield Uint8Array.from(e);else if(e instanceof Uint8Array)yield e;else throw(0,xx.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}}var DK=h3e;function d3e(r){return Symbol.iterator in r}function p3e(r){return Symbol.asyncIterator in r}function m3e(r){try{if(r instanceof Uint8Array)return async function*(){yield r}();if(d3e(r))return async function*(){yield*r}();if(p3e(r))return r}catch{throw(0,Ax.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw(0,Ax.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}async function*g3e(r,e,t){for await(let n of r)if(n.path&&(n.path.substring(0,2)==="./"&&(t.wrapWithDirectory=!0),n.path=n.path.split("/").filter(i=>i&&i!==".").join("/")),n.content){let i;typeof t.chunker=="function"?i=t.chunker:t.chunker==="rabin"?i=OK:i=NK;let s;typeof t.chunkValidator=="function"?s=t.chunkValidator:s=DK;let o={path:n.path,mtime:n.mtime,mode:n.mode,content:i(s(m3e(n.content),t),t)};yield()=>mK(o,e,t)}else if(n.path){let i={path:n.path,mtime:n.mtime,mode:n.mode};yield()=>cK(i,e,t)}else throw new Error("Import candidate must have content or path or both")}var LK=g3e;l();l();l();var Tx=class{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}},Uu=Tx;var Ix=class extends Uu{constructor(e,t){super(e,t),this._children={}}async put(e,t){this.cid=void 0,this.size=void 0,this._children[e]=t}get(e){return Promise.resolve(this._children[e])}childCount(){return Object.keys(this._children).length}directChildrenCount(){return this.childCount()}onlyChild(){return this._children[Object.keys(this._children)[0]]}async*eachChildSeries(){let e=Object.keys(this._children);for(let t=0;t<e.length;t++){let n=e[t];yield{key:n,child:this._children[n]}}}async*flush(e){let t=Object.keys(this._children),n=[];for(let u=0;u<t.length;u++){let f=this._children[t[u]];if(f instanceof Uu)for await(let h of f.flush(e))f=h,yield f;f.size!=null&&f.cid&&n.push({Name:t[u],Tsize:f.size,Hash:f.cid})}let i=new Ke({type:"directory",mtime:this.mtime,mode:this.mode}),s={Data:i.marshal(),Links:n},o=ze(Pn(s)),a=await Ko(o,e,this.options),c=o.length+s.Links.reduce((u,f)=>u+(f.Tsize==null?0:f.Tsize),0);this.cid=a,this.size=c,yield{cid:a,unixfs:i,path:this.path,size:c}}},$2=Ix;l();l();l();l();var FK=S(MK(),1);var zr=class{constructor(e,t,n=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new FK.default,this.key=null}async put(e,t){let n=await this._findNewBucketAndPos(e);await n.bucket._putAt(n,e,t)}async get(e){let t=await this._findChild(e);if(t!=null)return t.value}async del(e){let t=await this._findPlace(e),n=t.bucket._at(t.pos);n!=null&&n.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce((t,n)=>n instanceof zr?t+n.leafCount():t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){let e=this._children.compactArray();for(let t of e)t instanceof zr?yield*t.eachLeafSeries():yield t}serialize(e,t){let n=[];return t(this._children.reduce((i,s,o)=>(s!=null&&(s instanceof zr?i.push(s.serialize(e,t)):i.push(e(s,o))),i),n))}async asyncTransform(e,t){return await VK(this,e,t)}toJSON(){return this.serialize(_3e,v3e)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){let t=await this._findPlace(e),n=t.bucket._at(t.pos);if(!(n instanceof zr)&&n!=null&&n.key===e)return n}async _findPlace(e){let t=this._options.hash(typeof e=="string"?U(e):e),n=await t.take(this._options.bits),i=this._children.get(n);return i instanceof zr?await i._findPlace(t):{bucket:this,pos:n,hash:t,existingChild:i}}async _findNewBucketAndPos(e){let t=await this._findPlace(e);if(t.existingChild!=null&&t.existingChild.key!==e){let n=new zr(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,n);let i=await n._findPlace(t.existingChild.hash);return i.bucket._putAt(i,t.existingChild.key,t.existingChild.value),await n._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){this._children.get(e)==null&&this._popCount++,this._children.set(e,t)}_delAt(e){if(e===-1)throw new Error("Invalid position");this._children.get(e)!=null&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){let e=this._children.find(E3e);if(e!=null&&!(e instanceof zr)){let t=e.hash;t.untake(this._options.bits);let n={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}};function E3e(r){return Boolean(r)}function _3e(r,e){return r.key}function v3e(r){return r}async function VK(r,e,t){let n=[];for(let i of r._children.compactArray())if(i instanceof zr)await VK(i,e,t);else{let s=await e(i);n.push({bitField:r._children.bitField(),children:s})}return await t(n)}l();l();var S3e=[255,254,252,248,240,224,192,128],x3e=[1,3,7,15,31,63,127,255],b6=class{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){let i=this._value[this._currentBytePos],s=this._currentBitPos+1,o=Math.min(s,t),a=A3e(i,s-o,o);n=(n<<o)+a,t-=o,this._currentBitPos-=o,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function A3e(r,e,t){let n=T3e(e,t);return(r&n)>>>e}function T3e(r,e){return S3e[r]&x3e[Math.min(e+r-1,7)]}function zK(r){function e(t){return t instanceof E6?t:new E6(t,r)}return e}var E6=class{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){let i=this._buffers[this._currentBufferIndex],s=Math.min(i.availableBits(),t),o=i.take(s);n=(n<<s)+o,t-=s,this._availableBits-=s,i.availableBits()===0&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){let n=this._buffers[this._currentBufferIndex],i=Math.min(n.totalBits()-n.availableBits(),t);n.untake(i),t-=i,this._availableBits+=i,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?Z([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new b6(t);this._buffers.push(n),this._availableBits+=n.availableBits()}};function Mu(r){if(r==null||r.hashFn==null)throw new Error("please define an options.hashFn");let e={bits:r.bits??8,hash:zK(r.hashFn)};return new zr(e)}var Rx=class extends Uu{constructor(e,t){super(e,t),this._bucket=Mu({hashFn:t.hamtHashFn,bits:t.hamtBucketBits})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){for await(let t of qK(this._bucket,e,this,this.options))yield{...t,path:this.path}}},KK=Rx;async function*qK(r,e,t,n){let i=r._children,s=[],o=0;for(let d=0;d<i.length;d++){let m=i.get(d);if(!m)continue;let g=d.toString(16).toUpperCase().padStart(2,"0");if(m instanceof zr){let y;for await(let w of await qK(m,e,null,n))y=w;if(!y)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:g,Tsize:y.size,Hash:y.cid}),o+=y.size}else if(typeof m.value.flush=="function"){let y=m.value,w;for await(let _ of y.flush(e))w=_,yield w;let b=g+m.key;s.push({Name:b,Tsize:w.size,Hash:w.cid}),o+=w.size}else{let y=m.value;if(!y.cid)continue;let w=g+m.key,b=y.size;s.push({Name:w,Tsize:b,Hash:y.cid}),o+=b}}let a=Uint8Array.from(i.bitField().reverse()),c=new Ke({type:"hamt-sharded-directory",data:a,fanout:r.tableSize(),hashType:n.hamtHashCode,mtime:t&&t.mtime,mode:t&&t.mode}),u={Data:c.marshal(),Links:s},f=ze(Pn(u)),h=await Ko(f,e,n),p=f.length+o;yield{cid:h,unixfs:c,size:p}}async function $K(r,e,t,n){let i=e;e instanceof $2&&e.directChildrenCount()>=t&&(i=await I3e(e,n));let s=i.parent;if(s){if(i!==e){if(r&&(r.parent=i),!i.parentKey)throw new Error("No parent key found");await s.put(i.parentKey,i)}return $K(i,s,t,n)}return i}async function I3e(r,e){let t=new KK({root:r.root,dir:!0,parent:r.parent,parentKey:r.parentKey,path:r.path,dirty:r.dirty,flat:!1,mtime:r.mtime,mode:r.mode},e);for await(let{key:n,child:i}of r.eachChildSeries())await t.put(n,i);return t}var HK=$K;l();var R3e=(r="")=>(r.trim().match(/([^\\/]|\\\/)+/g)||[]).filter(Boolean),GK=R3e;async function C3e(r,e,t){let n=GK(r.path||""),i=n.length-1,s=e,o="";for(let a=0;a<n.length;a++){let c=n[a];o+=`${o?"/":""}${c}`;let u=a===i;if(s.dirty=!0,s.cid=void 0,s.size=void 0,u)await s.put(c,r),e=await HK(null,s,t.shardSplitThreshold,t);else{let f=await s.get(c);(!f||!(f instanceof Uu))&&(f=new $2({root:!1,dir:!0,parent:s,parentKey:c,path:o,dirty:!0,flat:!0,mtime:f&&f.unixfs&&f.unixfs.mtime,mode:f&&f.unixfs&&f.unixfs.mode},t)),await s.put(c,f),s=f}}return e}async function*jK(r,e){if(!(r instanceof Uu)){r&&r.unixfs&&r.unixfs.isDirectory()&&(yield r);return}yield*r.flush(e)}async function*P3e(r,e,t){let n=new $2({root:!0,dir:!0,path:"",dirty:!0,flat:!0},t);for await(let i of r)i&&(n=await C3e(i,n,t),(!i.unixfs||!i.unixfs.isDirectory())&&(yield i));if(t.wrapWithDirectory)yield*jK(n,e);else for await(let i of n.eachChildSeries())i&&(yield*jK(i.child,e))}var WK=P3e;async function*y0(r,e,t={}){let n=aK(t),i;typeof t.dagBuilder=="function"?i=t.dagBuilder:i=LK;let s;typeof t.treeBuilder=="function"?s=t.treeBuilder:s=WK;let o;Symbol.asyncIterator in r||Symbol.iterator in r?o=r:o=[r];for await(let a of s(F2(i(o,e,n),n.fileImportConcurrency),e,n))yield{cid:a.cid,path:a.path,unixfs:a.unixfs,size:a.size}}l();l();var H2=S(W(),1);async function*_6(r,e){if(typeof r=="string"||r instanceof String||Zs(r)||Qc(r)||r._readableState)throw(0,H2.default)(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(Xc(r)&&(r=Wi(r)),Symbol.iterator in r||Symbol.asyncIterator in r){let t=zo(r),{value:n,done:i}=await t.peek();if(i){yield*[];return}if(t.push(n),Number.isInteger(n))throw(0,H2.default)(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(n._readableState){yield*Zt(t,s=>Cx({content:s},e));return}if(Zs(n)){yield Cx({content:t},e);return}if(M2(n)||n[Symbol.iterator]||n[Symbol.asyncIterator]||Xc(n)||Qc(n)){yield*Zt(t,s=>Cx(s,e));return}}throw M2(r)?(0,H2.default)(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT"):(0,H2.default)(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}async function Cx(r,e){let{path:t,mode:n,mtime:i,content:s}=r,o={path:t||"",mode:Tc(n),mtime:au(i)};return s?o.content=await e(s):t||(o.content=await e(r)),o}function YK(r){return _6(r,h6)}l();var QK=r=>{if(r)if(r.startsWith("size-")){let e=r.split("-")[1],t=parseInt(e);if(isNaN(t))throw new Error("Chunker parameter size must be an integer");return{chunker:"fixed",maxChunkSize:t}}else{if(r.startsWith("rabin"))return{chunker:"rabin",...k3e(r)};throw new Error(`Unrecognized chunker option: ${r}`)}else return{chunker:"fixed"}},k3e=r=>{let e={},t=r.split("-");switch(t.length){case 1:e.avgChunkSize=262144;break;case 2:e.avgChunkSize=v6(t[1],"avg");break;case 4:e.minChunkSize=v6(t[1],"min"),e.avgChunkSize=v6(t[2],"avg"),e.maxChunkSize=v6(t[3],"max");break;default:throw new Error('Incorrect chunker format (expected "rabin" "rabin-[avg]" or "rabin-[min]-[avg]-[max]"')}return e},v6=(r,e)=>{let t=parseInt(r);if(isNaN(t))throw new Error(`Chunker parameter ${e} must be an integer`);return t};var O3e=Ve.bind({ignoreUndefined:!0});function XK({repo:r,preload:e,hashers:t,options:n}){let i=n&&n.sharding;async function*s(o,a={}){let c=O3e({shardSplitThreshold:i?1e3:1/0,strategy:"balanced"},a,{...QK(a.chunker)});c.hashAlg&&c.hashAlg!=="sha2-256"&&c.cidVersion!==1&&(c.cidVersion=1),c.trickle&&(c.strategy="trickle"),c.strategy==="trickle"&&(c.leafType="raw",c.reduceSingleLeafToSelf=!1),c.cidVersion>0&&c.rawLeaves===void 0&&(c.rawLeaves=!0),c.hashAlg!==void 0&&c.rawLeaves===void 0&&(c.rawLeaves=!0),delete c.trickle;let u={};if(c.progress){let d=c.progress;c.progress=(m,g)=>{u[g]||(u[g]=0),u[g]+=m,d(u[g],g)}}let f;c.hashAlg!=null&&(f=await t.getHasher(c.hashAlg));let h=_e(YK(o),d=>y0(d,r.blocks,{...c,hasher:f,pin:!1}),N3e(c),D3e(e,c),L3e(r,c)),p=await r.gcLock.readLock();try{for await(let d of h){let m=d.path??d.cid.toString();delete u[m],yield{...d,path:m}}}finally{p()}}return z(s)}function N3e(r){async function*e(t){for await(let n of t){let i=n.cid;r.cidVersion===1&&(i=i.toV1());let s=n.path?n.path:i.toString();r.wrapWithDirectory&&!n.path&&(s=""),yield{path:s,cid:i,size:n.size,mode:n.unixfs&&n.unixfs.mode,mtime:n.unixfs&&n.unixfs.mtime}}}return e}function D3e(r,e){async function*t(n){for await(let i of n)(!i.path||e.wrapWithDirectory?i.path==="":!i.path.includes("/"))&&!e.onlyHash&&e.preload!==!1&&r(i.cid),yield i}return t}function L3e(r,e){async function*t(n){for await(let i of n){let s=!(i.path&&i.path.includes("/"));(e.pin==null?!0:e.pin)&&s&&!e.onlyHash&&await r.pins.pinRecursively(i.cid),yield i}}return t}l();l();var T6=S(W(),1);l();var hq=S(W(),1);l();var A6=S(W(),1);l();var B3e=async function(r){return(await Nh.encode(r)).slice(0,8).reverse()},U3e=(r,e,t)=>Promise.all(r.map(n=>{if(n.Name==null)throw new Error("Unexpected Link without a Name");if(n.Name.length===2){let i=parseInt(n.Name,16);return e._putObjectAt(i,new zr({hash:t._options.hash,bits:t._options.bits},e,i))}return t.put(n.Name.substring(2),!0)})),ZK=r=>r.toString(16).toUpperCase().padStart(2,"0").substring(0,2),M3e=r=>{let e=r.bucket,t=[];for(;e._parent;)t.push(e),e=e._parent;return t.push(e),t.reverse()},JK=async(r,e,t,n,i)=>{if(!n){let f=Mu({hashFn:B3e});n={rootBucket:f,hamtDepth:1,lastBucket:f}}await U3e(r.Links,n.lastBucket,n.rootBucket);let s=await n.rootBucket._findNewBucketAndPos(e),o=ZK(s.pos),a=M3e(s);a.length>n.hamtDepth&&(n.lastBucket=a[n.hamtDepth],o=ZK(n.lastBucket._posAtParent));let c=r.Links.find(f=>{if(f.Name==null)return!1;let h=f.Name.substring(0,2),p=f.Name.substring(2);return!(h!==o||p&&p!==e)});if(!c)return null;if(c.Name!=null&&c.Name.substring(2)===e)return c.Hash;n.hamtDepth++;let u=await t.get(c.Hash,i);return r=lt(u),JK(r,e,t,n,i)},eq=JK;l();l();function F3e(r,e,t,n){let i=r.length,s=e+i;return t>=s||n<e?new Uint8Array(0):(n>=e&&n<s&&(r=r.subarray(0,n-e)),t>=e&&t<s&&(r=r.subarray(t-e)),r)}var Dh=F3e;l();var S6=S(W(),1),V3e=(r,e,t)=>{if(e||(e=0),e<0)throw(0,S6.default)(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(e>r)throw(0,S6.default)(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(!t&&t!==0&&(t=r-e),t<0)throw(0,S6.default)(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");return e+t>r&&(t=r-e),{offset:e,length:t}},w0=V3e;var x6=S(W(),1);async function tq(r,e,t,n,i,s,o,a){if(e instanceof Uint8Array){t.push(Dh(e,n,i,s));return}if(e.Data==null)throw(0,x6.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=Ke.unmarshal(e.Data)}catch(f){throw(0,x6.default)(f,"ERR_NOT_UNIXFS")}if(c.data!=null){let f=c.data,h=Dh(f,n,i,s);t.push(h),n+=h.byteLength}let u=[];for(let f=0;f<e.Links.length;f++){let h=e.Links[f],p=n,d=p+c.blockSizes[f];if((i>=p&&i<d||s>=p&&s<=d||i<p&&s>d)&&u.push({link:h,blockStart:n}),n=d,n>s)break}await _e(u,f=>Zt(f,h=>async()=>{let p=await r.get(h.link.Hash,{signal:a.signal});return{...h,block:p}}),f=>Yc(f,{ordered:!0}),async f=>{for await(let{link:h,block:p,blockStart:d}of f){let m;switch(h.Hash.code){case We:m=lt(p);break;case On:m=p;break;default:t.end((0,x6.default)(new Error(`Unsupported codec: ${h.Hash.code}`),"ERR_NOT_UNIXFS"));return}o.add(async()=>{await tq(r,m,t,d,i,s,o,a)})}})}var z3e=(r,e,t,n,i,s,o)=>{async function*a(c={}){let u=t.fileSize();if(u===void 0)throw new Error("File was a directory");let{offset:f,length:h}=w0(u,c.offset,c.length);if(h===0)return;let p=new qt({concurrency:1}),d=dt();p.add(async()=>{await tq(o,e,d,0,f,f+h,p,c)}),p.on("error",g=>{d.end(g)});let m=0;for await(let g of d)g!=null&&(m+=g.byteLength,m===h&&d.end(),yield g)}return a},Px=z3e;l();var K3e=(r,e,t,n,i,s,o)=>{async function*a(c={}){let u=c.offset||0,f=c.length||e.Links.length,h=e.Links.slice(u,f);for(let p of h){let d=await i(p.Hash,p.Name||"",`${n}/${p.Name||""}`,[],s+1,o,c);d.entry&&(yield d.entry)}}return a},rq=K3e;l();var q3e=(r,e,t,n,i,s,o)=>{function a(c={}){return nq(e,n,i,s,o,c)}return a};async function*nq(r,e,t,n,i,s){let o=r.Links;for(let a of o){let c=a.Name!=null?a.Name.substring(2):null;if(c)yield(await t(a.Hash,c,`${e}/${c}`,[],n+1,i,s)).entry;else{let u=await i.get(a.Hash);r=lt(u);for await(let f of nq(r,e,t,n,i,s))yield f}}}var iq=q3e;var $3e=(r,e)=>{let t=r.Links.find(n=>n.Name===e);return t&&t.Hash},H3e={raw:Px,file:Px,directory:rq,"hamt-sharded-directory":iq,metadata:(r,e,t,n,i,s,o)=>()=>[],symlink:(r,e,t,n,i,s,o)=>()=>[]},G3e=async(r,e,t,n,i,s,o,a)=>{let c=await o.get(r,a),u=lt(c),f,h;if(e||(e=r.toString()),u.Data==null)throw(0,A6.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{f=Ke.unmarshal(u.Data)}catch(p){throw(0,A6.default)(p,"ERR_NOT_UNIXFS")}if(t||(t=e),n.length){let p;if(f&&f.type==="hamt-sharded-directory"?p=await eq(u,n[0],o):p=$3e(u,n[0]),!p)throw(0,A6.default)(new Error("file does not exist"),"ERR_NOT_FOUND");let d=n.shift(),m=`${t}/${d}`;h={cid:p,toResolve:n,name:d||"",path:m}}return{entry:{type:f.isDirectory()?"directory":"file",name:e,path:t,cid:r,content:H3e[f.type](r,u,f,t,i,s,o),unixfs:f,depth:s,node:u,size:f.fileSize()},next:h}},sq=G3e;l();var oq=S(W(),1);var j3e=r=>{async function*e(t={}){let{offset:n,length:i}=w0(r.length,t.offset,t.length);yield Dh(r,0,n,n+i)}return e},W3e=async(r,e,t,n,i,s,o,a)=>{if(n.length)throw(0,oq.default)(new Error(`No link named ${t} found in raw node ${r}`),"ERR_NOT_FOUND");let c=await o.get(r,a);return{entry:{type:"raw",name:e,path:t,cid:r,content:j3e(c),depth:s,size:c.length,node:c}}},aq=W3e;l();var cq=S(W(),1);var Y3e=async(r,e,t,n,i,s,o,a)=>{let c=await o.get(r),u=rh(c),f=u,h=t;for(;n.length;){let p=n[0];if(p in f){n.shift(),h=`${h}/${p}`;let d=T.asCID(f[p]);if(d)return{entry:{type:"object",name:e,path:t,cid:r,node:c,depth:s,size:c.length,content:async function*(){yield u}},next:{cid:d,name:p,path:h,toResolve:n}};f=f[p]}else throw(0,cq.default)(new Error(`No property named ${p} found in cbor node ${r}`),"ERR_NO_PROP")}return{entry:{type:"object",name:e,path:t,cid:r,node:c,depth:s,size:c.length,content:async function*(){yield u}}}},lq=Y3e;l();var uq=S(W(),1);var Q3e=r=>{async function*e(t={}){let{offset:n,length:i}=w0(r.length,t.offset,t.length);yield Dh(r,0,n,n+i)}return e},X3e=async(r,e,t,n,i,s,o,a)=>{if(n.length)throw(0,uq.default)(new Error(`No link named ${t} found in raw node ${r}`),"ERR_NOT_FOUND");let c=await Ze(r.multihash.bytes);return{entry:{type:"identity",name:e,path:t,cid:r,content:Q3e(c.digest),depth:s,size:c.digest.length,node:c.digest}}},fq=X3e;var Z3e={[We]:sq,[On]:aq,[Pm]:lq,[un.code]:fq};function dq(r,e,t,n,i,s,o){let a=Z3e[r.code];if(!a)throw(0,hq.default)(new Error(`No resolver for code ${r.code}`),"ERR_NO_RESOLVER");return a(r,e,t,n,dq,i,s,o)}var pq=dq;var J3e=(r="")=>(r.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean),e4e=r=>{if(r instanceof Uint8Array)return{cid:T.decode(r),toResolve:[]};let e=T.asCID(r);if(e)return{cid:e,toResolve:[]};if(typeof r=="string"){r.indexOf("/ipfs/")===0&&(r=r.substring(6));let t=J3e(r);return{cid:T.parse(t[0]),toResolve:t.slice(1)}}throw(0,T6.default)(new Error(`Unknown path type ${r}`),"ERR_BAD_PATH")};async function*kx(r,e,t={}){let{cid:n,toResolve:i}=e4e(r),s=n.toString(),o=s,a=i.length;for(;;){let c=await pq(n,s,o,i,a,e,t);if(!c.entry&&!c.next)throw(0,T6.default)(new Error(`Could not resolve ${r}`),"ERR_NOT_FOUND");if(c.entry&&(yield c.entry),!c.next)return;i=c.next.toResolve,n=c.next.cid,s=c.next.name,o=c.next.path}}async function ei(r,e,t={}){let n=await ir(kx(r,e,t));if(!n)throw(0,T6.default)(new Error(`Could not resolve ${r}`),"ERR_NOT_FOUND");return n}async function*I6(r,e,t={}){let n=await ei(r,e,t);if(!n)return;if(yield n,n.type==="directory")for await(let s of i(n,t))yield s;async function*i(s,o){for await(let a of s.content(o))yield a,!(a instanceof Uint8Array)&&a.type==="directory"&&(yield*i(a,o))}}function mq({repo:r,preload:e}){async function*t(n,i={}){if(n=Fp(n),i.preload!==!1){let o=n.split("/");e(T.parse(o[0]))}let s=await ei(n,r.blocks,i);if(s.type==="directory")throw new Error("this dag node is a directory");if(!s.content)throw new Error("this dag node has no content");yield*s.content(i)}return z(t)}l();var R0=S(W(),1);l();l();l();l();function Lh(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}var Ett="0".charCodeAt(0),_tt=U("ustar\0","binary"),vtt=U("ustar ","binary"),Stt=U(" \0","binary");l();l();function R6(r){let e=async function*(){let t=yield,n=new ke;for await(let i of r){if(t==null){n.append(i),t=yield n,n=new ke;continue}for(n.append(i);n.length>=t;){let s=n.sublist(0,t);if(n.consume(t),t=yield s,t==null){n.length>0&&(t=yield n,n=new ke);break}}}if(t!=null)throw Object.assign(new Error(`stream ended before ${t} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return e.next(),e}l();var bq=S(yq(),1);l();async function b0(r){let e=new Uint8Array(0);for await(let t of r)e=Z([e,t],e.length+t.length);return e}l();var r4e="0000000000000000000",n4e="7777777777777777777",i4e="0".charCodeAt(0),s4e=U("ustar\0","binary"),o4e=U("00","binary"),a4e=parseInt("7777",8),c4e=257,l4e=263,u4e=function(r){switch(r){case"file":return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72;default:return 0}},f4e=function(r){let e=256;for(let t=0;t<148;t++)e+=r[t];for(let t=156;t<512;t++)e+=r[t];return e},Fu=function(r,e){let t=r.toString(8);return t.length>e?U(n4e.slice(0,e)+" "):U(r4e.slice(0,e-t.length)+t+" ")},Ox=function(r){let e=U(r).byteLength,t=Math.floor(Math.log(e)/Math.log(10))+1;return e+t>=Math.pow(10,t)&&t++,`${e+t}${r}`};function wq(r){let e="";r.name!=null&&(e+=Ox(" path="+r.name+`
`)),r.linkname!=null&&(e+=Ox(" linkpath="+r.linkname+`
`));let t=r.pax;if(t!=null)for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e+=Ox(" "+n+"="+t[n]+`
`));return U(e)}function C6(r){let e=new Uint8Array(512),t=r.name,n="";if(r.typeflag===5&&t[t.length-1]!=="/"&&(t+="/"),U(t).byteLength!==t.length)return null;for(;U(t).byteLength>100;){let i=t.indexOf("/");if(i===-1)return null;n+=n!==""?"/"+t.slice(0,i):t.slice(0,i),t=t.slice(i+1)}return U(t).byteLength>100||U(n).byteLength>155||r.linkname!=null&&U(r.linkname).byteLength>100?null:(e.set(U(t),0),e.set(Fu(r.mode&a4e,6),100),e.set(Fu(r.uid,6),108),e.set(Fu(r.gid,6),116),e.set(Fu(r.size,11),124),e.set(Fu(r.mtime.getTime()/1e3|0,11),136),e[156]=i4e+u4e(r.type),r.linkname!=null&&e.set(U(r.linkname),157),e.set(s4e,c4e),e.set(o4e,l4e),r.uname!=null&&e.set(U(r.uname),265),r.gname!=null&&e.set(U(r.gname),297),e.set(Fu(r.devmajor??0,6),329),e.set(Fu(r.devminor??0,6),337),n!=null&&e.set(U(n),345),e.set(Fu(f4e(e),6),148),e)}var{S_IFMT:d4e,S_IFBLK:p4e,S_IFCHR:m4e,S_IFDIR:g4e,S_IFIFO:y4e,S_IFLNK:w4e}=bq.default,b4e=parseInt("755",8),E4e=parseInt("644",8),Eq=new Uint8Array(1024);function _4e(r=0){switch(r&d4e){case p4e:return"block-device";case m4e:return"character-device";case g4e:return"directory";case y4e:return"fifo";case w4e:return"symlink";default:return"file"}}function Dx(r){return r&=511,r!==0?Eq.subarray(0,512-r):new Uint8Array(0)}function Nx(r){if(r.pax==null){let e=C6(r);if(e!=null)return e}return v4e(r)}function v4e(r){let e=wq(r),t={name:"PaxHeader",mode:r.mode,uid:r.uid,gid:r.gid,size:e.length,mtime:r.mtime,type:"pax-header",linkname:r.linkname,uname:r.uname,gname:r.gname,devmajor:r.devmajor,devminor:r.devminor};return new ke(C6(t)??new Uint8Array(0),e,Dx(e.length),C6({...t,size:r.size,type:r.type})??new Uint8Array(0)).subarray()}function P6(){return async function*(r){for await(let{header:e,body:t}of r){let n={...e,size:e.type==="symlink"?0:e.size??0,type:e.type??_4e(e.mode),mode:e.mode??(e.type==="directory"?b4e:E4e),uid:e.uid??0,gid:e.gid??0,mtime:e.mtime??new Date};if(typeof t=="string"&&(t=U(t)),t instanceof Uint8Array||Da(t)){n.size=t.length,yield Nx(n),yield Da(t)?t.subarray():t,yield Dx(n.size);continue}if(n.type==="symlink"&&n.linkname==null){if(t==null)throw new Error("type was symlink but no linkname or body specified");n.linkname=C(await b0(t)),yield Nx(n);continue}if(yield Nx(n),n.type!=="file"&&n.type!=="contiguous-file")continue;let i=0;for await(let s of t??[])i+=s.length,yield Da(s)?s.subarray():s;if(i!==n.size)throw new Error(`size mismatch, wrote ${i} of ${n.size} bytes`);yield Dx(n.size)}yield Eq}}l();function A0(r){let e=r.length;for(;--e>=0;)r[e]=0}var S4e=0,s$=1,x4e=2,A4e=3,T4e=258,iA=29,og=256,Z2=og+1+iA,v0=30,sA=19,o$=2*Z2+1,Bh=15,Lx=16,I4e=7,oA=256,a$=16,c$=17,l$=18,Yx=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),B6=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),R4e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),u$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),C4e=512,el=new Array((Z2+2)*2);A0(el);var Y2=new Array(v0*2);A0(Y2);var J2=new Array(C4e);A0(J2);var eg=new Array(T4e-A4e+1);A0(eg);var aA=new Array(iA);A0(aA);var U6=new Array(v0);A0(U6);function Bx(r,e,t,n,i){this.static_tree=r,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=i,this.has_stree=r&&r.length}var f$,h$,d$;function Ux(r,e){this.dyn_tree=r,this.max_code=0,this.stat_desc=e}var p$=r=>r<256?J2[r]:J2[256+(r>>>7)],tg=(r,e)=>{r.pending_buf[r.pending++]=e&255,r.pending_buf[r.pending++]=e>>>8&255},Yi=(r,e,t)=>{r.bi_valid>Lx-t?(r.bi_buf|=e<<r.bi_valid&65535,tg(r,r.bi_buf),r.bi_buf=e>>Lx-r.bi_valid,r.bi_valid+=t-Lx):(r.bi_buf|=e<<r.bi_valid&65535,r.bi_valid+=t)},Ba=(r,e,t)=>{Yi(r,t[e*2],t[e*2+1])},m$=(r,e)=>{let t=0;do t|=r&1,r>>>=1,t<<=1;while(--e>0);return t>>>1},P4e=r=>{r.bi_valid===16?(tg(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)},k4e=(r,e)=>{let t=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length,u,f,h,p,d,m,g=0;for(p=0;p<=Bh;p++)r.bl_count[p]=0;for(t[r.heap[r.heap_max]*2+1]=0,u=r.heap_max+1;u<o$;u++)f=r.heap[u],p=t[t[f*2+1]*2+1]+1,p>c&&(p=c,g++),t[f*2+1]=p,!(f>n)&&(r.bl_count[p]++,d=0,f>=a&&(d=o[f-a]),m=t[f*2],r.opt_len+=m*(p+d),s&&(r.static_len+=m*(i[f*2+1]+d)));if(g!==0){do{for(p=c-1;r.bl_count[p]===0;)p--;r.bl_count[p]--,r.bl_count[p+1]+=2,r.bl_count[c]--,g-=2}while(g>0);for(p=c;p!==0;p--)for(f=r.bl_count[p];f!==0;)h=r.heap[--u],!(h>n)&&(t[h*2+1]!==p&&(r.opt_len+=(p-t[h*2+1])*t[h*2],t[h*2+1]=p),f--)}},g$=(r,e,t)=>{let n=new Array(Bh+1),i=0,s,o;for(s=1;s<=Bh;s++)i=i+t[s-1]<<1,n[s]=i;for(o=0;o<=e;o++){let a=r[o*2+1];a!==0&&(r[o*2]=m$(n[a]++,a))}},O4e=()=>{let r,e,t,n,i,s=new Array(Bh+1);for(t=0,n=0;n<iA-1;n++)for(aA[n]=t,r=0;r<1<<Yx[n];r++)eg[t++]=n;for(eg[t-1]=n,i=0,n=0;n<16;n++)for(U6[n]=i,r=0;r<1<<B6[n];r++)J2[i++]=n;for(i>>=7;n<v0;n++)for(U6[n]=i<<7,r=0;r<1<<B6[n]-7;r++)J2[256+i++]=n;for(e=0;e<=Bh;e++)s[e]=0;for(r=0;r<=143;)el[r*2+1]=8,r++,s[8]++;for(;r<=255;)el[r*2+1]=9,r++,s[9]++;for(;r<=279;)el[r*2+1]=7,r++,s[7]++;for(;r<=287;)el[r*2+1]=8,r++,s[8]++;for(g$(el,Z2+1,s),r=0;r<v0;r++)Y2[r*2+1]=5,Y2[r*2]=m$(r,5);f$=new Bx(el,Yx,og+1,Z2,Bh),h$=new Bx(Y2,B6,0,v0,Bh),d$=new Bx(new Array(0),R4e,0,sA,I4e)},y$=r=>{let e;for(e=0;e<Z2;e++)r.dyn_ltree[e*2]=0;for(e=0;e<v0;e++)r.dyn_dtree[e*2]=0;for(e=0;e<sA;e++)r.bl_tree[e*2]=0;r.dyn_ltree[oA*2]=1,r.opt_len=r.static_len=0,r.sym_next=r.matches=0},w$=r=>{r.bi_valid>8?tg(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},_q=(r,e,t,n)=>{let i=e*2,s=t*2;return r[i]<r[s]||r[i]===r[s]&&n[e]<=n[t]},Mx=(r,e,t)=>{let n=r.heap[t],i=t<<1;for(;i<=r.heap_len&&(i<r.heap_len&&_q(e,r.heap[i+1],r.heap[i],r.depth)&&i++,!_q(e,n,r.heap[i],r.depth));)r.heap[t]=r.heap[i],t=i,i<<=1;r.heap[t]=n},vq=(r,e,t)=>{let n,i,s=0,o,a;if(r.sym_next!==0)do n=r.pending_buf[r.sym_buf+s++]&255,n+=(r.pending_buf[r.sym_buf+s++]&255)<<8,i=r.pending_buf[r.sym_buf+s++],n===0?Ba(r,i,e):(o=eg[i],Ba(r,o+og+1,e),a=Yx[o],a!==0&&(i-=aA[o],Yi(r,i,a)),n--,o=p$(n),Ba(r,o,t),a=B6[o],a!==0&&(n-=U6[o],Yi(r,n,a)));while(s<r.sym_next);Ba(r,oA,e)},Qx=(r,e)=>{let t=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems,o,a,c=-1,u;for(r.heap_len=0,r.heap_max=o$,o=0;o<s;o++)t[o*2]!==0?(r.heap[++r.heap_len]=c=o,r.depth[o]=0):t[o*2+1]=0;for(;r.heap_len<2;)u=r.heap[++r.heap_len]=c<2?++c:0,t[u*2]=1,r.depth[u]=0,r.opt_len--,i&&(r.static_len-=n[u*2+1]);for(e.max_code=c,o=r.heap_len>>1;o>=1;o--)Mx(r,t,o);u=s;do o=r.heap[1],r.heap[1]=r.heap[r.heap_len--],Mx(r,t,1),a=r.heap[1],r.heap[--r.heap_max]=o,r.heap[--r.heap_max]=a,t[u*2]=t[o*2]+t[a*2],r.depth[u]=(r.depth[o]>=r.depth[a]?r.depth[o]:r.depth[a])+1,t[o*2+1]=t[a*2+1]=u,r.heap[1]=u++,Mx(r,t,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],k4e(r,e),g$(t,c,r.bl_count)},Sq=(r,e,t)=>{let n,i=-1,s,o=e[0*2+1],a=0,c=7,u=4;for(o===0&&(c=138,u=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)s=o,o=e[(n+1)*2+1],!(++a<c&&s===o)&&(a<u?r.bl_tree[s*2]+=a:s!==0?(s!==i&&r.bl_tree[s*2]++,r.bl_tree[a$*2]++):a<=10?r.bl_tree[c$*2]++:r.bl_tree[l$*2]++,a=0,i=s,o===0?(c=138,u=3):s===o?(c=6,u=3):(c=7,u=4))},xq=(r,e,t)=>{let n,i=-1,s,o=e[0*2+1],a=0,c=7,u=4;for(o===0&&(c=138,u=3),n=0;n<=t;n++)if(s=o,o=e[(n+1)*2+1],!(++a<c&&s===o)){if(a<u)do Ba(r,s,r.bl_tree);while(--a!==0);else s!==0?(s!==i&&(Ba(r,s,r.bl_tree),a--),Ba(r,a$,r.bl_tree),Yi(r,a-3,2)):a<=10?(Ba(r,c$,r.bl_tree),Yi(r,a-3,3)):(Ba(r,l$,r.bl_tree),Yi(r,a-11,7));a=0,i=s,o===0?(c=138,u=3):s===o?(c=6,u=3):(c=7,u=4)}},N4e=r=>{let e;for(Sq(r,r.dyn_ltree,r.l_desc.max_code),Sq(r,r.dyn_dtree,r.d_desc.max_code),Qx(r,r.bl_desc),e=sA-1;e>=3&&r.bl_tree[u$[e]*2+1]===0;e--);return r.opt_len+=3*(e+1)+5+5+4,e},D4e=(r,e,t,n)=>{let i;for(Yi(r,e-257,5),Yi(r,t-1,5),Yi(r,n-4,4),i=0;i<n;i++)Yi(r,r.bl_tree[u$[i]*2+1],3);xq(r,r.dyn_ltree,e-1),xq(r,r.dyn_dtree,t-1)},L4e=r=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&r.dyn_ltree[t*2]!==0)return 0;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return 1;for(t=32;t<og;t++)if(r.dyn_ltree[t*2]!==0)return 1;return 0},Aq=!1,B4e=r=>{Aq||(O4e(),Aq=!0),r.l_desc=new Ux(r.dyn_ltree,f$),r.d_desc=new Ux(r.dyn_dtree,h$),r.bl_desc=new Ux(r.bl_tree,d$),r.bi_buf=0,r.bi_valid=0,y$(r)},b$=(r,e,t,n)=>{Yi(r,(S4e<<1)+(n?1:0),3),w$(r),tg(r,t),tg(r,~t),t&&r.pending_buf.set(r.window.subarray(e,e+t),r.pending),r.pending+=t},U4e=r=>{Yi(r,s$<<1,3),Ba(r,oA,el),P4e(r)},M4e=(r,e,t,n)=>{let i,s,o=0;r.level>0?(r.strm.data_type===2&&(r.strm.data_type=L4e(r)),Qx(r,r.l_desc),Qx(r,r.d_desc),o=N4e(r),i=r.opt_len+3+7>>>3,s=r.static_len+3+7>>>3,s<=i&&(i=s)):i=s=t+5,t+4<=i&&e!==-1?b$(r,e,t,n):r.strategy===4||s===i?(Yi(r,(s$<<1)+(n?1:0),3),vq(r,el,Y2)):(Yi(r,(x4e<<1)+(n?1:0),3),D4e(r,r.l_desc.max_code+1,r.d_desc.max_code+1,o+1),vq(r,r.dyn_ltree,r.dyn_dtree)),y$(r),n&&w$(r)},F4e=(r,e,t)=>(r.pending_buf[r.sym_buf+r.sym_next++]=e,r.pending_buf[r.sym_buf+r.sym_next++]=e>>8,r.pending_buf[r.sym_buf+r.sym_next++]=t,e===0?r.dyn_ltree[t*2]++:(r.matches++,e--,r.dyn_ltree[(eg[t]+og+1)*2]++,r.dyn_dtree[p$(e)*2]++),r.sym_next===r.sym_end),V4e=B4e,z4e=b$,K4e=M4e,q4e=F4e,$4e=U4e,H4e={_tr_init:V4e,_tr_stored_block:z4e,_tr_flush_block:K4e,_tr_tally:q4e,_tr_align:$4e},G4e=(r,e,t,n)=>{let i=r&65535|0,s=r>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do i=i+e[n++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0},rg=G4e,j4e=()=>{let r,e=[];for(var t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e},W4e=new Uint32Array(j4e()),Y4e=(r,e,t,n)=>{let i=W4e,s=n+t;r^=-1;for(let o=n;o<s;o++)r=r>>>8^i[(r^e[o])&255];return r^-1},Vn=Y4e,Fh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Kh={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Q4e,_tr_stored_block:Xx,_tr_flush_block:X4e,_tr_tally:Ku,_tr_align:Z4e}=H4e,{Z_NO_FLUSH:qu,Z_PARTIAL_FLUSH:J4e,Z_FULL_FLUSH:ewe,Z_FINISH:Js,Z_BLOCK:Tq,Z_OK:ti,Z_STREAM_END:Iq,Z_STREAM_ERROR:Ua,Z_DATA_ERROR:twe,Z_BUF_ERROR:Fx,Z_DEFAULT_COMPRESSION:rwe,Z_FILTERED:nwe,Z_HUFFMAN_ONLY:k6,Z_RLE:iwe,Z_FIXED:swe,Z_DEFAULT_STRATEGY:owe,Z_UNKNOWN:awe,Z_DEFLATED:V6}=Kh,cwe=9,lwe=15,uwe=8,fwe=29,hwe=256,Zx=hwe+1+fwe,dwe=30,pwe=19,mwe=2*Zx+1,gwe=15,pt=3,zu=258,Ma=zu+pt+1,ywe=32,S0=42,cA=57,Jx=69,eA=73,tA=91,rA=103,Uh=113,j2=666,Di=1,T0=2,Vh=3,I0=4,wwe=3,Mh=(r,e)=>(r.msg=Fh[e],e),Rq=r=>r*2-(r>4?9:0),Vu=r=>{let e=r.length;for(;--e>=0;)r[e]=0},bwe=r=>{let e,t,n,i=r.w_size;e=r.hash_size,n=e;do t=r.head[--n],r.head[n]=t>=i?t-i:0;while(--e);e=i,n=e;do t=r.prev[--n],r.prev[n]=t>=i?t-i:0;while(--e)},Ewe=(r,e,t)=>(e<<r.hash_shift^t)&r.hash_mask,$u=Ewe,ys=r=>{let e=r.state,t=e.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(r.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),r.next_out),r.next_out+=t,e.pending_out+=t,r.total_out+=t,r.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},ws=(r,e)=>{X4e(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,e),r.block_start=r.strstart,ys(r.strm)},Ht=(r,e)=>{r.pending_buf[r.pending++]=e},G2=(r,e)=>{r.pending_buf[r.pending++]=e>>>8&255,r.pending_buf[r.pending++]=e&255},nA=(r,e,t,n)=>{let i=r.avail_in;return i>n&&(i=n),i===0?0:(r.avail_in-=i,e.set(r.input.subarray(r.next_in,r.next_in+i),t),r.state.wrap===1?r.adler=rg(r.adler,e,i,t):r.state.wrap===2&&(r.adler=Vn(r.adler,e,i,t)),r.next_in+=i,r.total_in+=i,i)},E$=(r,e)=>{let t=r.max_chain_length,n=r.strstart,i,s,o=r.prev_length,a=r.nice_match,c=r.strstart>r.w_size-Ma?r.strstart-(r.w_size-Ma):0,u=r.window,f=r.w_mask,h=r.prev,p=r.strstart+zu,d=u[n+o-1],m=u[n+o];r.prev_length>=r.good_match&&(t>>=2),a>r.lookahead&&(a=r.lookahead);do if(i=e,!(u[i+o]!==m||u[i+o-1]!==d||u[i]!==u[n]||u[++i]!==u[n+1])){n+=2,i++;do;while(u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&n<p);if(s=zu-(p-n),n=p-zu,s>o){if(r.match_start=e,o=s,s>=a)break;d=u[n+o-1],m=u[n+o]}}while((e=h[e&f])>c&&--t!==0);return o<=r.lookahead?o:r.lookahead},x0=r=>{let e=r.w_size,t,n,i;do{if(n=r.window_size-r.lookahead-r.strstart,r.strstart>=e+(e-Ma)&&(r.window.set(r.window.subarray(e,e+e-n),0),r.match_start-=e,r.strstart-=e,r.block_start-=e,r.insert>r.strstart&&(r.insert=r.strstart),bwe(r),n+=e),r.strm.avail_in===0)break;if(t=nA(r.strm,r.window,r.strstart+r.lookahead,n),r.lookahead+=t,r.lookahead+r.insert>=pt)for(i=r.strstart-r.insert,r.ins_h=r.window[i],r.ins_h=$u(r,r.ins_h,r.window[i+1]);r.insert&&(r.ins_h=$u(r,r.ins_h,r.window[i+pt-1]),r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++,r.insert--,!(r.lookahead+r.insert<pt)););}while(r.lookahead<Ma&&r.strm.avail_in!==0)},_$=(r,e)=>{let t=r.pending_buf_size-5>r.w_size?r.w_size:r.pending_buf_size-5,n,i,s,o=0,a=r.strm.avail_in;do{if(n=65535,s=r.bi_valid+42>>3,r.strm.avail_out<s||(s=r.strm.avail_out-s,i=r.strstart-r.block_start,n>i+r.strm.avail_in&&(n=i+r.strm.avail_in),n>s&&(n=s),n<t&&(n===0&&e!==Js||e===qu||n!==i+r.strm.avail_in)))break;o=e===Js&&n===i+r.strm.avail_in?1:0,Xx(r,0,0,o),r.pending_buf[r.pending-4]=n,r.pending_buf[r.pending-3]=n>>8,r.pending_buf[r.pending-2]=~n,r.pending_buf[r.pending-1]=~n>>8,ys(r.strm),i&&(i>n&&(i=n),r.strm.output.set(r.window.subarray(r.block_start,r.block_start+i),r.strm.next_out),r.strm.next_out+=i,r.strm.avail_out-=i,r.strm.total_out+=i,r.block_start+=i,n-=i),n&&(nA(r.strm,r.strm.output,r.strm.next_out,n),r.strm.next_out+=n,r.strm.avail_out-=n,r.strm.total_out+=n)}while(o===0);return a-=r.strm.avail_in,a&&(a>=r.w_size?(r.matches=2,r.window.set(r.strm.input.subarray(r.strm.next_in-r.w_size,r.strm.next_in),0),r.strstart=r.w_size,r.insert=r.strstart):(r.window_size-r.strstart<=a&&(r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,r.insert>r.strstart&&(r.insert=r.strstart)),r.window.set(r.strm.input.subarray(r.strm.next_in-a,r.strm.next_in),r.strstart),r.strstart+=a,r.insert+=a>r.w_size-r.insert?r.w_size-r.insert:a),r.block_start=r.strstart),r.high_water<r.strstart&&(r.high_water=r.strstart),o?I0:e!==qu&&e!==Js&&r.strm.avail_in===0&&r.strstart===r.block_start?T0:(s=r.window_size-r.strstart,r.strm.avail_in>s&&r.block_start>=r.w_size&&(r.block_start-=r.w_size,r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,s+=r.w_size,r.insert>r.strstart&&(r.insert=r.strstart)),s>r.strm.avail_in&&(s=r.strm.avail_in),s&&(nA(r.strm,r.window,r.strstart,s),r.strstart+=s,r.insert+=s>r.w_size-r.insert?r.w_size-r.insert:s),r.high_water<r.strstart&&(r.high_water=r.strstart),s=r.bi_valid+42>>3,s=r.pending_buf_size-s>65535?65535:r.pending_buf_size-s,t=s>r.w_size?r.w_size:s,i=r.strstart-r.block_start,(i>=t||(i||e===Js)&&e!==qu&&r.strm.avail_in===0&&i<=s)&&(n=i>s?s:i,o=e===Js&&r.strm.avail_in===0&&n===i?1:0,Xx(r,r.block_start,n,o),r.block_start+=n,ys(r.strm)),o?Vh:Di)},Vx=(r,e)=>{let t,n;for(;;){if(r.lookahead<Ma){if(x0(r),r.lookahead<Ma&&e===qu)return Di;if(r.lookahead===0)break}if(t=0,r.lookahead>=pt&&(r.ins_h=$u(r,r.ins_h,r.window[r.strstart+pt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-Ma&&(r.match_length=E$(r,t)),r.match_length>=pt)if(n=Ku(r,r.strstart-r.match_start,r.match_length-pt),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=pt){r.match_length--;do r.strstart++,r.ins_h=$u(r,r.ins_h,r.window[r.strstart+pt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=$u(r,r.ins_h,r.window[r.strstart+1]);else n=Ku(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(ws(r,!1),r.strm.avail_out===0))return Di}return r.insert=r.strstart<pt-1?r.strstart:pt-1,e===Js?(ws(r,!0),r.strm.avail_out===0?Vh:I0):r.sym_next&&(ws(r,!1),r.strm.avail_out===0)?Di:T0},E0=(r,e)=>{let t,n,i;for(;;){if(r.lookahead<Ma){if(x0(r),r.lookahead<Ma&&e===qu)return Di;if(r.lookahead===0)break}if(t=0,r.lookahead>=pt&&(r.ins_h=$u(r,r.ins_h,r.window[r.strstart+pt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=pt-1,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-Ma&&(r.match_length=E$(r,t),r.match_length<=5&&(r.strategy===nwe||r.match_length===pt&&r.strstart-r.match_start>4096)&&(r.match_length=pt-1)),r.prev_length>=pt&&r.match_length<=r.prev_length){i=r.strstart+r.lookahead-pt,n=Ku(r,r.strstart-1-r.prev_match,r.prev_length-pt),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=i&&(r.ins_h=$u(r,r.ins_h,r.window[r.strstart+pt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=pt-1,r.strstart++,n&&(ws(r,!1),r.strm.avail_out===0))return Di}else if(r.match_available){if(n=Ku(r,0,r.window[r.strstart-1]),n&&ws(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return Di}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=Ku(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<pt-1?r.strstart:pt-1,e===Js?(ws(r,!0),r.strm.avail_out===0?Vh:I0):r.sym_next&&(ws(r,!1),r.strm.avail_out===0)?Di:T0},_we=(r,e)=>{let t,n,i,s,o=r.window;for(;;){if(r.lookahead<=zu){if(x0(r),r.lookahead<=zu&&e===qu)return Di;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=pt&&r.strstart>0&&(i=r.strstart-1,n=o[i],n===o[++i]&&n===o[++i]&&n===o[++i])){s=r.strstart+zu;do;while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&i<s);r.match_length=zu-(s-i),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=pt?(t=Ku(r,1,r.match_length-pt),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(t=Ku(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),t&&(ws(r,!1),r.strm.avail_out===0))return Di}return r.insert=0,e===Js?(ws(r,!0),r.strm.avail_out===0?Vh:I0):r.sym_next&&(ws(r,!1),r.strm.avail_out===0)?Di:T0},vwe=(r,e)=>{let t;for(;;){if(r.lookahead===0&&(x0(r),r.lookahead===0)){if(e===qu)return Di;break}if(r.match_length=0,t=Ku(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,t&&(ws(r,!1),r.strm.avail_out===0))return Di}return r.insert=0,e===Js?(ws(r,!0),r.strm.avail_out===0?Vh:I0):r.sym_next&&(ws(r,!1),r.strm.avail_out===0)?Di:T0};function La(r,e,t,n,i){this.good_length=r,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=i}var W2=[new La(0,0,0,0,_$),new La(4,4,8,4,Vx),new La(4,5,16,8,Vx),new La(4,6,32,32,Vx),new La(4,4,16,16,E0),new La(8,16,32,32,E0),new La(8,16,128,128,E0),new La(8,32,128,256,E0),new La(32,128,258,1024,E0),new La(32,258,258,4096,E0)],Swe=r=>{r.window_size=2*r.w_size,Vu(r.head),r.max_lazy_match=W2[r.level].max_lazy,r.good_match=W2[r.level].good_length,r.nice_match=W2[r.level].nice_length,r.max_chain_length=W2[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=pt-1,r.match_available=0,r.ins_h=0};function xwe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=V6,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(mwe*2),this.dyn_dtree=new Uint16Array((2*dwe+1)*2),this.bl_tree=new Uint16Array((2*pwe+1)*2),Vu(this.dyn_ltree),Vu(this.dyn_dtree),Vu(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(gwe+1),this.heap=new Uint16Array(2*Zx+1),Vu(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Zx+1),Vu(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var ag=r=>{if(!r)return 1;let e=r.state;return!e||e.strm!==r||e.status!==S0&&e.status!==cA&&e.status!==Jx&&e.status!==eA&&e.status!==tA&&e.status!==rA&&e.status!==Uh&&e.status!==j2?1:0},v$=r=>{if(ag(r))return Mh(r,Ua);r.total_in=r.total_out=0,r.data_type=awe;let e=r.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?cA:e.wrap?S0:Uh,r.adler=e.wrap===2?0:1,e.last_flush=-2,Q4e(e),ti},S$=r=>{let e=v$(r);return e===ti&&Swe(r.state),e},Awe=(r,e)=>ag(r)||r.state.wrap!==2?Ua:(r.state.gzhead=e,ti),x$=(r,e,t,n,i,s)=>{if(!r)return Ua;let o=1;if(e===rwe&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),i<1||i>cwe||t!==V6||n<8||n>15||e<0||e>9||s<0||s>swe||n===8&&o!==1)return Mh(r,Ua);n===8&&(n=9);let a=new xwe;return r.state=a,a.strm=r,a.status=S0,a.wrap=o,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+pt-1)/pt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=s,a.method=t,S$(r)},Twe=(r,e)=>x$(r,e,V6,lwe,uwe,owe),Iwe=(r,e)=>{if(ag(r)||e>Tq||e<0)return r?Mh(r,Ua):Ua;let t=r.state;if(!r.output||r.avail_in!==0&&!r.input||t.status===j2&&e!==Js)return Mh(r,r.avail_out===0?Fx:Ua);let n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(ys(r),r.avail_out===0)return t.last_flush=-1,ti}else if(r.avail_in===0&&Rq(e)<=Rq(n)&&e!==Js)return Mh(r,Fx);if(t.status===j2&&r.avail_in!==0)return Mh(r,Fx);if(t.status===S0&&t.wrap===0&&(t.status=Uh),t.status===S0){let i=V6+(t.w_bits-8<<4)<<8,s=-1;if(t.strategy>=k6||t.level<2?s=0:t.level<6?s=1:t.level===6?s=2:s=3,i|=s<<6,t.strstart!==0&&(i|=ywe),i+=31-i%31,G2(t,i),t.strstart!==0&&(G2(t,r.adler>>>16),G2(t,r.adler&65535)),r.adler=1,t.status=Uh,ys(r),t.pending!==0)return t.last_flush=-1,ti}if(t.status===cA){if(r.adler=0,Ht(t,31),Ht(t,139),Ht(t,8),t.gzhead)Ht(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),Ht(t,t.gzhead.time&255),Ht(t,t.gzhead.time>>8&255),Ht(t,t.gzhead.time>>16&255),Ht(t,t.gzhead.time>>24&255),Ht(t,t.level===9?2:t.strategy>=k6||t.level<2?4:0),Ht(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(Ht(t,t.gzhead.extra.length&255),Ht(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(r.adler=Vn(r.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=Jx;else if(Ht(t,0),Ht(t,0),Ht(t,0),Ht(t,0),Ht(t,0),Ht(t,t.level===9?2:t.strategy>=k6||t.level<2?4:0),Ht(t,wwe),t.status=Uh,ys(r),t.pending!==0)return t.last_flush=-1,ti}if(t.status===Jx){if(t.gzhead.extra){let i=t.pending,s=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+s>t.pending_buf_size;){let a=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>i&&(r.adler=Vn(r.adler,t.pending_buf,t.pending-i,i)),t.gzindex+=a,ys(r),t.pending!==0)return t.last_flush=-1,ti;i=0,s-=a}let o=new Uint8Array(t.gzhead.extra);t.pending_buf.set(o.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending+=s,t.gzhead.hcrc&&t.pending>i&&(r.adler=Vn(r.adler,t.pending_buf,t.pending-i,i)),t.gzindex=0}t.status=eA}if(t.status===eA){if(t.gzhead.name){let i=t.pending,s;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>i&&(r.adler=Vn(r.adler,t.pending_buf,t.pending-i,i)),ys(r),t.pending!==0)return t.last_flush=-1,ti;i=0}t.gzindex<t.gzhead.name.length?s=t.gzhead.name.charCodeAt(t.gzindex++)&255:s=0,Ht(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>i&&(r.adler=Vn(r.adler,t.pending_buf,t.pending-i,i)),t.gzindex=0}t.status=tA}if(t.status===tA){if(t.gzhead.comment){let i=t.pending,s;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>i&&(r.adler=Vn(r.adler,t.pending_buf,t.pending-i,i)),ys(r),t.pending!==0)return t.last_flush=-1,ti;i=0}t.gzindex<t.gzhead.comment.length?s=t.gzhead.comment.charCodeAt(t.gzindex++)&255:s=0,Ht(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>i&&(r.adler=Vn(r.adler,t.pending_buf,t.pending-i,i))}t.status=rA}if(t.status===rA){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(ys(r),t.pending!==0))return t.last_flush=-1,ti;Ht(t,r.adler&255),Ht(t,r.adler>>8&255),r.adler=0}if(t.status=Uh,ys(r),t.pending!==0)return t.last_flush=-1,ti}if(r.avail_in!==0||t.lookahead!==0||e!==qu&&t.status!==j2){let i=t.level===0?_$(t,e):t.strategy===k6?vwe(t,e):t.strategy===iwe?_we(t,e):W2[t.level].func(t,e);if((i===Vh||i===I0)&&(t.status=j2),i===Di||i===Vh)return r.avail_out===0&&(t.last_flush=-1),ti;if(i===T0&&(e===J4e?Z4e(t):e!==Tq&&(Xx(t,0,0,!1),e===ewe&&(Vu(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),ys(r),r.avail_out===0))return t.last_flush=-1,ti}return e!==Js?ti:t.wrap<=0?Iq:(t.wrap===2?(Ht(t,r.adler&255),Ht(t,r.adler>>8&255),Ht(t,r.adler>>16&255),Ht(t,r.adler>>24&255),Ht(t,r.total_in&255),Ht(t,r.total_in>>8&255),Ht(t,r.total_in>>16&255),Ht(t,r.total_in>>24&255)):(G2(t,r.adler>>>16),G2(t,r.adler&65535)),ys(r),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?ti:Iq)},Rwe=r=>{if(ag(r))return Ua;let e=r.state.status;return r.state=null,e===Uh?Mh(r,twe):ti},Cwe=(r,e)=>{let t=e.length;if(ag(r))return Ua;let n=r.state,i=n.wrap;if(i===2||i===1&&n.status!==S0||n.lookahead)return Ua;if(i===1&&(r.adler=rg(r.adler,e,t,0)),n.wrap=0,t>=n.w_size){i===0&&(Vu(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(e.subarray(t-n.w_size,t),0),e=c,t=n.w_size}let s=r.avail_in,o=r.next_in,a=r.input;for(r.avail_in=t,r.next_in=0,r.input=e,x0(n);n.lookahead>=pt;){let c=n.strstart,u=n.lookahead-(pt-1);do n.ins_h=$u(n,n.ins_h,n.window[c+pt-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--u);n.strstart=c,n.lookahead=pt-1,x0(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=pt-1,n.match_available=0,r.next_in=o,r.input=a,r.avail_in=s,n.wrap=i,ti},Pwe=Twe,kwe=x$,Owe=S$,Nwe=v$,Dwe=Awe,Lwe=Iwe,Bwe=Rwe,Uwe=Cwe,Mwe="pako deflate (from Nodeca project)",Q2={deflateInit:Pwe,deflateInit2:kwe,deflateReset:Owe,deflateResetKeep:Nwe,deflateSetHeader:Dwe,deflate:Lwe,deflateEnd:Bwe,deflateSetDictionary:Uwe,deflateInfo:Mwe},Fwe=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),Vwe=function(r){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let n in t)Fwe(t,n)&&(r[n]=t[n])}}return r},zwe=r=>{let e=0;for(let n=0,i=r.length;n<i;n++)e+=r[n].length;let t=new Uint8Array(e);for(let n=0,i=0,s=r.length;n<s;n++){let o=r[n];t.set(o,i),i+=o.length}return t},z6={assign:Vwe,flattenChunks:zwe},A$=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{A$=!1}var ng=new Uint8Array(256);for(let r=0;r<256;r++)ng[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;ng[254]=ng[254]=1;var Kwe=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let e,t,n,i,s,o=r.length,a=0;for(i=0;i<o;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<o&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<o&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|t&63):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|t&63):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|t&63);return e},qwe=(r,e)=>{if(e<65534&&r.subarray&&A$)return String.fromCharCode.apply(null,r.length===e?r:r.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(r[n]);return t},$we=(r,e)=>{let t=e||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,e));let n,i,s=new Array(t*2);for(i=0,n=0;n<t;){let o=r[n++];if(o<128){s[i++]=o;continue}let a=ng[o];if(a>4){s[i++]=65533,n+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&n<t;)o=o<<6|r[n++]&63,a--;if(a>1){s[i++]=65533;continue}o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|o&1023)}return qwe(s,i)},Hwe=(r,e)=>{e=e||r.length,e>r.length&&(e=r.length);let t=e-1;for(;t>=0&&(r[t]&192)===128;)t--;return t<0||t===0?e:t+ng[r[t]]>e?t:e},ig={string2buf:Kwe,buf2string:$we,utf8border:Hwe};function Gwe(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var T$=Gwe,I$=Object.prototype.toString,{Z_NO_FLUSH:jwe,Z_SYNC_FLUSH:Wwe,Z_FULL_FLUSH:Ywe,Z_FINISH:Qwe,Z_OK:M6,Z_STREAM_END:Xwe,Z_DEFAULT_COMPRESSION:Zwe,Z_DEFAULT_STRATEGY:Jwe,Z_DEFLATED:e6e}=Kh;function cg(r){this.options=z6.assign({level:Zwe,method:e6e,chunkSize:16384,windowBits:15,memLevel:8,strategy:Jwe},r||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new T$,this.strm.avail_out=0;let t=Q2.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==M6)throw new Error(Fh[t]);if(e.header&&Q2.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=ig.string2buf(e.dictionary):I$.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=Q2.deflateSetDictionary(this.strm,n),t!==M6)throw new Error(Fh[t]);this._dict_set=!0}}cg.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?Qwe:jwe,typeof r=="string"?t.input=ig.string2buf(r):I$.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(s===Wwe||s===Ywe)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(i=Q2.deflate(t,s),i===Xwe)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),i=Q2.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===M6;if(t.avail_out===0){this.onData(t.output);continue}if(s>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};cg.prototype.onData=function(r){this.chunks.push(r)};cg.prototype.onEnd=function(r){r===M6&&(this.result=z6.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function lA(r,e){let t=new cg(e);if(t.push(r,!0),t.err)throw t.msg||Fh[t.err];return t.result}function t6e(r,e){return e=e||{},e.raw=!0,lA(r,e)}function r6e(r,e){return e=e||{},e.gzip=!0,lA(r,e)}var n6e=cg,i6e=lA,s6e=t6e,o6e=r6e,a6e=Kh,c6e={Deflate:n6e,deflate:i6e,deflateRaw:s6e,gzip:o6e,constants:a6e},O6=16209,l6e=16191,u6e=function(e,t){let n,i,s,o,a,c,u,f,h,p,d,m,g,y,w,b,_,v,I,x,A,R,O,V,$=e.state;n=e.next_in,O=e.input,i=n+(e.avail_in-5),s=e.next_out,V=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),c=$.dmax,u=$.wsize,f=$.whave,h=$.wnext,p=$.window,d=$.hold,m=$.bits,g=$.lencode,y=$.distcode,w=(1<<$.lenbits)-1,b=(1<<$.distbits)-1;e:do{m<15&&(d+=O[n++]<<m,m+=8,d+=O[n++]<<m,m+=8),_=g[d&w];t:for(;;){if(v=_>>>24,d>>>=v,m-=v,v=_>>>16&255,v===0)V[s++]=_&65535;else if(v&16){I=_&65535,v&=15,v&&(m<v&&(d+=O[n++]<<m,m+=8),I+=d&(1<<v)-1,d>>>=v,m-=v),m<15&&(d+=O[n++]<<m,m+=8,d+=O[n++]<<m,m+=8),_=y[d&b];r:for(;;){if(v=_>>>24,d>>>=v,m-=v,v=_>>>16&255,v&16){if(x=_&65535,v&=15,m<v&&(d+=O[n++]<<m,m+=8,m<v&&(d+=O[n++]<<m,m+=8)),x+=d&(1<<v)-1,x>c){e.msg="invalid distance too far back",$.mode=O6;break e}if(d>>>=v,m-=v,v=s-o,x>v){if(v=x-v,v>f&&$.sane){e.msg="invalid distance too far back",$.mode=O6;break e}if(A=0,R=p,h===0){if(A+=u-v,v<I){I-=v;do V[s++]=p[A++];while(--v);A=s-x,R=V}}else if(h<v){if(A+=u+h-v,v-=h,v<I){I-=v;do V[s++]=p[A++];while(--v);if(A=0,h<I){v=h,I-=v;do V[s++]=p[A++];while(--v);A=s-x,R=V}}}else if(A+=h-v,v<I){I-=v;do V[s++]=p[A++];while(--v);A=s-x,R=V}for(;I>2;)V[s++]=R[A++],V[s++]=R[A++],V[s++]=R[A++],I-=3;I&&(V[s++]=R[A++],I>1&&(V[s++]=R[A++]))}else{A=s-x;do V[s++]=V[A++],V[s++]=V[A++],V[s++]=V[A++],I-=3;while(I>2);I&&(V[s++]=V[A++],I>1&&(V[s++]=V[A++]))}}else if(v&64){e.msg="invalid distance code",$.mode=O6;break e}else{_=y[(_&65535)+(d&(1<<v)-1)];continue r}break}}else if(v&64)if(v&32){$.mode=l6e;break e}else{e.msg="invalid literal/length code",$.mode=O6;break e}else{_=g[(_&65535)+(d&(1<<v)-1)];continue t}break}}while(n<i&&s<a);I=m>>3,n-=I,m-=I<<3,d&=(1<<m)-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?5+(i-n):5-(n-i),e.avail_out=s<a?257+(a-s):257-(s-a),$.hold=d,$.bits=m},_0=15,Cq=852,Pq=592,kq=0,zx=1,Oq=2,f6e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),h6e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),d6e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),p6e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),m6e=(r,e,t,n,i,s,o,a)=>{let c=a.bits,u=0,f=0,h=0,p=0,d=0,m=0,g=0,y=0,w=0,b=0,_,v,I,x,A,R=null,O,V=new Uint16Array(_0+1),$=new Uint16Array(_0+1),Y=null,Q,pe,re;for(u=0;u<=_0;u++)V[u]=0;for(f=0;f<n;f++)V[e[t+f]]++;for(d=c,p=_0;p>=1&&V[p]===0;p--);if(d>p&&(d=p),p===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,a.bits=1,0;for(h=1;h<p&&V[h]===0;h++);for(d<h&&(d=h),y=1,u=1;u<=_0;u++)if(y<<=1,y-=V[u],y<0)return-1;if(y>0&&(r===kq||p!==1))return-1;for($[1]=0,u=1;u<_0;u++)$[u+1]=$[u]+V[u];for(f=0;f<n;f++)e[t+f]!==0&&(o[$[e[t+f]]++]=f);if(r===kq?(R=Y=o,O=20):r===zx?(R=f6e,Y=h6e,O=257):(R=d6e,Y=p6e,O=0),b=0,f=0,u=h,A=s,m=d,g=0,I=-1,w=1<<d,x=w-1,r===zx&&w>Cq||r===Oq&&w>Pq)return 1;for(;;){Q=u-g,o[f]+1<O?(pe=0,re=o[f]):o[f]>=O?(pe=Y[o[f]-O],re=R[o[f]-O]):(pe=32+64,re=0),_=1<<u-g,v=1<<m,h=v;do v-=_,i[A+(b>>g)+v]=Q<<24|pe<<16|re|0;while(v!==0);for(_=1<<u-1;b&_;)_>>=1;if(_!==0?(b&=_-1,b+=_):b=0,f++,--V[u]===0){if(u===p)break;u=e[t+o[f]]}if(u>d&&(b&x)!==I){for(g===0&&(g=d),A+=h,m=u-g,y=1<<m;m+g<p&&(y-=V[m+g],!(y<=0));)m++,y<<=1;if(w+=1<<m,r===zx&&w>Cq||r===Oq&&w>Pq)return 1;I=b&x,i[I]=d<<24|m<<16|A-s|0}}return b!==0&&(i[A+b]=u-g<<24|64<<16|0),a.bits=d,0},X2=m6e,g6e=0,R$=1,C$=2,{Z_FINISH:Nq,Z_BLOCK:y6e,Z_TREES:N6,Z_OK:zh,Z_STREAM_END:w6e,Z_NEED_DICT:b6e,Z_STREAM_ERROR:eo,Z_DATA_ERROR:P$,Z_MEM_ERROR:k$,Z_BUF_ERROR:E6e,Z_DEFLATED:Dq}=Kh,K6=16180,Lq=16181,Bq=16182,Uq=16183,Mq=16184,Fq=16185,Vq=16186,zq=16187,Kq=16188,qq=16189,F6=16190,Jc=16191,Kx=16192,$q=16193,qx=16194,Hq=16195,Gq=16196,jq=16197,Wq=16198,D6=16199,L6=16200,Yq=16201,Qq=16202,Xq=16203,Zq=16204,Jq=16205,$x=16206,e$=16207,t$=16208,Cr=16209,O$=16210,N$=16211,_6e=852,v6e=592,S6e=15,x6e=S6e,r$=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function A6e(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var qh=r=>{if(!r)return 1;let e=r.state;return!e||e.strm!==r||e.mode<K6||e.mode>N$?1:0},D$=r=>{if(qh(r))return eo;let e=r.state;return r.total_in=r.total_out=e.total=0,r.msg="",e.wrap&&(r.adler=e.wrap&1),e.mode=K6,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(_6e),e.distcode=e.distdyn=new Int32Array(v6e),e.sane=1,e.back=-1,zh},L$=r=>{if(qh(r))return eo;let e=r.state;return e.wsize=0,e.whave=0,e.wnext=0,D$(r)},B$=(r,e)=>{let t;if(qh(r))return eo;let n=r.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?eo:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,L$(r))},U$=(r,e)=>{if(!r)return eo;let t=new A6e;r.state=t,t.strm=r,t.window=null,t.mode=K6;let n=B$(r,e);return n!==zh&&(r.state=null),n},T6e=r=>U$(r,x6e),n$=!0,Hx,Gx,I6e=r=>{if(n$){Hx=new Int32Array(512),Gx=new Int32Array(32);let e=0;for(;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for(X2(R$,r.lens,0,288,Hx,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;X2(C$,r.lens,0,32,Gx,0,r.work,{bits:5}),n$=!1}r.lencode=Hx,r.lenbits=9,r.distcode=Gx,r.distbits=5},M$=(r,e,t,n)=>{let i,s=r.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(e.subarray(t-s.wsize,t),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>n&&(i=n),s.window.set(e.subarray(t-n,t-n+i),s.wnext),n-=i,n?(s.window.set(e.subarray(t-n,t),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},R6e=(r,e)=>{let t,n,i,s,o,a,c,u,f,h,p,d,m,g,y=0,w,b,_,v,I,x,A,R,O=new Uint8Array(4),V,$,Y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(qh(r)||!r.output||!r.input&&r.avail_in!==0)return eo;t=r.state,t.mode===Jc&&(t.mode=Kx),o=r.next_out,i=r.output,c=r.avail_out,s=r.next_in,n=r.input,a=r.avail_in,u=t.hold,f=t.bits,h=a,p=c,R=zh;e:for(;;)switch(t.mode){case K6:if(t.wrap===0){t.mode=Kx;break}for(;f<16;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}if(t.wrap&2&&u===35615){t.wbits===0&&(t.wbits=15),t.check=0,O[0]=u&255,O[1]=u>>>8&255,t.check=Vn(t.check,O,2,0),u=0,f=0,t.mode=Lq;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((u&255)<<8)+(u>>8))%31){r.msg="incorrect header check",t.mode=Cr;break}if((u&15)!==Dq){r.msg="unknown compression method",t.mode=Cr;break}if(u>>>=4,f-=4,A=(u&15)+8,t.wbits===0&&(t.wbits=A),A>15||A>t.wbits){r.msg="invalid window size",t.mode=Cr;break}t.dmax=1<<t.wbits,t.flags=0,r.adler=t.check=1,t.mode=u&512?qq:Jc,u=0,f=0;break;case Lq:for(;f<16;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}if(t.flags=u,(t.flags&255)!==Dq){r.msg="unknown compression method",t.mode=Cr;break}if(t.flags&57344){r.msg="unknown header flags set",t.mode=Cr;break}t.head&&(t.head.text=u>>8&1),t.flags&512&&t.wrap&4&&(O[0]=u&255,O[1]=u>>>8&255,t.check=Vn(t.check,O,2,0)),u=0,f=0,t.mode=Bq;case Bq:for(;f<32;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}t.head&&(t.head.time=u),t.flags&512&&t.wrap&4&&(O[0]=u&255,O[1]=u>>>8&255,O[2]=u>>>16&255,O[3]=u>>>24&255,t.check=Vn(t.check,O,4,0)),u=0,f=0,t.mode=Uq;case Uq:for(;f<16;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}t.head&&(t.head.xflags=u&255,t.head.os=u>>8),t.flags&512&&t.wrap&4&&(O[0]=u&255,O[1]=u>>>8&255,t.check=Vn(t.check,O,2,0)),u=0,f=0,t.mode=Mq;case Mq:if(t.flags&1024){for(;f<16;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}t.length=u,t.head&&(t.head.extra_len=u),t.flags&512&&t.wrap&4&&(O[0]=u&255,O[1]=u>>>8&255,t.check=Vn(t.check,O,2,0)),u=0,f=0}else t.head&&(t.head.extra=null);t.mode=Fq;case Fq:if(t.flags&1024&&(d=t.length,d>a&&(d=a),d&&(t.head&&(A=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(s,s+d),A)),t.flags&512&&t.wrap&4&&(t.check=Vn(t.check,n,d,s)),a-=d,s+=d,t.length-=d),t.length))break e;t.length=0,t.mode=Vq;case Vq:if(t.flags&2048){if(a===0)break e;d=0;do A=n[s+d++],t.head&&A&&t.length<65536&&(t.head.name+=String.fromCharCode(A));while(A&&d<a);if(t.flags&512&&t.wrap&4&&(t.check=Vn(t.check,n,d,s)),a-=d,s+=d,A)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=zq;case zq:if(t.flags&4096){if(a===0)break e;d=0;do A=n[s+d++],t.head&&A&&t.length<65536&&(t.head.comment+=String.fromCharCode(A));while(A&&d<a);if(t.flags&512&&t.wrap&4&&(t.check=Vn(t.check,n,d,s)),a-=d,s+=d,A)break e}else t.head&&(t.head.comment=null);t.mode=Kq;case Kq:if(t.flags&512){for(;f<16;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}if(t.wrap&4&&u!==(t.check&65535)){r.msg="header crc mismatch",t.mode=Cr;break}u=0,f=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=Jc;break;case qq:for(;f<32;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}r.adler=t.check=r$(u),u=0,f=0,t.mode=F6;case F6:if(t.havedict===0)return r.next_out=o,r.avail_out=c,r.next_in=s,r.avail_in=a,t.hold=u,t.bits=f,b6e;r.adler=t.check=1,t.mode=Jc;case Jc:if(e===y6e||e===N6)break e;case Kx:if(t.last){u>>>=f&7,f-=f&7,t.mode=$x;break}for(;f<3;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}switch(t.last=u&1,u>>>=1,f-=1,u&3){case 0:t.mode=$q;break;case 1:if(I6e(t),t.mode=D6,e===N6){u>>>=2,f-=2;break e}break;case 2:t.mode=Gq;break;case 3:r.msg="invalid block type",t.mode=Cr}u>>>=2,f-=2;break;case $q:for(u>>>=f&7,f-=f&7;f<32;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}if((u&65535)!==(u>>>16^65535)){r.msg="invalid stored block lengths",t.mode=Cr;break}if(t.length=u&65535,u=0,f=0,t.mode=qx,e===N6)break e;case qx:t.mode=Hq;case Hq:if(d=t.length,d){if(d>a&&(d=a),d>c&&(d=c),d===0)break e;i.set(n.subarray(s,s+d),o),a-=d,s+=d,c-=d,o+=d,t.length-=d;break}t.mode=Jc;break;case Gq:for(;f<14;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}if(t.nlen=(u&31)+257,u>>>=5,f-=5,t.ndist=(u&31)+1,u>>>=5,f-=5,t.ncode=(u&15)+4,u>>>=4,f-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=Cr;break}t.have=0,t.mode=jq;case jq:for(;t.have<t.ncode;){for(;f<3;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}t.lens[Y[t.have++]]=u&7,u>>>=3,f-=3}for(;t.have<19;)t.lens[Y[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,V={bits:t.lenbits},R=X2(g6e,t.lens,0,19,t.lencode,0,t.work,V),t.lenbits=V.bits,R){r.msg="invalid code lengths set",t.mode=Cr;break}t.have=0,t.mode=Wq;case Wq:for(;t.have<t.nlen+t.ndist;){for(;y=t.lencode[u&(1<<t.lenbits)-1],w=y>>>24,b=y>>>16&255,_=y&65535,!(w<=f);){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}if(_<16)u>>>=w,f-=w,t.lens[t.have++]=_;else{if(_===16){for($=w+2;f<$;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}if(u>>>=w,f-=w,t.have===0){r.msg="invalid bit length repeat",t.mode=Cr;break}A=t.lens[t.have-1],d=3+(u&3),u>>>=2,f-=2}else if(_===17){for($=w+3;f<$;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}u>>>=w,f-=w,A=0,d=3+(u&7),u>>>=3,f-=3}else{for($=w+7;f<$;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}u>>>=w,f-=w,A=0,d=11+(u&127),u>>>=7,f-=7}if(t.have+d>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=Cr;break}for(;d--;)t.lens[t.have++]=A}}if(t.mode===Cr)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=Cr;break}if(t.lenbits=9,V={bits:t.lenbits},R=X2(R$,t.lens,0,t.nlen,t.lencode,0,t.work,V),t.lenbits=V.bits,R){r.msg="invalid literal/lengths set",t.mode=Cr;break}if(t.distbits=6,t.distcode=t.distdyn,V={bits:t.distbits},R=X2(C$,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,V),t.distbits=V.bits,R){r.msg="invalid distances set",t.mode=Cr;break}if(t.mode=D6,e===N6)break e;case D6:t.mode=L6;case L6:if(a>=6&&c>=258){r.next_out=o,r.avail_out=c,r.next_in=s,r.avail_in=a,t.hold=u,t.bits=f,u6e(r,p),o=r.next_out,i=r.output,c=r.avail_out,s=r.next_in,n=r.input,a=r.avail_in,u=t.hold,f=t.bits,t.mode===Jc&&(t.back=-1);break}for(t.back=0;y=t.lencode[u&(1<<t.lenbits)-1],w=y>>>24,b=y>>>16&255,_=y&65535,!(w<=f);){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}if(b&&!(b&240)){for(v=w,I=b,x=_;y=t.lencode[x+((u&(1<<v+I)-1)>>v)],w=y>>>24,b=y>>>16&255,_=y&65535,!(v+w<=f);){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}u>>>=v,f-=v,t.back+=v}if(u>>>=w,f-=w,t.back+=w,t.length=_,b===0){t.mode=Jq;break}if(b&32){t.back=-1,t.mode=Jc;break}if(b&64){r.msg="invalid literal/length code",t.mode=Cr;break}t.extra=b&15,t.mode=Yq;case Yq:if(t.extra){for($=t.extra;f<$;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}t.length+=u&(1<<t.extra)-1,u>>>=t.extra,f-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=Qq;case Qq:for(;y=t.distcode[u&(1<<t.distbits)-1],w=y>>>24,b=y>>>16&255,_=y&65535,!(w<=f);){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}if(!(b&240)){for(v=w,I=b,x=_;y=t.distcode[x+((u&(1<<v+I)-1)>>v)],w=y>>>24,b=y>>>16&255,_=y&65535,!(v+w<=f);){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}u>>>=v,f-=v,t.back+=v}if(u>>>=w,f-=w,t.back+=w,b&64){r.msg="invalid distance code",t.mode=Cr;break}t.offset=_,t.extra=b&15,t.mode=Xq;case Xq:if(t.extra){for($=t.extra;f<$;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}t.offset+=u&(1<<t.extra)-1,u>>>=t.extra,f-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=Cr;break}t.mode=Zq;case Zq:if(c===0)break e;if(d=p-c,t.offset>d){if(d=t.offset-d,d>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=Cr;break}d>t.wnext?(d-=t.wnext,m=t.wsize-d):m=t.wnext-d,d>t.length&&(d=t.length),g=t.window}else g=i,m=o-t.offset,d=t.length;d>c&&(d=c),c-=d,t.length-=d;do i[o++]=g[m++];while(--d);t.length===0&&(t.mode=L6);break;case Jq:if(c===0)break e;i[o++]=t.length,c--,t.mode=L6;break;case $x:if(t.wrap){for(;f<32;){if(a===0)break e;a--,u|=n[s++]<<f,f+=8}if(p-=c,r.total_out+=p,t.total+=p,t.wrap&4&&p&&(r.adler=t.check=t.flags?Vn(t.check,i,p,o-p):rg(t.check,i,p,o-p)),p=c,t.wrap&4&&(t.flags?u:r$(u))!==t.check){r.msg="incorrect data check",t.mode=Cr;break}u=0,f=0}t.mode=e$;case e$:if(t.wrap&&t.flags){for(;f<32;){if(a===0)break e;a--,u+=n[s++]<<f,f+=8}if(t.wrap&4&&u!==(t.total&4294967295)){r.msg="incorrect length check",t.mode=Cr;break}u=0,f=0}t.mode=t$;case t$:R=w6e;break e;case Cr:R=P$;break e;case O$:return k$;case N$:default:return eo}return r.next_out=o,r.avail_out=c,r.next_in=s,r.avail_in=a,t.hold=u,t.bits=f,(t.wsize||p!==r.avail_out&&t.mode<Cr&&(t.mode<$x||e!==Nq))&&M$(r,r.output,r.next_out,p-r.avail_out),h-=r.avail_in,p-=r.avail_out,r.total_in+=h,r.total_out+=p,t.total+=p,t.wrap&4&&p&&(r.adler=t.check=t.flags?Vn(t.check,i,p,r.next_out-p):rg(t.check,i,p,r.next_out-p)),r.data_type=t.bits+(t.last?64:0)+(t.mode===Jc?128:0)+(t.mode===D6||t.mode===qx?256:0),(h===0&&p===0||e===Nq)&&R===zh&&(R=E6e),R},C6e=r=>{if(qh(r))return eo;let e=r.state;return e.window&&(e.window=null),r.state=null,zh},P6e=(r,e)=>{if(qh(r))return eo;let t=r.state;return t.wrap&2?(t.head=e,e.done=!1,zh):eo},k6e=(r,e)=>{let t=e.length,n,i,s;return qh(r)||(n=r.state,n.wrap!==0&&n.mode!==F6)?eo:n.mode===F6&&(i=1,i=rg(i,e,t,0),i!==n.check)?P$:(s=M$(r,e,t,t),s?(n.mode=O$,k$):(n.havedict=1,zh))},O6e=L$,N6e=B$,D6e=D$,L6e=T6e,B6e=U$,U6e=R6e,M6e=C6e,F6e=P6e,V6e=k6e,z6e="pako inflate (from Nodeca project)",tl={inflateReset:O6e,inflateReset2:N6e,inflateResetKeep:D6e,inflateInit:L6e,inflateInit2:B6e,inflate:U6e,inflateEnd:M6e,inflateGetHeader:F6e,inflateSetDictionary:V6e,inflateInfo:z6e};function K6e(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var q6e=K6e,F$=Object.prototype.toString,{Z_NO_FLUSH:$6e,Z_FINISH:H6e,Z_OK:sg,Z_STREAM_END:jx,Z_NEED_DICT:Wx,Z_STREAM_ERROR:G6e,Z_DATA_ERROR:i$,Z_MEM_ERROR:j6e}=Kh;function lg(r){this.options=z6.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(r&&r.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new T$,this.strm.avail_out=0;let t=tl.inflateInit2(this.strm,e.windowBits);if(t!==sg)throw new Error(Fh[t]);if(this.header=new q6e,tl.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=ig.string2buf(e.dictionary):F$.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=tl.inflateSetDictionary(this.strm,e.dictionary),t!==sg)))throw new Error(Fh[t])}lg.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i=this.options.dictionary,s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?H6e:$6e,F$.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),s=tl.inflate(t,o),s===Wx&&i&&(s=tl.inflateSetDictionary(t,i),s===sg?s=tl.inflate(t,o):s===i$&&(s=Wx));t.avail_in>0&&s===jx&&t.state.wrap>0&&r[t.next_in]!==0;)tl.inflateReset(t),s=tl.inflate(t,o);switch(s){case G6e:case i$:case Wx:case j6e:return this.onEnd(s),this.ended=!0,!1}if(a=t.avail_out,t.next_out&&(t.avail_out===0||s===jx))if(this.options.to==="string"){let c=ig.utf8border(t.output,t.next_out),u=t.next_out-c,f=ig.buf2string(t.output,c);t.next_out=u,t.avail_out=n-u,u&&t.output.set(t.output.subarray(c,c+u),0),this.onData(f)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(s===sg&&a===0)){if(s===jx)return s=tl.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};lg.prototype.onData=function(r){this.chunks.push(r)};lg.prototype.onEnd=function(r){r===sg&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=z6.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function uA(r,e){let t=new lg(e);if(t.push(r),t.err)throw t.msg||Fh[t.err];return t.result}function W6e(r,e){return e=e||{},e.raw=!0,uA(r,e)}var Y6e=lg,Q6e=uA,X6e=W6e,Z6e=uA,J6e=Kh,e5e={Inflate:Y6e,inflate:Q6e,inflateRaw:X6e,ungzip:Z6e,constants:J6e},{Deflate:t5e,deflate:r5e,deflateRaw:n5e,gzip:i5e}=c6e,{Inflate:s5e,inflate:o5e,inflateRaw:a5e,ungzip:c5e}=e5e,l5e=t5e,u5e=r5e,f5e=n5e,h5e=i5e,d5e=s5e,p5e=o5e,m5e=a5e,g5e=c5e,y5e=Kh,fA={Deflate:l5e,deflate:u5e,deflateRaw:f5e,gzip:h5e,Inflate:d5e,inflate:p5e,inflateRaw:m5e,ungzip:g5e,constants:y5e};var V$=6;function z$({repo:r,preload:e}){async function*t(n,i={}){if(i.compressionLevel!=null&&(i.compressionLevel<-1||i.compressionLevel>9))throw(0,R0.default)(new Error("Compression level must be between -1 and 9"),"ERR_INVALID_PARAMS");if(i.preload!==!1){let a;try{a=Fp(n).split("/")}catch(c){throw(0,R0.default)(c,"ERR_INVALID_PATH")}e(T.parse(a[0]))}let s=T.asCID(n)||n,o=await ei(s,r.blocks,i);if(o.type==="file"||o.type==="raw"){let a=[];!i.compress||i.archive===!0?a.push([{header:{name:o.path,mode:o.type==="file"&&o.unixfs.mode,mtime:o.type==="file"&&o.unixfs.mtime?new Date(o.unixfs.mtime.secs*1e3):void 0,size:o.size,type:"file"},body:o.content()}],P6()):a.push(o.content),i.compress&&a.push(async function*(c){let u=await b0(c);yield fA.gzip(u,{level:i.compressionLevel||V$})}),yield*_e(...a);return}if(o.type==="directory"){let a=[I6(s,r.blocks,i),async function*(c){for await(let u of c){let f={header:{name:u.path,size:u.size}};if(u.type==="file")f.header.type="file",f.header.mode=u.unixfs.mode!=null?u.unixfs.mode:void 0,f.header.mtime=u.unixfs.mtime?new Date(u.unixfs.mtime.secs*1e3):void 0,f.body=u.content();else if(u.type==="raw")f.header.type="file",f.body=u.content();else if(u.type==="directory")f.header.type="directory",f.header.mode=u.unixfs.mode!=null?u.unixfs.mode:void 0,f.header.mtime=u.unixfs.mtime?new Date(u.unixfs.mtime.secs*1e3):void 0;else throw(0,R0.default)(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS");yield f}},P6()];if(i.compress){if(!i.archive)throw(0,R0.default)(new Error("file is not regular"),"ERR_INVALID_PATH");i.compress&&a.push(async function*(c){let u=await b0(c);yield fA.gzip(u,{level:i.compressionLevel||V$})})}yield*_e(...a);return}throw(0,R0.default)(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS")}return z(t)}l();var K$=S(W(),1);function q$({repo:r,preload:e}){async function*t(n,i={}){let s=Fp(n),o=s.split("/");i.preload!==!1&&e(T.parse(o[0]));let a=T.asCID(s)||s,c=await ei(a,r.blocks,i);if(c.type==="file"){yield J9(c);return}if(c.type==="directory"){for await(let u of c.content())yield J9(u);return}throw(0,K$.default)(new Error(`Unknown UnixFS type ${c.type}`),"ERR_UNKNOWN_UNIXFS_TYPE")}return z(t)}var q6=class{constructor({preload:e,repo:t,hashers:n,options:i}){let s=XK({preload:e,repo:t,options:i,hashers:n});this.addAll=s,this.add=nK({addAll:s}),this.cat=mq({repo:t,preload:e}),this.get=z$({repo:t,preload:e}),this.ls=q$({repo:t,preload:e})}};l();l();var $h="",$$="",H$="";function G$({repo:r}){async function e(t={}){let n=await r.version.get();return{version:$h,commit:$$,repo:`${n}`,"ipfs-core":$h,"interface-ipfs-core":H$}}return z(e)}l();var $6=S(W(),1);var w5e=k("ipfs:components:id");function j$({peerId:r,network:e}){async function t(n={}){let i=e.try();if(!i){if(n.peerId)throw new kc;if(r.publicKey==null)throw(0,$6.default)(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");return{id:r,publicKey:C(r.publicKey,"base64pad"),addresses:[],agentVersion:`js-ipfs/${$h}`,protocolVersion:"9000",protocols:[]}}let{libp2p:s}=i,o=n.peerId?n.peerId:r,a=await b5e(o,s,n),c=C(a.metadata.get("AgentVersion")||new Uint8Array),u=C(a.metadata.get("ProtocolVersion")||new Uint8Array),f=a.id.toString(),h=a.publicKey?C(a.publicKey,"base64pad"):"";return{id:o,publicKey:h,addresses:(a.addresses||[]).map(p=>{let d=p.toString();return d.endsWith(`/p2p/${f}`)?d:`${d}/p2p/${f}`}).sort().map(p=>se(p)),agentVersion:c,protocolVersion:u,protocols:(a.protocols||[]).sort()}}return z(t)}async function b5e(r,e,t){let n=await e.peerStore.get(r);n||(n=await E5e(r,e,t));let i=r.publicKey?r.publicKey:await e.peerStore.keyBook.get(r);if(i==null)try{i=await e.getPublicKey(r,t)}catch(s){w5e.error("Could not load public key for",r.toString(),s)}return{...n,publicKey:i,metadata:n.metadata||new Map,addresses:n.addresses.map(s=>s.multiaddr)}}async function E5e(r,e,t){if(e.dht==null)throw(0,$6.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");for await(let i of e.dht.findPeer(r,t))if(i.name==="FINAL_PEER")break;let n=await e.peerStore.get(r);if(!n)throw(0,$6.default)(new Error("Could not find peer"),"ERR_NOT_FOUND");return n}l();l();l();var Pr=_5e;function _5e(r,e,t){var n,i;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");if(i=n.pop(),!i)return!1;W$(i);for(var s;s=n.shift();)if(W$(s),typeof r[s]>"u"&&(r[s]={}),r=r[s],!r||typeof r!="object")return!1;return r[i]=t,!0}function W$(r){if(r=="__proto__"||r=="constructor"||r=="prototype")throw new Error("setting of prototype values not supported")}var C0={server:{description:"Recommended for nodes with public IPv4 address (servers, VPSes, etc.), disables host and content discovery and UPnP in local networks.",transform:r=>(Pr(r,"Discovery.MDNS.Enabled",!1),Pr(r,"Discovery.webRTCStar.Enabled",!1),r.Swarm={...r.Swarm||{},DisableNatPortMap:!0},r)},"local-discovery":{description:"Sets default values to fields affected by `server` profile, enables discovery and UPnP in local networks.",transform:r=>(Pr(r,"Discovery.MDNS.Enabled",!0),Pr(r,"Discovery.webRTCStar.Enabled",!0),Pr(r,"Swarm",{...r.Swarm||{},DisableNatPortMap:!1}),r)},test:{description:"Reduces external interference, useful for running ipfs in test environments. Note that with these settings node won't be able to talk to the rest of the network without manual bootstrap.",transform:r=>{let e=Wc();return Pr(r,"Addresses.API",e.Addresses.API?"/ip4/127.0.0.1/tcp/0":""),Pr(r,"Addresses.Gateway",e.Addresses.Gateway?"/ip4/127.0.0.1/tcp/0":""),Pr(r,"Addresses.Swarm",e.Addresses.Swarm.length?["/ip4/127.0.0.1/tcp/0"]:[]),Pr(r,"Addresses.Delegates",[]),Pr(r,"Bootstrap",[]),Pr(r,"Discovery.MDNS.Enabled",!1),Pr(r,"Discovery.webRTCStar.Enabled",!1),Pr(r,"Swarm",{...r.Swarm||{},DisableNatPortMap:!0}),r}},"default-networking":{description:"Restores default network settings. Inverse profile of the `test` profile.",transform:r=>{let e=Wc();return Pr(r,"Addresses.API",e.Addresses.API),Pr(r,"Addresses.Gateway",e.Addresses.Gateway),Pr(r,"Addresses.Swarm",e.Addresses.Swarm),Pr(r,"Addresses.Delegates",e.Addresses.Delegates),Pr(r,"Bootstrap",e.Bootstrap),Pr(r,"Discovery.MDNS.Enabled",e.Discovery.MDNS.Enabled),Pr(r,"Discovery.webRTCStar.Enabled",e.Discovery.webRTCStar.Enabled),Pr(r,"Swarm",{...r.Swarm||{},DisableNatPortMap:!1}),r}},lowpower:{description:"Reduces daemon overhead on the system. May affect node functionality,performance of content discovery and data fetching may be degraded. Recommended for low power systems.",transform:r=>{let e=r.Swarm||{},t=e.ConnMgr||{};return t.LowWater=20,t.HighWater=40,e.ConnMgr=t,r.Swarm=e,r}},"default-power":{description:'Inverse of "lowpower" profile.',transform:r=>{let e=Wc();return r.Swarm=e.Swarm,r}}};var v5e=k("ipfs:core:config");function Y$({repo:r}){return{getAll:z(e),get:z(t),set:z(n),replace:z(i),profiles:{apply:z(s),list:z(S5e)}};async function e(o={}){return r.config.getAll(o)}async function t(o,a){return o?r.config.get(o,a):Promise.reject(new Error("key argument is required"))}async function n(o,a,c){return r.config.set(o,a,c)}async function i(o,a){return r.config.replace(o,a)}async function s(o,a={dryRun:!1}){let{dryRun:c}=a,u=C0[o];if(!u)throw new Error(`No profile with name '${o}' exists`);try{let f=await r.config.getAll(a),h=JSON.parse(JSON.stringify(f));return h=u.transform(h),c||await r.config.replace(h,a),delete f.Identity.PrivKey,delete h.Identity.PrivKey,{original:f,updated:h}}catch(f){throw v5e(f),new Error(`Could not apply profile '${o}' to config: ${f.message}`)}}}async function S5e(r){return Object.keys(C0).map(e=>({name:e,description:C0[e].description}))}l();l();l();function H6({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*x5e(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(let[t,n]of e.entries()){let i=[...r,t],s=T.asCID(n);s?yield[i.join("/"),s]:typeof n=="object"&&(yield*hA(n,i))}else{let t=T.asCID(e);t?yield[r.join("/"),t]:yield*hA(e,r)}}function*hA(r,e){if(r==null||r instanceof Uint8Array)return;let t=T.asCID(r);t&&(yield[e.join("/"),t]);for(let[n,i]of Object.entries(r)){let s=[...e,n];yield*x5e(s,i)}}function*A5e(r,e){if(Array.isArray(e))for(let[t,n]of e.entries()){let i=[...r,t];yield i.join("/"),typeof n=="object"&&!T.asCID(n)&&(yield*dA(n,i))}else yield*dA(e,r)}function*dA(r,e){if(!(r==null||typeof r!="object"))for(let[t,n]of Object.entries(r)){let i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!T.asCID(n)&&(yield*A5e(i,n))}}function T5e(r,e){let t=r;for(let[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);let s=T.asCID(t);if(s)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}var pA=class{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:H6(),bytes:H6(),value:H6(),asBlock:H6()})}links(){return hA(this.value,[])}tree(){return dA(this.value,[])}get(e="/"){return T5e(this.value,e.split("/").filter(Boolean))}};function P0({bytes:r,cid:e,value:t,codec:n}){let i=t!==void 0?t:n&&n.decode(r);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new pA({cid:e,bytes:r,value:i})}l();l();var mA=S(ur(),1);function gA(r){let e=km({version:1,roots:r}),t=mA.default.encode(e.length),n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n}function Q$(r){return{async setRoots(e){let t=gA(e);await r.write(t)},async writeBlock(e){let{cid:t,bytes:n}=e;await r.write(new Uint8Array(mA.default.encode(t.bytes.length+n.length))),await r.write(t.bytes),n.length&&await r.write(n)},async close(){await r.end()}}}l();function G6(){}function X$(){let r=[],e=null,t=G6,n=!1,i=null,s=G6,o=()=>(e||(e=new Promise(u=>{t=()=>{e=null,t=G6,u()}})),e),a={write(u){r.push(u);let f=o();return s(),f},async end(){n=!0;let u=o();s(),await u}},c={async next(){let u=r.shift();return u?(r.length===0&&t(),{done:!1,value:u}):n?(t(),{done:!0,value:void 0}):(i||(i=new Promise(f=>{s=()=>(i=null,s=G6,f(c.next()))})),i)}};return{writer:a,iterator:c}}l();l();var Hu={Null:r=>r===null,Int:r=>Number.isInteger(r),Float:r=>typeof r=="number"&&Number.isFinite(r),String:r=>typeof r=="string",Bool:r=>typeof r=="boolean",Bytes:r=>r instanceof Uint8Array,Link:r=>!Hu.Null(r)&&typeof r=="object"&&r.asCID===r,List:r=>Array.isArray(r),Map:r=>!Hu.Null(r)&&typeof r=="object"&&r.asCID!==r&&!Hu.List(r)&&!Hu.Bytes(r)},k0={Int:Hu.Int,"CarHeader > version":r=>k0.Int(r),"CarHeader > roots (anon) > valueType (anon)":Hu.Link,"CarHeader > roots (anon)":r=>Hu.List(r)&&Array.prototype.every.call(r,k0["CarHeader > roots (anon) > valueType (anon)"]),"CarHeader > roots":r=>k0["CarHeader > roots (anon)"](r),CarHeader:r=>{let e=r&&Object.keys(r);return Hu.Map(r)&&["version"].every(t=>e.includes(t))&&Object.entries(r).every(([t,n])=>k0["CarHeader > "+t]&&k0["CarHeader > "+t](n))}},Z$=k0.CarHeader;l();var Gu=S(ur(),1),j6={SHA2_256:18,LENGTH:32,DAG_PB:112},J$=16+8+8+8;function ug(r,e){if(!r.length)throw new Error("Unexpected end of data");let t=Gu.default.decode(r);return e.seek(Gu.default.decode.bytes),t}function eH(r){let e=new DataView(r.buffer,r.byteOffset,r.byteLength),t=0;return{version:2,characteristics:[e.getBigUint64(t,!0),e.getBigUint64(t+=8,!0)],dataOffset:Number(e.getBigUint64(t+=8,!0)),dataSize:Number(e.getBigUint64(t+=8,!0)),indexOffset:Number(e.getBigUint64(t+=8,!0))}}function tH(r){Gu.default.decode(r);let e=Gu.default.decode.bytes,t=Gu.default.decode(r.subarray(Gu.default.decode.bytes)),n=Gu.default.decode.bytes;return e+n+t}async function W6(r,e){let t=ug(await r.upTo(8),r);if(t===0)throw new Error("Invalid CAR header (zero length)");let n=await r.exactly(t,!0),i=rh(n);if(!Z$(i))throw new Error("Invalid CAR header format");if(i.version!==1&&i.version!==2||e!==void 0&&i.version!==e)throw new Error(`Invalid CAR version: ${i.version}${e!==void 0?` (expected ${e})`:""}`);let s=Array.isArray(i.roots);if(i.version===1&&!s||i.version===2&&s)throw new Error("Invalid CAR header format");if(i.version===1)return i;let o=eH(await r.exactly(J$,!0));r.seek(o.dataOffset-r.pos);let a=await W6(r,1);return Object.assign(a,o)}async function I5e(r){let e=await r.exactly(2,!1);if(e[0]===j6.SHA2_256&&e[1]===j6.LENGTH){let o=await r.exactly(34,!0),a=Ze(o);return T.create(0,j6.DAG_PB,a)}let t=ug(await r.upTo(8),r);if(t!==1)throw new Error(`Unexpected CID version (${t})`);let n=ug(await r.upTo(8),r),i=await r.exactly(tH(await r.upTo(8)),!0),s=Ze(i);return T.create(t,n,s)}async function rH(r){let e=r.pos,t=ug(await r.upTo(8),r);if(t===0)throw new Error("Invalid CAR section (zero length)");t+=r.pos-e;let n=await I5e(r),i=t-Number(r.pos-e);return{cid:n,length:t,blockLength:i}}async function R5e(r){let{cid:e,blockLength:t}=await rH(r);return{bytes:await r.exactly(t,!0),cid:e}}async function C5e(r){let e=r.pos,{cid:t,length:n,blockLength:i}=await rH(r),s={cid:t,length:n,blockLength:i,offset:e,blockOffset:r.pos};return r.seek(s.blockLength),s}function nH(r){let e=(async()=>{let t=await W6(r);if(t.version===2){let n=r.pos-t.dataOffset;r=k5e(r,t.dataSize-n)}return t})();return{header:()=>e,async*blocks(){for(await e;(await r.upTo(8)).length>0;)yield await R5e(r)},async*blocksIndex(){for(await e;(await r.upTo(8)).length>0;)yield await C5e(r)}}}function Y6(r){let e=0;return{async upTo(t){return r.subarray(e,e+Math.min(t,r.length-e))},async exactly(t,n=!1){if(t>r.length-e)throw new Error("Unexpected end of data");let i=r.subarray(e,e+t);return n&&(e+=t),i},seek(t){e+=t},get pos(){return e}}}function P5e(r){let e=0,t=0,n=0,i=new Uint8Array(0),s=async o=>{t=i.length-n;let a=[i.subarray(n)];for(;t<o;){let u=await r();if(u==null)break;t<0?u.length>t&&a.push(u.subarray(-t)):a.push(u),t+=u.length}i=new Uint8Array(a.reduce((u,f)=>u+f.length,0));let c=0;for(let u of a)i.set(u,c),c+=u.length;n=0};return{async upTo(o){return i.length-n<o&&await s(o),i.subarray(n,n+Math.min(i.length-n,o))},async exactly(o,a=!1){if(i.length-n<o&&await s(o),i.length-n<o)throw new Error("Unexpected end of data");let c=i.subarray(n,n+o);return a&&(e+=o,n+=o),c},seek(o){e+=o,n+=o},get pos(){return e}}}function iH(r){let e=r[Symbol.asyncIterator]();async function t(){let n=await e.next();return n.done?null:n.value}return P5e(t)}function k5e(r,e){let t=0;return{async upTo(n){let i=await r.upTo(n);return i.length+t>e&&(i=i.subarray(0,e-t)),i},async exactly(n,i=!1){let s=await r.exactly(n,i);if(s.length+t>e)throw new Error("Unexpected end of data");return i&&(t+=n),s},seek(n){t+=n,r.seek(n)},get pos(){return r.pos}}}var Hh=class{constructor(e,t){this._encoder=t,this._mutex=t.setRoots(e),this._ended=!1}async put(e){if(!(e.bytes instanceof Uint8Array)||!e.cid)throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");let t=T.asCID(e.cid);if(!t)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then(()=>this._encoder.writeBlock({cid:t,bytes:e.bytes})),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}static create(e){e=O5e(e);let{encoder:t,iterator:n}=sH(),i=new Hh(e,t),s=new Q6(n);return{writer:i,out:s}}static createAppender(){let{encoder:e,iterator:t}=sH();e.setRoots=()=>Promise.resolve();let n=new Hh([],e),i=new Q6(t);return{writer:n,out:i}}static async updateRootsInBytes(e,t){let n=Y6(e);await W6(n);let i=gA(t);if(Number(n.pos)!==i.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${n.pos} bytes, new header is ${i.length} bytes)`);return e.set(i,0),e}},Q6=class{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}};function sH(){let r=X$(),{writer:e,iterator:t}=r;return{encoder:Q$(e),iterator:t}}function O5e(r){if(r===void 0)return[];if(!Array.isArray(r)){let t=T.asCID(r);if(!t)throw new TypeError("roots must be a single CID or an array of CIDs");return[t]}let e=[];for(let t of r){let n=T.asCID(t);if(!n)throw new TypeError("roots must be a single CID or an array of CIDs");e.push(n)}return e}l();var yA=async({cid:r,load:e,seen:t})=>{t=t||new Set;let n=r.toString(le);if(t.has(n))return;let i=await e(r);if(t.add(n),i!==null)for(let[,s]of i.links())await yA({cid:s,load:e,seen:t})};var oH=k("ipfs:components:dag:import"),N5e=[On,p9];function aH({repo:r,preload:e,codecs:t}){async function*n(i,s={}){s.preload!==!1&&e(i);let o=T.asCID(i);if(!o)throw new Error(`Unexpected error converting CID type: ${i}`);oH(`Exporting ${o} as car`);let{writer:a,out:c}=await Hh.create([o]),u=null;(async()=>{try{let f=D5e(r,a,{signal:s.signal,timeout:s.timeout},t);await yA({cid:o,load:f})}catch(f){u=f}finally{a.close()}})();for await(let f of c){if(u)break;yield f}if(u)throw u}return z(n)}function D5e(r,e,t,n){return async i=>{let s=await n.getCodec(i.code);if(!s)throw new Error(`Can't decode links in block with codec 0x${i.code.toString(16)} to form complete DAG`);let o=await r.blocks.get(i,t);return oH(`Adding block ${i} to car`),await e.put({cid:i,bytes:o}),N5e.includes(i.code)?null:P0({bytes:o,cid:i,codec:s})}}l();l();async function hn(r){for await(let e of r)return e}var cH=S(W(),1);function lH({codecs:r,repo:e,preload:t}){return z(async function(s,o={}){if(o.preload!==!1&&t(s),o.path){let h=o.localResolve?await hn(du(s,o.path,r,e,o)):await ir(du(s,o.path,r,e,o));if(!h)throw(0,cH.default)(new Error("Not found"),"ERR_NOT_FOUND");return h}let a=await r.getCodec(s.code),c=await e.blocks.get(s,o);return{value:a.decode(c),remainderPath:""}})}l();l();var X6=class{constructor(e,t,n){this._version=e,this._roots=t,this._iterable=n,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}},Gh=class extends X6{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(e){let{version:t,roots:n,iterator:i}=await uH(e);return new Gh(t,n,i)}static async fromIterable(e){let{version:t,roots:n,iterator:i}=await fH(e);return new Gh(t,n,i)}},fg=class extends X6{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");this._decoded=!0;let e=this._iterable[Symbol.asyncIterator]();return{async next(){let t=await e.next();return t.done?t:{done:!1,value:t.value.cid}}}}static async fromBytes(e){let{version:t,roots:n,iterator:i}=await uH(e);return new fg(t,n,i)}static async fromIterable(e){let{version:t,roots:n,iterator:i}=await fH(e);return new fg(t,n,i)}};async function uH(r){if(!(r instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return hH(Y6(r))}async function fH(r){if(!r||typeof r[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return hH(iH(r))}async function hH(r){let e=nH(r),{version:t,roots:n}=await e.header();return{version:t,roots:n,iterator:e.blocks()}}var dH=k("ipfs:components:dag:import");function pH({repo:r}){async function*e(t,n={}){let i=await r.gcLock.readLock();try{let s={signal:n.signal,timeout:n.timeout},o=zo(t),{value:a,done:c}=await o.peek();if(c)return;a&&o.push(a);let u;a instanceof Uint8Array?u=[o]:u=o;for await(let f of u){let h=await L5e(r,s,f);if(n.pinRoots!==!1)for(let p of h){let d="";try{await r.blocks.has(p)?(dH(`Pinning root ${p}`),await r.pins.pinRecursively(p)):d="blockstore: block not found"}catch(m){d=m.message}yield{root:{cid:p,pinErrorMsg:d}}}}}finally{i()}}return z(e)}async function L5e(r,e,t){let n=await Gh.fromIterable(t),i=await n.getRoots();return await Ct(r.blocks.putMany(Zt(n,({cid:s,bytes:o})=>(dH(`Import block ${s}`),{key:s,value:o})),{signal:e.signal})),i}l();function mH({repo:r,codecs:e,hashers:t,preload:n}){async function i(s,o={}){let a=o.pin?await r.gcLock.readLock():null;try{let c=await e.getCodec(o.storeCodec||"dag-cbor");if(!c)throw new Error(`Unknown storeCodec ${o.storeCodec}, please configure additional BlockCodecs for this IPFS instance`);if(o.inputCodec){if(!(s instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");let m=await e.getCodec(o.inputCodec);if(!m)throw new Error(`Unknown inputCodec ${o.inputCodec}, please configure additional BlockCodecs for this IPFS instance`);s=m.decode(s)}let u=o.version!=null?o.version:1,f=await t.getHasher(o.hashAlg||"sha2-256");if(!f)throw new Error(`Unknown hash algorithm ${o.hashAlg}, please configure additional MultihashHashers for this IPFS instance`);let h=c.encode(s),p=await f.digest(h),d=T.create(u,c.code,p);return await r.blocks.put(d,h,{signal:o.signal}),o.pin&&await r.pins.pinRecursively(d),o.preload!==!1&&n(d),d}finally{a&&a()}}return z(i)}l();function gH({repo:r,codecs:e,preload:t}){async function n(i,s={}){let{cid:o}=Uc(i);return s.preload!==!1&&t(o),hu(r,e,i,s)}return z(n)}var Z6=class{constructor({repo:e,codecs:t,hashers:n,preload:i}){this.export=aH({repo:e,preload:i,codecs:t}),this.get=lH({codecs:t,repo:e,preload:i}),this.import=pH({repo:e}),this.resolve=gH({repo:e,codecs:t,preload:i}),this.put=mH({repo:e,codecs:t,hashers:n,preload:i})}};l();l();l();var RA=S(ur(),1);l();var O0=S(ur(),1);l();var Fa=S(ur(),1);l();var yH=cs,B5e=ls,wA=function(r){let e=0;if(r=r.toString().trim(),yH(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(B5e(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let s=yH(t[n]),o;s&&(o=wA(t[n]),t[n]=C(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,C(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}let i=new Uint8Array(e+16);for(n=0;n<t.length;n++){let s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},wH=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){let i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};l();var hg={},bA={},M5e=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];M5e.forEach(r=>{let e=F5e(...r);bA[e.code]=e,hg[e.name]=e});function F5e(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:Boolean(n),path:Boolean(i)}}function Et(r){if(typeof r=="number"){if(bA[r]!=null)return bA[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(hg[r]!=null)return hg[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var Oit=Et("ip4"),Nit=Et("ip6"),Dit=Et("ipcidr");function SH(r,e){switch(Et(r).code){case 4:case 41:return z5e(e);case 42:return _H(e);case 6:case 273:case 33:case 132:return AH(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return _H(e);case 421:return H5e(e);case 444:return vH(e);case 445:return vH(e);case 466:return $5e(e);default:return C(e,"base16")}}function xH(r,e){switch(Et(r).code){case 4:return bH(e);case 41:return bH(e);case 42:return EH(e);case 6:case 273:case 33:case 132:return _A(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return EH(e);case 421:return K5e(e);case 444:return G5e(e);case 445:return j5e(e);case 466:return q5e(e);default:return U(e,"base16")}}var EA=Object.values(Ar).map(r=>r.decoder),V5e=function(){let r=EA[0].or(EA[1]);return EA.slice(2).forEach(e=>r=r.or(e)),r}();function bH(r){if(!Xt(r))throw new Error("invalid ip address");return wA(r)}function z5e(r){let e=wH(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Xt(e))throw new Error("invalid ip address");return e}function _A(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function AH(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function EH(r){let e=U(r),t=Uint8Array.from(Fa.default.encode(e.length));return Z([t,e],t.length+e.length)}function _H(r){let e=Fa.default.decode(r);if(r=r.slice(Fa.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return C(r)}function K5e(r){let e;r[0]==="Q"||r[0]==="1"?e=Ze(le.decode(`z${r}`)).bytes:e=T.parse(r).multihash.bytes;let t=Uint8Array.from(Fa.default.encode(e.length));return Z([t,e],t.length+e.length)}function q5e(r){let e=V5e.decode(r),t=Uint8Array.from(Fa.default.encode(e.length));return Z([t,e],t.length+e.length)}function $5e(r){let e=Fa.default.decode(r),t=r.slice(Fa.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+C(t,"base64url")}function H5e(r){let e=Fa.default.decode(r),t=r.slice(Fa.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return C(t,"base58btc")}function G5e(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=De.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=_A(n);return Z([t,i],t.length+i.length)}function j5e(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=De.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=_A(n);return Z([t,i],t.length+i.length)}function vH(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=C(e,"base32"),i=AH(t);return`${n}:${i}`}function W5e(r){let e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){let i=t[n],s=Et(i);if(s.size===0){e.push([i]);continue}if(n++,n>=t.length)throw IH("invalid address: "+r);if(s.path===!0){e.push([i,TA(t.slice(n).join("/"))]);break}e.push([i,t[n]])}return e}function Y5e(r){let e=[];return r.map(t=>{let n=t5(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),TA(e.join("/"))}function Q5e(r){return r.map(e=>{Array.isArray(e)||(e=[e]);let t=t5(e);return e.length>1?[t.code,xH(t.code,e[1])]:[t.code]})}function vA(r){return r.map(e=>{let t=t5(e);return e[1]!=null?[t.code,SH(t.code,e[1])]:[t.code]})}function SA(r){return e5(Z(r.map(e=>{let t=t5(e),n=Uint8Array.from(O0.default.encode(t.code));return e.length>1&&e[1]!=null&&(n=Z([n,e[1]])),n})))}function xA(r,e){return r.size>0?r.size/8:r.size===0?0:O0.default.decode(e)+(O0.default.decode.bytes??0)}function J6(r){let e=[],t=0;for(;t<r.length;){let n=O0.default.decode(r,t),i=O0.default.decode.bytes??0,s=Et(n),o=xA(s,r.slice(t+i));if(o===0){e.push([n]),t+=i;continue}let a=r.slice(t+i,t+i+o);if(t+=o+i,t>r.length)throw IH("Invalid address Uint8Array: "+C(r,"base16"));e.push([n,a])}return e}function AA(r){let e=J6(r),t=vA(e);return Y5e(t)}function X5e(r){r=TA(r);let e=W5e(r),t=Q5e(e);return SA(t)}function TH(r){return X5e(r)}function e5(r){let e=Z5e(r);if(e!=null)throw e;return Uint8Array.from(r)}function Z5e(r){try{J6(r)}catch(e){return e}}function TA(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function IH(r){return new Error("Error parsing address: "+r)}function t5(r){return Et(r[0])}l();var e8e=Symbol.for("nodejs.util.inspect.custom"),t8e=[Et("dns").code,Et("dns4").code,Et("dns6").code,Et("dnsaddr").code],r8e=new Map,RH=Symbol.for("@multiformats/js-multiaddr/multiaddr");function n8e(r){return Boolean(r?.[RH])}var rl=class{bytes;#e;#r;#n;#t;[RH]=!0;constructor(e){if(e==null&&(e=""),e instanceof Uint8Array)this.bytes=e5(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=TH(e)}else if(n8e(e))this.bytes=e5(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return this.#e==null&&(this.#e=AA(this.bytes)),this.#e}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="",o=Et("tcp"),a=Et("udp"),c=Et("ip4"),u=Et("ip6"),f=Et("dns6"),h=Et("ip6zone");for(let[d,m]of this.stringTuples())d===h.code&&(s=`%${m??""}`),t8e.includes(d)&&(t=o.name,i=443,n=`${m??""}${s}`,e=d===f.code?6:4),(d===o.code||d===a.code)&&(t=Et(d).name,i=parseInt(m??"")),(d===c.code||d===u.code)&&(t=Et(d).name,n=`${m??""}${s}`,e=d===u.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return this.protoCodes().map(e=>Object.assign({},Et(e)))}protoCodes(){let e=[],t=this.bytes,n=0;for(;n<t.length;){let i=RA.default.decode(t,n),s=RA.default.decode.bytes??0,o=Et(i),a=xA(o,t.slice(n+s));n+=a+s,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return this.#r==null&&(this.#r=J6(this.bytes)),this.#r}stringTuples(){return this.#n==null&&(this.#n=vA(this.tuples())),this.#n}encapsulate(e){return e=new rl(e),new rl(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new rl(n.slice(0,i))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new rl(SA(t.slice(0,n)));return this}getPeerId(){try{let t=this.stringTuples().filter(n=>n[0]===hg.ipfs.code).pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?C(le.decode(`z${n}`),"base58btc"):C(T.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){if(this.#t===void 0)try{this.#t=this.stringTuples().filter(e=>Et(e[0]).path===!0)[0][1],this.#t==null&&(this.#t=null)}catch{this.#t=null}return this.#t}equals(e){return be(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(s=>s.resolvable);if(t==null)return[this];let n=r8e.get(t.name);if(n==null)throw new F(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(s=>new rl(s))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[e8e](){return`Multiaddr(${AA(this.bytes)})`}};function IA(r){return new rl(r)}function CH(r){let e;try{e=Et("sni").code}catch{return null}for(let[t,n]of r)if(t===e&&n!==void 0)return n;return null}function PH(r){return r.some(([e,t])=>e===Et("tls").code)}function bs(r,e,t){let n=kH[Et(r).name];if(n===void 0)throw new Error(`Can't interpret protocol ${Et(r).name}`);let i=n(e,t);return r===Et("ip6").code?`[${i}]`:i}var kH={ip4:(r,e)=>r,ip6:(r,e)=>e.length===0?r:`[${r}]`,tcp:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`tcp://${bs(t[0],t[1]??"",e)}:${r}`},udp:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`udp://${bs(t[0],t[1]??"",e)}:${r}`},dnsaddr:(r,e)=>r,dns4:(r,e)=>r,dns6:(r,e)=>r,dns:(r,e)=>r,ipfs:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${bs(t[0],t[1]??"",e)}/ipfs/${r}`},p2p:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${bs(t[0],t[1]??"",e)}/p2p/${r}`},http:(r,e)=>{let t=PH(e),n=CH(e);if(t&&n!==null)return`https://${n}`;let i=t?"https://":"http://",s=e.pop();if(s===void 0)throw new Error("Unexpected end of multiaddr");let o=bs(s[0],s[1]??"",e);return o=o.replace("tcp://",""),`${i}${o}`},tls:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return bs(t[0],t[1]??"",e)},sni:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return bs(t[0],t[1]??"",e)},https:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");let n=bs(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{let t=PH(e),n=CH(e);if(t&&n!==null)return`wss://${n}`;let i=t?"wss://":"ws://",s=e.pop();if(s===void 0)throw new Error("Unexpected end of multiaddr");let o=bs(s[0],s[1]??"",e);return o=o.replace("tcp://",""),`${i}${o}`},wss:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");let n=bs(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`wss://${n}`},"p2p-websocket-star":(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${bs(t[0],t[1]??"",e)}/p2p-websocket-star`},"p2p-webrtc-star":(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${bs(t[0],t[1]??"",e)}/p2p-webrtc-star`},"p2p-webrtc-direct":(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${bs(t[0],t[1]??"",e)}/p2p-webrtc-direct`}};function N0(r,e){let n=IA(r).stringTuples(),i=n.pop();if(i===void 0)throw new Error("Unexpected end of multiaddr");let s=Et(i[0]),o=kH[s.name];if(o==null)throw new Error(`No interpreter found for ${s.name}`);let a=o(i[1]??"",n);return e?.assumeHttp!==!1&&i[0]===Et("tcp").code&&(a=a.replace("tcp://","http://"),(i[1]==="443"||i[1]==="80")&&(i[1]==="443"&&(a=a.replace("http://","https://")),a=a.substring(0,a.lastIndexOf(":")))),a}l();function CA(r){if(!Array.isArray(r))throw new TypeError(`Expected an array, got ${typeof r}`);r=[...r];for(let e=r.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[r[e],r[t]]=[r[t],r[e]]}return r}l();var OH=S(Vp(),1);var i8e=k("ipfs:preload"),s8e=qt.default?qt.default:qt,o8e=new s8e({concurrency:4});function NH(r,e={}){return i8e(r),o8e.add(async()=>{let n=(await OH.default.post(r,{signal:e.signal})).body.getReader();try{for(;;){let{done:i}=await n.read();if(i)return}}finally{n.releaseLock()}})}var DH=S($m(),1),dg=k("ipfs:preload");function LH(r={}){if(r.enabled=Boolean(r.enabled),r.addresses=r.addresses||[],r.cache=r.cache||1e3,!r.enabled||!r.addresses.length)return dg("preload disabled"),Object.assign(()=>{},{start:()=>{},stop:()=>{}});let e=!0,t=[],n=r.addresses.map(o=>N0(o)),i=(0,DH.default)(r.cache),s=async o=>{try{if(e)throw new Error(`preload ${o} but preloader is not started`);let a=o.toString();if(i.has(a))return;i.set(a,!0);let c=CA(n),u=!1,f=Date.now();for(let h of c){if(e)throw new Error(`preload aborted for ${a}`);let p;try{p=new AbortController,t=t.concat(p),await NH(`${h}/api/v0/refs?r=true&arg=${encodeURIComponent(a)}`,{signal:p.signal}),u=!0}catch(d){d.type!=="aborted"&&dg.error(d)}finally{t=t.filter(d=>d!==p)}if(u)break}dg(`${u?"":"un"}successfully preloaded ${a} in ${Date.now()-f}ms`)}catch(a){dg.error(a)}};return s.start=()=>{e=!1},s.stop=()=>{e=!0,dg(`aborting ${t.length} pending preload request(s)`),t.forEach(o=>o.abort()),t=[]},s}l();var r5=k("ipfs:mfs-preload");function BH({preload:r,files:e,options:t={}}){if(t.interval=t.interval||30*1e3,!t.enabled){r5("MFS preload disabled");let o=async()=>{};return{start:o,stop:o}}let n="",i,s=async()=>{try{let o=await e.stat("/"),a=o.cid.toString();n!==a&&(r5(`preloading updated MFS root ${n} -> ${o.cid}`),await r(o.cid),n=a)}catch(o){r5.error("failed to preload MFS root",o)}finally{i=setTimeout(s,t.interval)}};return{async start(){let o=await e.stat("/");n=o.cid.toString(),r5(`monitoring MFS root ${o.cid}`),i=setTimeout(s,t.interval)},stop(){clearTimeout(i)}}}l();l();l();l();var PA=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},kA=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},UH=r=>globalThis.DOMException===void 0?new kA(r):new DOMException(r),MH=r=>{let e=r.reason===void 0?UH("This operation was aborted."):r.reason;return e instanceof Error?e:UH(e)};function pg(r,e){let{milliseconds:t,fallback:n,message:i,customTimers:s={setTimeout,clearTimeout}}=e,o,a=new Promise((c,u)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t===Number.POSITIVE_INFINITY){c(r);return}if(e.signal){let{signal:h}=e;h.aborted&&u(MH(h)),h.addEventListener("abort",()=>{u(MH(h))})}let f=new PA;o=s.setTimeout.call(void 0,()=>{if(n){try{c(n())}catch(h){u(h)}return}typeof r.cancel=="function"&&r.cancel(),i===!1?c():i instanceof Error?u(i):(f.message=i??`Promise timed out after ${t} milliseconds`,u(f))},t),(async()=>{try{c(await r)}catch(h){u(h)}finally{s.clearTimeout.call(void 0,o)}})()});return a.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},a}l();l();var OA="lock:worker:request-read",NA="lock:worker:release-read",DA="lock:master:grant-read",LA="lock:worker:request-write",BA="lock:worker:release-write",UA="lock:master:grant-write";l();var ju={},D0=r=>{r.addEventListener("message",e=>{D0.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{D0.dispatchEvent("message",r,e)})};D0.addEventListener=(r,e)=>{ju[r]==null&&(ju[r]=[]),ju[r].push(e)};D0.removeEventListener=(r,e)=>{ju[r]!=null&&(ju[r]=ju[r].filter(t=>t===e))};D0.dispatchEvent=function(r,e,t){ju[r]!=null&&ju[r].forEach(n=>n(e,t))};var MA=D0;var FH=(r,e,t,n,i)=>(s,o)=>{if(o.data.type!==t)return;let a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>(s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise(c=>{let u=f=>{if(f==null||f.data==null)return;let h={type:f.data.type,name:f.data.name,identifier:f.data.identifier};h.type===n&&h.identifier===a.identifier&&(s.removeEventListener("message",u),c())};s.addEventListener("message",u)}))}}))},VH=(r,e,t,n)=>async()=>{let i=Tr();return globalThis.postMessage({type:e,identifier:i,name:r}),await new Promise(s=>{let o=a=>{if(a==null||a.data==null)return;let c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===i&&(globalThis.removeEventListener("message",o),s(()=>{globalThis.postMessage({type:n,identifier:i,name:r})}))};globalThis.addEventListener("message",o)})},a8e={singleProcess:!1},zH=r=>{if(r=Object.assign({},a8e,r),Boolean(globalThis.document)||r.singleProcess){let t=new EventTarget;return MA.addEventListener("message",FH(t,"requestReadLock",OA,NA,DA)),MA.addEventListener("message",FH(t,"requestWriteLock",LA,BA,UA)),t}return{isWorker:!0,readLock:t=>VH(t,OA,DA,NA),writeLock:t=>VH(t,LA,UA,BA)}};var jh={},Wu;async function FA(r,e){let t,n=new Promise(i=>{t=i});return r.add(async()=>await pg((async()=>await new Promise(i=>{t(()=>{i()})}))(),{milliseconds:e.timeout})),await n}var c8e=(r,e)=>{if(Wu.isWorker===!0)return{readLock:Wu.readLock(r,e),writeLock:Wu.writeLock(r,e)};let t=new qt({concurrency:1}),n;return{async readLock(){if(n!=null)return await FA(n,e);n=new qt({concurrency:e.concurrency,autoStart:!1});let i=n,s=FA(n,e);return t.add(async()=>(i.start(),await i.onIdle().then(()=>{n===i&&(n=null)}))),await s},async writeLock(){return n=null,await FA(t,e)}}},l8e={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function Wh(r){let e=Object.assign({},l8e,r);return Wu==null&&(Wu=zH(e),Wu.isWorker!==!0&&(Wu.addEventListener("requestReadLock",t=>{jh[t.data.name]!=null&&jh[t.data.name].readLock().then(async n=>await t.data.handler().finally(()=>n()))}),Wu.addEventListener("requestWriteLock",async t=>{jh[t.data.name]!=null&&jh[t.data.name].writeLock().then(async n=>await t.data.handler().finally(()=>n()))}))),jh[e.name]==null&&(jh[e.name]=c8e(e.name,e)),jh[e.name]}var n5;function mg(r=!1){if(n5)return n5;let e=Wh({singleProcess:r});return n5={readLock:t=>async(...n)=>{let i=await e.readLock();try{return await t.apply(null,n)}finally{i()}},writeLock:t=>async(...n)=>{let i=await e.writeLock();try{return await t.apply(null,n)}finally{i()}}},n5}l();l();l();var VA=S(W(),1);var KH=k("ipfs:mfs:utils:with-mfs-root");async function L0(r,e){if(e&&e.signal&&e.signal.aborted)throw(0,VA.default)(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});await r.repo.datastore.open();let t;try{let n=await r.repo.datastore.get(qm);t=T.decode(n)}catch(n){if(n.code!=="ERR_NOT_FOUND")throw n;KH("Creating new MFS root");let i=ze({Data:new Ke({type:"directory"}).marshal(),Links:[]}),s=await Le.digest(i);if(t=T.createV0(s),await r.repo.blocks.put(t,i),e&&e.signal&&e.signal.aborted)throw(0,VA.default)(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});await r.repo.datastore.put(qm,t.bytes)}return KH(`Loaded MFS root /ipfs/${t}`),t}l();function B0(r=""){return(r.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean)}var KA=S(W(),1);var zA="ipfs",$r=async(r,e,t)=>{let n=await L0(r,t),i={entryType:"file"},s="";if(T.asCID(e)?s=`/ipfs/${e}`:s=e.toString(),s=s.trim(),s=s.replace(/(\/\/+)/g,"/"),s.endsWith("/")&&s.length>1&&(s=s.substring(0,s.length-1)),!s)throw(0,KA.default)(new Error("paths must not be empty"),"ERR_NO_PATH");if(s.substring(0,1)!=="/")throw(0,KA.default)(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");s.substring(s.length-1)==="/"&&(s=s.substring(0,s.length-1));let o=B0(s);if(o[0]===zA){let c;o.length===2?c=`/${o.join("/")}`:c=`/${o.slice(0,o.length-1).join("/")}`,i={type:"ipfs",depth:o.length-2,entryType:"file",mfsPath:`/${o.join("/")}`,mfsDirectory:c,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}else{let c=`/${zA}/${n}${o.length?"/"+o.join("/"):""}`,u=`/${zA}/${n}/${o.slice(0,o.length-1).join("/")}`;i={type:"mfs",depth:o.length,entryType:"file",mfsDirectory:u,mfsPath:c,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}let a=i.type==="mfs"?i.mfsPath:i.path;try{let c=await ei(a,r.repo.blocks,t);i.cid=c.cid,i.mfsPath=`/ipfs/${c.path}`,i.entryType=c.type,i.content=c.content,(i.entryType==="file"||i.entryType==="directory")&&(c.type==="file"||c.type==="directory")&&(i.unixfs=c.unixfs)}catch(c){if(c.code!=="ERR_NOT_FOUND")throw c}return i.exists=Boolean(i.cid),i};var $H=S(W(),1);var u8e=Ve.bind({ignoreUndefined:!0}),f8e=k("ipfs:mfs:stat"),h8e={withLocal:!1};function Yu(r){async function e(t,n={}){n=u8e(h8e,n),f8e(`Fetching stats for ${t}`);let{type:i,cid:s,mfsPath:o}=await $r(r,t,n),a=i==="ipfs"&&s?s:o,c;try{c=await ei(a,r.repo.blocks)}catch(u){throw u.code==="ERR_NOT_FOUND"?(0,$H.default)(new Error(`${t} does not exist`),"ERR_NOT_FOUND"):u}if(!qH[c.type])throw new Error(`Cannot stat codec ${c.cid.code}`);return qH[c.type](c)}return z(e)}var qH={raw:r=>({cid:r.cid,size:r.node.length,cumulativeSize:r.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1}),file:r=>{let e={cid:r.cid,type:"file",size:r.unixfs.fileSize(),cumulativeSize:ze(r.node).length+(r.node.Links||[]).reduce((t,n)=>t+(n.Tsize||0),0),blocks:r.unixfs.blockSizes.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:r.unixfs.mode};return r.unixfs.mtime&&(e.mtime=r.unixfs.mtime),e},directory:r=>{let e={cid:r.cid,type:"directory",size:0,cumulativeSize:ze(r.node).length+(r.node.Links||[]).reduce((t,n)=>t+(n.Tsize||0),0),blocks:r.node.Links.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:r.unixfs.mode};return r.unixfs.mtime&&(e.mtime=r.unixfs.mtime),e},object:r=>({cid:r.cid,size:r.node.length,cumulativeSize:r.node.length,type:"file",blocks:0,local:void 0,sizeLocal:void 0,withLocality:!1}),identity:r=>({cid:r.cid,size:r.node.length,cumulativeSize:r.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1})};l();var z0=S(W(),1);l();var d8e=k("ipfs:mfs:utils:to-trail");async function Va(r,e){d8e(`Creating trail for path ${e}`);let t=[];for await(let n of kx(e,r.repo.blocks))t.push({name:n.name,cid:n.cid,size:n.size,type:n.type});return t}l();l();l();var i5=async(r,e,t)=>{t.codec||(t.codec=ut),t.hasher||(t.hasher=Le),t.cidVersion===void 0&&(t.cidVersion=1),t.codec===ut&&t.hasher!==Le&&(t.cidVersion=1);let n=await t.hasher.digest(r),i=T.create(t.cidVersion,t.codec.code,n);return t.onlyHash||await e.put(i,r,{signal:t.signal}),i};l();var s5=Nh.code,o5=8;async function a5(r){return(await Nh.encode(r)).subarray(0,8).reverse()}var qA=class{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}},U0=class extends qA{constructor(e,t){super(e,t),this._bucket=Mu({hashFn:a5,bits:o5})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){yield*HH(this._bucket,e,this,this.options)}};async function*HH(r,e,t,n){let i=r._children,s=[],o=0;for(let d=0;d<i.length;d++){let m=i.get(d);if(!m)continue;let g=d.toString(16).toUpperCase().padStart(2,"0");if(m instanceof zr){let y;for await(let w of await HH(m,e,null,n))y=w;if(!y)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:g,Tsize:y.size,Hash:y.cid}),o+=y.size}else if(typeof m.value.flush=="function"){let y=m.value,w;for await(let _ of y.flush(e))w=_,yield w;let b=g+m.key;s.push({Name:b,Tsize:w.size,Hash:w.cid}),o+=w.size}else{let y=m.value;if(!y.cid)continue;let w=g+m.key,b=y.size;s.push({Name:w,Tsize:b,Hash:y.cid}),o+=b}}let a=Uint8Array.from(i.bitField().reverse()),u={Data:new Ke({type:"hamt-sharded-directory",data:a,fanout:r.tableSize(),hashType:s5,mtime:t&&t.mtime,mode:t&&t.mode}).marshal(),Links:s},f=ze(Pn(u)),h=await i5(f,e,n),p=f.length+o;yield{cid:h,node:u,size:p}}l();var gg=k("ipfs:mfs:core:utils:hamt-utils"),M0=async(r,e,t,n)=>{if(!n.parent.Data)throw new Error("Could not update HAMT directory because parent had no data");let i=Uint8Array.from(t._children.bitField().reverse()),s=Ke.unmarshal(n.parent.Data),o=new Ke({type:"hamt-sharded-directory",data:i,fanout:t.tableSize(),hashType:s5,mode:s.mode,mtime:s.mtime}),a=await r.hashers.getHasher(n.hashAlg),c={Data:o.marshal(),Links:e.sort((p,d)=>(p.Name||"").localeCompare(d.Name||""))},u=ze(c),f=await a.digest(u),h=T.create(n.cidVersion,We,f);return n.flush&&await r.repo.blocks.put(h,u),{node:c,cid:h,size:e.reduce((p,d)=>p+(d.Tsize||0),u.length)}},$A=async(r,e,t,n,i)=>{let s=new zr({hash:t._options.hash,bits:t._options.bits},n,i);return n._putObjectAt(i,s),await yg(r,e,s,t),s},HA=async r=>{let e=Mu({hashFn:a5,bits:o5});return await Promise.all(r.map(async t=>{let n=t.Name||"";if(n.length===2){let i=parseInt(n,16),s=new zr({hash:e._options.hash,bits:e._options.bits},e,i);return e._putObjectAt(i,s),Promise.resolve()}return e.put(n.substring(2),{size:t.Tsize,cid:t.Hash})})),e},yg=async(r,e,t,n)=>{await Promise.all(e.map(async i=>{let s=i.Name||"";if(s.length===2){gg("Populating sub bucket",s);let o=parseInt(s,16),a=await r.repo.blocks.get(i.Hash),c=lt(a),u=new zr({hash:n._options.hash,bits:n._options.bits},t,o);return t._putObjectAt(o,u),await yg(r,c.Links,u,n),Promise.resolve()}return n.put(s.substring(2),{size:i.Tsize,cid:i.Hash})}))},Yh=r=>r.toString(16).toUpperCase().padStart(2,"0").substring(0,2),GH=async(r,e,t)=>{let n=await HA(t.Links),i=await n._findNewBucketAndPos(e),s=[{bucket:i.bucket,prefix:Yh(i.pos)}],o=i.bucket;for(;o!==n;)s.push({bucket:o,prefix:Yh(o._posAtParent)}),o=o._parent;s.reverse(),s[0].node=t;for(let a=0;a<s.length;a++){let c=s[a];if(!c.node)throw new Error("Could not generate HAMT path");let u=c.node.Links.filter(d=>(d.Name||"").substring(0,2)===c.prefix).pop();if(!u){gg(`Link ${c.prefix}${e} will be added`);continue}if(u.Name===`${c.prefix}${e}`){gg(`Link ${c.prefix}${e} will be replaced`);continue}gg(`Found subshard ${c.prefix}`);let f=await r.repo.blocks.get(u.Hash),h=lt(f);if(!s[a+1]){gg(`Loaded new subshard ${c.prefix}`),await $A(r,h.Links,n,c.bucket,parseInt(c.prefix,16));let d=await n._findNewBucketAndPos(e);s.push({bucket:d.bucket,prefix:Yh(d.pos),node:h});continue}let p=s[a+1];await yg(r,h.Links,p.bucket,n),p.node=h}return await n.put(e,!0),s.reverse(),{rootBucket:n,path:s}},jH=async(r,e,t={})=>{let n=new U0({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:t.mtime,mode:t.mode},t);for(let s=0;s<e.length;s++)await n._bucket.put(e[s].name,{size:e[s].size,cid:e[s].cid});let i=await ir(n.flush(r.repo.blocks));if(!i)throw new Error("Flushing shard yielded no result");return i};var za=S(W(),1);var Ka=k("ipfs:mfs:core:utils:add-link");async function to(r,e){let t=e.parent;if(e.parentCid){let i=T.asCID(e.parentCid);if(i===null)throw(0,za.default)(new Error("Invalid CID passed to addLink"),"EINVALIDPARENTCID");if(i.code!==We)throw(0,za.default)(new Error("Unsupported codec. Only DAG-PB is supported"),"EINVALIDPARENTCID");Ka(`Loading parent node ${i}`);let s=await r.repo.blocks.get(i);t=lt(s)}if(!t)throw(0,za.default)(new Error("No parent node or CID passed to addLink"),"EINVALIDPARENT");if(!e.cid)throw(0,za.default)(new Error("No child cid passed to addLink"),"EINVALIDCHILDCID");if(!e.name)throw(0,za.default)(new Error("No child name passed to addLink"),"EINVALIDCHILDNAME");if(!e.size&&e.size!==0)throw(0,za.default)(new Error("No child size passed to addLink"),"EINVALIDCHILDSIZE");if(!t.Data)throw(0,za.default)(new Error("Parent node with no data passed to addLink"),"ERR_INVALID_PARENT");let n=Ke.unmarshal(t.Data);return n.type==="hamt-sharded-directory"?(Ka("Adding link to sharded directory"),g8e(r,{...e,parent:t})):t.Links.length>=e.shardSplitThreshold?(Ka("Converting directory to sharded directory"),p8e(r,{...e,parent:t,mtime:n.mtime,mode:n.mode})):(Ka(`Adding ${e.name} (${e.cid}) to regular directory`),m8e(r,{...e,parent:t}))}var p8e=async(r,e)=>{let t=await jH(r,e.parent.Links.map(n=>({name:n.Name||"",size:n.Tsize||0,cid:n.Hash})).concat({name:e.name,size:e.size,cid:e.cid}),e);return Ka(`Converted directory to sharded directory ${t.cid}`),t},m8e=async(r,e)=>{let t=e.parent.Links.filter(u=>u.Name!==e.name);if(t.push({Name:e.name,Tsize:e.size,Hash:e.cid}),!e.parent.Data)throw(0,za.default)(new Error("Parent node with no data passed to addToDirectory"),"ERR_INVALID_PARENT");let n=Ke.unmarshal(e.parent.Data),i;if(n.mtime){let u=Date.now(),f=Math.floor(u/1e3);n.mtime={secs:f,nsecs:(u-f*1e3)*1e3},i=n.marshal()}else i=e.parent.Data;e.parent=Pn({Data:i,Links:t});let s=await r.hashers.getHasher(e.hashAlg),o=ze(e.parent),a=await s.digest(o),c=T.create(e.cidVersion,We,a);return e.flush&&await r.repo.blocks.put(c,o),{node:e.parent,cid:c,size:o.length}},g8e=async(r,e)=>{let{shard:t,path:n}=await y8e(r,e),i=await ir(t.flush(r.repo.blocks));if(!i)throw new Error("No result from flushing shard");let s=await r.repo.blocks.get(i.cid),o=lt(s),a=e.parent.Links.filter(u=>(u.Name||"").substring(0,2)!==n[0].prefix),c=o.Links.find(u=>(u.Name||"").substring(0,2)===n[0].prefix);if(!c)throw new Error(`No link found with prefix ${n[0].prefix}`);return a.push(c),M0(r,a,n[0].bucket,e)},y8e=async(r,e)=>{let t={name:e.name,cid:e.cid,size:e.size};if(!e.parent.Data)throw(0,za.default)(new Error("Parent node with no data passed to addFileToShardedDirectory"),"ERR_INVALID_PARENT");let n=await HA(e.parent.Links),i=Ke.unmarshal(e.parent.Data),s=new U0({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mode:i.mode},e);s._bucket=n,i.mtime&&(s.mtime={secs:Math.round(Date.now()/1e3)});let o=await n._findNewBucketAndPos(t.name),a=w8e(o);a[0].node=e.parent;let c=0;for(;c<a.length;){let u=a[c];c++;let f=u.node;if(!f)throw new Error("Segment had no node");let h=f.Links.find(g=>(g.Name||"").substring(0,2)===u.prefix);if(!h){Ka(`Link ${u.prefix}${t.name} will be added`),c=a.length;break}if(h.Name===`${u.prefix}${t.name}`){Ka(`Link ${u.prefix}${t.name} will be replaced`),c=a.length;break}if((h.Name||"").length>2){Ka(`Link ${h.Name} ${h.Hash} will be replaced with a subshard`),c=a.length;break}Ka(`Found subshard ${u.prefix}`);let p=await r.repo.blocks.get(h.Hash),d=lt(p);if(!a[c]){Ka(`Loaded new subshard ${u.prefix}`),await $A(r,d.Links,n,u.bucket,parseInt(u.prefix,16));let g=await n._findNewBucketAndPos(t.name);a.push({bucket:g.bucket,prefix:Yh(g.pos),node:d});break}let m=a[c];await yg(r,d.Links,m.bucket,n),m.node=d}return await s._bucket.put(t.name,{size:t.size,cid:t.cid}),{shard:s,path:a}},w8e=r=>{let e=[{bucket:r.bucket,prefix:Yh(r.pos)}],t=r.bucket._parent,n=r.bucket._posAtParent;for(;t;)e.push({bucket:t,prefix:Yh(n)}),n=t._posAtParent,t=t._parent;return e.reverse(),e};l();var WH=k("ipfs:mfs:utils:update-tree"),b8e={shardSplitThreshold:1e3};async function Es(r,e,t){t=Object.assign({},b8e,t),WH("Trail",e),e=e.slice().reverse();let n=0,i;for await(let o of r.repo.blocks.getMany(e.map(a=>a.cid))){let a=lt(o),c=e[n].cid,u=e[n].name;if(n++,!i){i={cid:c,name:u,size:o.length};continue}let f=await to(r,{parent:a,name:i.name,cid:i.cid,size:i.size,flush:t.flush,shardSplitThreshold:t.shardSplitThreshold,hashAlg:t.hashAlg,cidVersion:t.cidVersion});i={cid:f.cid,name:u,size:f.size}}let{cid:s}=i;return WH(`Final CID ${s}`),s}l();var YH=S(W(),1),E8e=k("ipfs:mfs:utils:update-mfs-root");async function _s(r,e,t){if(t&&t.signal&&t.signal.aborted)throw(0,YH.default)(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});return E8e(`New MFS root will be ${e}`),await r.repo.datastore.put(qm,e.bytes),e}l();l();var Qh=S(W(),1);l();async function QH(r,e,t){let n=new Ke({type:e,mode:t.mode,mtime:t.mtime}),i=await r.hashers.getHasher(t.hashAlg),s={Data:n.marshal(),Links:[]},o=ze(s),a=await i.digest(o),c=T.create(t.cidVersion,We,a);return t.flush&&await r.repo.blocks.put(c,o),{cid:c,node:s}}var _8e=Ve.bind({ignoreUndefined:!0}),XH=k("ipfs:mfs:mkdir"),v8e={parents:!1,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3,flush:!0};function Xh(r){async function e(t,n={}){let i=_8e(v8e,n);if(!t)throw new Error("no path given to Mkdir");if(t=t.trim(),t==="/"){if(i.parents)return;throw(0,Qh.default)(new Error("cannot create directory '/': Already exists"),"ERR_INVALID_PATH")}if(t.substring(0,1)!=="/")throw(0,Qh.default)(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");XH(`Creating ${t}`);let s=B0(t);if(s[0]==="ipfs")throw(0,Qh.default)(new Error("path cannot have the prefix 'ipfs'"),"ERR_INVALID_PATH");let o=await L0(r,i),a,c=[],u=await QH(r,"directory",i);for(let h=0;h<=s.length;h++){let p=s.slice(0,h),d=`/ipfs/${o}/${p.join("/")}`;try{if(a=await ei(d,r.repo.blocks),a.type!=="file"&&a.type!=="directory")throw(0,Qh.default)(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(h===s.length){if(i.parents)return;throw(0,Qh.default)(new Error("file already exists"),"ERR_ALREADY_EXISTS")}c.push({name:a.name,cid:a.cid})}catch(m){if(m.code==="ERR_NOT_FOUND"){if(h<s.length&&!i.parents)throw(0,Qh.default)(new Error(`Intermediate directory path ${d} does not exist, use the -p flag to create it`),"ERR_NOT_FOUND");await S8e(r,p[p.length-1],u,c[c.length-1],c,i)}else throw m}}let f=await Es(r,c,i);await _s(r,f,i)}return z(e)}var S8e=async(r,e,t,n,i,s)=>{XH(`Adding empty dir called ${e} to ${n.cid}`);let o=await to(r,{parent:n.node,parentCid:n.cid,size:0,cid:t.cid,name:e,hashAlg:s.hashAlg,cidVersion:s.cidVersion,flush:s.flush,shardSplitThreshold:s.shardSplitThreshold});i[i.length-1].cid=o.cid,i.push({name:e,cid:t.cid})};var Qu=S(W(),1);var x8e=Ve.bind({ignoreUndefined:!0}),c5=k("ipfs:mfs:cp"),A8e={parents:!1,flush:!0,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3};function F0(r){async function e(t,n,i={}){let s=x8e(A8e,i);Array.isArray(t)||(t=[t]);let o=await Promise.all(t.map(p=>$r(r,p,s))),a=await $r(r,n,s);if(!o.length||!a)throw(0,Qu.default)(new Error("Please supply at least one source"),"ERR_INVALID_PARAMS");let c=o.find(p=>!p.exists);if(c)throw(0,Qu.default)(new Error(`${c.path} does not exist`),"ERR_INVALID_PARAMS");let u=ZH(a);if(a.exists){if(c5("Destination exists"),o.length===1&&!u)throw(0,Qu.default)(new Error("directory already has entry by that name"),"ERR_ALREADY_EXISTS")}else if(c5("Destination does not exist"),o.length>1){if(!s.parents)throw(0,Qu.default)(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await Xh(r)(a.path,s),a=await $r(r,a.path,s)}else if(a.parts.length>1){let p=`/${a.parts.slice(0,-1).join("/")}`;try{await Yu(r)(p,s)}catch(d){if(d.code!=="ERR_NOT_FOUND")throw d;if(!s.parents)throw(0,Qu.default)(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await Xh(r)(p,s),a=await $r(r,a.path,s)}}let f=ZH(a)?a.mfsPath:a.mfsDirectory,h=await Va(r,f);if(o.length===1){let p=o.pop();if(!p)throw(0,Qu.default)(new Error("could not find source"),"ERR_INVALID_PARAMS");let d=u?p.name:a.name;return c5(`Only one source, copying to destination ${u?"directory":"file"} ${d}`),T8e(r,p,d,h,s)}return c5("Multiple sources, wrapping in a directory"),I8e(r,o,a,h,s)}return z(e)}var ZH=r=>r.unixfs&&r.unixfs.type&&r.unixfs.type.includes("directory"),T8e=async(r,e,t,n,i)=>{let s=n.pop();if(!s)throw(0,Qu.default)(new Error("destination had no parent"),"ERR_INVALID_PARAMS");s=await JH(r,e,t,s,i),n.push(s);let o=await Es(r,n,i);await _s(r,o,i)},I8e=async(r,e,t,n,i)=>{for(let o=0;o<e.length;o++){let a=e[o];t=await JH(r,a,a.name,t,i)}n[n.length-1]=t;let s=await Es(r,n,i);await _s(r,s,i)},JH=async(r,e,t,n,i)=>{let s=await r.repo.blocks.get(e.cid),{node:o,cid:a,size:c}=await to(r,{parentCid:n.cid,size:s.length,cid:e.cid,name:t,hashAlg:i.hashAlg,cidVersion:i.cidVersion,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold});return n.node=o,n.cid=a,n.size=c,n};l();var wg=S(W(),1);l();var Xu=S(W(),1),Zu=k("ipfs:mfs:core:utils:remove-link");async function eG(r,e){let t=e.parent;if(e.parentCid){let i=T.asCID(e.parentCid);if(i===null)throw(0,Xu.default)(new Error("Invalid CID passed to removeLink"),"EINVALIDPARENTCID");Zu(`Loading parent node ${i}`);let s=await r.repo.blocks.get(i);t=lt(s)}if(!t)throw(0,Xu.default)(new Error("No parent node or CID passed to removeLink"),"EINVALIDPARENT");if(!e.name)throw(0,Xu.default)(new Error("No child name passed to removeLink"),"EINVALIDCHILDNAME");if(!t.Data)throw(0,Xu.default)(new Error("Parent node had no data"),"ERR_INVALID_NODE");return Ke.unmarshal(t.Data).type==="hamt-sharded-directory"?(Zu(`Removing ${e.name} from sharded directory`),C8e(r,{...e,parent:t})):(Zu(`Removing link ${e.name} regular directory`),R8e(r,{...e,parent:t}))}var R8e=async(r,e)=>{e.parent.Links=e.parent.Links.filter(o=>o.Name!==e.name);let t=await ze(e.parent),i=await(await r.hashers.getHasher(e.hashAlg)).digest(t),s=T.create(e.cidVersion,We,i);return await r.repo.blocks.put(s,t),Zu(`Updated regular directory ${s}`),{node:e.parent,cid:s}},C8e=async(r,e)=>{let{rootBucket:t,path:n}=await GH(r,e.name,e.parent);await t.del(e.name);let{node:i}=await tG(r,n,e.name,e);return M0(r,i.Links,t,e)},tG=async(r,e,t,n)=>{let i=e.pop();if(!i)throw(0,Xu.default)(new Error("Could not find parent"),"EINVALIDPARENT");let{bucket:s,prefix:o,node:a}=i;if(!a)throw(0,Xu.default)(new Error("Could not find parent"),"EINVALIDPARENT");let c=a.Links.find(d=>(d.Name||"").substring(0,2)===o);if(!c)throw(0,Xu.default)(new Error(`No link found with prefix ${o} for file ${t}`),"ERR_NOT_FOUND");if(c.Name===`${o}${t}`){Zu(`Removing existing link ${c.Name}`);let d=a.Links.filter(m=>m.Name!==c.Name);return await s.del(t),M0(r,d,s,n)}Zu(`Descending into sub-shard ${c.Name} for ${o}${t}`);let u=await tG(r,e,t,n),f=u.cid,h=u.size,p=o;if(u.node.Links.length===1){Zu(`Removing subshard for ${o}`);let d=u.node.Links[0];p=`${o}${(d.Name||"").substring(2)}`,f=d.Hash,h=d.Tsize||0}return Zu(`Updating shard ${o} with name ${p}`),P8e(r,s,a,o,p,h,f,n)},P8e=(r,e,t,n,i,s,o,a)=>{let c=t.Links.filter(u=>u.Name!==n);return c.push({Name:i,Tsize:s,Hash:o}),M0(r,c,e,a)};var k8e=Ve.bind({ignoreUndefined:!0}),O8e={recursive:!1,cidVersion:0,hashAlg:"sha2-256",flush:!0,shardSplitThreshold:1e3};function V0(r){async function e(t,n={}){let i=k8e(O8e,n);Array.isArray(t)||(t=[t]);let s=await Promise.all(t.map(o=>$r(r,o,i)));if(!s.length)throw(0,wg.default)(new Error("Please supply at least one path to remove"),"ERR_INVALID_PARAMS");s.forEach(o=>{if(o.path==="/")throw(0,wg.default)(new Error("Cannot delete root"),"ERR_INVALID_PARAMS")});for(let o of s)await N8e(r,o.path,i)}return z(e)}var N8e=async(r,e,t)=>{let n=await $r(r,e,t),i=await Va(r,n.mfsPath),s=i[i.length-1];i.pop();let o=i[i.length-1];if(!o)throw(0,wg.default)(new Error(`${e} does not exist`),"ERR_NOT_FOUND");if(s.type==="directory"&&!t.recursive)throw(0,wg.default)(new Error(`${e} is a directory, use -r to remove directories`),"ERR_WAS_DIR");let{cid:a}=await eG(r,{parentCid:o.cid,name:s.name,hashAlg:t.hashAlg,cidVersion:t.cidVersion,flush:t.flush,shardSplitThreshold:t.shardSplitThreshold});o.cid=a;let c=await Es(r,i,t);await _s(r,c,t)};var D8e=Ve.bind({ignoreUndefined:!0}),L8e=k("ipfs:mfs:touch"),rG={flush:!0,shardSplitThreshold:1e3,hashAlg:"sha2-256",cidVersion:0,recursive:!1};function B8e(r,e,t){let n=0;return(r.includes("x")||r.includes("X")&&(t||e&1||e&8||e&64))&&(n+=1),r.includes("w")&&(n+=2),r.includes("r")&&(n+=4),n}function U8e(r,e){let t=0;return r.includes("u")&&(t+=e<<6),r.includes("g")&&(t+=e<<3),r.includes("o")&&(t+=e),t}function M8e(r,e,t){return e.includes("t")&&(t+=parseInt("1000",8)),e.includes("s")&&(r.includes("u")&&(t+=parseInt("4000",8)),r.includes("g")&&(t+=parseInt("2000",8))),t}function F8e(r,e,t){e||(e=0);let n=r.match(/^(u?g?o?a?)(-?\+?=?)?(r?w?x?X?s?t?)$/);if(!n)throw new Error(`Invalid file mode: ${r}`);let[,i,s,o]=n;(i==="a"||!i)&&(i="ugo");let a=B8e(o,e,t);return a=U8e(i,a),a=M8e(i,o,a),s==="="?(i.includes("u")&&(e=e&parseInt("7077",8),e=e|a),i.includes("g")&&(e=e&parseInt("7707",8),e=e|a),i.includes("o")&&(e=e&parseInt("7770",8),e=e|a),e):s==="+"?a|e:s==="-"?a^e:e}function nG(r,e){if(r instanceof String||typeof r=="string"){let t=`${r}`;t.match(/^\d+$/g)?r=parseInt(t,8):r=0+t.split(",").reduce((n,i)=>F8e(i,n,e.isDirectory()),e.mode||0)}return r}function iG(r){async function e(t,n,i={}){let s=D8e(rG,i);L8e(`Fetching stats for ${t}`);let{cid:o,mfsDirectory:a,name:c}=await $r(r,t,s);if(o.code!==We)throw(0,z0.default)(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(s.recursive){let R=await _e(async function*(){for await(let O of I6(o,r.repo.blocks)){if(O.type!=="file"&&O.type!=="directory")throw(0,z0.default)(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");O.unixfs.mode=nG(n,O.unixfs);let V=Pn({Data:O.unixfs.marshal(),Links:O.node.Links});yield{path:O.path,content:V}}},O=>y0(O,r.repo.blocks,{...s,pin:!1,dagBuilder:async function*(V,$,Y){for await(let Q of V)yield async function(){let pe=Q.content,re=ze(pe),he=await i5(re,$,Y);if(!pe.Data)throw(0,z0.default)(new Error(`${he} had no data`),"ERR_INVALID_NODE");let H=Ke.unmarshal(pe.Data);return{cid:he,size:re.length,path:Q.path,unixfs:H}}}}),O=>ir(O));if(!R)throw(0,z0.default)(new Error(`Could not chmod ${t}`),"ERR_COULD_NOT_CHMOD");await V0(r)(t,s),await F0(r)(`/ipfs/${R.cid}`,t,s);return}let u=await r.repo.blocks.get(o),f=lt(u);if(!f.Data)throw(0,z0.default)(new Error(`${o} had no data`),"ERR_INVALID_NODE");let h=Ke.unmarshal(f.Data);h.mode=nG(n,h);let p=ze({Data:h.marshal(),Links:f.Links}),d=s.hashAlg||rG.hashAlg,g=await(await r.hashers.getHasher(d)).digest(p),y=T.create(s.cidVersion,We,g);s.flush&&await r.repo.blocks.put(y,p);let w=await Va(r,a),b=w[w.length-1],_=T.decode(b.cid.bytes),v=await r.repo.blocks.get(_),I=lt(v),x=await to(r,{parent:I,name:c,cid:y,size:p.length,flush:s.flush,hashAlg:d,cidVersion:o.version,shardSplitThreshold:1/0});b.cid=x.cid;let A=await Es(r,w,s);await _s(r,A,s)}return z(e)}l();var V8e=Ve.bind({ignoreUndefined:!0}),z8e={};function sG(r){async function e(t,n={}){n=V8e(z8e,n);let{cid:i}=await Yu(r)(t,n);return i}return z(e)}l();var K8e=Ve.bind({ignoreUndefined:!0}),q8e={parents:!1,flush:!0,cidVersion:0,hashAlg:"sha2-256",shardSplitThreshold:1e3};function oG(r){async function e(t,n,i={}){let s=K8e(q8e,i);await F0(r)(t,n,s),await V0(r)(t,{...s,recursive:!0})}return z(e)}l();var GA=S(W(),1);var $8e=Ve.bind({ignoreUndefined:!0}),H8e=k("ipfs:mfs:touch"),aG={flush:!0,shardSplitThreshold:1e3,cidVersion:0,hashAlg:"sha2-256"};function cG(r){async function e(t,n={}){let i=$8e(aG,n);i.mtime=i.mtime||new Date,H8e(`Touching ${t} mtime: ${i.mtime}`);let{cid:s,mfsDirectory:o,name:a,exists:c}=await $r(r,t,i),u=n.hashAlg||aG.hashAlg,f=await r.hashers.getHasher(u),h,p,d=i.cidVersion;if(c){if(s.code!==We)throw(0,GA.default)(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");d=s.version;let I=await r.repo.blocks.get(s),x=lt(I);if(!x.Data)throw(0,GA.default)(new Error(`${t} had no data`),"ERR_INVALID_NODE");let A=Ke.unmarshal(x.Data);A.mtime=i.mtime,h=ze({Data:A.marshal(),Links:x.Links});let R=await f.digest(h);p=T.create(i.cidVersion,We,R),i.flush&&await r.repo.blocks.put(p,h)}else{let I=new Ke({type:"file",mtime:i.mtime});h=ze({Data:I.marshal(),Links:[]});let x=await f.digest(h);p=T.create(i.cidVersion,We,x),i.flush&&await r.repo.blocks.put(p,h)}let m=await Va(r,o),g=m[m.length-1],y=g.cid,w=await r.repo.blocks.get(y),b=lt(w),_=await to(r,{parent:b,name:a,cid:p,size:h.length,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold,hashAlg:i.hashAlg,cidVersion:d});g.cid=_.cid;let v=await Es(r,m,i);await _s(r,v,i)}return z(e)}l();var jA=S(W(),1);var G8e=Ve.bind({ignoreUndefined:!0}),j8e={offset:0,length:1/0};function lG(r){function e(t,n={}){return n=G8e(j8e,n),{[Symbol.asyncIterator]:async function*(){let s=await $r(r,t,n),o=await ei(s.mfsPath,r.repo.blocks);if(o.type!=="file"&&o.type!=="raw")throw(0,jA.default)(new Error(`${t} was not a file or raw bytes`),"ERR_NOT_FILE");if(!o.content)throw(0,jA.default)(new Error(`Could not load content stream from ${t}`),"ERR_NO_CONTENT");for await(let a of o.content({offset:n.offset,length:n.length}))yield a}}}return z(e)}l();l();var WA=S(W(),1);var bg=k("ipfs:mfs:utils:to-async-iterator");function uG(r){if(!r)throw(0,WA.default)(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");if((typeof r=="string"||r instanceof String)&&(bg("Content was a string"),r=U(r.toString())),r.length)return bg("Content was array-like"),{[Symbol.asyncIterator]:function*(){yield r}};if(r[Symbol.asyncIterator])return bg("Content was an async iterator"),r;if(r[Symbol.iterator])return bg("Content was an iterator"),r;if(globalThis.Blob&&r instanceof globalThis.Blob)return bg("Content was an HTML5 Blob"),Wi(r.stream());throw(0,WA.default)(new Error(`Don't know how to convert ${r} into an async iterator`),"ERR_INVALID_PARAMS")}var $a=S(W(),1);var W8e=Ve.bind({ignoreUndefined:!0}),qa=k("ipfs:mfs:write"),Y8e={offset:0,length:1/0,create:!1,truncate:!1,rawLeaves:!1,reduceSingleLeafToSelf:!1,cidVersion:0,hashAlg:"sha2-256",parents:!1,progress:(r,e)=>{},strategy:"trickle",flush:!0,leafType:"raw",shardSplitThreshold:1e3};function hG(r){async function e(t,n,i={}){let s=W8e(Y8e,i),o,a,c;if(qa("Reading source, destination and parent"),await mg().readLock(async()=>{o=await uG(n),a=await $r(r,t,s),c=await $r(r,a.mfsDirectory,s)})(),qa("Read source, destination and parent"),!s.parents&&!c.exists)throw(0,$a.default)(new Error("directory does not exist"),"ERR_NO_EXIST");if(o==null)throw(0,$a.default)(new Error("could not create source"),"ERR_NO_SOURCE");if(a==null)throw(0,$a.default)(new Error("could not create destination"),"ERR_NO_DESTINATION");if(!s.create&&!a.exists)throw(0,$a.default)(new Error("file does not exist"),"ERR_NO_EXIST");if(a.entryType!=="file")throw(0,$a.default)(new Error("not a file"),"ERR_NOT_A_FILE");return Q8e(r,t,o,a,s)}return z(e)}var Q8e=async(r,e,t,n,i)=>{let s=await X8e(r,t,n,i);await mg().writeLock(async()=>{let o=B0(e),a=o.pop();if(a==null)throw(0,$a.default)(new Error("source does not exist"),"ERR_NO_EXIST");let c=!1;try{await Yu(r)(`/${o.join("/")}`,i),c=!0}catch(y){if(y.code!=="ERR_NOT_FOUND")throw y}c||await Xh(r)(`/${o.join("/")}`,i);let u=await $r(r,e,i),f=await Va(r,u.mfsDirectory),h=f[f.length-1];if(!h)throw(0,$a.default)(new Error("directory does not exist"),"ERR_NO_EXIST");if(!h.type||!h.type.includes("directory"))throw(0,$a.default)(new Error(`cannot write to ${h.name}: Not a directory`),"ERR_NOT_A_DIRECTORY");let p=await r.repo.blocks.get(h.cid),d=lt(p),m=await to(r,{parent:d,name:a,cid:s.cid,size:s.size,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold,hashAlg:i.hashAlg,cidVersion:i.cidVersion});h.cid=m.cid;let g=await Es(r,f,i);await _s(r,g,i)})()},X8e=async(r,e,t,n)=>{t.exists?qa(`Overwriting file ${t.cid} offset ${n.offset} length ${n.length}`):qa(`Writing file offset ${n.offset} length ${n.length}`);let i=[];if(n.offset>0)if(t.unixfs){if(qa(`Writing first ${n.offset} bytes of original file`),i.push(()=>t.content({offset:0,length:n.offset})),t.unixfs.fileSize()<n.offset){let f=n.offset-t.unixfs.fileSize();qa(`Writing zeros for extra ${f} bytes`),i.push(fG(f))}}else qa(`Writing zeros for first ${n.offset} bytes`),i.push(fG(n.offset));i.push(dG(e,n.length));let s=J8e(Z8e(i),f=>{if(t.unixfs&&!n.truncate){let h=t.unixfs.fileSize();if(h>f)return qa(`Writing last ${h-f} of ${h} bytes from original file starting at offset ${f}`),t.content({offset:f});qa("Not writing last bytes from original file")}return{[Symbol.asyncIterator]:async function*(){}}}),o;n.mode!==void 0&&n.mode!==null?o=Tc(n.mode):t&&t.unixfs&&(o=t.unixfs.mode);let a;n.mtime!=null?a=au(n.mtime):t&&t.unixfs&&(a=t.unixfs.mtime);let c=await r.hashers.getHasher(n.hashAlg),u=await ir(y0([{content:s,mode:o,mtime:a}],r.repo.blocks,{progress:n.progress,hasher:c,cidVersion:n.cidVersion,strategy:n.strategy,rawLeaves:n.rawLeaves,reduceSingleLeafToSelf:n.reduceSingleLeafToSelf,leafType:n.leafType}));if(!u)throw(0,$a.default)(new Error(`cannot write to ${parent.name}`),"ERR_COULD_NOT_WRITE");return qa(`Wrote ${u.cid}`),{cid:u.cid,size:u.size}},dG=(r,e)=>async function*(){let n=0;for await(let i of r){if(n+=i.length,n>e){yield i.subarray(0,e-n);return}yield i}},fG=(r,e=BB)=>{let t=new Uint8Array(e);async function*n(){for(;;)yield t}return dG(n(),r)},Z8e=async function*(r){for(let e=0;e<r.length;e++)yield*r[e]()},J8e=async function*(r,e){let t=0;for await(let n of r)t+=n.length,yield n;for await(let n of e(t))t+=n.length,yield n};l();var pG=r=>{let e={cid:r.cid,name:r.name,type:r.type==="directory"?"directory":"file",size:r.size};return(r.type==="file"||r.type==="directory")&&(e.mode=r.unixfs.mode,e.mtime=r.unixfs.mtime),e};function mG(r){async function*e(t,n={}){let i=await $r(r,t,n),s=await ei(i.mfsPath,r.repo.blocks);if(s.type==="directory"){yield*Zt(s.content(n),pG);return}yield pG(s)}return z(e)}var ebe={stat:Yu},tbe={chmod:iG,cp:F0,flush:sG,mkdir:Xh,mv:oG,rm:V0,touch:cG},gG={write:hG,read:lG,ls:mG},yG=({options:r,mfs:e,operations:t,lock:n})=>{Object.keys(t).forEach(i=>{e[i]=n(t[i](r))})},rbe={repoOwner:!0,repo:null};function nbe(r){let{repoOwner:e}=Object.assign({},rbe||{},r),t=mg(e),n=o=>t.readLock(o),i=o=>t.writeLock(o),s={};return yG({options:r,mfs:s,operations:ebe,lock:n}),yG({options:r,mfs:s,operations:tbe,lock:i}),Object.keys(gG).forEach(o=>{s[o]=gG[o](r)}),s}function wG({repo:r,preload:e,hashers:t,options:n}){let i=nbe({repo:r,repoOwner:n.repoOwner!==!1,hashers:t}),s=o=>(...c)=>{let u=c.filter(f=>CB(f)||P4(f));if(u.length){let f=c[c.length-1];f&&f.preload!==!1&&u.forEach(h=>e(h))}return o(...c)};return{...i,chmod:i.chmod,cp:s(i.cp),mkdir:i.mkdir,stat:s(i.stat),rm:i.rm,read:s(i.read),touch:i.touch,write:i.write,mv:s(i.mv),flush:i.flush,ls:s(async function*(...o){for await(let a of i.ls(...o))yield{...a,size:a.size||0}})}}l();l();function bG({keychain:r}){return z((t,n)=>r.exportKey(t,n))}l();var EG="Ed25519",_G=2048;function vG({keychain:r}){return z((t,n={type:EG,size:_G})=>r.createKey(t,n.type||EG,n.size||_G))}l();function SG({keychain:r}){return z((t,n,i)=>r.importKey(t,n,i))}l();function xG({keychain:r}){return z(t=>r.findKeyByName(t))}l();function AG({keychain:r}){return z(()=>r.listKeys())}l();function TG({keychain:r}){return z(async(t,n)=>{let i=await r.renameKey(t,n);return{was:t,now:i.name,id:i.id,overwrite:!1}})}l();function IG({keychain:r}){return z(t=>r.removeKey(t))}var l5=class{constructor({keychain:e}){this.gen=vG({keychain:e}),this.list=AG({keychain:e}),this.rm=IG({keychain:e}),this.rename=TG({keychain:e}),this.export=bG({keychain:e}),this.import=SG({keychain:e}),this.info=xG({keychain:e})}};l();l();l();function Qi({repo:r,preload:e}){async function t(n,i={}){i.preload!==!1&&e(n);let s=await r.blocks.get(n,i);return lt(s)}return z(t)}function RG({repo:r,preload:e}){let t=Qi({repo:r,preload:e});async function n(i,s={}){return(await t(i,s)).Data||new Uint8Array(0)}return z(n)}l();function YA(r,e=[]){for(let t in r){let n=r[t];if(t==="/"&&Object.keys(r).length===1)try{e.push({Name:"",Tsize:0,Hash:T.parse(n)});continue}catch{}let i=T.asCID(n);if(i){e.push({Name:"",Tsize:0,Hash:i});continue}Array.isArray(n)&&YA(n,e),n&&typeof n=="object"&&YA(n,e)}return e}function CG({repo:r,codecs:e}){async function t(n,i={}){let s=await e.getCodec(n.code),o=await r.blocks.get(n,i),a=s.decode(o);switch(n.code){case On:return[];case We:return a.Links;case Pm:case i9:return YA(a);default:throw new Error(`Cannot resolve links from codec ${n.code}`)}}return z(t)}l();function PG({repo:r,preload:e}){async function t(n={}){let i;if(n.template)if(n.template==="unixfs-dir")i=new Ke({type:"directory"}).marshal();else throw new Error("unknown template");let s=ze({Data:i,Links:[]}),o=await Le.digest(s),a=T.createV0(o);return await r.blocks.put(a,s,{signal:n.signal}),n.preload!==!1&&e(a),a}return z(t)}l();function Ha({repo:r,preload:e}){async function t(n,i={}){let s=await r.gcLock.readLock();try{let o=ze(n),a=await Le.digest(o),c=T.createV1(We,a);return await r.blocks.put(c,o,{signal:i.signal}),i.preload!==!1&&e(c),i.pin&&await r.pins.pinRecursively(c,{signal:i.signal}),c}finally{s()}}return z(t)}l();function kG({repo:r,preload:e}){let t=Qi({repo:r,preload:e});async function n(i,s={}){let o=await t(i,s),c=ze(o).length,u=o.Links.reduce((f,h)=>f+(h.Tsize||0),0);return{Hash:i,NumLinks:o.Links.length,BlockSize:c,LinksSize:c-(o.Data||[]).length,DataSize:(o.Data||[]).length,CumulativeSize:c+u}}return z(n)}l();l();function OG({repo:r,preload:e}){let t=Qi({repo:r,preload:e}),n=Ha({repo:r,preload:e});async function i(s,o,a={}){let c=await t(s,a);return n({...c,Links:c.Links.concat([o])},a)}return z(i)}l();function NG({repo:r,preload:e}){let t=Qi({repo:r,preload:e}),n=Ha({repo:r,preload:e});async function i(s,o,a={}){let c=await t(s,a),u=Z([c.Data||[],o]);return n({...c,Data:u},a)}return z(i)}l();function DG({repo:r,preload:e}){let t=Qi({repo:r,preload:e}),n=Ha({repo:r,preload:e});async function i(s,o,a={}){let c=await t(s,a),u=(typeof o=="string"?o:o.Name)||"";return c.Links=c.Links.filter(f=>f.Name!==u),n(c,a)}return z(i)}l();function LG({repo:r,preload:e}){let t=Qi({repo:r,preload:e}),n=Ha({repo:r,preload:e});async function i(s,o,a={}){let c=await t(s,a);return n({...c,Data:o},a)}return z(i)}var u5=class{constructor({repo:e,preload:t}){this.addLink=OG({repo:e,preload:t}),this.appendData=NG({repo:e,preload:t}),this.rmLink=DG({repo:e,preload:t}),this.setData=LG({repo:e,preload:t})}};var f5=class{constructor({repo:e,codecs:t,preload:n}){this.data=RG({repo:e,preload:n}),this.get=Qi({repo:e,preload:n}),this.links=CG({repo:e,codecs:t}),this.new=PG({repo:e,preload:n}),this.put=Ha({repo:e,preload:n}),this.stat=kG({repo:e,preload:n}),this.patch=new u5({repo:e,preload:n})}};l();l();var ibe=k("ipfs:repo:gc");function BG({repo:r,hashers:e}){async function*t(n={}){let i=Date.now(),s;try{s=await L0({repo:r,hashers:e},n),await r.pins.pinRecursively(s),yield*r.gc()}finally{s&&await r.pins.unpin(s)}ibe(`Complete (${Date.now()-i}ms)`)}return z(t)}l();function h5({repo:r}){async function e(t={}){let n=await r.stat();return{numObjects:BigInt(n.numObjects.toString()),repoSize:BigInt(n.repoSize.toString()),repoPath:n.repoPath,version:`${n.version}`,storageMax:BigInt(n.storageMax.toString())}}return z(e)}l();l();function UG({repo:r}){async function e(t={}){try{await r._checkInitialized(t)}catch(n){if([/Key not found in database \[\/version\]/,/ENOENT/,/repo is not initialized yet/].some(s=>s.test(n.message)))return 12;throw n}return r.version.get()}return z(e)}var d5=class{constructor({repo:e,hashers:t}){this.gc=BG({repo:e,hashers:t}),this.stat=h5({repo:e}),this.version=UG({repo:e}),this.setApiAddr=n=>e.apiAddr.set(n)}};l();l();var FG=S(W(),1);function MG(r,e){return{totalIn:BigInt(0),totalOut:BigInt(0),rateIn:0,rateOut:0}}function VG({network:r}){return z(async function*(t={}){let{libp2p:n}=await r.use(t);if(!t.poll){yield MG(n,t);return}let i=t.interval||1e3,s=-1;try{if(s=typeof i=="string"?fu(i)||-1:i,!s||s<0)throw new Error("invalid duration")}catch(a){throw(0,FG.default)(a,"ERR_INVALID_POLL_INTERVAL")}let o;try{for(;;)yield MG(n,t),await new Promise(a=>{o=setTimeout(a,s)})}finally{clearTimeout(o)}})}var p5=class{constructor({repo:e,network:t}){this.repo=h5({repo:e}),this.bw=VG({network:t}),this.bitswap=i6({network:t})}};l();l();l();l();var _g=obe;function obe(r,e,t){if(!r)return t;var n,i;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");for(;n.length;)if(i=n.shift(),!r||(r=r[i],r===void 0))return t;return r}var SW=S(Us(),1),cd=S(W(),1);l();l();l();l();var nl="/",zG=new TextEncoder().encode(nl),m5=zG[0],Gt=class{constructor(e,t){if(typeof e=="string")this._buf=U(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==m5)throw new Error("Invalid key")}toString(e="utf8"){return C(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Gt(e.join(nl))}static random(){return new Gt(Tr().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Gt(e):typeof e.uint8Array=="function"?new Gt(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=zG),this._buf[0]!==m5){let e=new Uint8Array(this._buf.byteLength+1);e.fill(m5,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===m5;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return Gt.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(nl).slice(1)}type(){return abe(this.baseNamespace())}name(){return cbe(this.baseNamespace())}instance(e){return new Gt(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(nl)||(e+=nl),e+=this.type(),new Gt(e)}parent(){let e=this.list();return e.length===1?new Gt(nl):new Gt(e.slice(0,-1).join(nl))}child(e){return this.toString()===nl?e:e.toString()===nl?this:new Gt(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Gt.withNamespaces([...this.namespaces(),...lbe(e.map(t=>t.namespaces()))])}};function abe(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function cbe(r){let e=r.split(":");return e[e.length-1]}function lbe(r){return[].concat(...r)}var qG=S(Us(),1);l();async function qo(r){let e=0;for await(let t of r)e++;return e}var ube=(0,qG.default)("ipfs:repo:migrator:migration-8");function $G(r){return r.child?$G(r.child):r}function fbe(r){try{let e=De.decode(`b${r.toString().toLowerCase().slice(1)}`),t=T.decode(e).multihash.bytes,n=De.encode(t).slice(1).toUpperCase();return new Gt(`/${n}`,!1)}catch{return r}}function hbe(r){try{let e=De.decode(`b${r.toString().toLowerCase().slice(1)}`),t=Ze(e),n=De.encode(T.createV1(On,t).bytes).slice(1);return new Gt(`/${n.toUpperCase()}`,!1)}catch{return r}}async function KG(r,e,t){let n=r.blocks;await n.open();let i=$G(n),s=await qo(i.queryKeys({filters:[o=>t(o).toString()!==o.toString()]}));try{let o=0;for await(let a of i.query({})){let c=t(a.key);c.toString()!==a.key.toString()&&(o+=1,ube(`Migrating Block from ${a.key} to ${c}`,await i.has(a.key)),await i.delete(a.key),await i.put(c,a.value),e(o/s*100,`Migrated Block from ${a.key} to ${c}`))}}finally{await n.close()}}var HG={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:(r,e=()=>{})=>KG(r,e,fbe),revert:(r,e=()=>{})=>KG(r,e,hbe)};l();l();l();var ed=S(rf(),1),vj=ed.default.Reader,Ebe=ed.default.Writer,Eht=ed.default.util,w5=ed.default.roots.default||(ed.default.roots.default={}),Sj=w5.ipfs=(()=>{let r={};return r.pin=function(){let e={};return e.Set=function(){function t(n){if(n)for(var i=Object.keys(n),s=0;s<i.length;++s)n[i[s]]!=null&&(this[i[s]]=n[i[s]])}return t.prototype.version=0,t.prototype.fanout=0,t.prototype.seed=0,t.encode=function(i,s){return s||(s=Ebe.create()),i.version!=null&&Object.hasOwnProperty.call(i,"version")&&s.uint32(8).uint32(i.version),i.fanout!=null&&Object.hasOwnProperty.call(i,"fanout")&&s.uint32(16).uint32(i.fanout),i.seed!=null&&Object.hasOwnProperty.call(i,"seed")&&s.uint32(29).fixed32(i.seed),s},t.decode=function(i,s){i instanceof vj||(i=vj.create(i));for(var o=s===void 0?i.len:i.pos+s,a=new w5.ipfs.pin.Set;i.pos<o;){var c=i.uint32();switch(c>>>3){case 1:a.version=i.uint32();break;case 2:a.fanout=i.uint32();break;case 3:a.seed=i.fixed32();break;default:i.skipType(c&7);break}}return a},t.fromObject=function(i){if(i instanceof w5.ipfs.pin.Set)return i;var s=new w5.ipfs.pin.Set;return i.version!=null&&(s.version=i.version>>>0),i.fanout!=null&&(s.fanout=i.fanout>>>0),i.seed!=null&&(s.seed=i.seed>>>0),s},t.toObject=function(i,s){s||(s={});var o={};return s.defaults&&(o.version=0,o.fanout=0,o.seed=0),i.version!=null&&i.hasOwnProperty("version")&&(o.version=i.version),i.fanout!=null&&i.hasOwnProperty("fanout")&&(o.fanout=i.fanout),i.seed!=null&&i.hasOwnProperty("seed")&&(o.seed=i.seed),o},t.prototype.toJSON=function(){return this.constructor.toObject(this,ed.default.util.toJSONOptions)},t}(),e}(),r})();var Ij=S(Aj(),1),_5=S(ur(),1);l();var Ag=new Gt("/local/pins"),E5=256,Tj=8192,lT=T.parse("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),td={direct:"direct",recursive:"recursive"};function uT(r){return new Gt(`/${De.encode(r.multihash.bytes).toUpperCase().substring(1)}`)}var fT=Sj.pin.Set;function _be(r){let e=r.Data;if(!e)throw new Error("No data present");let t=_5.default.decode(e),n=_5.default.decode.bytes??0;if(n<=0)throw new Error("Invalid Set header length");if(n+t>e.length)throw new Error("Impossibly large set header length");let i=e.slice(n,t+n),s=fT.toObject(fT.decode(i),{defaults:!1,arrays:!0,longs:Number,objects:!1});if(s.version!==1)throw new Error(`Unsupported Set version: ${s.version}`);if(s.fanout>r.Links.length)throw new Error("Impossibly large fanout");return{header:s,data:e.slice(t+n)}}function vbe(r,e){let t=new Uint8Array(4);new DataView(t.buffer).setUint32(0,r,!0);let i=U(e.toString()),s=Z([t,i],t.byteLength+i.byteLength);return(0,Ij.default)(C(s))}async function*Rj(r,e){let t=_be(e),n=0;for(let i of e.Links){if(n<t.header.fanout){let s=i.Hash;if(!lT.equals(s)){let o=await r.get(s),a=lt(o);yield*Rj(r,a)}}else yield i.Hash;n++}}async function*Tg(r,e,t){let n=e.Links.find(o=>o.Name===t);if(!n)throw new Error("No link found with name "+t);let i=await r.get(n.Hash),s=lt(i);yield*Rj(r,s)}function Sbe(r,e){return t(e,0);async function t(n,i){let s=fT.encode({version:1,fanout:E5,seed:i}).finish(),o=_5.default.encode(s.length),a=Z([o,s]),c=[];for(let f=0;f<E5;f++)c.push({Name:"",Tsize:1,Hash:lT});if(n.length<=Tj){let f=n.map(d=>({link:{Name:"",Tsize:1,Hash:d.key},data:d.data||new Uint8Array})).sort((d,m)=>Lh(d.link.Hash.bytes,m.link.Hash.bytes)),h=c.concat(f.map(d=>d.link));return{Data:Z([a,...f.map(d=>d.data)]),Links:h}}else{let f=n.reduce((p,d)=>{let m=vbe(i,d.key)%E5;return p[m]=m in p?p[m].concat([d]):[d],p},[]),h=0;for(let p of f){let d=await t(p,i+1);await u(d,h),h++}return{Data:a,Links:c}}async function u(f,h){let p=ze(f),d=await Le.digest(p),m=T.createV0(d);await r.put(m,p);let g=f.Links.reduce((y,w)=>y+(w.Tsize||0),0)+p.length;c[h]={Name:"",Tsize:g,Hash:m}}}}async function hT(r,e,t){let n=await Sbe(r,t.map(c=>({key:c}))),i=ze(n),s=await Le.digest(i),o=T.createV0(s);await r.put(o,i);let a=n.Links.reduce((c,u)=>c+u.Tsize,0)+i.length;return{Name:e,Tsize:a,Hash:o}}async function Abe(r,e,t,n){if(!await e.has(Ag))return;let i=await e.get(Ag),s=T.decode(i),o=await r.get(s),a=lt(o),c=0,u=await qo(Tg(r,a,td.recursive))+await qo(Tg(r,a,td.direct));for await(let f of Tg(r,a,td.recursive)){c++;let h={depth:1/0};f.version!==0&&(h.version=f.version),f.code!==We&&(h.codec=f.code),await t.put(uT(f),To(h)),n(c/u*100,`Migrated recursive pin ${f}`)}for await(let f of Tg(r,a,td.direct)){c++;let h={depth:0};f.version!==0&&(h.version=f.version),f.code!==We&&(h.codec=f.code),await t.put(uT(f),To(h)),n(c/u*100,`Migrated direct pin ${f}`)}await r.delete(s),await e.delete(Ag)}async function Tbe(r,e,t,n){let i=[],s=[],o=0,a=await qo(t.queryKeys({}));for await(let{key:p,value:d}of t.query({})){o++;let m=di(d),g=T.create(m.version||0,m.codec||We,Ze(De.decode("b"+p.toString().toLowerCase().split("/").pop())));m.depth===0?(n(o/a*100,`Reverted direct pin ${g}`),s.push(g)):(n(o/a*100,`Reverted recursive pin ${g}`),i.push(g))}n(100,"Updating pin root");let c={Links:[await hT(r,td.direct,s),await hT(r,td.recursive,i)]},u=ze(c),f=await Le.digest(u),h=T.createV0(f);await r.put(h,u),await e.put(Ag,h.bytes)}async function Cj(r,e,t){let n=r.blocks,i=r.datastore,s=r.pins;await n.open(),await i.open(),await s.open();try{await t(n,i,s,e)}finally{await s.close(),await i.close(),await n.close()}}var Pj={version:9,description:"Migrates pins to datastore",migrate:(r,e=()=>{})=>Cj(r,e,Abe),revert:(r,e=()=>{})=>Cj(r,e,Tbe)};l();l();var kj=new Gt("/config"),Ig=new Gt("/version");function Rg(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}async function Ibe(r,e,t){let n=await e(r);if(n)return n;let i=Rg(t);return i?new Promise((s,o)=>{let a=i.store("readonly").get(r.toString());a.transaction.onabort=()=>{o(a.transaction.error)},a.transaction.oncomplete=()=>{s(Boolean(a.result))}}):!1}async function Rbe(r,e,t,n){if(await t(r))return e(r);let i=Rg(n);if(!i)throw vn();return new Promise((s,o)=>{let a=i.store("readonly").get(r.toString());a.transaction.onabort=()=>{o(a.transaction.error)},a.transaction.oncomplete=()=>{if(a.result)return s(a.result);o(vn())}})}function v5(r){let e=r.get.bind(r),t=r.has.bind(r);return r.get=n=>Rbe(n,e,t,r),r.has=n=>Ibe(n,t,r),r}function dT(r){return{...r,root:v5(r.root),datastore:v5(r.datastore),pins:v5(r.pins),keys:v5(r.keys)}}async function Cbe(r,e,t=()=>{}){let n=Rg(e);if(!n){t(`${r} did not need an upgrade`);return}t(`Upgrading ${r}`),await Lj(n,(s,o)=>[{type:"del",key:s},{type:"put",key:U(s),value:o}])}async function Pbe(r,e,t=()=>{}){let n=Rg(e);if(!n){t(`${r} did not need a downgrade`);return}t(`Downgrading ${r}`),await Lj(n,(s,o)=>[{type:"del",key:s},{type:"put",key:C(s),value:o}])}function Nj(r){return r.child?Nj(r.child):r}async function Oj(r,e,t){let n=Object.entries(r).map(([o,a])=>({key:o,backend:Nj(a)})).filter(({key:o,backend:a})=>a.constructor.name==="LevelDatastore").map(({key:o,backend:a})=>({name:o,store:a}));e(0,`Migrating ${n.length} dbs`);let i=0,s=o=>{e(Math.round(i/n.length*100),o)};for(let{name:o,store:a}of n){await a.open();try{await t(o,a,s)}finally{i++,await a.close()}}e(100,`Migrated ${n.length} dbs`)}var Dj={version:10,description:"Migrates datastore-level keys to binary",migrate:(r,e=()=>{})=>Oj(r,e,Cbe),revert:(r,e=()=>{})=>Oj(r,e,Pbe)};function Lj(r,e){function t(n,i){let s=r.store("readwrite"),o=s.transaction,a=0,c;o.onabort=()=>i(c||o.error||new Error("aborted by user")),o.oncomplete=()=>i();function u(){let f=n[a++],h=f.key,p;try{p=f.type==="del"?s.delete(h):s.put(f.value,h)}catch(d){c=d,o.abort();return}a<n.length&&(p.onsuccess=u)}u()}return new Promise((n,i)=>{let s=r.iterator(),o=c=>c;s._deserializeKey=s._deserializeValue=o,a();function a(){let c=(u,f,h)=>{if(u||f===void 0){let p=d=>{if(d){i(d);return}n()};s.end(p);return}t(e(f,h),a)};s.next(c)}})}l();var nf=new Gt("/local/filesroot");async function kbe(r,e=()=>{}){if(e(100,"Migrating MFS root to repo datastore"),await r.root.open(),await r.datastore.open(),await r.root.has(nf)){let t=await r.root.get(nf);await r.datastore.put(nf,t),await r.root.delete(nf)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo datastore")}async function Obe(r,e=()=>{}){if(e(100,"Migrating MFS root to repo root datastore"),await r.root.open(),await r.datastore.open(),await r.datastore.has(nf)){let t=await r.datastore.get(nf);await r.root.put(nf,t),await r.datastore.delete(nf)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo root datastore")}var Bj={version:11,description:"Store mfs root in the datastore",migrate:kbe,revert:Obe};l();var bT=S(rf(),1);l();var rd=S(rf(),1),Uj=rd.default.Reader,Nbe=rd.default.Writer,Dbe=rd.default.util,S5=rd.default.roots.default||(rd.default.roots.default={}),pT=S5.Protocols=(()=>{function r(e){if(this.protocols=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.protocols=Dbe.emptyArray,r.encode=function(t,n){if(n||(n=Nbe.create()),t.protocols!=null&&t.protocols.length)for(var i=0;i<t.protocols.length;++i)n.uint32(10).string(t.protocols[i]);return n},r.decode=function(t,n){t instanceof Uj||(t=Uj.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new S5.Protocols;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.protocols&&s.protocols.length||(s.protocols=[]),s.protocols.push(t.string());break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof S5.Protocols)return t;var n=new S5.Protocols;if(t.protocols){if(!Array.isArray(t.protocols))throw TypeError(".Protocols.protocols: array expected");n.protocols=[];for(var i=0;i<t.protocols.length;++i)n.protocols[i]=String(t.protocols[i])}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.protocols=[]),t.protocols&&t.protocols.length){i.protocols=[];for(var s=0;s<t.protocols.length;++s)i.protocols[s]=t.protocols[s]}return i},r.prototype.toJSON=function(){return this.constructor.toObject(this,rd.default.util.toJSONOptions)},r})();l();var il=S(rf(),1),K0=il.default.Reader,mT=il.default.Writer,kr=il.default.util,Kn=il.default.roots.default||(il.default.roots.default={}),gT=Kn.Addresses=(()=>{function r(e){if(this.addrs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.addrs=kr.emptyArray,r.prototype.certifiedRecord=null,r.encode=function(t,n){if(n||(n=mT.create()),t.addrs!=null&&t.addrs.length)for(var i=0;i<t.addrs.length;++i)Kn.Addresses.Address.encode(t.addrs[i],n.uint32(10).fork()).ldelim();return t.certifiedRecord!=null&&Object.hasOwnProperty.call(t,"certifiedRecord")&&Kn.Addresses.CertifiedRecord.encode(t.certifiedRecord,n.uint32(18).fork()).ldelim(),n},r.decode=function(t,n){t instanceof K0||(t=K0.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new Kn.Addresses;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.addrs&&s.addrs.length||(s.addrs=[]),s.addrs.push(Kn.Addresses.Address.decode(t,t.uint32()));break;case 2:s.certifiedRecord=Kn.Addresses.CertifiedRecord.decode(t,t.uint32());break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof Kn.Addresses)return t;var n=new Kn.Addresses;if(t.addrs){if(!Array.isArray(t.addrs))throw TypeError(".Addresses.addrs: array expected");n.addrs=[];for(var i=0;i<t.addrs.length;++i){if(typeof t.addrs[i]!="object")throw TypeError(".Addresses.addrs: object expected");n.addrs[i]=Kn.Addresses.Address.fromObject(t.addrs[i])}}if(t.certifiedRecord!=null){if(typeof t.certifiedRecord!="object")throw TypeError(".Addresses.certifiedRecord: object expected");n.certifiedRecord=Kn.Addresses.CertifiedRecord.fromObject(t.certifiedRecord)}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.addrs=[]),n.defaults&&(i.certifiedRecord=null),t.addrs&&t.addrs.length){i.addrs=[];for(var s=0;s<t.addrs.length;++s)i.addrs[s]=Kn.Addresses.Address.toObject(t.addrs[s],n)}return t.certifiedRecord!=null&&t.hasOwnProperty("certifiedRecord")&&(i.certifiedRecord=Kn.Addresses.CertifiedRecord.toObject(t.certifiedRecord,n)),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,il.default.util.toJSONOptions)},r.Address=function(){function e(n){if(n)for(var i=Object.keys(n),s=0;s<i.length;++s)n[i[s]]!=null&&(this[i[s]]=n[i[s]])}e.prototype.multiaddr=kr.newBuffer([]),e.prototype.isCertified=null;let t;return Object.defineProperty(e.prototype,"_isCertified",{get:kr.oneOfGetter(t=["isCertified"]),set:kr.oneOfSetter(t)}),e.encode=function(i,s){return s||(s=mT.create()),i.multiaddr!=null&&Object.hasOwnProperty.call(i,"multiaddr")&&s.uint32(10).bytes(i.multiaddr),i.isCertified!=null&&Object.hasOwnProperty.call(i,"isCertified")&&s.uint32(16).bool(i.isCertified),s},e.decode=function(i,s){i instanceof K0||(i=K0.create(i));for(var o=s===void 0?i.len:i.pos+s,a=new Kn.Addresses.Address;i.pos<o;){var c=i.uint32();switch(c>>>3){case 1:a.multiaddr=i.bytes();break;case 2:a.isCertified=i.bool();break;default:i.skipType(c&7);break}}return a},e.fromObject=function(i){if(i instanceof Kn.Addresses.Address)return i;var s=new Kn.Addresses.Address;return i.multiaddr!=null&&(typeof i.multiaddr=="string"?kr.base64.decode(i.multiaddr,s.multiaddr=kr.newBuffer(kr.base64.length(i.multiaddr)),0):i.multiaddr.length&&(s.multiaddr=i.multiaddr)),i.isCertified!=null&&(s.isCertified=Boolean(i.isCertified)),s},e.toObject=function(i,s){s||(s={});var o={};return s.defaults&&(s.bytes===String?o.multiaddr="":(o.multiaddr=[],s.bytes!==Array&&(o.multiaddr=kr.newBuffer(o.multiaddr)))),i.multiaddr!=null&&i.hasOwnProperty("multiaddr")&&(o.multiaddr=s.bytes===String?kr.base64.encode(i.multiaddr,0,i.multiaddr.length):s.bytes===Array?Array.prototype.slice.call(i.multiaddr):i.multiaddr),i.isCertified!=null&&i.hasOwnProperty("isCertified")&&(o.isCertified=i.isCertified,s.oneofs&&(o._isCertified="isCertified")),o},e.prototype.toJSON=function(){return this.constructor.toObject(this,il.default.util.toJSONOptions)},e}(),r.CertifiedRecord=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.seq=kr.Long?kr.Long.fromBits(0,0,!0):0,e.prototype.raw=kr.newBuffer([]),e.encode=function(n,i){return i||(i=mT.create()),n.seq!=null&&Object.hasOwnProperty.call(n,"seq")&&i.uint32(8).uint64(n.seq),n.raw!=null&&Object.hasOwnProperty.call(n,"raw")&&i.uint32(18).bytes(n.raw),i},e.decode=function(n,i){n instanceof K0||(n=K0.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new Kn.Addresses.CertifiedRecord;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.seq=n.uint64();break;case 2:o.raw=n.bytes();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof Kn.Addresses.CertifiedRecord)return n;var i=new Kn.Addresses.CertifiedRecord;return n.seq!=null&&(kr.Long?(i.seq=kr.Long.fromValue(n.seq)).unsigned=!0:typeof n.seq=="string"?i.seq=parseInt(n.seq,10):typeof n.seq=="number"?i.seq=n.seq:typeof n.seq=="object"&&(i.seq=new kr.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0))),n.raw!=null&&(typeof n.raw=="string"?kr.base64.decode(n.raw,i.raw=kr.newBuffer(kr.base64.length(n.raw)),0):n.raw.length&&(i.raw=n.raw)),i},e.toObject=function(n,i){i||(i={});var s={};if(i.defaults){if(kr.Long){var o=new kr.Long(0,0,!0);s.seq=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else s.seq=i.longs===String?"0":0;i.bytes===String?s.raw="":(s.raw=[],i.bytes!==Array&&(s.raw=kr.newBuffer(s.raw)))}return n.seq!=null&&n.hasOwnProperty("seq")&&(typeof n.seq=="number"?s.seq=i.longs===String?String(n.seq):n.seq:s.seq=i.longs===String?kr.Long.prototype.toString.call(n.seq):i.longs===Number?new kr.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0):n.seq),n.raw!=null&&n.hasOwnProperty("raw")&&(s.raw=i.bytes===String?kr.base64.encode(n.raw,0,n.raw.length):i.bytes===Array?Array.prototype.slice.call(n.raw):n.raw),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,il.default.util.toJSONOptions)},e}(),r})();l();var sl=S(rf(),1),q0=sl.default.Reader,yT=sl.default.Writer,Jt=sl.default.util,dn=sl.default.roots.default||(sl.default.roots.default={}),wT=dn.Peer=(()=>{function r(t){if(this.addresses=[],this.protocols=[],this.metadata=[],t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}r.prototype.addresses=Jt.emptyArray,r.prototype.protocols=Jt.emptyArray,r.prototype.metadata=Jt.emptyArray,r.prototype.pubKey=null,r.prototype.peerRecordEnvelope=null;let e;return Object.defineProperty(r.prototype,"_pubKey",{get:Jt.oneOfGetter(e=["pubKey"]),set:Jt.oneOfSetter(e)}),Object.defineProperty(r.prototype,"_peerRecordEnvelope",{get:Jt.oneOfGetter(e=["peerRecordEnvelope"]),set:Jt.oneOfSetter(e)}),r.encode=function(n,i){if(i||(i=yT.create()),n.addresses!=null&&n.addresses.length)for(var s=0;s<n.addresses.length;++s)dn.Address.encode(n.addresses[s],i.uint32(10).fork()).ldelim();if(n.protocols!=null&&n.protocols.length)for(var s=0;s<n.protocols.length;++s)i.uint32(18).string(n.protocols[s]);if(n.metadata!=null&&n.metadata.length)for(var s=0;s<n.metadata.length;++s)dn.Metadata.encode(n.metadata[s],i.uint32(26).fork()).ldelim();return n.pubKey!=null&&Object.hasOwnProperty.call(n,"pubKey")&&i.uint32(34).bytes(n.pubKey),n.peerRecordEnvelope!=null&&Object.hasOwnProperty.call(n,"peerRecordEnvelope")&&i.uint32(42).bytes(n.peerRecordEnvelope),i},r.decode=function(n,i){n instanceof q0||(n=q0.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new dn.Peer;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.addresses&&o.addresses.length||(o.addresses=[]),o.addresses.push(dn.Address.decode(n,n.uint32()));break;case 2:o.protocols&&o.protocols.length||(o.protocols=[]),o.protocols.push(n.string());break;case 3:o.metadata&&o.metadata.length||(o.metadata=[]),o.metadata.push(dn.Metadata.decode(n,n.uint32()));break;case 4:o.pubKey=n.bytes();break;case 5:o.peerRecordEnvelope=n.bytes();break;default:n.skipType(a&7);break}}return o},r.fromObject=function(n){if(n instanceof dn.Peer)return n;var i=new dn.Peer;if(n.addresses){if(!Array.isArray(n.addresses))throw TypeError(".Peer.addresses: array expected");i.addresses=[];for(var s=0;s<n.addresses.length;++s){if(typeof n.addresses[s]!="object")throw TypeError(".Peer.addresses: object expected");i.addresses[s]=dn.Address.fromObject(n.addresses[s])}}if(n.protocols){if(!Array.isArray(n.protocols))throw TypeError(".Peer.protocols: array expected");i.protocols=[];for(var s=0;s<n.protocols.length;++s)i.protocols[s]=String(n.protocols[s])}if(n.metadata){if(!Array.isArray(n.metadata))throw TypeError(".Peer.metadata: array expected");i.metadata=[];for(var s=0;s<n.metadata.length;++s){if(typeof n.metadata[s]!="object")throw TypeError(".Peer.metadata: object expected");i.metadata[s]=dn.Metadata.fromObject(n.metadata[s])}}return n.pubKey!=null&&(typeof n.pubKey=="string"?Jt.base64.decode(n.pubKey,i.pubKey=Jt.newBuffer(Jt.base64.length(n.pubKey)),0):n.pubKey.length&&(i.pubKey=n.pubKey)),n.peerRecordEnvelope!=null&&(typeof n.peerRecordEnvelope=="string"?Jt.base64.decode(n.peerRecordEnvelope,i.peerRecordEnvelope=Jt.newBuffer(Jt.base64.length(n.peerRecordEnvelope)),0):n.peerRecordEnvelope.length&&(i.peerRecordEnvelope=n.peerRecordEnvelope)),i},r.toObject=function(n,i){i||(i={});var s={};if((i.arrays||i.defaults)&&(s.addresses=[],s.protocols=[],s.metadata=[]),n.addresses&&n.addresses.length){s.addresses=[];for(var o=0;o<n.addresses.length;++o)s.addresses[o]=dn.Address.toObject(n.addresses[o],i)}if(n.protocols&&n.protocols.length){s.protocols=[];for(var o=0;o<n.protocols.length;++o)s.protocols[o]=n.protocols[o]}if(n.metadata&&n.metadata.length){s.metadata=[];for(var o=0;o<n.metadata.length;++o)s.metadata[o]=dn.Metadata.toObject(n.metadata[o],i)}return n.pubKey!=null&&n.hasOwnProperty("pubKey")&&(s.pubKey=i.bytes===String?Jt.base64.encode(n.pubKey,0,n.pubKey.length):i.bytes===Array?Array.prototype.slice.call(n.pubKey):n.pubKey,i.oneofs&&(s._pubKey="pubKey")),n.peerRecordEnvelope!=null&&n.hasOwnProperty("peerRecordEnvelope")&&(s.peerRecordEnvelope=i.bytes===String?Jt.base64.encode(n.peerRecordEnvelope,0,n.peerRecordEnvelope.length):i.bytes===Array?Array.prototype.slice.call(n.peerRecordEnvelope):n.peerRecordEnvelope,i.oneofs&&(s._peerRecordEnvelope="peerRecordEnvelope")),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,sl.default.util.toJSONOptions)},r})(),adt=dn.Address=(()=>{function r(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}r.prototype.multiaddr=Jt.newBuffer([]),r.prototype.isCertified=null;let e;return Object.defineProperty(r.prototype,"_isCertified",{get:Jt.oneOfGetter(e=["isCertified"]),set:Jt.oneOfSetter(e)}),r.encode=function(n,i){return i||(i=yT.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&i.uint32(10).bytes(n.multiaddr),n.isCertified!=null&&Object.hasOwnProperty.call(n,"isCertified")&&i.uint32(16).bool(n.isCertified),i},r.decode=function(n,i){n instanceof q0||(n=q0.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new dn.Address;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.multiaddr=n.bytes();break;case 2:o.isCertified=n.bool();break;default:n.skipType(a&7);break}}return o},r.fromObject=function(n){if(n instanceof dn.Address)return n;var i=new dn.Address;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?Jt.base64.decode(n.multiaddr,i.multiaddr=Jt.newBuffer(Jt.base64.length(n.multiaddr)),0):n.multiaddr.length&&(i.multiaddr=n.multiaddr)),n.isCertified!=null&&(i.isCertified=Boolean(n.isCertified)),i},r.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.multiaddr="":(s.multiaddr=[],i.bytes!==Array&&(s.multiaddr=Jt.newBuffer(s.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(s.multiaddr=i.bytes===String?Jt.base64.encode(n.multiaddr,0,n.multiaddr.length):i.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),n.isCertified!=null&&n.hasOwnProperty("isCertified")&&(s.isCertified=n.isCertified,i.oneofs&&(s._isCertified="isCertified")),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,sl.default.util.toJSONOptions)},r})(),cdt=dn.Metadata=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.key="",r.prototype.value=Jt.newBuffer([]),r.encode=function(t,n){return n||(n=yT.create()),t.key!=null&&Object.hasOwnProperty.call(t,"key")&&n.uint32(10).string(t.key),t.value!=null&&Object.hasOwnProperty.call(t,"value")&&n.uint32(18).bytes(t.value),n},r.decode=function(t,n){t instanceof q0||(t=q0.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new dn.Metadata;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.key=t.string();break;case 2:s.value=t.bytes();break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof dn.Metadata)return t;var n=new dn.Metadata;return t.key!=null&&(n.key=String(t.key)),t.value!=null&&(typeof t.value=="string"?Jt.base64.decode(t.value,n.value=Jt.newBuffer(Jt.base64.length(t.value)),0):t.value.length&&(n.value=t.value)),n},r.toObject=function(t,n){n||(n={});var i={};return n.defaults&&(i.key="",n.bytes===String?i.value="":(i.value=[],n.bytes!==Array&&(i.value=Jt.newBuffer(i.value)))),t.key!=null&&t.hasOwnProperty("key")&&(i.key=t.key),t.value!=null&&t.hasOwnProperty("value")&&(i.value=n.bytes===String?Jt.base64.encode(t.value,0,t.value.length):n.bytes===Array?Array.prototype.slice.call(t.value):t.value),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,sl.default.util.toJSONOptions)},r})();l();var nd=S(rf(),1),Mj=nd.default.Reader,Lbe=nd.default.Writer,Or=nd.default.util,x5=nd.default.roots.default||(nd.default.roots.default={}),Fj=x5.Envelope=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.publicKey=Or.newBuffer([]),r.prototype.payloadType=Or.newBuffer([]),r.prototype.payload=Or.newBuffer([]),r.prototype.signature=Or.newBuffer([]),r.encode=function(t,n){return n||(n=Lbe.create()),t.publicKey!=null&&Object.hasOwnProperty.call(t,"publicKey")&&n.uint32(10).bytes(t.publicKey),t.payloadType!=null&&Object.hasOwnProperty.call(t,"payloadType")&&n.uint32(18).bytes(t.payloadType),t.payload!=null&&Object.hasOwnProperty.call(t,"payload")&&n.uint32(26).bytes(t.payload),t.signature!=null&&Object.hasOwnProperty.call(t,"signature")&&n.uint32(42).bytes(t.signature),n},r.decode=function(t,n){t instanceof Mj||(t=Mj.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new x5.Envelope;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.publicKey=t.bytes();break;case 2:s.payloadType=t.bytes();break;case 3:s.payload=t.bytes();break;case 5:s.signature=t.bytes();break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof x5.Envelope)return t;var n=new x5.Envelope;return t.publicKey!=null&&(typeof t.publicKey=="string"?Or.base64.decode(t.publicKey,n.publicKey=Or.newBuffer(Or.base64.length(t.publicKey)),0):t.publicKey.length&&(n.publicKey=t.publicKey)),t.payloadType!=null&&(typeof t.payloadType=="string"?Or.base64.decode(t.payloadType,n.payloadType=Or.newBuffer(Or.base64.length(t.payloadType)),0):t.payloadType.length&&(n.payloadType=t.payloadType)),t.payload!=null&&(typeof t.payload=="string"?Or.base64.decode(t.payload,n.payload=Or.newBuffer(Or.base64.length(t.payload)),0):t.payload.length&&(n.payload=t.payload)),t.signature!=null&&(typeof t.signature=="string"?Or.base64.decode(t.signature,n.signature=Or.newBuffer(Or.base64.length(t.signature)),0):t.signature.length&&(n.signature=t.signature)),n},r.toObject=function(t,n){n||(n={});var i={};return n.defaults&&(n.bytes===String?i.publicKey="":(i.publicKey=[],n.bytes!==Array&&(i.publicKey=Or.newBuffer(i.publicKey))),n.bytes===String?i.payloadType="":(i.payloadType=[],n.bytes!==Array&&(i.payloadType=Or.newBuffer(i.payloadType))),n.bytes===String?i.payload="":(i.payload=[],n.bytes!==Array&&(i.payload=Or.newBuffer(i.payload))),n.bytes===String?i.signature="":(i.signature=[],n.bytes!==Array&&(i.signature=Or.newBuffer(i.signature)))),t.publicKey!=null&&t.hasOwnProperty("publicKey")&&(i.publicKey=n.bytes===String?Or.base64.encode(t.publicKey,0,t.publicKey.length):n.bytes===Array?Array.prototype.slice.call(t.publicKey):t.publicKey),t.payloadType!=null&&t.hasOwnProperty("payloadType")&&(i.payloadType=n.bytes===String?Or.base64.encode(t.payloadType,0,t.payloadType.length):n.bytes===Array?Array.prototype.slice.call(t.payloadType):t.payloadType),t.payload!=null&&t.hasOwnProperty("payload")&&(i.payload=n.bytes===String?Or.base64.encode(t.payload,0,t.payload.length):n.bytes===Array?Array.prototype.slice.call(t.payload):t.payload),t.signature!=null&&t.hasOwnProperty("signature")&&(i.signature=n.bytes===String?Or.base64.encode(t.signature,0,t.signature.length):n.bytes===Array?Array.prototype.slice.call(t.signature):t.signature),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,nd.default.util.toJSONOptions)},r})();l();var sf=S(rf(),1),A5=sf.default.Reader,Vj=sf.default.Writer,Hr=sf.default.util,Ho=sf.default.roots.default||(sf.default.roots.default={}),zj=Ho.PeerRecord=(()=>{function r(e){if(this.addresses=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.peerId=Hr.newBuffer([]),r.prototype.seq=Hr.Long?Hr.Long.fromBits(0,0,!0):0,r.prototype.addresses=Hr.emptyArray,r.encode=function(t,n){if(n||(n=Vj.create()),t.peerId!=null&&Object.hasOwnProperty.call(t,"peerId")&&n.uint32(10).bytes(t.peerId),t.seq!=null&&Object.hasOwnProperty.call(t,"seq")&&n.uint32(16).uint64(t.seq),t.addresses!=null&&t.addresses.length)for(var i=0;i<t.addresses.length;++i)Ho.PeerRecord.AddressInfo.encode(t.addresses[i],n.uint32(26).fork()).ldelim();return n},r.decode=function(t,n){t instanceof A5||(t=A5.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new Ho.PeerRecord;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.peerId=t.bytes();break;case 2:s.seq=t.uint64();break;case 3:s.addresses&&s.addresses.length||(s.addresses=[]),s.addresses.push(Ho.PeerRecord.AddressInfo.decode(t,t.uint32()));break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof Ho.PeerRecord)return t;var n=new Ho.PeerRecord;if(t.peerId!=null&&(typeof t.peerId=="string"?Hr.base64.decode(t.peerId,n.peerId=Hr.newBuffer(Hr.base64.length(t.peerId)),0):t.peerId.length&&(n.peerId=t.peerId)),t.seq!=null&&(Hr.Long?(n.seq=Hr.Long.fromValue(t.seq)).unsigned=!0:typeof t.seq=="string"?n.seq=parseInt(t.seq,10):typeof t.seq=="number"?n.seq=t.seq:typeof t.seq=="object"&&(n.seq=new Hr.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0))),t.addresses){if(!Array.isArray(t.addresses))throw TypeError(".PeerRecord.addresses: array expected");n.addresses=[];for(var i=0;i<t.addresses.length;++i){if(typeof t.addresses[i]!="object")throw TypeError(".PeerRecord.addresses: object expected");n.addresses[i]=Ho.PeerRecord.AddressInfo.fromObject(t.addresses[i])}}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.addresses=[]),n.defaults)if(n.bytes===String?i.peerId="":(i.peerId=[],n.bytes!==Array&&(i.peerId=Hr.newBuffer(i.peerId))),Hr.Long){var s=new Hr.Long(0,0,!0);i.seq=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else i.seq=n.longs===String?"0":0;if(t.peerId!=null&&t.hasOwnProperty("peerId")&&(i.peerId=n.bytes===String?Hr.base64.encode(t.peerId,0,t.peerId.length):n.bytes===Array?Array.prototype.slice.call(t.peerId):t.peerId),t.seq!=null&&t.hasOwnProperty("seq")&&(typeof t.seq=="number"?i.seq=n.longs===String?String(t.seq):t.seq:i.seq=n.longs===String?Hr.Long.prototype.toString.call(t.seq):n.longs===Number?new Hr.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0):t.seq),t.addresses&&t.addresses.length){i.addresses=[];for(var o=0;o<t.addresses.length;++o)i.addresses[o]=Ho.PeerRecord.AddressInfo.toObject(t.addresses[o],n)}return i},r.prototype.toJSON=function(){return this.constructor.toObject(this,sf.default.util.toJSONOptions)},r.AddressInfo=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.multiaddr=Hr.newBuffer([]),e.encode=function(n,i){return i||(i=Vj.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&i.uint32(10).bytes(n.multiaddr),i},e.decode=function(n,i){n instanceof A5||(n=A5.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new Ho.PeerRecord.AddressInfo;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.multiaddr=n.bytes();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof Ho.PeerRecord.AddressInfo)return n;var i=new Ho.PeerRecord.AddressInfo;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?Hr.base64.decode(n.multiaddr,i.multiaddr=Hr.newBuffer(Hr.base64.length(n.multiaddr)),0):n.multiaddr.length&&(i.multiaddr=n.multiaddr)),i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.multiaddr="":(s.multiaddr=[],i.bytes!==Array&&(s.multiaddr=Hr.newBuffer(s.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(s.multiaddr=i.bytes===String?Hr.base64.encode(n.multiaddr,0,n.multiaddr.length):i.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,sf.default.util.toJSONOptions)},e}(),r})();bT.default.util.Long=void 0;bT.default.configure();async function Bbe(r,e=()=>{}){e(0,"Storing each peerstore key under a single datastore key"),await r.datastore.open();let t={},n=[];for await(let{key:i,value:s}of r.datastore.query({prefix:"/peers"})){n.push(i);let o=i.toString(),[,a,c,u,f]=o.split("/");if(a==="peers"&&["protos","addrs","metadata","keys"].includes(c)&&u)if(t[u]=t[u]||{addresses:[],protocols:[],metadata:[]},c==="protos"){let h=pT.decode(s);t[u].protocols=h.protocols.sort()}else if(c==="addrs"){let h=gT.decode(s);t[u].addresses=h.addrs.sort((p,d)=>se(p.multiaddr).toString().localeCompare(se(d.multiaddr).toString())),h.certifiedRecord&&h.certifiedRecord.raw&&(t[u].peerRecordEnvelope=h.certifiedRecord.raw)}else c==="metadata"?t[u].metadata.push({key:f,value:s}):c==="keys"&&(t[u].pubKey=s)}e(33,"Read peer data from store");for(let i of n)await r.datastore.delete(i);e(66,"Removed existing peer data from store");for(let i of Object.keys(t)){let s=t[i];s.metadata=s.metadata.sort((a,c)=>a.key.localeCompare(c.key));let o=wT.encode(s).finish();await r.datastore.put(new Gt(`/peers/${i}`),o)}await r.datastore.close(),e(100,"Stored each peerstore key under a single datastore key")}async function Ube(r,e=()=>{}){e(0,"Storing each peerstore key under a multiple datastore keys"),await r.datastore.open();let t={},n=[];for await(let{key:i,value:s}of r.datastore.query({prefix:"/peers"})){n.push(i);let o=i.toString(),[,,a]=o.split("/");t[a]=wT.decode(s)}e(33,"Read peer data from store");for(let i of n)await r.datastore.delete(i);e(66,"Removed existing peer data from store");for(let[i,s]of Object.entries(t)){if(s.protocols&&s.protocols.length>0&&await r.datastore.put(new Gt(`/peers/protos/${i}`),pT.encode({protocols:s.protocols}).finish()),s.addresses&&s.addresses.length>0){let o=s.peerRecordEnvelope,a;if(o){let c=Fj.decode(o),u=zj.decode(c.payload);a={raw:o,seq:u.seq}}await r.datastore.put(new Gt(`/peers/addrs/${i}`),gT.encode({addrs:s.addresses,certifiedRecord:a}).finish())}if(s.metadata&&s.metadata.length>0)for(let{key:o,value:a}of s.metadata)await r.datastore.put(new Gt(`/peers/metadata/${i}/${o}`),a);s.pubKey&&await r.datastore.put(new Gt(`/peers/keys/${i}`),s.pubKey)}await r.datastore.close(),e(100,"Stored each peerstore key under multiple datastore keys")}var Kj={version:12,description:"Store each peerstore peer under a single datastore key",migrate:Bbe,revert:Ube};var id={description:"Empty migration.",migrate:()=>{},revert:()=>{},empty:!0},T5=[Object.assign({version:1},id),Object.assign({version:2},id),Object.assign({version:3},id),Object.assign({version:4},id),Object.assign({version:5},id),Object.assign({version:6},id),Object.assign({version:7},id),HG,Pj,Dj,Bj,Kj];l();l();var qj=S(Us(),1);var ET={};jt(ET,{InvalidValueError:()=>G0,MissingRepoOptionsError:()=>Wa,NonReversibleMigrationError:()=>$0,NotInitializedRepoError:()=>of,RequiredParameterError:()=>H0});l();var $0=class extends Error{constructor(e){super(e),this.name="NonReversibleMigrationError",this.code=$0.code,this.message=e}};$0.code="ERR_NON_REVERSIBLE_MIGRATION";var of=class extends Error{constructor(e){super(e),this.name="NotInitializedRepoError",this.code=of.code,this.message=e}};of.code="ERR_NOT_INITIALIZED_REPO";var H0=class extends Error{constructor(e){super(e),this.name="RequiredParameterError",this.code=H0.code,this.message=e}};H0.code="ERR_REQUIRED_PARAMETER";var G0=class extends Error{constructor(e){super(e),this.name="InvalidValueError",this.code=G0.code,this.message=e}};G0.code="ERR_INVALID_VALUE";var Wa=class extends Error{constructor(e){super(e),this.name="MissingRepoOptionsError",this.code=Wa.code,this.message=e}};Wa.code="ERR_MISSING_REPO_OPTIONS";var _T=(0,qj.default)("ipfs:repo:migrator:repo:init");async function $j(r){if(!r)throw new Wa("Please pass repo options when trying to open a repo");let e=r.root;try{await e.open();let t=await e.has(Ig),n=await e.has(kj);return!t||!n?(_T(`Version entry present: ${t}`),_T(`Config entry present: ${n}`),!1):!0}catch(t){return _T("While checking if repo is initialized error was thrown: "+t.message),!1}finally{if(e!==void 0)try{await e.close()}catch{}}}async function vT(r){if(!await $j(r))throw new of("Repo is not initialized!");let e=r.root;await e.open();try{return parseInt(C(await e.get(Ig)))}finally{await e.close()}}async function Cg(r,e){if(!e)throw new Wa("Please pass repo options when trying to open a repo");let t=e.root;await t.open(),await t.put(Ig,U(String(r))),await t.close()}var Hj=S(Us(),1),Go=(0,Hj.default)("ipfs:repo:migrator");function Fbe(r){return r=r||T5,!Array.isArray(r)||r.length===0?0:r[r.length-1].version}async function Gj(r,e,t,n,i={}){let s=i.ignoreLock??!1,o=i.onProgress,a=i.isDryRun??!1,c=i.migrations??T5;if(!r)throw new no.RequiredParameterError("Path argument is required!");if(!t)throw new no.RequiredParameterError("repoOptions argument is required!");if(!n)throw new no.RequiredParameterError("toVersion argument is required!");if(!Number.isInteger(n)||n<=0)throw new no.InvalidValueError("Version has to be positive integer!");e=dT(e);let u=await vT(e);if(u===n){Go("Nothing to migrate.");return}if(u>n)throw new no.InvalidValueError(`Current repo's version (${u}) is higher then toVersion (${n}), you probably wanted to revert it?`);Wj(c,u,n);let f;!a&&!s&&(f=await t.repoLock.lock(r));try{for(let h of c){if(n!==void 0&&h.version>n)break;if(!(h.version<=u)){Go(`Migrating version ${h.version}`);try{if(!a){let p=()=>{};o&&(p=(d,m)=>o(h.version,d.toFixed(2),m)),await h.migrate(e,p)}}catch(p){let d=h.version-1;throw Go(`An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ${d}`),await Cg(d,e),new Error(`During migration to version ${h.version} exception was raised: ${p.stack||p.message||p}`)}Go(`Migrating to version ${h.version} finished`)}}a||await Cg(n||Fbe(c),e),Go("Repo successfully migrated",n!==void 0?`to version ${n}!`:"to latest version!")}finally{!a&&!s&&f&&await f.close()}}async function jj(r,e,t,n,i={}){let s=i.ignoreLock??!1,o=i.onProgress,a=i.isDryRun??!1,c=i.migrations??T5;if(!r)throw new no.RequiredParameterError("Path argument is required!");if(!t)throw new no.RequiredParameterError("repoOptions argument is required!");if(!n)throw new no.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");if(!Number.isInteger(n)||n<=0)throw new no.InvalidValueError("Version has to be positive integer!");e=dT(e);let u=await vT(e);if(u===n){Go("Nothing to revert.");return}if(u<n)throw new no.InvalidValueError(`Current repo's version (${u}) is lower then toVersion (${n}), you probably wanted to migrate it?`);Wj(c,n,u,!0);let f;!a&&!s&&(f=await t.repoLock.lock(r)),Go(`Reverting from version ${u} to ${n}`);try{let h=c.slice().reverse();for(let p of h){if(p.version<=n)break;if(!(p.version>u)){Go(`Reverting migration version ${p.version}`);try{if(!a){let d=()=>{};o&&(d=(m,g)=>o(p.version,m.toFixed(2),g)),await p.revert(e,d)}}catch(d){let m=p.version;throw Go(`An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ${m}`),await Cg(m,e),d.message=`During reversion to version ${p.version} exception was raised: ${d.message}`,d}Go(`Reverting to version ${p.version} finished`)}}a||await Cg(n,e),Go(`All migrations successfully reverted to version ${n}!`)}finally{!a&&!s&&f&&await f.close()}}function Wj(r,e,t,n=!1){let i=0;for(let s of r){if(s.version>t)break;if(s.version>e){if(n&&!s.revert)throw new no.NonReversibleMigrationError(`It is not possible to revert to version ${e} because migration version ${s.version} is not reversible. Cancelling reversion.`);i++}}if(i!==t-e)throw new no.InvalidValueError(`The ipfs-repo-migrations package does not have all migration to migrate from version ${e} to ${t}`)}var no=ET;var xW=S(Xj(),1);l();l();var ol="/",Zj=new TextEncoder().encode(ol),R5=Zj[0],cr=class{constructor(e,t){if(typeof e=="string")this._buf=U(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==R5)throw new Error("Invalid key")}toString(e="utf8"){return C(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new cr(e.join(ol))}static random(){return new cr(Tr().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new cr(e):typeof e.uint8Array=="function"?new cr(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=Zj),this._buf[0]!==R5){let e=new Uint8Array(this._buf.byteLength+1);e.fill(R5,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===R5;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return cr.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(ol).slice(1)}type(){return Hbe(this.baseNamespace())}name(){return Gbe(this.baseNamespace())}instance(e){return new cr(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(ol)||(e+=ol),e+=this.type(),new cr(e)}parent(){let e=this.list();return e.length===1?new cr(ol):new cr(e.slice(0,-1).join(ol))}child(e){return this.toString()===ol?e:e.toString()===ol?this:new cr(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return cr.withNamespaces([...this.namespaces(),...jbe(e.map(t=>t.namespaces()))])}};function Hbe(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Gbe(r){let e=r.split(":");return e[e.length-1]}function jbe(r){return[].concat(...r)}var rW=S(Us(),1);l();l();var sd=class extends Error{constructor(e){super(e),this.name="LockExistsError",this.code=sd.code}};sd.code="ERR_LOCK_EXISTS";var vs=class extends Error{constructor(e){super(e),this.name="NotFoundError",this.code=vs.code}};vs.code="ERR_NOT_FOUND";var od=class extends Error{constructor(e){super(e),this.name="InvalidRepoVersionError",this.code=od.code}};od.code="ERR_INVALID_REPO_VERSION";var ad="ERR_REPO_NOT_INITIALIZED",Jj="ERR_REPO_ALREADY_OPEN",eW="ERR_REPO_ALREADY_CLOSED";async function C5(r,e,t){let n=await e(r);if(n)return n;let i=tW(t);return i?new Promise((s,o)=>{let a=i.store("readonly").get(r.toString());a.transaction.onabort=()=>{o(a.transaction.error)},a.transaction.oncomplete=()=>{s(Boolean(a.result))}}):!1}async function P5(r,e,t,n){if(await t(r))return e(r);let i=tW(n);if(!i)throw new vs;return new Promise((s,o)=>{let a=i.store("readonly").get(r.toString());a.transaction.onabort=()=>{o(a.transaction.error)},a.transaction.oncomplete=()=>{if(a.result)return s(a.result);o(new vs)}})}function tW(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}var Ybe=(0,rW.default)("ipfs:repo:version"),ST=new cr("version");function nW(r){return{async exists(){return C5(ST,r.has.bind(r),r)},async get(){let e=await P5(ST,r.get.bind(r),r.has.bind(r),r);return parseInt(C(e),10)},set(e){return r.put(ST,U(String(e)))},async check(e){let t=await this.get();return Ybe("comparing version: %s and %s",t,e),t===e||(t===6&&e===7||e===6&&t===7)}}}l();var k5=S(W(),1);var Qbe=qt.default?qt.default:qt,xT=new cr("config");function iW(r){let e=new Qbe({concurrency:1}),t={async getAll(s={}){let o=await P5(xT,r.get.bind(r),r.has.bind(r),r);return JSON.parse(C(o))},async get(s,o={}){if(s==null)throw new vs(`Key ${s} does not exist in config`);let a=await this.getAll(o),c=_g(a,s);if(c===void 0)throw new vs(`Key ${s} does not exist in config`);return c},set(s,o,a={}){if(typeof s!="string"&&!(s instanceof String))throw(0,k5.default)(new Error("Invalid key type: "+typeof s),"ERR_INVALID_KEY");if(o===void 0||o instanceof Uint8Array)throw(0,k5.default)(new Error("Invalid value type: "+typeof o),"ERR_INVALID_VALUE");return e.add(()=>n({key:s,value:o},a.signal))},replace(s,o={}){if(!s||s instanceof Uint8Array)throw(0,k5.default)(new Error("Invalid value type: "+typeof s),"ERR_INVALID_VALUE");return e.add(()=>n({key:void 0,value:s},o.signal))},async exists(){return C5(xT,r.has.bind(r),r)}};return t;async function n(s,o){if(o&&o.aborted)return;let a=s.key,c=s.value;if(a){let u=await t.getAll();return typeof u=="object"&&u!==null&&Pr(u,a,c),i(u)}return i(c)}function i(s){let o=U(JSON.stringify(s,null,2));return r.put(xT,o)}}l();l();l();l();function Pg(r){if(typeof r!="object"||r===null)return!1;let e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)}function AT(r,e={}){if(!Pg(r)&&!Array.isArray(r))throw new TypeError("Expected a plain object or array");let{deep:t,compare:n}=e,i=[],s=[],o=c=>{let u=i.indexOf(c);if(u!==-1)return s[u];let f=[];return i.push(c),s.push(f),f.push(...c.map(h=>Array.isArray(h)?o(h):Pg(h)?a(h):h)),f},a=c=>{let u=i.indexOf(c);if(u!==-1)return s[u];let f={},h=Object.keys(c).sort(n);i.push(c),s.push(f);for(let p of h){let d=c[p],m;t&&Array.isArray(d)?m=o(d):m=t&&Pg(d)?a(d):d,Object.defineProperty(f,p,{...Object.getOwnPropertyDescriptor(c,p),value:m})}return f};return Array.isArray(r)?t?o(r):r.slice():a(r)}var TT=new cr("datastore_spec");function sW(r){return{exists(){return r.has(TT)},async get(){let e=await r.get(TT);return JSON.parse(C(e))},async set(e){return r.put(TT,U(JSON.stringify(AT(e,{deep:!0}))))}}}l();var IT=new cr("api");function oW(r){return{async get(){let e=await r.get(IT);return e&&e.toString()},set(e){return r.put(IT,U(e.toString()))},delete(){return r.delete(IT)}}}l();var aW=S(W(),1);function cW(r){return{open(){return r.open()},close(){return r.close()},query(e,t){return r.query(e,t)},queryKeys(e,t){return r.queryKeys(e,t)},async get(e,t){let n=cf(e);return n.isIdentity?Promise.resolve(n.digest):r.get(e,t)},async*getMany(e,t){for await(let n of e)yield this.get(n,t)},async put(e,t,n){let{isIdentity:i}=cf(e);i||await r.put(e,t,n)},async*putMany(e,t){let n=dt({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{await Ct(r.putMany(async function*(){for await(let{key:s,value:o}of e)cf(s).isIdentity||(yield{key:s,value:o}),n.push({key:s,value:o})}())),n.end()}catch(s){n.end(s)}}),yield*n},has(e,t){let{isIdentity:n}=cf(e);return n?Promise.resolve(!0):r.has(e,t)},delete(e,t){let{isIdentity:n}=cf(e);return n?Promise.resolve():r.delete(e,t)},deleteMany(e,t){return r.deleteMany(ht(e,n=>!cf(n).isIdentity),t)},batch(){let e=r.batch();return{put(t,n){let{isIdentity:i}=cf(t);i||e.put(t,n)},delete(t){let{isIdentity:n}=cf(t);n||e.delete(t)},commit:t=>e.commit(t)}}}}function cf(r){let e=T.asCID(r);if(e==null)throw(0,aW.default)(new Error("Not a valid cid"),"ERR_INVALID_CID");return e.multihash.code!==un.code?{isIdentity:!1}:{isIdentity:!0,digest:e.multihash.digest}}l();l();var lW=S(Us(),1),uW=(0,lW.default)("ipfs:repo:lock:memory"),fW="repo.lock",kg={};async function Xbe(r){let e=r+"/"+fW;if(uW("locking %s",e),kg[e]===!0)throw new sd(`Lock already being held for file: ${e}`);return kg[e]=!0,{async close(){kg[e]&&delete kg[e]}}}async function Zbe(r){let e=r+"/"+fW;return uW(`checking lock: ${e}`),Boolean(kg[e])}var O5={lock:Xbe,locked:Zbe};var hW={autoMigrate:!0,onMigrationProgress:()=>{},repoOwner:!0,repoLock:O5};l();var RT={Spec:{type:"mount",mounts:[{mountpoint:"/blocks",type:"measure",prefix:"flatfs.datastore",child:{type:"flatfs",path:"blocks",sync:!0,shardFunc:"/repo/flatfs/shard/v1/next-to-last/2"}},{mountpoint:"/",type:"measure",prefix:"leveldb.datastore",child:{type:"levelds",path:"datastore",compression:"none"}}]}};l();var mW=S(W(),1),gW=S(Us(),1);l();var dW=S(W(),1);function Og(r){let e=T.asCID(r);if(e==null)throw(0,dW.default)(new Error("Not a valid cid"),"ERR_INVALID_CID");let t=De.encode(e.multihash.bytes);return new cr("/"+t.slice(1).toUpperCase(),!1)}function CT(r){return Ze(De.decode(`b${r.toString().toLowerCase().substring(1)}`))}l();var pW=S(Us(),1);var Jbe=(0,pW.default)("ipfs:repo:utils:walk-dag");async function*j0(r,e,t,n){try{let i=await e.get(r,n),s=await t(r.code),o=P0({bytes:i,cid:r,codec:s});for(let[,a]of o.links())yield a,yield*j0(a,e,t,n)}catch(i){throw Jbe("Could not walk DAG for CID",r.toString(),i),i}}l();var Ng=class extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(let[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){let n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(let e of this.oldCache){let[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(let e of this.cache){let[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){let t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){let t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){let i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){let t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");let t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(let[e]of this)yield e}*values(){for(let[,e]of this)yield e}*[Symbol.iterator](){for(let e of this.cache){let[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(let e of this.oldCache){let[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){let n=e[t],[i,s]=n;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){let n=e[t],[i,s]=n;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(let[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(let t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(let[n,i]of this.entriesAscending())e.call(t,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}};var eEe=2048;function tEe(r){let e=`Invalid type '${r}', must be one of {direct, indirect, recursive, all}`;return(0,mW.default)(new Error(e),"ERR_INVALID_PIN_TYPE")}var N5=class{constructor({pinstore:e,blockstore:t,loadCodec:n}){this.pinstore=e,this.blockstore=t,this.loadCodec=n,this.log=(0,gW.default)("ipfs:repo:pin"),this.directPins=new Set,this.recursivePins=new Set}async pinDirectly(e,t={}){await this.blockstore.get(e,t);let n={depth:0};return e.version!==0&&(n.version=e.version),e.code!==We&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),this.pinstore.put(Og(e),To(n))}unpin(e,t){return this.pinstore.delete(Og(e),t)}async pinRecursively(e,t={}){await this.fetchCompleteDag(e,t);let n={depth:1/0};e.version!==0&&(n.version=e.version),e.code!==We&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),await this.pinstore.put(Og(e),To(n))}async*directKeys(e){for await(let t of this.pinstore.query({filters:[n=>di(n.value).depth===0]})){let n=di(t.value),i=n.version||0,s=n.codec!=null?n.codec:We,o=CT(t.key);yield{cid:T.create(i,s,o),metadata:n.metadata}}}async*recursiveKeys(e){for await(let t of this.pinstore.query({filters:[n=>di(n.value).depth===1/0]})){let n=di(t.value),i=n.version||0,s=n.codec!=null?n.codec:We,o=CT(t.key);yield{cid:T.create(i,s,o),metadata:n.metadata}}}async*indirectKeys(e){for await(let{cid:t}of this.recursiveKeys())for await(let n of j0(t,this.blockstore,this.loadCodec,e)){let i=[st.recursive];(await this.isPinnedWithType(n,i)).pinned||(yield n)}}async isPinnedWithType(e,t,n){Array.isArray(t)||(t=[t]);let i=t.includes(st.all),s=t.includes(st.direct),o=t.includes(st.recursive),a=t.includes(st.indirect);if(o||s||i){let f=await hn(this.pinstore.query({prefix:Og(e).toString(),filters:[h=>{if(i)return!0;let p=di(h.value);return t.includes(p.depth===0?st.direct:st.recursive)}],limit:1}));if(f){let h=di(f.value);return{cid:e,pinned:!0,reason:h.depth===0?st.direct:st.recursive,metadata:h.metadata}}}let c=this;async function*u(f,h){for await(let{cid:p}of h)for await(let d of j0(p,c.blockstore,c.loadCodec))if(d.equals(f)){yield p;return}}if(i||a){let f=await hn(u(e,this.recursiveKeys()));if(f)return{cid:e,pinned:!0,reason:st.indirect,parent:f}}return{cid:e,pinned:!1}}async fetchCompleteDag(e,t={}){let n=new Ng({maxSize:t.cidCacheMaxSize??eEe}),i=async(s,o)=>{if(n.has(s.toString()))return;n.set(s.toString(),!0);let a=await this.blockstore.get(s,o),c=await this.loadCodec(s.code),u=P0({bytes:a,cid:s,codec:c});await Promise.all([...u.links()].map(([,f])=>i(f,o)))};await i(e,t)}static checkPinType(e){if(typeof e!="string"||!Object.keys(st).includes(e))throw tEe(e);return!0}};l();var wW=S(W(),1);function bW(r,e){return{open(){return e.open()},close(){return e.close()},query(t,n){return e.query(t,n)},queryKeys(t,n){return e.queryKeys(t,n)},async get(t,n){return e.get(t,n)},async*getMany(t,n){yield*e.getMany(t,n)},async put(t,n,i){await e.put(t,n,i)},async*putMany(t,n){yield*e.putMany(t,n)},has(t,n){return e.has(t,n)},async delete(t,n){return await yW(t,r),e.delete(t,n)},deleteMany(t,n){return e.deleteMany(Zt(t,async i=>(await yW(i,r),i)),n)},batch(){return e.batch()}}}async function yW(r,e){let{pinned:t,reason:n}=await e.isPinnedWithType(r,st.all);if(t)throw(0,wW.default)(new Error(`pinned: ${n}`),"ERR_BLOCK_PINNED")}l();var EW=S(Us(),1);l();async function*PT(r,e=1){for await(let t of Zc(r,e)){let n=t.map(async i=>await i().then(s=>({ok:!0,value:s}),s=>({ok:!1,err:s})));for(let i=0;i<n.length;i++){let s=await n[i];if(s.ok)yield s.value;else throw s.err}}}var Dg=(0,EW.default)("ipfs:repo:gc"),rEe=vn().code,nEe=256,iEe=new cr("/local/filesroot");function _W({gcLock:r,pins:e,blockstore:t,root:n,loadCodec:i}){async function*s(){let o=Date.now();Dg("Creating set of marked blocks");let a=await r.writeLock();try{let c=await sEe({pins:e,blockstore:t,root:n,loadCodec:i}),u=t.queryKeys({});yield*oEe({blockstore:t},c,u),Dg(`Complete (${Date.now()-o}ms)`)}finally{a()}}return s}async function sEe({pins:r,blockstore:e,loadCodec:t,root:n}){let i=async function*(){let a;try{a=await n.get(iEe)}catch(u){if(u.code===rEe){Dg("No blocks in MFS");return}throw u}let c=T.decode(a);yield c,yield*j0(c,e,t)}(),s=Fr(Zt(r.recursiveKeys(),({cid:a})=>a),r.indirectKeys(),Zt(r.directKeys(),({cid:a})=>a),i),o=new Set;for await(let a of Fr(s,i))o.add(De.encode(a.multihash.bytes));return o}async function*oEe({blockstore:r},e,t){let n=0,i=0;yield*_e(PT(Zt(t,async o=>async function(){n++;try{let c=De.encode(o.multihash.bytes);if(e.has(c))return null;try{await r.delete(o),i++}catch(u){return{err:new Error(`Could not delete block with CID ${o}: ${u.message}`)}}return{cid:o}}catch(c){let u=`Could delete block with CID ${o}`;return Dg(u,c),{err:new Error(u+`: ${c.message}`)}}}),nEe),o=>ht(o,Boolean)),Dg(`Marked set has ${e.size} unique blocks. Blockstore has ${n} blocks. Deleted ${i} blocks.`)}var Zi=(0,SW.default)("ipfs:repo"),aEe=Number.MAX_SAFE_INTEGER,cEe="repoAutoMigrate",kT=class{constructor(e,t,n,i){if(typeof e!="string")throw new Error("missing repo path");if(typeof t!="function")throw new Error("missing codec loader");this.options=Ve(hW,i),this.closed=!0,this.path=e,this.root=n.root,this.datastore=n.datastore,this.keys=n.keys;let s=n.blocks,o=n.pins;this.pins=new N5({pinstore:o,blockstore:s,loadCodec:t});let a=bW(this.pins,s);this.blocks=cW(a),this.version=nW(this.root),this.config=iW(this.root),this.spec=sW(this.root),this.apiAddr=oW(this.root),this.gcLock=Wh({name:e,singleProcess:this.options.repoOwner!==!1}),this.gc=_W({gcLock:this.gcLock,pins:this.pins,blockstore:this.blocks,root:this.root,loadCodec:t})}async init(e){Zi("initializing at: %s",this.path),await this._openRoot(),await this.config.replace(lEe(e)),await this.spec.set(uEe(e)),await this.version.set(12)}async isInitialized(){if(!this.closed)return!0;try{return await this._openRoot(),await this._checkInitialized(),await this.root.close(),!0}catch{return!1}}async open(){if(!this.closed)throw(0,cd.default)(new Error("repo is already open"),Jj);Zi("opening at: %s",this.path);try{if(await this._openRoot(),await this._checkInitialized(),this._lockfile=await this._openLock(),Zi("acquired repo.lock"),!await this.version.check(12))if(await this._isAutoMigrationEnabled())await this._migrate(12,{root:this.root,datastore:this.datastore,pins:this.pins.pinstore,blocks:this.pins.blockstore,keys:this.keys});else throw new od("Incompatible repo versions. Automatic migrations disabled. Please migrate the repo manually.");Zi("creating datastore"),await this.datastore.open(),Zi("creating blocks"),await this.blocks.open(),Zi("creating keystore"),await this.keys.open(),Zi("creating pins"),await this.pins.pinstore.open(),this.closed=!1,Zi("all opened")}catch(e){if(this._lockfile)try{await this._closeLock(),this._lockfile=null}catch(t){Zi("error removing lock",t)}throw e}}async _openRoot(){try{await this.root.open()}catch(e){if(e.message!=="Already open")throw e}}async _openLock(){let e=await this.options.repoLock.lock(this.path);if(typeof e.close!="function")throw(0,cd.default)(new Error("Locks must have a close method"),"ERR_NO_CLOSE_FUNCTION");return e}_closeLock(){return this._lockfile&&this._lockfile.close()}async _checkInitialized(){Zi("init check");let e;try{[e]=await Promise.all([this.config.exists(),this.spec.exists(),this.version.exists()])}catch(t){throw t.code==="ERR_NOT_FOUND"?(0,cd.default)(new Error("repo is not initialized yet"),ad,{path:this.path}):t}if(!e)throw(0,cd.default)(new Error("repo is not initialized yet"),ad,{path:this.path})}async close(){if(this.closed)throw(0,cd.default)(new Error("repo is already closed"),eW);Zi("closing at: %s",this.path);try{await this.apiAddr.delete()}catch(e){if(e.code!==ad&&!e.message.startsWith("ENOENT"))throw e}await Promise.all([this.root,this.blocks,this.keys,this.datastore,this.pins.pinstore].map(e=>e&&e.close())),Zi("unlocking"),this.closed=!0,await this._closeLock()}exists(){return this.version.exists()}async stat(){if(this.datastore&&this.keys){let[e,t,n,i,s]=await Promise.all([this._storageMaxStat(),this._blockStat(),this.version.get(),vW(this.datastore),vW(this.keys)]),o=t.size+i+s;return{repoPath:this.path,storageMax:e,version:n,numObjects:t.count,repoSize:o}}throw(0,cd.default)(new Error("repo is not initialized yet"),ad,{path:this.path})}async _isAutoMigrationEnabled(){if(this.options.autoMigrate!==void 0)return this.options.autoMigrate;let e;try{e=await this.config.get(cEe)}catch(t){if(t.code===vs.code)e=!0;else throw t}return e}async _migrate(e,t){return await this.version.get()>e?(Zi(`reverting to version ${e}`),jj(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress})):(Zi(`migrating to version ${e}`),Gj(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress}))}async _storageMaxStat(){try{let e=await this.config.get("Datastore.StorageMax");return BigInt((0,xW.default)(e))}catch{return BigInt(aEe)}}async _blockStat(){let e=BigInt(0),t=BigInt(0);if(this.blocks)for await(let{key:n,value:i}of this.blocks.query({}))e+=BigInt(1),t+=BigInt(i.byteLength),t+=BigInt(n.bytes.byteLength);return{count:e,size:t}}};async function vW(r){let e=BigInt(0);for await(let t of r.query({}))e+=BigInt(t.value.byteLength),e+=BigInt(t.key.uint8Array().byteLength);return e}function AW(r,e,t,n){return new kT(r,e,t,n)}function lEe(r){return r.Datastore=Object.assign({},RT,_g(r,"datastore")),r}function uEe(r){let e={...RT.Spec,..._g(r,"Datastore.Spec")};return{type:e.type,mounts:e.mounts.map(t=>({mountpoint:t.mountpoint,type:t.child.type,path:t.child.path,shardFunc:t.child.shardFunc}))}}l();l();l();var al="/",TW=new TextEncoder().encode(al),D5=TW[0],qn=class{constructor(e,t){if(typeof e=="string")this._buf=U(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==D5)throw new Error("Invalid key")}toString(e="utf8"){return C(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new qn(e.join(al))}static random(){return new qn(Tr().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new qn(e):typeof e.uint8Array=="function"?new qn(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=TW),this._buf[0]!==D5){let e=new Uint8Array(this._buf.byteLength+1);e.fill(D5,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===D5;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return qn.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(al).slice(1)}type(){return fEe(this.baseNamespace())}name(){return hEe(this.baseNamespace())}instance(e){return new qn(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(al)||(e+=al),e+=this.type(),new qn(e)}parent(){let e=this.list();return e.length===1?new qn(al):new qn(e.slice(0,-1).join(al))}child(e){return this.toString()===al?e:e.toString()===al?this:new qn(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return qn.withNamespaces([...this.namespaces(),...dEe(e.map(t=>t.namespaces()))])}};function fEe(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function hEe(r){let e=r.split(":");return e[e.length-1]}function dEe(r){return[].concat(...r)}l();async function*lf(r,e){yield*(await Zn(r)).sort(e)}var VY=S(FY(),1),bf=class extends ji{constructor(e,t={}){super(),this.db=typeof e=="string"?new VY.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw ds.dbOpenFailedError(e)}}async put(e,t){try{await this.db.put(e.toString(),t)}catch(n){throw ds.dbWriteFailedError(n)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(n){throw n.notFound?ds.notFoundError(n):ds.dbWriteFailedError(n)}return t}async has(e){try{await this.db.get(e.toString())}catch(t){if(t.notFound)return!1;throw t}return!0}async delete(e){try{await this.db.del(e.toString())}catch(t){throw ds.dbDeleteFailedError(t)}}close(){return this.db&&this.db.close()}batch(){let e=[];return{put:(t,n)=>{e.push({type:"put",key:t.toString(),value:n})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:()=>this.db.batch(e)}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce((s,o)=>ht(s,o),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((s,o)=>lf(s,o),t));let{offset:n,limit:i}=e;if(n){let s=0;t=ht(t,()=>s++>=n)}return i&&(t=gs(t,i)),t}queryKeys(e){let t=Zt(this._query({values:!1,prefix:e.prefix}),({key:s})=>s);Array.isArray(e.filters)&&(t=e.filters.reduce((s,o)=>ht(s,o),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((s,o)=>lf(s,o),t));let{offset:n,limit:i}=e;if(n){let s=0;t=ht(t,()=>s++>=n)}return i&&(t=gs(t,i)),t}_query(e){let t={keys:!0,keyEncoding:"buffer",values:e.values};if(e.prefix!=null){let i=e.prefix.toString();t.gte=i,t.lt=i+"\xFF"}let n=this.db.iterator(t);if(n[Symbol.asyncIterator])return b7e(n);if(n.next!=null&&n.end!=null)return E7e(n);throw new Error("Level returned incompatible iterator")}};async function*b7e(r){for await(let[e,t]of r)yield{key:new qn(e,!1),value:t};await r.close()}function E7e(r){return{[Symbol.asyncIterator](){return{next:()=>new Promise((e,t)=>{r.next((n,i,s)=>{if(n)return t(n);if(i==null)return r.end(o=>{if(o)return t(o);e({done:!0,value:void 0})});e({done:!1,value:{key:new qn(i,!1),value:s}})})}),return:()=>new Promise((e,t)=>{r.end(n=>{if(n)return t(n);e({done:!0,value:void 0})})})}}}}l();l();var ml="/",zY=new TextEncoder().encode(ml),c8=zY[0],Ei=class{constructor(e,t){if(typeof e=="string")this._buf=U(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==c8)throw new Error("Invalid key")}toString(e="utf8"){return C(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Ei(e.join(ml))}static random(){return new Ei(Tr().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Ei(e):typeof e.uint8Array=="function"?new Ei(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=zY),this._buf[0]!==c8){let e=new Uint8Array(this._buf.byteLength+1);e.fill(c8,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===c8;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return Ei.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(ml).slice(1)}type(){return _7e(this.baseNamespace())}name(){return v7e(this.baseNamespace())}instance(e){return new Ei(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(ml)||(e+=ml),e+=this.type(),new Ei(e)}parent(){let e=this.list();return e.length===1?new Ei(ml):new Ei(e.slice(0,-1).join(ml))}child(e){return this.toString()===ml?e:e.toString()===ml?this:new Ei(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Ei.withNamespaces([...this.namespaces(),...S7e(e.map(t=>t.namespaces()))])}};function _7e(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function v7e(r){let e=r.split(":");return e[e.length-1]}function S7e(r){return[].concat(...r)}var qY=S(W(),1);l();var KY=(r,e)=>async function*(){yield*(await Zn(r)).sort(e)}(),Za=class{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(let{key:n,value:i}of e)await this.put(n,i,t),yield{key:n,value:i}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(let n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await Ct(this.putMany(e,n)),e=[],await Ct(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=ht(n,i=>i.key.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>ht(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>KY(i,s),n)),e.offset!=null){let i=0;n=ht(n,()=>i++>=(e.offset||0))}return e.limit!=null&&(n=gs(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=ht(n,i=>i.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>ht(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>KY(i,s),n)),e.offset!=null){let i=0;n=ht(n,()=>i++>=e.offset)}return e.limit!=null&&(n=gs(n,e.limit)),n}};function s1(r){let e=T.asCID(r);if(!e)throw(0,qY.default)(new Error("Not a valid cid"),"ERR_INVALID_CID");return new Ei("/"+De.encode(e.multihash.bytes).slice(1).toUpperCase(),!1)}function Ef(r){return T.createV1(On,Ze(De.decode("b"+r.toString().slice(1).toLowerCase())))}function SI(r){let e=r.substring(0,1);if(e==="/")return SI(r.substring(1));let t;e.toLowerCase()==="b"?t=s=>De.decode(s.toLowerCase()).subarray(2):e.toLowerCase()==="c"?t=s=>v_.decode(s.toLowerCase()).subarray(2):e==="z"?t=s=>le.decode(s).subarray(2):e==="Q"?t=s=>le.decode("z"+s):t=s=>De.decode("b"+s.toLowerCase()).subarray(2);let n;for(let s=1;s<r.length;s++)try{n=t(r.substring(0,s))}catch(o){if(o.message!=="Unexpected end of data")throw o}let i="/C";return n&&(i=`/${De.encode(n).slice(1,-1).toUpperCase()||"C"}`),i}function x7e(r){return{...r,prefix:r.prefix?SI(r.prefix):void 0,filters:r.filters?r.filters.map(e=>t=>e({key:Ef(t.key),value:t.value})):void 0,orders:r.orders?r.orders.map(e=>(t,n)=>e({key:Ef(t.key),value:t.value},{key:Ef(n.key),value:n.value})):void 0}}function A7e(r){return{...r,prefix:r.prefix?SI(r.prefix):void 0,filters:r.filters?r.filters.map(e=>t=>e(Ef(t))):void 0,orders:r.orders?r.orders.map(e=>(t,n)=>e(Ef(t),Ef(n))):void 0}}var l8=class extends Za{constructor(e){super(),this.child=e}open(){return this.child.open()}close(){return this.child.close()}async*query(e,t){for await(let{key:n,value:i}of this.child.query(x7e(e),t))yield{key:Ef(n),value:i}}async*queryKeys(e,t){for await(let n of this.child.queryKeys(A7e(e),t))yield Ef(n)}async get(e,t){return this.child.get(s1(e),t)}async*getMany(e,t){for await(let n of e)yield this.get(n,t)}async put(e,t,n){await this.child.put(s1(e),t,n)}async*putMany(e,t){let n=dt({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{let s=this.child;await Ct(this.child.putMany(async function*(){for await(let o of e){let a=s1(o.key);await s.has(a,t)||(yield{key:a,value:o.value}),n.push(o)}}())),n.end()}catch(s){n.end(s)}}),yield*n}has(e,t){return this.child.has(s1(e),t)}delete(e,t){return this.child.delete(s1(e),t)}deleteMany(e,t){let n=dt({objectMode:!0});return Ct(this.child.deleteMany(async function*(){for await(let i of e)yield s1(i),n.push(i);n.end()}(),t)).catch(i=>{n.end(i)}),n}};function $Y(r,e,t){let n=t.path||"ipfs";return AW(n,i=>e.getCodec(i),{root:new bf(n,{prefix:"",version:2}),blocks:new l8(new bf(`${n}/blocks`,{prefix:"",version:2})),datastore:new bf(`${n}/datastore`,{prefix:"",version:2}),keys:new bf(`${n}/keys`,{prefix:"",version:2}),pins:new bf(`${n}/pins`,{prefix:"",version:2})},{autoMigrate:t.autoMigrate,onMigrationProgress:t.onMigrationProgress||r,repoLock:O5})}l();var Yt=S(Gw(),1);var Tce=S(W(),1);l();l();l();l();l();var HY={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};l();var ty;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.publicKey=t.bytes();break;case 2:i.payloadType=t.bytes();break;case 3:i.payload=t.bytes();break;case 5:i.signature=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(ty||(ty={}));l();l();l();function u8(r){return r instanceof Uint8Array?{get(e){return r[e]},set(e,t){r[e]=t}}:{get(e){return r.get(e)},set(e,t){r.set(e,t)}}}var GY=4294967296,Ts=class{constructor(e=0,t=0){this.hi=e,this.lo=t}toBigInt(e){if(e===!0)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(e){return Number(this.toBigInt(e))}zzDecode(){let e=-(this.lo&1),t=((this.lo>>>1|this.hi<<31)^e)>>>0,n=(this.hi>>>1^e)>>>0;return new Ts(n,t)}zzEncode(){let e=this.hi>>31,t=((this.hi<<1|this.lo>>>31)^e)>>>0,n=(this.lo<<1^e)>>>0;return new Ts(t,n)}toBytes(e,t=0){let n=u8(e);for(;this.hi>0;)n.set(t++,this.lo&127|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)n.set(t++,this.lo&127|128),this.lo=this.lo>>>7;n.set(t++,this.lo)}static fromBigInt(e){if(e===0n)return new Ts;let t=e<0;t&&(e=-e);let n=Number(e>>32n)|0,i=Number(e-(BigInt(n)<<32n))|0;return t&&(n=~n>>>0,i=~i>>>0,++i>GY&&(i=0,++n>GY&&(n=0))),new Ts(n,i)}static fromNumber(e){if(e===0)return new Ts;let t=e<0;t&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Ts(i,n)}static fromBytes(e,t=0){let n=u8(e),i=new Ts,s=0;if(e.length-t>4){for(;s<4;++s)if(i.lo=(i.lo|(n.get(t)&127)<<s*7)>>>0,n.get(t++)<128)return i;if(i.lo=(i.lo|(n.get(t)&127)<<28)>>>0,i.hi=(i.hi|(n.get(t)&127)>>4)>>>0,n.get(t++)<128)return i;s=0}else for(;s<4;++s){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(i.lo=(i.lo|(n.get(t)&127)<<s*7)>>>0,n.get(t++)<128)return i}if(e.length-t>4){for(;s<5;++s)if(i.hi=(i.hi|(n.get(t)&127)<<s*7+3)>>>0,n.get(t++)<128)return i}else if(t<e.byteLength)for(;s<5;++s){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(i.hi=(i.hi|(n.get(t)&127)<<s*7+3)>>>0,n.get(t++)<128)return i}throw RangeError("invalid varint encoding")}};var T7e=Math.pow(2,7),I7e=Math.pow(2,14),R7e=Math.pow(2,21),C7e=Math.pow(2,28),P7e=Math.pow(2,35),k7e=Math.pow(2,42),O7e=Math.pow(2,49),N7e=Math.pow(2,56),D7e=Math.pow(2,63),xr={encodingLength(r){return r<T7e?1:r<I7e?2:r<R7e?3:r<C7e?4:r<P7e?5:r<k7e?6:r<O7e?7:r<N7e?8:r<D7e?9:10},encode(r,e,t=0){if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return e==null&&(e=Ri(xr.encodingLength(r))),Ts.fromNumber(r).toBytes(e,t),e},decode(r,e=0){return Ts.fromBytes(r,e).toNumber(!0)}};var L7e,nn=class{constructor(e){let{peerId:t,payloadType:n,payload:i,signature:s}=e;this.peerId=t,this.payloadType=n,this.payload=i,this.signature=s}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=ty.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return be(this.marshal(),e.marshal())}async validate(e){let t=jY(e,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return await Hi(this.peerId.publicKey).verify(t.subarray(),this.signature)}};L7e=nn;nn.createFromProtobuf=async r=>{let e=ty.decode(r),t=await Ur(e.publicKey);return new nn({peerId:t,payloadType:e.payloadType,payload:e.payload,signature:e.signature})};nn.seal=async(r,e)=>{if(e.privateKey==null)throw new Error("Missing private key");let t=r.domain,n=r.codec,i=r.marshal(),s=jY(t,n,i),a=await(await Mn(e.privateKey)).sign(s.subarray());return new nn({peerId:e,payloadType:n,payload:i,signature:a})};nn.openAndCertify=async(r,e)=>{let t=await nn.createFromProtobuf(r);if(!await t.validate(e))throw new F("envelope signature is not valid for the given domain",HY.ERR_SIGNATURE_NOT_VALID);return t};var jY=(r,e,t)=>{let n=U(r),i=xr.encode(n.byteLength),s=xr.encode(e.length),o=xr.encode(t.length);return new ke(i,n,s,e,o,t)};l();l();var DI=S(ur(),1);l();var o1=S(ur(),1);l();var Ja=S(ur(),1);l();var WY=cs,B7e=ls,xI=function(r){let e=0;if(r=r.toString().trim(),WY(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(B7e(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let s=WY(t[n]),o;s&&(o=xI(t[n]),t[n]=C(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,C(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}let i=new Uint8Array(e+16);for(n=0;n<t.length;n++){let s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},YY=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){let i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};l();var ry={},AI={},M7e=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];M7e.forEach(r=>{let e=F7e(...r);AI[e.code]=e,ry[e.name]=e});function F7e(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:Boolean(n),path:Boolean(i)}}function pr(r){if(typeof r=="number"){if(AI[r]!=null)return AI[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(ry[r]!=null)return ry[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var D2t=pr("ip4"),L2t=pr("ip6"),B2t=pr("ipcidr");function eQ(r,e){switch(pr(r).code){case 4:case 41:return z7e(e);case 42:return ZY(e);case 6:case 273:case 33:case 132:return rQ(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return ZY(e);case 421:return H7e(e);case 444:return JY(e);case 445:return JY(e);case 466:return $7e(e);default:return C(e,"base16")}}function tQ(r,e){switch(pr(r).code){case 4:return QY(e);case 41:return QY(e);case 42:return XY(e);case 6:case 273:case 33:case 132:return II(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return XY(e);case 421:return K7e(e);case 444:return G7e(e);case 445:return j7e(e);case 466:return q7e(e);default:return U(e,"base16")}}var TI=Object.values(Ar).map(r=>r.decoder),V7e=function(){let r=TI[0].or(TI[1]);return TI.slice(2).forEach(e=>r=r.or(e)),r}();function QY(r){if(!Xt(r))throw new Error("invalid ip address");return xI(r)}function z7e(r){let e=YY(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Xt(e))throw new Error("invalid ip address");return e}function II(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function rQ(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function XY(r){let e=U(r),t=Uint8Array.from(Ja.default.encode(e.length));return Z([t,e],t.length+e.length)}function ZY(r){let e=Ja.default.decode(r);if(r=r.slice(Ja.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return C(r)}function K7e(r){let e;r[0]==="Q"||r[0]==="1"?e=Ze(le.decode(`z${r}`)).bytes:e=T.parse(r).multihash.bytes;let t=Uint8Array.from(Ja.default.encode(e.length));return Z([t,e],t.length+e.length)}function q7e(r){let e=V7e.decode(r),t=Uint8Array.from(Ja.default.encode(e.length));return Z([t,e],t.length+e.length)}function $7e(r){let e=Ja.default.decode(r),t=r.slice(Ja.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+C(t,"base64url")}function H7e(r){let e=Ja.default.decode(r),t=r.slice(Ja.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return C(t,"base58btc")}function G7e(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=De.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=II(n);return Z([t,i],t.length+i.length)}function j7e(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=De.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=II(n);return Z([t,i],t.length+i.length)}function JY(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=C(e,"base32"),i=rQ(t);return`${n}:${i}`}function W7e(r){let e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){let i=t[n],s=pr(i);if(s.size===0){e.push([i]);continue}if(n++,n>=t.length)throw iQ("invalid address: "+r);if(s.path===!0){e.push([i,OI(t.slice(n).join("/"))]);break}e.push([i,t[n]])}return e}function Y7e(r){let e=[];return r.map(t=>{let n=d8(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),OI(e.join("/"))}function Q7e(r){return r.map(e=>{Array.isArray(e)||(e=[e]);let t=d8(e);return e.length>1?[t.code,tQ(t.code,e[1])]:[t.code]})}function RI(r){return r.map(e=>{let t=d8(e);return e[1]!=null?[t.code,eQ(t.code,e[1])]:[t.code]})}function CI(r){return h8(Z(r.map(e=>{let t=d8(e),n=Uint8Array.from(o1.default.encode(t.code));return e.length>1&&e[1]!=null&&(n=Z([n,e[1]])),n})))}function PI(r,e){return r.size>0?r.size/8:r.size===0?0:o1.default.decode(e)+(o1.default.decode.bytes??0)}function f8(r){let e=[],t=0;for(;t<r.length;){let n=o1.default.decode(r,t),i=o1.default.decode.bytes??0,s=pr(n),o=PI(s,r.slice(t+i));if(o===0){e.push([n]),t+=i;continue}let a=r.slice(t+i,t+i+o);if(t+=o+i,t>r.length)throw iQ("Invalid address Uint8Array: "+C(r,"base16"));e.push([n,a])}return e}function kI(r){let e=f8(r),t=RI(e);return Y7e(t)}function X7e(r){r=OI(r);let e=W7e(r),t=Q7e(e);return CI(t)}function nQ(r){return X7e(r)}function h8(r){let e=Z7e(r);if(e!=null)throw e;return Uint8Array.from(r)}function Z7e(r){try{f8(r)}catch(e){return e}}function OI(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function iQ(r){return new Error("Error parsing address: "+r)}function d8(r){return pr(r[0])}l();var e_e=Symbol.for("nodejs.util.inspect.custom"),t_e=[pr("dns").code,pr("dns4").code,pr("dns6").code,pr("dnsaddr").code],r_e=new Map,sQ=Symbol.for("@multiformats/js-multiaddr/multiaddr");function n_e(r){return Boolean(r?.[sQ])}var gl=class{bytes;#e;#r;#n;#t;[sQ]=!0;constructor(e){if(e==null&&(e=""),e instanceof Uint8Array)this.bytes=h8(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=nQ(e)}else if(n_e(e))this.bytes=h8(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return this.#e==null&&(this.#e=kI(this.bytes)),this.#e}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="",o=pr("tcp"),a=pr("udp"),c=pr("ip4"),u=pr("ip6"),f=pr("dns6"),h=pr("ip6zone");for(let[d,m]of this.stringTuples())d===h.code&&(s=`%${m??""}`),t_e.includes(d)&&(t=o.name,i=443,n=`${m??""}${s}`,e=d===f.code?6:4),(d===o.code||d===a.code)&&(t=pr(d).name,i=parseInt(m??"")),(d===c.code||d===u.code)&&(t=pr(d).name,n=`${m??""}${s}`,e=d===u.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return this.protoCodes().map(e=>Object.assign({},pr(e)))}protoCodes(){let e=[],t=this.bytes,n=0;for(;n<t.length;){let i=DI.default.decode(t,n),s=DI.default.decode.bytes??0,o=pr(i),a=PI(o,t.slice(n+s));n+=a+s,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return this.#r==null&&(this.#r=f8(this.bytes)),this.#r}stringTuples(){return this.#n==null&&(this.#n=RI(this.tuples())),this.#n}encapsulate(e){return e=new gl(e),new gl(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new gl(n.slice(0,i))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new gl(CI(t.slice(0,n)));return this}getPeerId(){try{let t=this.stringTuples().filter(n=>n[0]===ry.ipfs.code).pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?C(le.decode(`z${n}`),"base58btc"):C(T.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){if(this.#t===void 0)try{this.#t=this.stringTuples().filter(e=>pr(e[0]).path===!0)[0][1],this.#t==null&&(this.#t=null)}catch{this.#t=null}return this.#t}equals(e){return be(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(s=>s.resolvable);if(t==null)return[this];let n=r_e.get(t.name);if(n==null)throw new F(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(s=>new gl(s))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[e_e](){return`Multiaddr(${kI(this.bytes)})`}};function NI(r){return new gl(r)}l();function oQ(r,e){let t=(n,i)=>n.toString().localeCompare(i.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,i)=>e[i].equals(n)))}l();var ny;(function(r){let e;(function(n){let i;n.codec=()=>(i==null&&(i=ar((s,o,a={})=>{a.lengthDelimited!==!1&&o.fork(),s.multiaddr!=null&&s.multiaddr.byteLength>0&&(o.uint32(10),o.bytes(s.multiaddr)),a.lengthDelimited!==!1&&o.ldelim()},(s,o)=>{let a={multiaddr:new Uint8Array(0)},c=o==null?s.len:s.pos+o;for(;s.pos<c;){let u=s.uint32();switch(u>>>3){case 1:a.multiaddr=s.bytes();break;default:s.skipType(u&7);break}}return a})),i),n.encode=s=>or(s,n.codec()),n.decode=s=>sr(s,n.codec())})(e=r.AddressInfo||(r.AddressInfo={}));let t;r.codec=()=>(t==null&&(t=ar((n,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),n.peerId!=null&&n.peerId.byteLength>0&&(i.uint32(10),i.bytes(n.peerId)),n.seq!=null&&n.seq!==0n&&(i.uint32(16),i.uint64(n.seq)),n.addresses!=null)for(let o of n.addresses)i.uint32(26),r.AddressInfo.codec().encode(o,i);s.lengthDelimited!==!1&&i.ldelim()},(n,i)=>{let s={peerId:new Uint8Array(0),seq:0n,addresses:[]},o=i==null?n.len:n.pos+i;for(;n.pos<o;){let a=n.uint32();switch(a>>>3){case 1:s.peerId=n.bytes();break;case 2:s.seq=n.uint64();break;case 3:s.addresses.push(r.AddressInfo.codec().decode(n,n.uint32()));break;default:n.skipType(a&7);break}}return s})),t),r.encode=n=>or(n,r.codec()),r.decode=n=>sr(n,r.codec())})(ny||(ny={}));l();var aQ="libp2p-peer-record",cQ=Uint8Array.from([3,1]);var pn=class{constructor(e){this.domain=pn.DOMAIN,this.codec=pn.CODEC;let{peerId:t,multiaddrs:n,seqNumber:i}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=ny.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof pn)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!oQ(this.multiaddrs,e.multiaddrs))}};pn.createFromProtobuf=r=>{let e=ny.decode(r),t=Br(e.peerId),n=(e.addresses??[]).map(s=>NI(s.multiaddr)),i=e.seq;return new pn({peerId:t,multiaddrs:n,seqNumber:i})};pn.DOMAIN=aQ;pn.CODEC=cQ;l();l();var p8=Symbol.for("@libp2p/topology");function lQ(r){return r!=null&&Boolean(r[p8])}var uQ=()=>{},LI=class{constructor(e){this.min=e.min??0,this.max=e.max??1/0,this.peers=new Set,this.onConnect=e.onConnect??uQ,this.onDisconnect=e.onDisconnect??uQ}get[Symbol.toStringTag](){return p8.toString()}get[p8](){return!0}async setRegistrar(e){this.registrar=e}disconnect(e){this.onDisconnect(e)}};function a1(r){return new LI(r)}l();var Fe=class extends EventTarget{#e=new Map;listenerCount(e){let t=this.#e.get(e);return t==null?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let i=this.#e.get(e);i==null&&(i=[],this.#e.set(e,i)),i.push({callback:t,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let i=this.#e.get(e);i!=null&&(i=i.filter(({callback:s})=>s!==t),this.#e.set(e,i))}dispatchEvent(e){let t=super.dispatchEvent(e),n=this.#e.get(e.type);return n==null||(n=n.filter(({once:i})=>!i),this.#e.set(e.type,n)),t}safeDispatchEvent(e,t){return this.dispatchEvent(new ne(e,t))}},BI=class extends Event{detail;constructor(e,t){super(e,t),this.detail=t?.detail}},ne=globalThis.CustomEvent??BI;l();var m8=class{constructor(e,t,n){this.gossip=e,this.msgs=new Map,this.history=[],this.notValidatedCount=0,this.msgIdToStrFn=n;for(let i=0;i<t;i++)this.history[i]=[]}get size(){return this.msgs.size}put(e,t,n=!1){let{msgIdStr:i}=e;return this.msgs.has(i)?!1:(this.msgs.set(i,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,t){let n=this.msgs.get(e);n&&!n.validated&&n.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){let n=this.msgs.get(e);if(!n)return null;let i=(n.iwantCounts.get(t)??0)+1;return n.iwantCounts.set(t,i),{msg:n.message,count:i}}getGossipIDs(e){let t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(i=>{let s=this.msgs.get(i.msgIdStr);if(s&&s.validated&&e.has(i.topic)){let o=t.get(i.topic);o||(o=[],t.set(i.topic,o)),o.push(i.msgId)}});return t}validate(e){let t=this.msgs.get(e);if(!t)return null;t.validated||this.notValidatedCount--;let{message:n,originatingPeers:i}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:i}}shift(){this.history[this.history.length-1].forEach(t=>{let n=this.msgs.get(t.msgIdStr);n&&(this.msgs.delete(t.msgIdStr),n.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){let t=this.msgs.get(e);return t?(this.msgs.delete(e),t):null}};l();var qQ=S(KQ(),1),{RPC:cy}=qQ.default;l();var QI="/floodsub/1.0.0",XI="/meshsub/1.0.0",ZI="/meshsub/1.1.0";var $Q="ERR_TOPIC_VALIDATOR_REJECT",HQ="ERR_TOPIC_VALIDATOR_IGNORE";l();l();function rc(r){if(r.length<=1)return r;let e=()=>Math.floor(Math.random()*Math.floor(r.length));for(let t=0;t<r.length;t++){let n=e(),i=r[t];r[t]=r[n],r[n]=i}return r}l();function GQ(r){return C(r,"base64")}l();l();var Ad="StrictSign",c1="StrictNoSign",Xo;(function(r){r.Accept="accept",r.Ignore="ignore",r.Reject="reject"})(Xo||(Xo={}));l();var jQ;(function(r){r.StrictSign="StrictSign",r.StrictNoSign="StrictNoSign"})(jQ||(jQ={}));var xf;(function(r){r[r.Signing=0]="Signing",r[r.Anonymous=1]="Anonymous"})(xf||(xf={}));var Li;(function(r){r.Error="error",r.Ignore="ignore",r.Reject="reject",r.Blacklisted="blacklisted"})(Li||(Li={}));var _i;(function(r){r.InvalidSignature="invalid_signature",r.InvalidSeqno="invalid_seqno",r.InvalidPeerId="invalid_peerid",r.SignaturePresent="signature_present",r.SeqnoPresent="seqno_present",r.FromPresent="from_present",r.TransformFailed="transform_failed"})(_i||(_i={}));var ao;(function(r){r.duplicate="duplicate",r.invalid="invalid",r.valid="valid"})(ao||(ao={}));function JI(r){switch(r){case Xo.Ignore:return Li.Ignore;case Xo.Reject:return Li.Reject}}async function eR(r,e){switch(r){case Ad:{if(!e)throw Error("Must provide PeerId");if(e.privateKey==null)throw Error("Cannot sign message, no private key present");if(e.publicKey==null)throw Error("Cannot sign message, no public key present");let t=await Mn(e.privateKey);return{type:xf.Signing,author:e,key:e.publicKey,privateKey:t}}case c1:return{type:xf.Anonymous};default:throw new Error(`Unknown signature policy "${r}"`)}}l();l();l();var tr="ERR_INVALID_PEER_SCORE_PARAMS";var h_e={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},d_e={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function WQ(r={}){return{...h_e,...r,topics:r.topics?Object.entries(r.topics).reduce((e,[t,n])=>(e[t]=p_e(n),e),{}):{}}}function p_e(r={}){return{...d_e,...r}}function YQ(r){for(let[e,t]of Object.entries(r.topics))try{m_e(t)}catch(n){throw new F(`invalid score parameters for topic ${e}: ${n.message}`,tr)}if(r.topicScoreCap<0)throw new F("invalid topic score cap; must be positive (or 0 for no cap)",tr);if(r.appSpecificScore===null||r.appSpecificScore===void 0)throw new F("missing application specific score function",tr);if(r.IPColocationFactorWeight>0)throw new F("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",tr);if(r.IPColocationFactorWeight!==0&&r.IPColocationFactorThreshold<1)throw new F("invalid IPColocationFactorThreshold; must be at least 1",tr);if(r.behaviourPenaltyWeight>0)throw new F("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",tr);if(r.behaviourPenaltyWeight!==0&&(r.behaviourPenaltyDecay<=0||r.behaviourPenaltyDecay>=1))throw new F("invalid BehaviourPenaltyDecay; must be between 0 and 1",tr);if(r.decayInterval<1e3)throw new F("invalid DecayInterval; must be at least 1s",tr);if(r.decayToZero<=0||r.decayToZero>=1)throw new F("invalid DecayToZero; must be between 0 and 1",tr)}function m_e(r){if(r.topicWeight<0)throw new F("invalid topic weight; must be >= 0",tr);if(r.timeInMeshQuantum===0)throw new F("invalid TimeInMeshQuantum; must be non zero",tr);if(r.timeInMeshWeight<0)throw new F("invalid TimeInMeshWeight; must be positive (or 0 to disable)",tr);if(r.timeInMeshWeight!==0&&r.timeInMeshQuantum<=0)throw new F("invalid TimeInMeshQuantum; must be positive",tr);if(r.timeInMeshWeight!==0&&r.timeInMeshCap<=0)throw new F("invalid TimeInMeshCap; must be positive",tr);if(r.firstMessageDeliveriesWeight<0)throw new F("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",tr);if(r.firstMessageDeliveriesWeight!==0&&(r.firstMessageDeliveriesDecay<=0||r.firstMessageDeliveriesDecay>=1))throw new F("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",tr);if(r.firstMessageDeliveriesWeight!==0&&r.firstMessageDeliveriesCap<=0)throw new F("invalid FirstMessageDeliveriesCap; must be positive",tr);if(r.meshMessageDeliveriesWeight>0)throw new F("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",tr);if(r.meshMessageDeliveriesWeight!==0&&(r.meshMessageDeliveriesDecay<=0||r.meshMessageDeliveriesDecay>=1))throw new F("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",tr);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesCap<=0)throw new F("invalid MeshMessageDeliveriesCap; must be positive",tr);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesThreshold<=0)throw new F("invalid MeshMessageDeliveriesThreshold; must be positive",tr);if(r.meshMessageDeliveriesWindow<0)throw new F("invalid MeshMessageDeliveriesWindow; must be non-negative",tr);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesActivation<1e3)throw new F("invalid MeshMessageDeliveriesActivation; must be at least 1s",tr);if(r.meshFailurePenaltyWeight>0)throw new F("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",tr);if(r.meshFailurePenaltyWeight!==0&&(r.meshFailurePenaltyDecay<=0||r.meshFailurePenaltyDecay>=1))throw new F("invalid MeshFailurePenaltyDecay; must be between 0 and 1",tr);if(r.invalidMessageDeliveriesWeight>0)throw new F("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",tr);if(r.invalidMessageDeliveriesDecay<=0||r.invalidMessageDeliveriesDecay>=1)throw new F("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",tr)}l();var g_e={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function QQ(r={}){return{...g_e,...r}}l();l();function XQ(r,e,t,n){let i=0;Object.entries(e.topics).forEach(([o,a])=>{let c=t.topics[o];if(c===void 0)return;let u=0;if(a.inMesh){let d=a.meshTime/c.timeInMeshQuantum;d>c.timeInMeshCap&&(d=c.timeInMeshCap),u+=d*c.timeInMeshWeight}let f=a.firstMessageDeliveries;if(f>c.firstMessageDeliveriesCap&&(f=c.firstMessageDeliveriesCap),u+=f*c.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<c.meshMessageDeliveriesThreshold){let d=c.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,m=d*d;u+=m*c.meshMessageDeliveriesWeight}let h=a.meshFailurePenalty;u+=h*c.meshFailurePenaltyWeight;let p=a.invalidMessageDeliveries*a.invalidMessageDeliveries;u+=p*c.invalidMessageDeliveriesWeight,i+=u*c.topicWeight}),t.topicScoreCap>0&&i>t.topicScoreCap&&(i=t.topicScoreCap);let s=t.appSpecificScore(r);if(i+=s*t.appSpecificWeight,e.knownIPs.forEach(o=>{if(t.IPColocationFactorWhitelist.has(o))return;let a=n.get(o),c=a?a.size:0;if(c>t.IPColocationFactorThreshold){let u=c-t.IPColocationFactorThreshold,f=u*u;i+=f*t.IPColocationFactorWeight}}),e.behaviourPenalty>t.behaviourPenaltyThreshold){let o=e.behaviourPenalty-t.behaviourPenaltyThreshold,a=o*o;i+=a*t.behaviourPenaltyWeight}return i}l();var eX=S(JQ(),1),Bi;(function(r){r[r.unknown=0]="unknown",r[r.valid=1]="valid",r[r.invalid=2]="invalid",r[r.ignored=3]="ignored"})(Bi||(Bi={}));var w8=class{constructor(){this.records=new Map,this.queue=new eX.default}ensureRecord(e){let t=this.records.get(e);if(t)return t;t={status:Bi.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(e,t);let n={msgId:e,expire:Date.now()+12e4};return this.queue.push(n),t}gc(){let e=Date.now(),t=this.queue.peekFront();for(;t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}};l();function E8(r,e,t=()=>!0){let n=new Set;if(e<=0)return n;for(let i of r){if(n.size>=e)break;t(i)&&(n.add(i),r.delete(i))}return n}function tX(r,e){return E8(r,e,()=>!0)}var b8=class extends Map{constructor(e){super(),this.getDefault=e}getOrDefault(e){let t=super.get(e);return t===void 0&&(t=this.getDefault(),this.set(e,t)),t}};var l1=k("libp2p:gossipsub:score"),_8=class{constructor(e,t,n){this.params=e,this.metrics=t,this.peerStats=new Map,this.peerIPs=new b8(()=>new Set),this.scoreCache=new Map,this.deliveryRecords=new w8,YQ(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??XQ}get size(){return this.peerStats.size}start(){if(this._backgroundInterval){l1("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),l1("started")}stop(){if(!this._backgroundInterval){l1("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),l1("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}refreshScores(){let e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((n,i)=>{if(!n.connected){e>n.expire&&(this.removeIPsForPeer(i,n.knownIPs),this.peerStats.delete(i),this.scoreCache.delete(i));return}Object.entries(n.topics).forEach(([s,o])=>{let a=this.params.topics[s];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<t&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<t&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<t&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<t&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)})}score(e){this.metrics?.scoreFnCalls.inc();let t=this.peerStats.get(e);if(!t)return 0;let n=Date.now(),i=this.scoreCache.get(e);if(i&&i.cacheUntil>n)return i.score;this.metrics?.scoreFnRuns.inc();let s=this.computeScore(e,t,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return i?(this.metrics?.scoreCachedDelta.observe(Math.abs(s-i.score)),i.score=s,i.cacheUntil=o):this.scoreCache.set(e,{score:s,cacheUntil:o}),s}addPenalty(e,t,n){let i=this.peerStats.get(e);i&&(i.behaviourPenalty+=t,this.metrics?.onScorePenalty(n))}addPeer(e){let t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){let n=this.peerStats.get(e);n&&n.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){let n=this.peerStats.get(e);n&&n.knownIPs.delete(t);let i=this.peerIPs.get(t);i&&(i.delete(e),i.size===0&&this.peerIPs.delete(t))}removePeer(e){let t=this.peerStats.get(e);if(t){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([n,i])=>{i.firstMessageDeliveries=0;let s=this.params.topics[n].meshMessageDeliveriesThreshold;if(i.inMesh&&i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){let o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.inMesh=!1,i.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,t);i&&(i.inMesh=!0,i.graftTime=Date.now(),i.meshTime=0,i.meshMessageDeliveriesActive=!1)}}prune(e,t){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,t);if(i){let s=this.params.topics[t].meshMessageDeliveriesThreshold;if(i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){let o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.meshMessageDeliveriesActive=!1,i.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);let i=this.deliveryRecords.ensureRecord(t),s=Date.now();if(i.status!==Bi.unknown){l1("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-i.firstSeen,Bi[i.status]);return}i.status=Bi.valid,i.validated=s,i.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,i){switch(i){case Li.Error:this.markInvalidMessageDelivery(e,n);return;case Li.Blacklisted:return}let s=this.deliveryRecords.ensureRecord(t);if(s.status!==Bi.unknown){l1("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeen,Bi[s.status]);return}if(i===Li.Ignore){s.status=Bi.ignored,s.peers.clear();return}s.status=Bi.invalid,this.markInvalidMessageDelivery(e,n),s.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),s.peers.clear()}duplicateMessage(e,t,n){let i=this.deliveryRecords.ensureRecord(t);if(!i.peers.has(e))switch(i.status){case Bi.unknown:i.peers.add(e);break;case Bi.valid:i.peers.add(e),this.markDuplicateMessageDelivery(e,n,i.validated);break;case Bi.invalid:this.markInvalidMessageDelivery(e,n);break;case Bi.ignored:break}}markInvalidMessageDelivery(e,t){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,t);i&&(i.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,t);if(i){let s=this.params.topics[t].firstMessageDeliveriesCap;i.firstMessageDeliveries=Math.min(s,i.firstMessageDeliveries+1),i.inMesh&&(s=this.params.topics[t].meshMessageDeliveriesCap,i.meshMessageDeliveries=Math.min(s,i.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){let i=this.peerStats.get(e);if(i){let s=n!==void 0?Date.now():0,o=this.getPtopicStats(i,t);if(o&&o.inMesh){let a=this.params.topics[t];if(n!==void 0){let u=s-n,f=u>a.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,u,f),f)return}let c=a.meshMessageDeliveriesCap;o.meshMessageDeliveries=Math.min(c,o.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(let n of t){let i=this.peerIPs.get(n);i&&(i.delete(e),i.size===0&&this.peerIPs.delete(n))}}getPtopicStats(e,t){let n=e.topics[t];return n!==void 0?n:this.params.topics[t]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}};l();var v8=class{constructor(e,t,n){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){let n=Math.floor(Math.random()*t.length),i=t[n],s=this.msgIdToStrFn(i),o=this.promises.get(s);o||(o=new Map,this.promises.set(s,o));let a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(s)||this.requestMsByMsg.set(s,a)))}getBrokenPromises(){let e=Date.now(),t=new Map,n=0;return this.promises.forEach((i,s)=>{i.forEach((o,a)=>{o<e&&(t.set(a,(t.get(a)??0)+1),i.delete(a),n++)}),i.size||this.promises.delete(s)}),this.metrics?.iwantPromiseBroken.inc(n),t}deliverMessage(e,t=!1){this.trackMessage(e);let n=this.promises.get(e);n&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,t){switch(this.trackMessage(e),t){case Li.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){let e=Date.now()-this.requestMsByMsgExpire,t=0;for(let[n,i]of this.requestMsByMsg.entries())if(i<e)this.requestMsByMsg.delete(n),t++;else break;this.metrics?.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics){let t=this.requestMsByMsg.get(e);t!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}};l();var u1=class{constructor(e){this.entries=new Map,this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return this.entries.has(e)?!0:(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){let e=Date.now();for(let[t,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){let t=this.entries.get(e);return t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}};l();var rX;(function(r){r.forward="forward",r.publish="publish"})(rX||(rX={}));var yl;(function(r){r.Fanout="fanout",r.Random="random",r.Subscribed="subscribed",r.Outbound="outbound",r.NotEnough="not_enough",r.Opportunistic="opportunistic"})(yl||(yl={}));var Td;(function(r){r.Dc="disconnected",r.BadScore="bad_score",r.Prune="prune",r.Unsub="unsubscribed",r.Excess="excess"})(Td||(Td={}));var h1;(function(r){r.GraftBackoff="graft_backoff",r.BrokenPromise="broken_promise",r.MessageDeficit="message_deficit",r.IPColocation="IP_colocation"})(h1||(h1={}));var d1;(function(r){r.LowScore="low_score",r.MaxIhave="max_ihave",r.MaxIasked="max_iasked"})(d1||(d1={}));var f1;(function(r){r.graylist="graylist",r.publish="publish",r.gossip="gossip",r.mesh="mesh"})(f1||(f1={}));function nX(r,e,t){return{protocolsEnabled:r.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:r.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:r.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:r.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),meshPeerChurnEvents:r.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),peersPerProtocol:r.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:r.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:r.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:r.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result for each topic",labelNames:["topic","acceptance"]}),asyncValidationMcacheHit:r.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),peerReadStreamError:r.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:r.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:r.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:r.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:r.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:r.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:r.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:r.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:r.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:r.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:r.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:r.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:r.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:r.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:r.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:r.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:r.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:r.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:r.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:r.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:r.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:r.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:r.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeers:r.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:r.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["topic","peerGroup"]}),msgPublishBytes:r.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:r.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:r.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:r.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:r.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),msgReceivedStatus:r.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["topic","status"]}),msgReceivedInvalid:r.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["topic","error"]}),duplicateMsgDeliveryDelay:r.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*t.maxMeshMessageDeliveriesWindowSec,.5*t.maxMeshMessageDeliveriesWindowSec,1*t.maxMeshMessageDeliveriesWindowSec,2*t.maxMeshMessageDeliveriesWindowSec,4*t.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:r.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:r.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:r.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:r.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:r.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:r.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:r.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores",labelNames:["topic","p"]}),scoreWeights:r.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:r.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:r.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:r.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*t.behaviourPenaltyThreshold,.5*t.behaviourPenaltyThreshold,1*t.behaviourPenaltyThreshold,2*t.behaviourPenaltyThreshold,4*t.behaviourPenaltyThreshold]}),ihaveRcvIgnored:r.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:r.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:r.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:r.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:r.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:r.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:r.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:r.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:r.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:r.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:r.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*t.gossipPromiseExpireSec,1*t.gossipPromiseExpireSec,2*t.gossipPromiseExpireSec,4*t.gossipPromiseExpireSec]}),iwantPromiseUntracked:r.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),cacheSize:r.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:r.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:r.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:r.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:r.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,i,s){let o=this.toTopic(n);this.meshPeerInclusionEvents.inc({topic:o,reason:i},s)},onRemoveFromMesh(n,i,s){let o=this.toTopic(n);this.meshPeerChurnEvents.inc({topic:o,reason:i},s)},onReportValidationMcacheHit(n){this.asyncValidationMcacheHit.inc({hit:n?"hit":"miss"})},onReportValidation(n,i){let s=this.toTopic(n);this.asyncValidationResult.inc({topic:s,acceptance:i})},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,i,s){let o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},i),this.ihaveRcvNotSeenMsgids.inc({topic:o},s)},onIwantRcv(n,i){for(let[s,o]of n){let a=this.toTopic(s);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(i)},onForwardMsg(n,i){let s=this.toTopic(n);this.msgForwardCount.inc({topic:s},1),this.msgForwardPeers.inc({topic:s},i)},onPublishMsg(n,i,s,o){let a=this.toTopic(n);this.msgPublishCount.inc({topic:a},1),this.msgPublishBytes.inc({topic:a},s*o),this.msgPublishPeers.inc({topic:a},s),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"direct"},i.direct),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"floodsub"},i.floodsub),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"mesh"},i.mesh),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"fanout"},i.fanout)},onMsgRecvPreValidation(n){let i=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:i},1)},onMsgRecvError(n){let i=this.toTopic(n);this.msgReceivedError.inc({topic:i},1)},onMsgRecvResult(n,i){let s=this.toTopic(n);this.msgReceivedStatus.inc({topic:s,status:i})},onMsgRecvInvalid(n,i){let s=this.toTopic(n),o=i.reason===Li.Error?i.error:i.reason;this.msgReceivedInvalid.inc({topic:s,error:o},1)},onDuplicateMsgDelivery(n,i,s){if(this.duplicateMsgDeliveryDelay.observe(i/1e3),s){let o=this.toTopic(n);this.duplicateMsgLateDelivery.inc({topic:o},1)}},onPublishDuplicateMsg(n){let i=this.toTopic(n);this.duplicateMsgIgnored.inc({topic:i},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(n,i){this.rpcRecvBytes.inc(i),this.rpcRecvCount.inc(1),n.subscriptions&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages&&this.rpcRecvMessage.inc(n.messages.length),n.control&&(this.rpcRecvControl.inc(1),n.control.ihave&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,i){if(this.rpcSentBytes.inc(i),this.rpcSentCount.inc(1),n.subscriptions&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages&&this.rpcSentMessage.inc(n.messages.length),n.control){let s=n.control.ihave?.length??0,o=n.control.iwant?.length??0,a=n.control.graft?.length??0,c=n.control.prune?.length??0;s>0&&this.rpcSentIHave.inc(s),o>0&&this.rpcSentIWant.inc(o),a>0&&this.rpcSentGraft.inc(a),c>0&&this.rpcSentPrune.inc(c),(s>0||o>0||a>0||c>0)&&this.rpcSentControl.inc(1)}},registerScores(n,i){let s=0,o=0,a=0,c=0;for(let u of n)u>=i.graylistThreshold&&s++,u>=i.publishThreshold&&o++,u>=i.gossipThreshold&&a++,u>=0&&c++;this.peersByScoreThreshold.set({threshold:f1.graylist},s),this.peersByScoreThreshold.set({threshold:f1.publish},o),this.peersByScoreThreshold.set({threshold:f1.gossip},a),this.peersByScoreThreshold.set({threshold:f1.mesh},c),this.score.set(n)},registerScoreWeights(n){for(let[i,s]of n.byTopic)this.scoreWeights.set({topic:i,p:"p1"},s.p1w),this.scoreWeights.set({topic:i,p:"p2"},s.p2w),this.scoreWeights.set({topic:i,p:"p3"},s.p3w),this.scoreWeights.set({topic:i,p:"p3b"},s.p3bw),this.scoreWeights.set({topic:i,p:"p4"},s.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,i){let s=new Map;n.forEach((o,a)=>{let c=this.topicStrToLabel.get(a)??"unknown",u=s.get(c);u||(u=new Set,s.set(c,u)),o.forEach(f=>u?.add(f))});for(let[o,a]of s){let c=[];a.forEach(u=>{c.push(i.get(u)??0)}),this.scorePerMesh.set({topic:o},c)}}}}l();l();l();l();l();var m3t=S(Gp(),1),w_e=S(Je(),1);l();var sX=S(Ov(),1),oX=S(hr(),1),iX={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function ly(r,e,t,n,i){if(i!=="sha1"&&i!=="sha2-256"&&i!=="sha2-512"){let a=Object.keys(iX).join(" / ");throw new F(`Hash '${i}' is unknown or not supported. Must be ${a}`,"ERR_UNSUPPORTED_HASH_TYPE")}let s=iX[i],o=(0,sX.default)(r,e,t,n,s);return oX.default.encode64(o,null)}var aX=U("libp2p-pubsub:");async function cX(r,e,t,n){switch(r.type){case xf.Signing:{let i={from:r.author.toBytes(),data:n,seqno:$i(8),topic:e,signature:void 0,key:void 0},s=Z([aX,cy.Message.encode(i).finish()]);i.signature=await r.privateKey.sign(s),i.key=r.key;let o={type:"signed",from:r.author,data:t,sequenceNumber:BigInt(`0x${C(i.seqno,"base16")}`),topic:e,signature:i.signature,key:i.key};return{raw:i,msg:o}}case xf.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:t,topic:e}}}}async function lX(r,e){switch(r){case c1:return e.signature!=null?{valid:!1,error:_i.SignaturePresent}:e.seqno!=null?{valid:!1,error:_i.SeqnoPresent}:e.key!=null?{valid:!1,error:_i.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case Ad:{if(e.seqno==null)return{valid:!1,error:_i.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:_i.InvalidSeqno};if(e.signature==null)return{valid:!1,error:_i.InvalidSignature};if(e.from==null)return{valid:!1,error:_i.InvalidPeerId};let t;try{t=Br(e.from)}catch{return{valid:!1,error:_i.InvalidPeerId}}let n;if(e.key){if(n=Hi(e.key),t.publicKey!==void 0&&!be(n.bytes,t.publicKey))return{valid:!1,error:_i.InvalidPeerId}}else{if(t.publicKey==null)return{valid:!1,error:_i.InvalidPeerId};n=Hi(t.publicKey)}let i={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},s=Z([aX,cy.Message.encode(i).finish()]);return await n.verify(s,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${C(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key??S2(n)}}:{valid:!1,error:_i.InvalidSignature}}}}l();l();l();var uX=(r,e)=>{let t=U(e.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(r.length+t.length);return n.set(r,0),n.set(t,r.length),n};function fX(r){if(r.type!=="signed")throw new Error("expected signed message type");if(r.sequenceNumber==null)throw Error("missing seqno field");return uX(r.from.toBytes(),r.sequenceNumber)}async function hX(r){return await Le.encode(r.data)}l();function __e(r,e,t,n,i){let s=0,o=new Map;if(Object.entries(e.topics).forEach(([p,d])=>{let m=i.get(p)??"unknown",g=t.topics[p];if(g===void 0)return;let y=o.get(m);y||(y={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(m,y));let w=0,b=0,_=0,v=0,I=0;if(d.inMesh){let O=Math.max(d.meshTime/g.timeInMeshQuantum,g.timeInMeshCap);w+=O*g.timeInMeshWeight}let x=d.firstMessageDeliveries;if(x>g.firstMessageDeliveriesCap&&(x=g.firstMessageDeliveriesCap),b+=x*g.firstMessageDeliveriesWeight,d.meshMessageDeliveriesActive&&d.meshMessageDeliveries<g.meshMessageDeliveriesThreshold){let O=g.meshMessageDeliveriesThreshold-d.meshMessageDeliveries,V=O*O;_+=V*g.meshMessageDeliveriesWeight}let A=d.meshFailurePenalty;v+=A*g.meshFailurePenaltyWeight;let R=d.invalidMessageDeliveries*d.invalidMessageDeliveries;I+=R*g.invalidMessageDeliveriesWeight,s+=(w+b+_+v+I)*g.topicWeight,y.p1w+=w,y.p2w+=b,y.p3w+=_,y.p3bw+=v,y.p4w+=I}),t.topicScoreCap>0&&s>t.topicScoreCap){s=t.topicScoreCap;let p=t.topicScoreCap/s;for(let d of o.values())d.p1w*=p,d.p2w*=p,d.p3w*=p,d.p3bw*=p,d.p4w*=p}let a=0,c=0,u=0,f=t.appSpecificScore(r);a+=f*t.appSpecificWeight,e.knownIPs.forEach(p=>{if(t.IPColocationFactorWhitelist.has(p))return;let d=n.get(p),m=d?d.size:0;if(m>t.IPColocationFactorThreshold){let g=m-t.IPColocationFactorThreshold,y=g*g;c+=y*t.IPColocationFactorWeight}});let h=e.behaviourPenalty*e.behaviourPenalty;return u+=h*t.behaviourPenaltyWeight,s+=a+c+u,{byTopic:o,p5w:a,p6w:c,p7w:u,score:s}}function dX(r,e,t,n,i){let s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(let o of r){let a=e.get(o);if(a){let c=__e(o,a,t,n,i);for(let[u,f]of c.byTopic){let h=s.byTopic.get(u);h||(h={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(u,h)),h.p1w.push(f.p1w),h.p2w.push(f.p2w),h.p3w.push(f.p3w),h.p3bw.push(f.p3bw),h.p4w.push(f.p4w)}s.p5w.push(c.p5w),s.p6w.push(c.p6w),s.p7w.push(c.p7w),s.score.push(c.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}l();l();l();var Af=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};l();function p1(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}function ni(r,e,t){let n=t??{},i=p1(r);async function*s(){let o,a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){let{abortMessage:f,abortCode:h}=n;throw new Af(f,h)}let u=new Promise((f,h)=>{o=()=>{let{abortMessage:p,abortCode:d}=n;h(new Af(p,d))}});c=await Promise.race([u,i.next()]),o=null}catch(u){e.removeEventListener("abort",a);let f=u.type==="aborted"&&e.aborted;if(f&&n.onAbort!=null&&await n.onAbort(r),typeof i.return=="function")try{let h=i.return();h instanceof Promise&&h.catch(p=>{n.onReturnError!=null&&n.onReturnError(p)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(f&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return s()}function v_e(r,e,t){return n=>r(ni(n,e,t))}function vi(r,e,t){return{sink:v_e(r.sink,e,{...t,onAbort:void 0}),source:ni(r.source,e,t)}}l();l();l();function pX(r){return globalThis?.Buffer?.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}var S8=r=>{let e=xr.encodingLength(r),t=pX(e);return xr.encode(r,t),S8.bytes=e,t};S8.bytes=0;function xn(r){r=r??{};let e=r.lengthEncoder??S8;return async function*(n){for await(let i of n){let s=e(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}}}xn.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??S8;return new ke(t(r.byteLength),r)};l();var uy=S(W(),1),S_e=8,x_e=1024*1024*4,Id;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(Id||(Id={}));var tR=r=>{let e=xr.decode(r);return tR.bytes=xr.encodingLength(e),e};tR.bytes=0;function on(r){return async function*(t){let n=new ke,i=Id.LENGTH,s=-1,o=r?.lengthDecoder??tR,a=r?.maxLengthLength??S_e,c=r?.maxDataLength??x_e;for await(let u of t)for(n.append(u);n.byteLength>0;){if(i===Id.LENGTH)try{if(s=o(n),s<0)throw(0,uy.default)(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(s>c)throw(0,uy.default)(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");let f=o.bytes;n.consume(f),r?.onLength!=null&&r.onLength(s),i=Id.DATA}catch(f){if(f instanceof RangeError){if(n.byteLength>a)throw(0,uy.default)(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw f}if(i===Id.DATA){if(n.byteLength<s)break;let f=n.sublist(0,s);n.consume(s),r?.onData!=null&&r.onData(f),yield f,i=Id.LENGTH}}if(n.byteLength>0)throw(0,uy.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}on.fromReader=(r,e)=>{let t=1,n=async function*(){for(;;)try{let{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return on({...e??{},onLength:s=>{t=s}})(n)};var x8=class{constructor(e,t,n){this.rawStream=e,this.pushable=dt({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,_e(ni(this.pushable,this.closeController.signal,{returnOnAbort:!0}),xn(),this.rawStream).catch(t)}get protocol(){return this.rawStream.stat.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}},A8=class{constructor(e,t={}){this.rawStream=e,this.closeController=new AbortController,this.source=ni(_e(this.rawStream,on(t)),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}};l();var mX=S(YI(),1),gX={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function yX(r,e){e={...e};let t=mX.default.Reader.create(r),n=r.length,i=n===void 0?t.len:t.pos+n,s={};for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.subscriptions&&s.subscriptions.length||(s.subscriptions=[]),s.subscriptions.length<e.maxSubscriptions?s.subscriptions.push(A_e(t,t.uint32())):t.skipType(o&7);break;case 2:s.messages&&s.messages.length||(s.messages=[]),s.messages.length<e.maxMessages?s.messages.push(T_e(t,t.uint32())):t.skipType(o&7);break;case 3:s.control=I_e(t,t.uint32(),e);break;default:t.skipType(o&7);break}}return s}function A_e(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let i=r.uint32();switch(i>>>3){case 1:n.subscribe=r.bool();break;case 2:n.topic=r.string();break;default:r.skipType(i&7);break}}return n}function T_e(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let i=r.uint32();switch(i>>>3){case 1:n.from=r.bytes();break;case 2:n.data=r.bytes();break;case 3:n.seqno=r.bytes();break;case 4:n.topic=r.string();break;case 5:n.signature=r.bytes();break;case 6:n.key=r.bytes();break;default:r.skipType(i&7);break}}if(!n.topic)throw Error("missing required 'topic'");return n}function I_e(r,e,t){let n=e===void 0?r.len:r.pos+e,i={};for(;r.pos<n;){let s=r.uint32();switch(s>>>3){case 1:i.ihave&&i.ihave.length||(i.ihave=[]),i.ihave.length<t.maxControlMessages?i.ihave.push(R_e(r,r.uint32(),t)):r.skipType(s&7);break;case 2:i.iwant&&i.iwant.length||(i.iwant=[]),i.iwant.length<t.maxControlMessages?i.iwant.push(C_e(r,r.uint32(),t)):r.skipType(s&7);break;case 3:i.graft&&i.graft.length||(i.graft=[]),i.graft.length<t.maxControlMessages?i.graft.push(P_e(r,r.uint32())):r.skipType(s&7);break;case 4:i.prune&&i.prune.length||(i.prune=[]),i.prune.length<t.maxControlMessages?i.prune.push(k_e(r,r.uint32(),t)):r.skipType(s&7);break;default:r.skipType(s&7);break}}return i}function R_e(r,e,t){let n=e===void 0?r.len:r.pos+e,i={};for(;r.pos<n;){let s=r.uint32();switch(s>>>3){case 1:i.topicID=r.string();break;case 2:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),t.maxIhaveMessageIDs-- >0?i.messageIDs.push(r.bytes()):r.skipType(s&7);break;default:r.skipType(s&7);break}}return i}function C_e(r,e,t){let n=e===void 0?r.len:r.pos+e,i={};for(;r.pos<n;){let s=r.uint32();switch(s>>>3){case 1:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),t.maxIwantMessageIDs-- >0?i.messageIDs.push(r.bytes()):r.skipType(s&7);break;default:r.skipType(s&7);break}}return i}function P_e(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let i=r.uint32();switch(i>>>3){case 1:n.topicID=r.string();break;default:r.skipType(i&7);break}}return n}function k_e(r,e,t){let n=e===void 0?r.len:r.pos+e,i={};for(;r.pos<n;){let s=r.uint32();switch(s>>>3){case 1:i.topicID=r.string();break;case 2:i.peers&&i.peers.length||(i.peers=[]),t.maxPeerInfos-- >0?i.peers.push(O_e(r,r.uint32())):r.skipType(s&7);break;case 3:i.backoff=r.uint64();break;default:r.skipType(s&7);break}}return i}function O_e(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let i=r.uint32();switch(i>>>3){case 1:n.peerID=r.bytes();break;case 2:n.signedPeerRecord=r.bytes();break;default:r.skipType(i&7);break}}return n}l();l();var Rd=S(ur(),1);l();var wX=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){let i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};l();var rR={},nR={},D_e=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];D_e.forEach(r=>{let e=L_e(...r);nR[e.code]=e,rR[e.name]=e});function L_e(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:Boolean(n),path:Boolean(i)}}function fy(r){if(typeof r=="number"){if(nR[r]!=null)return nR[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(rR[r]!=null)return rR[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var J4t=fy("ip4"),ewt=fy("ip6"),twt=fy("ipcidr");function _X(r,e){switch(fy(r).code){case 4:case 41:return B_e(e);case 42:return bX(e);case 6:case 273:case 33:case 132:return vX(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return bX(e);case 421:return M_e(e);case 444:return EX(e);case 445:return EX(e);case 466:return U_e(e);default:return C(e,"base16")}}var iR=Object.values(Ar).map(r=>r.decoder),rwt=function(){let r=iR[0].or(iR[1]);return iR.slice(2).forEach(e=>r=r.or(e)),r}();function B_e(r){let e=wX(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Xt(e))throw new Error("invalid ip address");return e}function vX(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function bX(r){let e=Rd.default.decode(r);if(r=r.slice(Rd.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return C(r)}function U_e(r){let e=Rd.default.decode(r),t=r.slice(Rd.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+C(t,"base64url")}function M_e(r){let e=Rd.default.decode(r),t=r.slice(Rd.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return C(t,"base58btc")}function EX(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=C(e,"base32"),i=vX(t);return`${n}:${i}`}var T8;(function(r){r[r.ip4=4]="ip4",r[r.ip6=41]="ip6"})(T8||(T8={}));function SX(r){for(let e of r.tuples())switch(e[0]){case T8.ip4:case T8.ip6:return _X(e[0],e[1])}return null}var Is;(function(r){r[r.started=0]="started",r[r.stopped=1]="stopped"})(Is||(Is={}));var I8=class extends Fe{constructor(e,t={}){super(),this.multicodecs=[ZI,XI],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=dt({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.directPeerInitial=null,this.status={code:Is.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{let i=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch(s=>{this.log("Error running heartbeat",s)}).finally(()=>{if(i?.(),this.status.code===Is.started){clearTimeout(this.status.heartbeatTimeout);let s=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;s<this.opts.heartbeatInterval*.25&&(s+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,s)}})};let n={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...t,scoreParams:WQ(t.scoreParams),scoreThresholds:QQ(t.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=n.decodeRpcLimits??gX,this.globalSignaturePolicy=n.globalSignaturePolicy??Ad,n.fallbackToFloodsub&&this.multicodecs.push(QI),this.log=k(n.debugName??"libp2p:gossipsub"),this.opts=n,this.direct=new Set(n.directPeers.map(i=>i.id.toString())),this.seenCache=new u1({validityMs:n.seenTTL}),this.publishedMessageIds=new u1({validityMs:n.seenTTL}),t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case Ad:this.msgIdFn=fX;break;case c1:this.msgIdFn=hX;break}if(t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new u1({validityMs:n.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??GQ,this.mcache=t.messageCache||new m8(n.mcacheGossip,n.mcacheLength,this.msgIdToStrFn),t.dataTransform&&(this.dataTransform=t.dataTransform),t.metricsRegister){if(!t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");let i=Math.max(...Object.values(n.scoreParams.topics).map(o=>o.meshMessageDeliveriesWindow),1e3),s=nX(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:n.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:i/1e3});s.mcacheSize.addCollect(()=>this.onScrapeMetrics(s));for(let o of this.multicodecs)s.protocolsEnabled.set({protocol:o},1);this.metrics=s}else this.metrics=null;this.gossipTracer=new v8(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new _8(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:n.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams,this.allowedTopics=n.allowedTopics?new Set(n.allowedTopics):null}getPeers(){return[...this.peers.keys()].map(e=>ae(e))}isStarted(){return this.status.code===Is.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await eR(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=dt({objectMode:!0}),_e(this.outboundInflightQueue,async s=>{for await(let{peerId:o,connection:a}of s)await this.createOutboundStream(o,a)}).catch(s=>this.log.error("outbound inflight queue error",s)),await Promise.all(this.opts.directPeers.map(async s=>{await this.components.peerStore.addressBook.add(s.id,s.addrs)}));let e=this.components.registrar;await Promise.all(this.multicodecs.map(s=>e.handle(s,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams})));let t=a1({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),n=await Promise.all(this.multicodecs.map(s=>e.register(s,t))),i=setTimeout(this.runHeartbeat,100);this.status={code:Is.started,registrarTopologyIds:n,heartbeatTimeout:i,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async s=>await this.connect(s)))}).catch(s=>{this.log(s)})},1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==Is.started)return;let{registrarTopologyIds:e}=this.status;this.status={code:Is.stopped};let t=this.components.registrar;e.forEach(n=>t.unregister(n)),this.outboundInflightQueue.end();for(let n of this.streamsOutbound.values())n.close();this.streamsOutbound.clear();for(let n of this.streamsInbound.values())n.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;let n=t.remotePeer;this.addPeer(n,t.stat.direction,t.remoteAddr),this.createInboundStream(n,e),this.outboundInflightQueue.push({peerId:n,connection:t})}onPeerConnected(e,t){this.metrics?.newConnectionCount.inc({status:t.stat.status}),!(!this.isStarted()||t.stat.status!=="OPEN")&&(this.addPeer(e,t.stat.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;let n=e.toString();if(this.peers.has(n)&&!this.streamsOutbound.has(n))try{let i=new x8(await t.newStream(this.multicodecs),o=>this.log.error("outbound pipe error",o),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(n,i);let s=i.protocol;s===QI&&this.floodsubPeers.add(n),this.metrics?.peersPerProtocol.inc({protocol:s},1),this.subscriptions.size>0&&(this.log("send subscriptions to",n),this.sendSubscriptions(n,Array.from(this.subscriptions),!0))}catch(i){this.log.error("createOutboundStream error",i)}}async createInboundStream(e,t){if(!this.isStarted())return;let n=e.toString();if(!this.peers.has(n))return;let i=this.streamsInbound.get(n);i!==void 0&&(this.log("replacing existing inbound steam %s",n),i.close()),this.log("create inbound stream %s",n);let s=new A8(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(n,s),this.pipePeerReadStream(e,s.source).catch(o=>this.log(o))}addPeer(e,t,n){let i=e.toString();if(!this.peers.has(i)){this.log("new peer %p",e),this.peers.add(i),this.score.addPeer(i);let s=SX(n);s!==null?this.score.addIP(i,s):this.log("Added peer has no IP in current address %s %s",i,n.toString()),this.outbound.has(i)||this.outbound.set(i,t==="outbound")}}removePeer(e){let t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);let n=this.streamsOutbound.get(t),i=this.streamsInbound.get(t);n&&this.metrics?.peersPerProtocol.inc({protocol:n.protocol},-1),n?.close(),i?.close(),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(let s of this.topics.values())s.delete(t);for(let[s,o]of this.mesh)o.delete(t)===!0&&this.metrics?.onRemoveFromMesh(s,Td.Dc,1);for(let s of this.fanout.values())s.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===Is.started}getMeshPeers(e){let t=this.mesh.get(e);return t?Array.from(t):[]}getSubscribers(e){let t=this.topics.get(e);return(t?Array.from(t):[]).map(n=>ae(n))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await _e(t,async n=>{for await(let i of n)try{let s=i.subarray(),o=yX(s,this.decodeRpcLimits);if(this.metrics?.onRpcRecv(o,s.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(e,o)}catch(a){this.metrics?.onRpcRecvError(),this.log(a)}else this.handleReceivedRpc(e,o).catch(a=>{this.metrics?.onRpcRecvError(),this.log(a)})}catch(s){this.metrics?.onRpcDataError(),this.log(s)}})}catch(n){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(n,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){if(!this.acceptFrom(e.toString())){this.log("received message from unacceptable peer %p",e),this.metrics?.rpcRecvNotAccepted.inc();return}let n=t.subscriptions?t.subscriptions.length:0,i=t.messages?t.messages.length:0,s=0,o=0,a=0,c=0;if(t.control&&(t.control.ihave&&(s=t.control.ihave.length),t.control.iwant&&(o=t.control.iwant.length),t.control.graft&&(a=t.control.graft.length),t.control.prune&&(c=t.control.prune.length)),this.log(`rpc.from ${e.toString()} subscriptions ${n} messages ${i} ihave ${s} iwant ${o} graft ${a} prune ${c}`),t.subscriptions&&t.subscriptions.length>0){let u=[];t.subscriptions.forEach(f=>{let h=f.topic,p=f.subscribe===!0;if(h!=null){if(this.allowedTopics&&!this.allowedTopics.has(h))return;this.handleReceivedSubscription(e,h,p),u.push({topic:h,subscribe:p})}}),this.dispatchEvent(new ne("subscription-change",{detail:{peerId:e,subscriptions:u}}))}if(t.messages)for(let u of t.messages){if(this.allowedTopics&&!this.allowedTopics.has(u.topic))continue;let f=this.handleReceivedMessage(e,u).catch(h=>{this.metrics?.onMsgRecvError(u.topic),this.log(h)});this.opts.awaitRpcMessageHandler&&await f}t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,n){this.log("subscription update from %p topic %s",e,t);let i=this.topics.get(t);i==null&&(i=new Set,this.topics.set(t,i)),n?i.add(e.toString()):i.delete(e.toString())}async handleReceivedMessage(e,t){this.metrics?.onMsgRecvPreValidation(t.topic);let n=await this.validateReceivedMessage(e,t);switch(this.metrics?.onMsgRecvResult(t.topic,n.code),n.code){case ao.duplicate:this.score.duplicateMessage(e.toString(),n.msgIdStr,t.topic),this.gossipTracer.deliverMessage(n.msgIdStr,!0),this.mcache.observeDuplicate(n.msgIdStr,e.toString());return;case ao.invalid:if(n.msgIdStr){let i=n.msgIdStr;this.score.rejectMessage(e.toString(),i,t.topic,n.reason),this.gossipTracer.rejectMessage(i,n.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);this.metrics?.onMsgRecvInvalid(t.topic,n);return;case ao.valid:this.score.validateMessage(n.messageId.msgIdStr),this.gossipTracer.deliverMessage(n.messageId.msgIdStr),this.mcache.put(n.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)&&(!this.components.peerId.equals(e)||this.opts.emitSelf)&&(super.dispatchEvent(new ne("gossipsub:message",{detail:{propagationSource:e,msgId:n.messageId.msgIdStr,msg:n.msg}})),super.dispatchEvent(new ne("message",{detail:n.msg}))),this.opts.asyncValidation||this.forwardMessage(n.messageId.msgIdStr,t,e.toString())}}async validateReceivedMessage(e,t){let n=this.fastMsgIdFn?.(t),i=n!==void 0?this.fastMsgIdCache?.get(n):void 0;if(i)return{code:ao.duplicate,msgIdStr:i};let s=await lX(this.globalSignaturePolicy,t);if(!s.valid)return{code:ao.invalid,reason:Li.Error,error:s.error};let o=s.message;try{this.dataTransform&&(o.data=this.dataTransform.inboundTransform(t.topic,o.data))}catch(h){return this.log("Invalid message, transform failed",h),{code:ao.invalid,reason:Li.Error,error:_i.TransformFailed}}let a=await this.msgIdFn(o),c=this.msgIdToStrFn(a),u={msgId:a,msgIdStr:c};if(n!==void 0&&this.fastMsgIdCache&&this.fastMsgIdCache.put(n,c)&&this.metrics?.fastMsgIdCacheCollision.inc(),this.seenCache.has(c))return{code:ao.duplicate,msgIdStr:c};this.seenCache.put(c);let f=this.topicValidators.get(t.topic);if(f!=null){let h;try{h=await f(e,o)}catch(p){let d=p.code;d===HQ&&(h=Xo.Ignore),d===$Q?h=Xo.Reject:h=Xo.Ignore}if(h!==Xo.Accept)return{code:ao.invalid,reason:JI(h),msgIdStr:c}}return{code:ao.valid,messageId:u,msg:o}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,n){this.sendRpc(e,{subscriptions:t.map(i=>({topic:i,subscribe:n}))})}async handleControlMessage(e,t){if(t===void 0)return;let n=t.ihave?this.handleIHave(e,t.ihave):[],i=t.iwant?this.handleIWant(e,t.iwant):[],s=t.graft?await this.handleGraft(e,t.graft):[];if(t.prune&&await this.handlePrune(e,t.prune),!n.length&&!i.length&&!s.length)return;let o=this.sendRpc(e,{messages:i,control:{iwant:n,prune:s}}),a=n[0]?.messageIDs;a&&(o?this.gossipTracer.addPromise(e,a):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(e){if(this.direct.has(e))return!0;let t=Date.now(),n=this.acceptFromWhitelist.get(e);if(n&&n.messagesAccepted<128&&n.acceptUntil>=t)return n.messagesAccepted+=1,!0;let i=this.score.score(e);return i>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+1e3}):this.acceptFromWhitelist.delete(e),i>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){if(!t.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:d1.LowScore}),[];let i=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,i),i>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,i),this.metrics?.ihaveRcvIgnored.inc({reason:d1.MaxIhave}),[];let s=this.iasked.get(e)??0;if(s>=5e3)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,s),this.metrics?.ihaveRcvIgnored.inc({reason:d1.MaxIasked}),[];let o=new Map;if(t.forEach(({topicID:u,messageIDs:f})=>{if(!u||!f||!this.mesh.has(u))return;let h=0;f.forEach(p=>{let d=this.msgIdToStrFn(p);this.seenCache.has(d)||(o.set(d,p),h++)}),this.metrics?.onIhaveRcv(u,f.length,h)}),!o.size)return[];let a=o.size;a+s>5e3&&(a=5e3-s),this.log("IHAVE: Asking for %d out of %d messages from %s",a,o.size,e);let c=Array.from(o.values());return rc(c),c=c.slice(0,a),this.iasked.set(e,s+a),[{messageIDs:c}]}handleIWant(e,t){if(!t.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,n),[];let i=new Map,s=new Map,o=0;return t.forEach(({messageIDs:a})=>{a&&a.forEach(c=>{let u=this.msgIdToStrFn(c),f=this.mcache.getWithIWantCount(u,e);if(f==null){o++;return}if(s.set(f.msg.topic,1+(s.get(f.msg.topic)??0)),f.count>3){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,c);return}i.set(u,f.msg)})}),this.metrics?.onIwantRcv(s,o),i.size?(this.log("IWANT: Sending %d messages to %s",i.size,e),Array.from(i.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,t){let n=[],i=this.score.score(e),s=Date.now(),o=this.opts.doPX;return t.forEach(({topicID:a})=>{if(!a)return;let c=this.mesh.get(a);if(!c){o=!1;return}if(c.has(e))return;if(this.direct.has(e)){this.log("GRAFT: ignoring request from direct peer %s",e),n.push(a),o=!1;return}let u=this.backoff.get(a)?.get(e);if(typeof u=="number"&&s<u){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,h1.GraftBackoff),o=!1;let f=u+this.opts.graftFloodThreshold-this.opts.pruneBackoff;s<f&&this.score.addPenalty(e,1,h1.GraftBackoff),this.addBackoff(e,a),n.push(a);return}if(i<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,i,a),n.push(a),o=!1,this.addBackoff(e,a);return}if(c.size>=this.opts.Dhi&&!this.outbound.get(e)){n.push(a),this.addBackoff(e,a);return}this.log("GRAFT: Add mesh link from %s in %s",e,a),this.score.graft(e,a),c.add(e),this.metrics?.onAddToMesh(a,yl.Subscribed,1)}),n.length?await Promise.all(n.map(a=>this.makePrune(e,a,o))):[]}async handlePrune(e,t){let n=this.score.score(e);for(let{topicID:i,backoff:s,peers:o}of t){if(i==null)continue;let a=this.mesh.get(i);if(!a)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,i),this.score.prune(e,i),a.has(e)&&(a.delete(e),this.metrics?.onRemoveFromMesh(i,Td.Unsub,1)),typeof s=="number"&&s>0?this.doAddBackoff(e,i,s*1e3):this.addBackoff(e,i),o&&o.length){if(n<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,n,i);continue}await this.pxConnect(o)}}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,n){let i=this.backoff.get(t);i||(i=new Map,this.backoff.set(t,i));let s=Date.now()+n;(i.get(e)??0)<s&&i.set(e,s)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,h1.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%15!==0)return;let e=Date.now();this.backoff.forEach((t,n)=>{t.forEach((i,s)=>{i<e&&t.delete(s)}),t.size===0&&this.backoff.delete(n)})}async directConnect(){let e=[];this.direct.forEach(t=>{this.streamsOutbound.has(t)||e.push(t)}),await Promise.all(e.map(async t=>await this.connect(t)))}async pxConnect(e){e.length>this.opts.prunePeers&&(rc(e),e=e.slice(0,this.opts.prunePeers));let t=[];await Promise.all(e.map(async n=>{if(!n.peerID)return;let i=Br(n.peerID).toString();if(!this.peers.has(i)){if(!n.signedPeerRecord){t.push(i);return}try{let s=await nn.openAndCertify(n.signedPeerRecord,"libp2p-peer-record"),o=s.peerId;if(!s.peerId.equals(i)){this.log("bogus peer record obtained through px: peer ID %p doesn't match expected peer %p",o,i);return}if(!await this.components.peerStore.addressBook.consumePeerRecord(s)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}t.push(i)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),t.length&&await Promise.all(t.map(async n=>await this.connect(n)))}async connect(e){this.log("Initiating connection with %s",e);let t=ae(e),n=await this.components.connectionManager.openConnection(t);for(let i of this.multicodecs)for(let s of this.components.registrar.getTopologies(i))s.onConnect(t,n)}subscribe(e){if(this.status.code!==Is.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(let t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==Is.started)throw new Error("Pubsub is not started");let t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(let n of this.peers.keys())this.sendSubscriptions(n,[e],!1);this.leave(e)}join(e){if(this.status.code!==Is.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);let t=new Set,n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach(i=>{!this.direct.has(i)&&this.score.score(i)>=0&&t.add(i)}),this.metrics?.onAddToMesh(e,yl.Fanout,t.size)),t.size<this.opts.D){let i=t.size;this.getRandomGossipPeers(e,this.opts.D,o=>!t.has(o)&&!this.direct.has(o)&&this.score.score(o)>=0).forEach(o=>{t.add(o)}),this.metrics?.onAddToMesh(e,yl.Random,t.size-i)}this.mesh.set(e,t),t.forEach(i=>{this.log("JOIN: Add mesh link to %s in %s",i,e),this.sendGraft(i,e)})}leave(e){if(this.status.code!==Is.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);let t=this.mesh.get(e);t&&(Promise.all(Array.from(t).map(async n=>(this.log("LEAVE: Remove mesh link to %s in %s",n,e),await this.sendPrune(n,e)))).catch(n=>{this.log("Error sending prunes to mesh peers",n)}),this.mesh.delete(e))}selectPeersToForward(e,t,n){let i=new Set,s=this.topics.get(e);s&&(this.direct.forEach(a=>{s.has(a)&&t!==a&&!n?.has(a)&&i.add(a)}),this.floodsubPeers.forEach(a=>{s.has(a)&&t!==a&&!n?.has(a)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&i.add(a)}));let o=this.mesh.get(e);return o&&o.size>0&&o.forEach(a=>{t!==a&&!n?.has(a)&&i.add(a)}),i}selectPeersToPublish(e){let t=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},i=this.topics.get(e);if(i)if(this.opts.floodPublish)i.forEach(s=>{this.direct.has(s)?(t.add(s),n.direct++):this.score.score(s)>=this.opts.scoreThresholds.publishThreshold&&(t.add(s),n.floodsub++)});else{this.direct.forEach(o=>{i.has(o)&&(t.add(o),n.direct++)}),this.floodsubPeers.forEach(o=>{i.has(o)&&this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(t.add(o),n.floodsub++)});let s=this.mesh.get(e);if(s&&s.size>0)s.forEach(o=>{t.add(o),n.mesh++});else{let o=this.fanout.get(e);if(o&&o.size>0)o.forEach(a=>{t.add(a),n.fanout++});else{let a=this.getRandomGossipPeers(e,this.opts.D,c=>this.score.score(c)>=this.opts.scoreThresholds.publishThreshold);a.size>0&&(this.fanout.set(e,a),a.forEach(c=>{t.add(c),n.fanout++}))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:n}}forwardMessage(e,t,n,i){n&&this.score.deliverMessage(n,e,t.topic);let s=this.selectPeersToForward(t.topic,n,i);s.forEach(o=>{this.sendRpc(o,{messages:[t]})}),this.metrics?.onForwardMsg(t.topic,s.size)}async publish(e,t,n){let i=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");let{raw:s,msg:o}=await cX(this.publishConfig,e,t,i),a=await this.msgIdFn(o),c=this.msgIdToStrFn(a),u=n?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(c)){if(u)return this.metrics?.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}let{tosend:f,tosendCount:h}=this.selectPeersToPublish(e),p=this.opts.emitSelf===!0&&this.subscriptions.has(e),d=n?.allowPublishToZeroPeers??this.opts.allowPublishToZeroPeers;if(f.size===0&&!d&&!p)throw Error("PublishError.InsufficientPeers");this.seenCache.put(c),this.mcache.put({msgId:a,msgIdStr:c},s,!0),this.publishedMessageIds.put(c);for(let m of f)this.sendRpc(m,{messages:[s]})||f.delete(m);return this.metrics?.onPublishMsg(e,h,f.size,s.data!=null?s.data.length:0),p&&(f.add(this.components.peerId.toString()),super.dispatchEvent(new ne("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:c,msg:o}})),super.dispatchEvent(new ne("message",{detail:o}))),{recipients:Array.from(f.values()).map(m=>ae(m))}}reportMessageValidationResult(e,t,n){if(n===Xo.Accept){let i=this.mcache.validate(e);if(this.metrics?.onReportValidationMcacheHit(i!==null),i!=null){let{message:s,originatingPeers:o}=i;this.score.deliverMessage(t.toString(),e,s.topic),this.forwardMessage(e,i.message,t.toString(),o),this.metrics?.onReportValidation(s.topic,n)}}else{let i=this.mcache.remove(e);if(this.metrics?.onReportValidationMcacheHit(i!==null),i){let s=JI(n),{message:o,originatingPeers:a}=i;this.score.rejectMessage(t.toString(),e,o.topic,s);for(let c of a)this.score.rejectMessage(c,e,o.topic,s);this.metrics?.onReportValidation(o.topic,n)}}}sendGraft(e,t){let n=[{topicID:t}];this.sendRpc(e,{control:{graft:n}})}async sendPrune(e,t){let n=[await this.makePrune(e,t,this.opts.doPX)];this.sendRpc(e,{control:{prune:n}})}sendRpc(e,t){let n=this.streamsOutbound.get(e);if(!n)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;let i=this.control.get(e);i&&(this.piggybackControl(e,t,i),this.control.delete(e));let s=this.gossip.get(e);s&&(this.piggybackGossip(e,t,s),this.gossip.delete(e));let o=cy.encode(t).finish();try{n.push(o)}catch(a){return this.log.error(`Cannot send rpc to ${e}`,a),i&&this.control.set(e,i),s&&this.gossip.set(e,s),!1}return this.metrics?.onRpcSent(t,o.length),!0}piggybackControl(e,t,n){if(n.graft){t.control||(t.control={}),t.control.graft||(t.control.graft=[]);for(let i of n.graft)i.topicID&&this.mesh.get(i.topicID)?.has(e)&&t.control.graft.push(i)}if(n.prune){t.control||(t.control={}),t.control.prune||(t.control.prune=[]);for(let i of n.prune)i.topicID&&!this.mesh.get(i.topicID)?.has(e)&&t.control.prune.push(i)}}piggybackGossip(e,t,n){t.control||(t.control={}),t.control.ihave=n}async sendGraftPrune(e,t,n){let i=this.opts.doPX;for(let[s,o]of e){let a=o.map(f=>({topicID:f})),c=[],u=t.get(s);u&&(c=await Promise.all(u.map(async f=>await this.makePrune(s,f,i&&!(n.get(s)??!1)))),t.delete(s)),this.sendRpc(s,{control:{graft:a,prune:c}})}for(let[s,o]of t){let a=await Promise.all(o.map(async c=>await this.makePrune(s,c,i&&!(n.get(s)??!1))));this.sendRpc(s,{control:{prune:a}})}}emitGossip(e){let t=this.mcache.getGossipIDs(new Set(e.keys()));for(let[n,i]of e)this.doEmitGossip(n,i,t.get(n)??[])}doEmitGossip(e,t,n){if(!n.length||(rc(n),n.length>5e3&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),!t.size))return;let i=this.opts.Dlazy,s=.25*t.size,o=t;s>i&&(i=s),i>o.size?i=o.size:o=rc(Array.from(o)).slice(0,i),o.forEach(a=>{let c=n;n.length>5e3&&(c=rc(c.slice()).slice(0,5e3)),this.pushGossip(a,{topicID:e,messageIDs:c})})}flush(){for(let[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,{control:{ihave:t}});for(let[e,t]of this.control.entries())this.control.delete(e),this.sendRpc(e,{control:{graft:t.graft,prune:t.prune}})}pushGossip(e,t){this.log("Add gossip to %s",e);let n=this.gossip.get(e)||[];this.gossip.set(e,n.concat(t))}async makePrune(e,t,n){if(this.score.prune(e,t),this.streamsOutbound.get(e).protocol===XI)return{topicID:t,peers:[]};let i=this.opts.pruneBackoff/1e3;if(!n)return{topicID:t,peers:[],backoff:i};let s=this.getRandomGossipPeers(t,this.opts.prunePeers,a=>a!==e&&this.score.score(a)>=0),o=await Promise.all(Array.from(s).map(async a=>{let c=ae(a);return{peerID:c.toBytes(),signedPeerRecord:await this.components.peerStore.addressBook.getRawEnvelope(c)}}));return{topicID:t,peers:o,backoff:i}}async heartbeat(){let{D:e,Dlo:t,Dhi:n,Dscore:i,Dout:s,fanoutTTL:o}=this.opts;this.heartbeatTicks++;let a=new Map,c=m=>{let g=a.get(m);return g===void 0&&(g=this.score.score(m),a.set(m,g)),g},u=new Map,f=new Map,h=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();let p=new Map;this.mesh.forEach((m,g)=>{let y=this.topics.get(g),w=new Set,b=new Set;if(p.set(g,b),y){let I=rc(Array.from(y)),x=this.backoff.get(g);for(let A of I){let R=this.streamsOutbound.get(A);if(R&&this.multicodecs.includes(R.protocol)&&!m.has(A)&&!this.direct.has(A)){let O=c(A);(!x||!x.has(A))&&O>=0&&w.add(A),O>=this.opts.scoreThresholds.gossipThreshold&&b.add(A)}}}let _=(I,x)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",I,g),this.addBackoff(I,g),m.delete(I),c(I)>=this.opts.scoreThresholds.gossipThreshold&&b.add(I),this.metrics?.onRemoveFromMesh(g,x,1);let A=f.get(I);A?A.push(g):f.set(I,[g])},v=(I,x)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",I,g),this.score.graft(I,g),m.add(I),b.delete(I),this.metrics?.onAddToMesh(g,x,1);let A=u.get(I);A?A.push(g):u.set(I,[g])};if(m.forEach(I=>{let x=c(I);x<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",I,x,g),_(I,Td.BadScore),h.set(I,!0))}),m.size<t){let I=e-m.size;tX(w,I).forEach(A=>{v(A,yl.NotEnough)})}if(m.size>n){let I=Array.from(m);I.sort((A,R)=>c(R)-c(A)),I=I.slice(0,i).concat(rc(I.slice(i)));let x=0;if(I.slice(0,e).forEach(A=>{this.outbound.get(A)&&x++}),x<s){let A=O=>{let V=I[O];for(let $=O;$>0;$--)I[$]=I[$-1];I[0]=V};if(x>0){let O=x;for(let V=1;V<e&&O>0;V++)this.outbound.get(I[V])&&(A(V),O--)}let R=e-x;for(let O=e;O<I.length&&R>0;O++)this.outbound.get(I[O])&&(A(O),R--)}I.slice(e).forEach(A=>{_(A,Td.Excess)})}if(m.size>=t){let I=0;if(m.forEach(x=>{this.outbound.get(x)&&I++}),I<s){let x=s-I;E8(w,x,R=>this.outbound.get(R)===!0).forEach(R=>{v(R,yl.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&m.size>1){let I=Array.from(m).sort((R,O)=>c(R)-c(O)),x=Math.floor(m.size/2),A=c(I[x]);if(A<this.opts.scoreThresholds.opportunisticGraftThreshold){let R=this.opts.opportunisticGraftPeers,O=E8(w,R,V=>c(V)>A);for(let V of O)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",V,g),v(V,yl.Opportunistic)}}});let d=Date.now();this.fanoutLastpub.forEach((m,g)=>{m+o<d&&(this.fanout.delete(g),this.fanoutLastpub.delete(g))}),this.fanout.forEach((m,g)=>{let y=this.topics.get(g);m.forEach(v=>{(!y.has(v)||c(v)<this.opts.scoreThresholds.publishThreshold)&&m.delete(v)});let w=this.topics.get(g),b=[],_=new Set;if(p.set(g,_),w){let v=rc(Array.from(w));for(let I of v){let x=this.streamsOutbound.get(I);if(x&&this.multicodecs.includes(x.protocol)&&!m.has(I)&&!this.direct.has(I)){let A=c(I);A>=this.opts.scoreThresholds.publishThreshold&&b.push(I),A>=this.opts.scoreThresholds.gossipThreshold&&_.add(I)}}}if(m.size<e){let v=e-m.size;b.slice(0,v).forEach(I=>{m.add(I),_?.delete(I)})}}),this.emitGossip(p),await this.sendGraftPrune(u,f,h),this.flush(),this.mcache.shift(),this.dispatchEvent(new ne("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,n=()=>!0){let i=this.topics.get(e);if(!i)return new Set;let s=[];return i.forEach(o=>{let a=this.streamsOutbound.get(o);a&&this.multicodecs.includes(a.protocol)&&n(o)&&s.push(o)}),s=rc(s),t>0&&s.length>t&&(s=s.slice(0,t)),new Set(s)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0;for(let o of this.backoff.values())t+=o.size;e.cacheSize.set({cache:"backoff"},t);for(let[o,a]of this.topics)e.topicPeersCount.set({topicStr:o},a.size);for(let[o,a]of this.mesh)e.meshPeerCounts.set({topicStr:o},a.size);let n=[],i=new Map;e.behaviourPenalty.reset();for(let o of this.peers.keys()){let a=this.score.score(o);n.push(a),i.set(o,a),e.behaviourPenalty.observe(this.score.peerStats.get(o)?.behaviourPenalty??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,i);let s=dX(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(s)}};I8.multicodec=ZI;function AX(r={}){return e=>new I8(e,r)}var TX=()=>({gossipsub:AX({fallbackToFloodsub:!0,emitSelf:!0,maxInboundStreams:64,maxOutboundStreams:128})});l();var sR=S(us(),1);var Cd=k("libp2p:delegated-peer-routing"),IX=3e4,h9e=4,RX;(function(r){r[r.SENDING_QUERY=0]="SENDING_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADDING_PEER=6]="ADDING_PEER",r[r.DIALING_PEER=7]="DIALING_PEER"})(RX||(RX={}));var CX;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(CX||(CX={}));var oR=class{constructor(e){if(e==null)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new qt({concurrency:h9e});let{protocol:t,host:n,port:i}=e.getEndpointConfig();Cd(`enabled DelegatedPeerRouting via ${t}://${n}:${i}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async findPeer(e,t={}){Cd("findPeer starts: %p",e),t.timeout=t.timeout??IX,t.signal=(0,sR.default)([this.abortController.signal].concat(t.signal!=null?[t.signal]:[]));let n=bt(),i=bt();this.httpQueue.add(async()=>(n.resolve(),await i.promise));try{await n.promise;for await(let s of this.client.dht.findPeer(e,t))if(s.name==="FINAL_PEER")return{id:s.peer.id,multiaddrs:s.peer.multiaddrs,protocols:[]}}catch(s){throw Cd.error("findPeer errored: %o",s),s}finally{i.resolve(),Cd("findPeer finished: %p",e)}throw new F("Not found","ERR_NOT_FOUND")}async*getClosestPeers(e,t={}){let n,i=T.asCID(e);i!=null?n=i:n=Br(e),Cd("getClosestPeers starts: %s",n),t.timeout=t.timeout??IX,t.signal=(0,sR.default)([this.abortController.signal].concat(t.signal!=null?[t.signal]:[]));let s=bt(),o=bt();this.httpQueue.add(async()=>(s.resolve(),await o.promise));try{await s.promise;for await(let a of this.client.dht.query(n,t))a.name==="PEER_RESPONSE"&&(yield*a.closer.map(c=>({id:c.id,multiaddrs:c.multiaddrs,protocols:[]})))}catch(a){throw Cd.error("getClosestPeers errored:",a),a}finally{o.resolve(),Cd("getClosestPeers finished: %b",e)}}};function PX(r){return()=>new oR(r)}l();var aR=S(W(),1),hy=S(us(),1),nc=k("libp2p:delegated-content-routing"),R8=3e4,d9e=4,p9e=2,kX;(function(r){r[r.SENDING_QUERY=0]="SENDING_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADDING_PEER=6]="ADDING_PEER",r[r.DIALING_PEER=7]="DIALING_PEER"})(kX||(kX={}));var OX;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(OX||(OX={}));var cR=class{constructor(e){if(e==null)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new qt({concurrency:d9e}),this.httpQueueRefs=new qt({concurrency:p9e});let{protocol:t,host:n,port:i}=e.getEndpointConfig();nc(`enabled DelegatedContentRouting via ${t}://${n}:${i}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.httpQueueRefs.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async*findProviders(e,t={}){nc("findProviders starts: %c",e),t.timeout=t.timeout??R8,t.signal=(0,hy.default)([this.abortController.signal].concat(t.signal!=null?[t.signal]:[]));let n=bt(),i=bt();this.httpQueue.add(async()=>(n.resolve(),await i.promise));try{await n.promise;for await(let s of this.client.dht.findProvs(e,t))s.name==="PROVIDER"&&(yield*s.providers.map(o=>({id:o.id,protocols:[],multiaddrs:o.multiaddrs})))}catch(s){throw nc.error("findProviders errored:",s),s}finally{i.resolve(),nc("findProviders finished: %c",e)}}async provide(e,t={}){nc("provide starts: %c",e),t.timeout=t.timeout??R8,t.signal=(0,hy.default)([this.abortController.signal].concat(t.signal!=null?[t.signal]:[])),await this.httpQueueRefs.add(async()=>{await this.client.block.stat(e,t),await Ct(this.client.dht.provide(e,t))}),nc("provide finished: %c",e)}async put(e,t,n={}){nc("put value start: %b",e),n.timeout=n.timeout??R8,n.signal=(0,hy.default)([this.abortController.signal].concat(n.signal!=null?[n.signal]:[])),await this.httpQueue.add(async()=>{await Ct(this.client.dht.put(e,t,n))}),nc("put value finished: %b",e)}async get(e,t={}){nc("get value start: %b",e),t.timeout=t.timeout??R8,t.signal=(0,hy.default)([this.abortController.signal].concat(t.signal!=null?[t.signal]:[]));let n=await this.httpQueue.add(async()=>{for await(let i of this.client.dht.get(e,t))if(i.name==="VALUE")return nc("get value finished: %b",e),i.value;throw(0,aR.default)(new Error("Not found"),"ERR_NOT_FOUND")});if(n===void 0)throw(0,aR.default)(new Error("Not found"),"ERR_NOT_FOUND");return n}};function NX(r){return()=>new cR(r)}l();l();var m9e=r=>Promise.reject(new Error(`No base found for "${r}"`)),y1=class{constructor(e){this._basesByName={},this._basesByPrefix={},this._loadBase=e.loadBase||m9e;for(let t of e.bases)this.addBase(t)}addBase(e){if(this._basesByName[e.name]||this._basesByPrefix[e.prefix])throw new Error(`Codec already exists for codec "${e.name}"`);this._basesByName[e.name]=e,this._basesByPrefix[e.prefix]=e}removeBase(e){delete this._basesByName[e.name],delete this._basesByPrefix[e.prefix]}async getBase(e){if(this._basesByName[e])return this._basesByName[e];if(this._basesByPrefix[e])return this._basesByPrefix[e];let t=await this._loadBase(e);return this._basesByName[t.name]==null&&this._basesByPrefix[t.prefix]==null&&this.addBase(t),t}listBases(){return Object.values(this._basesByName)}};l();var g9e=r=>Promise.reject(new Error(`No codec found for "${r}"`)),w1=class{constructor(e){this._codecsByName={},this._codecsByCode={},this._loadCodec=e.loadCodec||g9e;for(let t of e.codecs)this.addCodec(t)}addCodec(e){if(this._codecsByName[e.name]||this._codecsByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._codecsByName[e.name]=e,this._codecsByCode[e.code]=e}removeCodec(e){delete this._codecsByName[e.name],delete this._codecsByCode[e.code]}async getCodec(e){let t=typeof e=="string"?this._codecsByName:this._codecsByCode;if(t[e])return t[e];let n=await this._loadCodec(e);return t[e]==null&&this.addCodec(n),n}listCodecs(){return Object.values(this._codecsByName)}};l();var y9e=r=>Promise.reject(new Error(`No hasher found for "${r}"`)),b1=class{constructor(e){this._hashersByName={},this._hashersByCode={},this._loadHasher=e.loadHasher||y9e;for(let t of e.hashers)this.addHasher(t)}addHasher(e){if(this._hashersByName[e.name]||this._hashersByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._hashersByName[e.name]=e,this._hashersByCode[e.code]=e}removeHasher(e){delete this._hashersByName[e.name],delete this._hashersByCode[e.code]}async getHasher(e){let t=typeof e=="string"?this._hashersByName:this._hashersByCode;if(t[e])return t[e];let n=await this._loadHasher(e);return t[e]==null&&this.addHasher(n),n}listHashers(){return Object.values(this._hashersByName)}};l();l();l();l();var ic=S(K3(),1);var Pd=S(Vp(),1);l();function lR(r){try{r=N0(se(r))}catch{}return r=r.toString(),r}l();var DX=()=>{};var LX=k("ipfs-http-client:lib:error-handler"),w9e=Ve.bind({ignoreUndefined:!0}),b9e=ic.isBrowser||ic.isWebWorker?location.protocol:"http",E9e=ic.isBrowser||ic.isWebWorker?location.hostname:"localhost",_9e=ic.isBrowser||ic.isWebWorker?location.port:"5001",v9e=(r={})=>{let e,t={},n;if(typeof r=="string"||pi(r))e=new URL(lR(r));else if(r instanceof URL)e=r;else if(typeof r.url=="string"||pi(r.url))e=new URL(lR(r.url)),t=r;else if(r.url instanceof URL)e=r.url,t=r;else{t=r||{};let i=(t.protocol||b9e).replace(":",""),s=(t.host||E9e).split(":")[0],o=t.port||_9e;e=new URL(`${i}://${s}:${o}`)}if(t.apiPath?e.pathname=t.apiPath:(e.pathname==="/"||e.pathname===void 0)&&(e.pathname="api/v0"),ic.isNode){let i=DX(e);n=t.agent||new i({keepAlive:!0,maxSockets:6})}return{...t,host:e.host,protocol:e.protocol.replace(":",""),port:Number(e.port),apiPath:e.pathname,url:e,agent:n}},S9e=async r=>{let e;try{if((r.headers.get("Content-Type")||"").startsWith("application/json")){let n=await r.json();LX(n),e=n.Message||n.message}else e=await r.text()}catch(n){LX("Failed to parse error response",n),e=n.message}let t=new Pd.default.HTTPError(r);throw e&&(e.includes("deadline has elapsed")&&(t=new Pd.default.TimeoutError),e&&e.includes("context deadline exceeded")&&(t=new Pd.default.TimeoutError)),e&&e.includes("request timed out")&&(t=new Pd.default.TimeoutError),e&&(t.message=e),t},x9e=/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,BX=r=>r.replace(x9e,function(e){return"-"+e.toLowerCase()}),A9e=r=>typeof r=="string"?fu(r):r,Tf=class extends Pd.default{constructor(e={}){let t=v9e(e);super({timeout:A9e(t.timeout||0)||void 0,headers:t.headers,base:`${t.url}`,handleError:S9e,transformSearchParams:i=>{let s=new URLSearchParams;for(let[o,a]of i)a!=="undefined"&&a!=="null"&&o!=="signal"&&s.append(BX(o),a),o==="timeout"&&!isNaN(a)&&s.append(BX(o),a);return s},agent:t.agent}),delete this.get,delete this.put,delete this.delete,delete this.options;let n=this.fetch;this.fetch=(i,s={})=>(typeof i=="string"&&!i.startsWith("/")&&(i=`${t.url}/${i}`),n.call(this,i,w9e(s,{method:"POST"})))}},g6t=Pd.default.HTTPError;var N=r=>e=>r(new Tf(e),e);l();l();function C8(r){if(r!=null)return typeof r=="string"?r:r.toString(8).padStart(4,"0")}l();var UX=S(W(),1);function P8(r){if(r==null)return;let e;if(r.secs!=null&&(e={secs:r.secs,nsecs:r.nsecs}),r.Seconds!=null&&(e={secs:r.Seconds,nsecs:r.FractionalNanoseconds}),Array.isArray(r)&&(e={secs:r[0],nsecs:r[1]}),r instanceof Date){let t=r.getTime(),n=Math.floor(t/1e3);e={secs:n,nsecs:(t-n*1e3)*1e3}}if(Object.prototype.hasOwnProperty.call(e,"secs")){if(e!=null&&e.nsecs!=null&&(e.nsecs<0||e.nsecs>999999999))throw(0,UX.default)(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return e}}function L({arg:r,searchParams:e,hashAlg:t,mtime:n,mode:i,...s}={}){e&&(s={...s,...e}),t&&(s.hash=t),n!=null&&(n=P8(n),s.mtime=n.secs,s.mtimeNsecs=n.nsecs),i!=null&&(s.mode=C8(i)),s.timeout&&!isNaN(s.timeout)&&(s.timeout=`${s.timeout}ms`),r==null?r=[]:Array.isArray(r)||(r=[r]);let o=new URLSearchParams(s);return r.forEach(a=>o.append("arg",a)),o}var MX=N(r=>{async function e(t={}){return((await(await r.post("bitswap/wantlist",{signal:t.signal,searchParams:L(t),headers:t.headers})).json()).Keys||[]).map(i=>T.parse(i["/"]))}return e});l();var FX=N(r=>{async function e(t,n={}){return((await(await r.post("bitswap/wantlist",{signal:n.signal,searchParams:L({...n,peer:t.toString()}),headers:n.headers})).json()).Keys||[]).map(s=>T.parse(s["/"]))}return e});l();var k8=N(r=>{async function e(t={}){let n=await r.post("bitswap/stat",{searchParams:L(t),signal:t.signal,headers:t.headers});return T9e(await n.json())}return e});function T9e(r){return{provideBufLen:r.ProvideBufLen,wantlist:(r.Wantlist||[]).map(e=>T.parse(e["/"])),peers:(r.Peers||[]).map(e=>ae(e)),blocksReceived:BigInt(r.BlocksReceived),dataReceived:BigInt(r.DataReceived),blocksSent:BigInt(r.BlocksSent),dataSent:BigInt(r.DataSent),dupBlksReceived:BigInt(r.DupBlksReceived),dupDataReceived:BigInt(r.DupDataReceived)}}l();var VX=N(r=>{async function e(t,n={}){return(await r.post("bitswap/unwant",{signal:n.signal,searchParams:L({arg:t.toString(),...n}),headers:n.headers})).json()}return e});function zX(r){return{wantlist:MX(r),wantlistForPeer:FX(r),unwant:VX(r),stat:k8(r)}}l();l();var O8=N(r=>{async function e(t,n={}){let i=await r.post("block/get",{signal:n.signal,searchParams:L({arg:t.toString(),...n}),headers:n.headers});return new Uint8Array(await i.arrayBuffer())}return e});l();l();l();l();var qX=S(W(),1);async function $X(r){if(Zs(r))return new Blob([r]);if(typeof r=="string"||r instanceof String)return new Blob([r.toString()]);if(Qc(r))return r;if(Xc(r)&&(r=Wi(r)),Symbol.iterator in r||Symbol.asyncIterator in r){let e=zo(r),{value:t,done:n}=await e.peek();if(n)return KX(e);if(e.push(t),Number.isInteger(t))return new Blob([Uint8Array.from(await Zn(e))]);if(Zs(t)||typeof t=="string"||t instanceof String)return KX(e)}throw(0,qX.default)(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT")}async function KX(r){let e=[];for await(let t of r)e.push(t);return new Blob(e)}function HX(r){return _6(r,$X,!0)}l();function GX(r){if(r!=null)return typeof r=="string"?r:r.toString(8).padStart(4,"0")}async function mn(r,e,t={}){let n=[],i=new FormData,s=0,o=0;for await(let{content:a,path:c,mode:u,mtime:f}of HX(r)){let h="",p=a?"file":"dir";s>0&&(h=`-${s}`);let d=p+h,m=[];if(u!=null&&m.push(`mode=${GX(u)}`),f!=null){let{secs:g,nsecs:y}=f;m.push(`mtime=${g}`),y!=null&&m.push(`mtime-nsecs=${y}`)}if(m.length&&(d=`${d}?${m.join("&")}`),a){i.set(d,a,c!=null?encodeURIComponent(c):void 0);let g=o+a.size;n.push({name:c,start:o,end:g}),o=g}else if(c!=null)i.set(d,new File([""],encodeURIComponent(c),{type:"application/x-directory"}));else throw new Error("path or content or both must be set");s++}return{total:o,parts:n,headers:t,body:i}}l();var jX=S(us(),1);function I9e(r){return r.filter(Boolean)}function gn(...r){return(0,jX.anySignal)(I9e(r))}var WX=N(r=>{async function e(t,n={}){let i=new AbortController,s=gn(i.signal,n.signal),o;try{o=await(await r.post("block/put",{signal:s,searchParams:L(n),...await mn([t],i,n.headers)})).json()}catch(a){if(n.format==="dag-pb")return e(t,{...n,format:"protobuf"});if(n.format==="dag-cbor")return e(t,{...n,format:"cbor"});throw a}return T.parse(o.Key)}return e});l();var YX=N(r=>{async function*e(t,n={}){Array.isArray(t)||(t=[t]);let i=await r.post("block/rm",{signal:n.signal,searchParams:L({arg:t.map(s=>s.toString()),"stream-channels":!0,...n}),headers:n.headers});for await(let s of i.ndjson())yield R9e(s)}return e});function R9e(r){let e={cid:T.parse(r.Hash)};return r.Error&&(e.error=new Error(r.Error)),e}l();var QX=N(r=>{async function e(t,n={}){let s=await(await r.post("block/stat",{signal:n.signal,searchParams:L({arg:t.toString(),...n}),headers:n.headers})).json();return{cid:T.parse(s.Key),size:s.Size}}return e});function XX(r){return{get:O8(r),put:WX(r),rm:YX(r),stat:QX(r)}}l();l();var ZX=N(r=>{async function e(t,n={}){let i=await r.post("bootstrap/add",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers}),{Peers:s}=await i.json();return{Peers:s.map(o=>se(o))}}return e});l();var JX=N(r=>{async function e(t={}){let n=await r.post("bootstrap/rm",{signal:t.signal,searchParams:L({...t,all:!0}),headers:t.headers}),{Peers:i}=await n.json();return{Peers:i.map(s=>se(s))}}return e});l();var eZ=N(r=>{async function e(t={}){let n=await r.post("bootstrap/list",{signal:t.signal,searchParams:L(t),headers:t.headers}),{Peers:i}=await n.json();return{Peers:i.map(s=>se(s))}}return e});l();var tZ=N(r=>{async function e(t={}){let n=await r.post("bootstrap/add",{signal:t.signal,searchParams:L({...t,default:!0}),headers:t.headers}),{Peers:i}=await n.json();return{Peers:i.map(s=>se(s))}}return e});l();var rZ=N(r=>{async function e(t,n={}){let i=await r.post("bootstrap/rm",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers}),{Peers:s}=await i.json();return{Peers:s.map(o=>se(o))}}return e});function nZ(r){return{add:ZX(r),clear:JX(r),list:eZ(r),reset:tZ(r),rm:rZ(r)}}l();l();l();var iZ=N(r=>{async function e(t,n={}){let s=await(await r.post("config/profile/apply",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers})).json();return{original:s.OldCfg,updated:s.NewCfg}}return e});l();l();function ot(r){if(r==null)return r;let e=/^[A-Z]+$/,t={};return Object.keys(r).reduce((n,i)=>(e.test(i)?n[i.toLowerCase()]=r[i]:e.test(i[0])?n[i[0].toLowerCase()+i.slice(1)]=r[i]:n[i]=r[i],n),t)}var sZ=N(r=>{async function e(t={}){return(await(await r.post("config/profile/list",{signal:t.signal,searchParams:L(t),headers:t.headers})).json()).map(s=>ot(s))}return e});function oZ(r){return{apply:iZ(r),list:sZ(r)}}l();var aZ=N(r=>async(t,n={})=>{if(!t)throw new Error("key argument is required");return(await(await r.post("config",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers})).json()).Value});l();var cZ=N(r=>async(t={})=>await(await r.post("config/show",{signal:t.signal,searchParams:L({...t}),headers:t.headers})).json());l();var lZ=N(r=>async(t,n={})=>{let i=new AbortController,s=gn(i.signal,n.signal);await(await r.post("config/replace",{signal:s,searchParams:L(n),...await mn([U(JSON.stringify(t))],i,n.headers)})).text()});l();var uZ=N(r=>async(t,n,i={})=>{if(typeof t!="string")throw new Error("Invalid key type");let s={...i,...C9e(t,n)};await(await r.post("config",{signal:i.signal,searchParams:L(s),headers:i.headers})).text()}),C9e=(r,e)=>{switch(typeof e){case"boolean":return{arg:[r,e.toString()],bool:!0};case"string":return{arg:[r,e]};default:return{arg:[r,JSON.stringify(e)],json:!0}}};function fZ(r){return{getAll:cZ(r),get:aZ(r),set:uZ(r),replace:lZ(r),profiles:oZ(r)}}l();l();var hZ=N(r=>{async function*e(t,n={}){yield*(await r.post("dag/export",{signal:n.signal,searchParams:L({arg:t.toString()}),headers:n.headers})).iterator()}return e});l();l();var uR=S(W(),1);async function*fR(r,e,t,n,i){let s=async u=>{let f=await t.getCodec(u.code),h=await n(u,i);return f.decode(h)},o=e.split("/").filter(Boolean),a=await s(r),c=r;for(;o.length;){let u=o.shift();if(!u)throw(0,uR.default)(new Error(`Could not resolve path "${e}"`),"ERR_INVALID_PATH");if(Object.prototype.hasOwnProperty.call(a,u))a=a[u],yield{value:a,remainderPath:o.join("/")};else throw(0,uR.default)(new Error(`no link named "${u}" under ${c}`),"ERR_NO_LINK");let f=T.asCID(a);f&&(c=f,a=await s(a))}yield{value:a,remainderPath:""}}var dZ=S(W(),1);var pZ=(r,e)=>N((n,i)=>{let s=O8(i);return async(a,c={})=>{if(c.path){let d=c.localResolve?await hn(fR(a,c.path,r,s,c)):await ir(fR(a,c.path,r,s,c));if(!d)throw(0,dZ.default)(new Error("Not found"),"ERR_NOT_FOUND");return d}let u=await r.getCodec(a.code),f=await s(a,c);return{value:u.decode(f),remainderPath:""}}})(e);l();var mZ=N(r=>{async function*e(t,n={}){let i=new AbortController,s=gn(i.signal,n.signal),{headers:o,body:a}=await mn(t,i,n.headers),c=await r.post("dag/import",{signal:s,headers:o,body:a,searchParams:L({"pin-roots":n.pinRoots})});for await(let{Root:u}of c.ndjson())if(u!==void 0){let{Cid:{"/":f},PinErrorMsg:h}=u;yield{root:{cid:T.parse(f),pinErrorMsg:h}}}}return e});l();var N8=(r,e)=>N(n=>async(s,o={})=>{let a={storeCodec:"dag-cbor",hashAlg:"sha2-256",...o},c;if(a.inputCodec){if(!(s instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");c=s}else c=(await r.getCodec(a.storeCodec)).encode(s),a.inputCodec=a.storeCodec;let u=new AbortController,f=gn(u.signal,a.signal),p=await(await n.post("dag/put",{timeout:a.timeout,signal:f,searchParams:L(a),...await mn([c],u,a.headers)})).json();return T.parse(p.Cid["/"])})(e);l();var gZ=N(r=>async(t,n={})=>{let s=await(await r.post("dag/resolve",{signal:n.signal,searchParams:L({arg:`${t}${n.path?`/${n.path}`.replace(/\/[/]+/g,"/"):""}`,...n}),headers:n.headers})).json();return{cid:T.parse(s.Cid["/"]),remainderPath:s.RemPath}});function yZ(r,e){return{export:hZ(e),get:pZ(r,e),import:mZ(e),put:N8(r,e),resolve:gZ(e)}}l();l();l();l();var co=r=>{if(r.Type===0)return{name:"SENDING_QUERY",type:r.Type};if(r.Type===1)return{from:ae(r.ID),name:"PEER_RESPONSE",type:r.Type,messageType:0,messageName:"PUT_VALUE",closer:(r.Responses||[]).map(({ID:e,Addrs:t})=>({id:ae(e),multiaddrs:t.map(n=>se(n)),protocols:[]})),providers:(r.Responses||[]).map(({ID:e,Addrs:t})=>({id:ae(e),multiaddrs:t.map(n=>se(n)),protocols:[]}))};if(r.Type===2){let e={id:r.ID??ae(r.ID),multiaddrs:[],protocols:[]};return r.Responses&&r.Responses.length&&(e={id:ae(r.Responses[0].ID),multiaddrs:r.Responses[0].Addrs.map(t=>se(t)),protocols:[]}),{name:"FINAL_PEER",type:r.Type,peer:e}}if(r.Type===3)return{name:"QUERY_ERROR",type:r.Type,error:new Error(r.Extra)};if(r.Type===4)return{name:"PROVIDER",type:r.Type,providers:r.Responses.map(({ID:e,Addrs:t})=>({id:ae(e),multiaddrs:t.map(n=>se(n)),protocols:[]}))};if(r.Type===5)return{name:"VALUE",type:r.Type,value:U(r.Extra,"base64pad")};if(r.Type===6){let e=r.Responses.map(({ID:t})=>ae(t));if(!e.length)throw new Error("No peer found");return{name:"ADDING_PEER",type:r.Type,peer:e[0]}}if(r.Type===7)return{name:"DIALING_PEER",type:r.Type,peer:ae(r.ID)};throw new Error("Unknown DHT event type")};var wZ=N(r=>{async function*e(t,n={}){let i=await r.post("dht/findpeer",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers});for await(let s of i.ndjson())yield co(s)}return e});l();var bZ=N(r=>{async function*e(t,n={}){let i=await r.post("dht/findprovs",{signal:n.signal,searchParams:L({arg:t.toString(),...n}),headers:n.headers});for await(let s of i.ndjson())yield co(s)}return e});l();var EZ=N(r=>{async function*e(t,n={}){let i=await r.post("dht/get",{signal:n.signal,searchParams:L({arg:t instanceof Uint8Array?C(t):t.toString(),...n}),headers:n.headers});for await(let s of i.ndjson())yield co(s)}return e});l();var _Z=N(r=>{async function*e(t,n={recursive:!1}){let i=Array.isArray(t)?t:[t],s=await r.post("dht/provide",{signal:n.signal,searchParams:L({arg:i.map(o=>o.toString()),...n}),headers:n.headers});for await(let o of s.ndjson())yield co(o)}return e});l();var vZ=N(r=>{async function*e(t,n,i={}){let s=new AbortController,o=gn(s.signal,i.signal),a=await r.post("dht/put",{signal:o,searchParams:L({arg:t instanceof Uint8Array?C(t):t.toString(),...i}),...await mn([n],s,i.headers)});for await(let c of a.ndjson())yield co(c)}return e});l();var SZ=N(r=>{async function*e(t,n={}){let i=await r.post("dht/query",{signal:n.signal,searchParams:L({arg:t.toString(),...n}),headers:n.headers});for await(let s of i.ndjson())yield co(s)}return e});function xZ(r){return{findPeer:wZ(r),findProvs:bZ(r),get:EZ(r),provide:_Z(r),put:vZ(r),query:SZ(r)}}l();l();var AZ=N(r=>{async function e(t={}){return(await r.post("diag/cmds",{signal:t.signal,searchParams:L(t),headers:t.headers})).json()}return e});l();var TZ=N(r=>{async function e(t={}){return(await r.post("diag/net",{signal:t.signal,searchParams:L(t),headers:t.headers})).json()}return e});l();var IZ=N(r=>{async function e(t={}){return(await r.post("diag/sys",{signal:t.signal,searchParams:L(t),headers:t.headers})).json()}return e});function RZ(r){return{cmds:AZ(r),net:TZ(r),sys:IZ(r)}}l();l();var CZ=N(r=>{async function e(t,n,i={}){await(await r.post("files/chmod",{signal:i.signal,searchParams:L({arg:t,mode:n,...i}),headers:i.headers})).text()}return e});l();var PZ=N(r=>{async function e(t,n,i={}){let s=Array.isArray(t)?t:[t];await(await r.post("files/cp",{signal:i.signal,searchParams:L({arg:s.concat(n).map(a=>T.asCID(a)?`/ipfs/${a}`:a),...i}),headers:i.headers})).text()}return e});l();var kZ=N(r=>{async function e(t,n={}){if(!t||typeof t!="string")throw new Error("ipfs.files.flush requires a path");let s=await(await r.post("files/flush",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers})).json();return T.parse(s.Cid)}return e});l();l();function dy(r){let e=ot(r);return Object.prototype.hasOwnProperty.call(e,"mode")&&(e.mode=parseInt(e.mode,8)),Object.prototype.hasOwnProperty.call(e,"mtime")&&(e.mtime={secs:e.mtime,nsecs:e.mtimeNsecs||0},delete e.mtimeNsecs),e}var NZ=N(r=>{async function*e(t,n={}){if(!t)throw new Error("ipfs.files.ls requires a path");let i=await r.post("files/ls",{signal:n.signal,searchParams:L({arg:T.asCID(t)?`/ipfs/${t}`:t,long:!0,...n,stream:!0}),headers:n.headers});for await(let s of i.ndjson())if("Entries"in s)for(let o of s.Entries||[])yield OZ(dy(o));else yield OZ(dy(s))}return e});function OZ(r){return r.hash&&(r.cid=T.parse(r.hash)),delete r.hash,r.type=r.type===1?"directory":"file",r}l();var DZ=N(r=>{async function e(t,n={}){await(await r.post("files/mkdir",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers})).text()}return e});l();var LZ=N(r=>{async function e(t,n,i={}){Array.isArray(t)||(t=[t]),await(await r.post("files/mv",{signal:i.signal,searchParams:L({arg:t.concat(n),...i}),headers:i.headers})).text()}return e});l();var MZ=S(UZ(),1),FZ=N(r=>{async function*e(t,n={}){let i=await r.post("files/read",{signal:n.signal,searchParams:L({arg:t,count:n.length,...n}),headers:n.headers});yield*(0,MZ.default)(i.body)}return e});l();var VZ=S(Vp(),1),zZ=N(r=>{async function e(t,n={}){let i=await r.post("files/rm",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers}),s=await i.text();if(s!==""){let o=new VZ.default.HTTPError(i);throw o.message=s,o}}return e});l();var D8=N(r=>{async function e(t,n={}){let s=await(await r.post("files/stat",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers})).json();return s.WithLocality=s.WithLocality||!1,M9e(dy(s))}return e});function M9e(r){return r.cid=T.parse(r.hash),delete r.hash,r}l();var KZ=N(r=>{async function e(t,n={}){await(await r.post("files/touch",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers})).text()}return e});l();var qZ=N(r=>{async function e(t,n,i={}){let s=new AbortController,o=gn(s.signal,i.signal);await(await r.post("files/write",{signal:o,searchParams:L({arg:t,streamChannels:!0,count:i.length,...i}),...await mn([{content:n,path:"arg",mode:C8(i.mode),mtime:P8(i.mtime)}],s,i.headers)})).text()}return e});function $Z(r){return{chmod:CZ(r),cp:PZ(r),flush:kZ(r),ls:NZ(r),mkdir:DZ(r),mv:LZ(r),read:FZ(r),rm:zZ(r),stat:D8(r),touch:KZ(r),write:qZ(r)}}l();l();var HZ=S(W(),1),GZ=N(r=>async(t,n,i={})=>{throw(0,HZ.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")});l();var jZ=N(r=>{async function e(t,n){let i=n??{type:"Ed25519"},o=await(await r.post("key/gen",{signal:i.signal,searchParams:L({arg:t,...i}),headers:i.headers})).json();return ot(o)}return e});l();var WZ=N(r=>{async function e(t,n,i,s={}){let a=await(await r.post("key/import",{signal:s.signal,searchParams:L({arg:t,pem:n,password:i,...s}),headers:s.headers})).json();return ot(a)}return e});l();var YZ=S(W(),1),QZ=N(r=>async(t,n={})=>{throw(0,YZ.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")});l();var XZ=N(r=>{async function e(t={}){return((await(await r.post("key/list",{signal:t.signal,searchParams:L(t),headers:t.headers})).json()).Keys||[]).map(s=>ot(s))}return e});l();var ZZ=N(r=>{async function e(t,n,i={}){let s=await r.post("key/rename",{signal:i.signal,searchParams:L({arg:[t,n],...i}),headers:i.headers});return ot(await s.json())}return e});l();var JZ=N(r=>{async function e(t,n={}){let s=await(await r.post("key/rm",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers})).json();return ot(s.Keys[0])}return e});function eJ(r){return{export:GZ(r),gen:jZ(r),import:WZ(r),info:QZ(r),list:XZ(r),rename:ZZ(r),rm:JZ(r)}}l();l();var tJ=N(r=>{async function e(t,n,i={}){let s=await r.post("log/level",{signal:i.signal,searchParams:L({arg:[t,n],...i}),headers:i.headers});return ot(await s.json())}return e});l();var rJ=N(r=>{async function e(t={}){return(await(await r.post("log/ls",{signal:t.signal,searchParams:L(t),headers:t.headers})).json()).Strings}return e});l();var nJ=N(r=>{async function*e(t={}){yield*(await r.post("log/tail",{signal:t.signal,searchParams:L(t),headers:t.headers})).ndjson()}return e});function iJ(r){return{level:tJ(r),ls:rJ(r),tail:nJ(r)}}l();l();var sJ=N(r=>{async function e(t,n={}){let i=await r.post("name/publish",{signal:n.signal,searchParams:L({arg:`${t}`,...n}),headers:n.headers});return ot(await i.json())}return e});l();var oJ=N(r=>{async function*e(t,n={}){let i=await r.post("name/resolve",{signal:n.signal,searchParams:L({arg:t,stream:!0,...n}),headers:n.headers});for await(let s of i.ndjson())yield s.Path}return e});l();l();var aJ=N(r=>{async function e(t,n={}){let i=await r.post("name/pubsub/cancel",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers});return ot(await i.json())}return e});l();var cJ=N(r=>{async function e(t={}){let n=await r.post("name/pubsub/state",{signal:t.signal,searchParams:L(t),headers:t.headers});return ot(await n.json())}return e});l();var lJ=N(r=>{async function e(t={}){return(await(await r.post("name/pubsub/subs",{signal:t.signal,searchParams:L(t),headers:t.headers})).json()).Strings||[]}return e});function uJ(r){return{cancel:aJ(r),state:cJ(r),subs:lJ(r)}}function fJ(r){return{publish:sJ(r),resolve:oJ(r),pubsub:uJ(r)}}l();l();var hJ=N(r=>{async function e(t,n={}){let s=await(await r.post("object/data",{signal:n.signal,searchParams:L({arg:`${t instanceof Uint8Array?T.decode(t):t}`,...n}),headers:n.headers})).arrayBuffer();return new Uint8Array(s,0,s.byteLength)}return e});l();var dJ=N(r=>{async function e(t,n={}){let s=await(await r.post("object/get",{signal:n.signal,searchParams:L({arg:`${t instanceof Uint8Array?T.decode(t):t}`,dataEncoding:"base64",...n}),headers:n.headers})).json();return{Data:U(s.Data,"base64pad"),Links:(s.Links||[]).map(o=>({Name:o.Name,Hash:T.parse(o.Hash),Tsize:o.Size}))}}return e});l();var pJ=N(r=>{async function e(t,n={}){return((await(await r.post("object/links",{signal:n.signal,searchParams:L({arg:`${t instanceof Uint8Array?T.decode(t):t}`,...n}),headers:n.headers})).json()).Links||[]).map(o=>({Name:o.Name,Tsize:o.Size,Hash:T.parse(o.Hash)}))}return e});l();var mJ=N(r=>{async function e(t={}){let n=await r.post("object/new",{signal:t.signal,searchParams:L({arg:t.template,...t}),headers:t.headers}),{Hash:i}=await n.json();return T.parse(i)}return e});l();var gJ=(r,e)=>N(n=>{let i=N8(r,e);async function s(o,a={}){return i(o,{...a,storeCodec:"dag-pb",hashAlg:"sha2-256",version:1})}return s})(e);l();var yJ=N(r=>{async function e(t,n={}){let s=await(await r.post("object/stat",{signal:n.signal,searchParams:L({arg:`${t}`,...n}),headers:n.headers})).json();return{...s,Hash:T.parse(s.Hash)}}return e});l();l();var wJ=N(r=>{async function e(t,n,i={}){let s=await r.post("object/patch/add-link",{signal:i.signal,searchParams:L({arg:[`${t}`,n.Name||n.name||"",(n.Hash||n.cid||"").toString()||null],...i}),headers:i.headers}),{Hash:o}=await s.json();return T.parse(o)}return e});l();var bJ=N(r=>{async function e(t,n,i={}){let s=new AbortController,o=gn(s.signal,i.signal),a=await r.post("object/patch/append-data",{signal:o,searchParams:L({arg:`${t}`,...i}),...await mn([n],s,i.headers)}),{Hash:c}=await a.json();return T.parse(c)}return e});l();var EJ=N(r=>{async function e(t,n,i={}){let s=await r.post("object/patch/rm-link",{signal:i.signal,searchParams:L({arg:[`${t}`,n.Name||n.name||null],...i}),headers:i.headers}),{Hash:o}=await s.json();return T.parse(o)}return e});l();var _J=N(r=>{async function e(t,n,i={}){let s=new AbortController,o=gn(s.signal,i.signal),a=await r.post("object/patch/set-data",{signal:o,searchParams:L({arg:[`${t}`],...i}),...await mn([n],s,i.headers)}),{Hash:c}=await a.json();return T.parse(c)}return e});function vJ(r){return{addLink:wJ(r),appendData:bJ(r),rmLink:EJ(r),setData:_J(r)}}function SJ(r,e){return{data:hJ(e),get:dJ(e),links:pJ(e),new:mJ(e),put:gJ(r,e),stat:yJ(e),patch:vJ(e)}}l();l();var L8=N(r=>{async function*e(t,n={}){for await(let{path:i,recursive:s,metadata:o}of ba(t)){let a=await r.post("pin/add",{signal:n.signal,searchParams:L({...n,arg:i,recursive:s,metadata:o?JSON.stringify(o):void 0,stream:!0}),headers:n.headers});for await(let c of a.ndjson()){if(c.Pins){for(let u of c.Pins)yield T.parse(u);continue}yield T.parse(c)}}}return e});l();function xJ(r){let e=L8(r);return N(()=>{async function t(n,i={}){return ir(e([{path:n,...i}],i))}return t})(r)}l();function AJ(r,e,t){let n={type:r,cid:T.parse(e)};return t&&(n.metadata=t),n}var TJ=N(r=>{async function*e(t={}){let n=[];t.paths&&(n=Array.isArray(t.paths)?t.paths:[t.paths]);let i=await r.post("pin/ls",{signal:t.signal,searchParams:L({...t,arg:n.map(s=>`${s}`),stream:!0}),headers:t.headers});for await(let s of i.ndjson()){if(s.Keys){for(let o of Object.keys(s.Keys))yield AJ(s.Keys[o].Type,o,s.Keys[o].Metadata);return}yield AJ(s.Type,s.Cid,s.Metadata)}}return e});l();var B8=N(r=>{async function*e(t,n={}){for await(let{path:i,recursive:s}of ba(t)){let o=new URLSearchParams(n.searchParams);o.append("arg",`${i}`),s!=null&&o.set("recursive",String(s));let a=await r.post("pin/rm",{signal:n.signal,headers:n.headers,searchParams:L({...n,arg:`${i}`,recursive:s})});for await(let c of a.ndjson()){if(c.Pins){yield*c.Pins.map(u=>T.parse(u));continue}yield T.parse(c)}}}return e});l();var IJ=r=>{let e=B8(r);return N(()=>{async function t(n,i={}){return ir(e([{path:n,...i}],i))}return t})(r)};l();l();l();var U8=({Name:r,Status:e,Cid:t})=>({cid:T.parse(t),name:r,status:e}),RJ=r=>{if(typeof r=="string"&&r!=="")return r;throw new TypeError("service name must be passed")},CJ=r=>{if(T.asCID(r))return r.toString();throw new TypeError(`CID instance expected instead of ${typeof r}`)},E1=({service:r,cid:e,name:t,status:n,all:i})=>{let s=L({service:RJ(r),name:t,force:i?!0:void 0});if(e)for(let o of e)s.append("cid",CJ(o));if(n)for(let o of n)s.append("status",o);return s},PJ=({cid:r,service:e,background:t,name:n,origins:i})=>{let s=L({arg:CJ(r),service:RJ(e),name:n,background:t?!0:void 0});if(i)for(let o of i)s.append("origin",o.toString());return s};function kJ(r){async function e(t,{timeout:n,signal:i,headers:s,...o}){let a=await r.post("pin/remote/add",{timeout:n,signal:i,headers:s,searchParams:PJ({cid:t,...o})});return U8(await a.json())}return e}l();function OJ(r){async function*e({timeout:t,signal:n,headers:i,...s}){let o=await r.post("pin/remote/ls",{timeout:t,signal:n,headers:i,searchParams:E1(s)});for await(let a of o.ndjson())yield U8(a)}return e}l();function NJ(r){async function e({timeout:t,signal:n,headers:i,...s}){await r.post("pin/remote/rm",{timeout:t,signal:n,headers:i,searchParams:E1({...s,all:!1})})}return e}l();function DJ(r){async function e({timeout:t,signal:n,headers:i,...s}){await r.post("pin/remote/rm",{timeout:t,signal:n,headers:i,searchParams:E1({...s,all:!0})})}return e}l();l();l();function LJ(r){let e=String(r);if(e==="undefined")throw Error("endpoint is required");return e[e.length-1]==="/"?e.slice(0,-1):e}function BJ(r){return{service:r.Service,endpoint:new URL(r.ApiEndpoint),...r.Stat&&{stat:F9e(r.Stat)}}}function F9e(r){switch(r.Status){case"valid":{let{Pinning:e,Pinned:t,Queued:n,Failed:i}=r.PinCount;return{status:"valid",pinCount:{queued:n,pinning:e,pinned:t,failed:i}}}case"invalid":return{status:"invalid"};default:return{status:r.Status}}}function UJ(r){async function e(t,n){let{endpoint:i,key:s,headers:o,timeout:a,signal:c}=n;await r.post("pin/remote/service/add",{timeout:a,signal:c,searchParams:L({arg:[t,LJ(i),s]}),headers:o})}return e}l();function MJ(r){async function e(t={}){let{stat:n,headers:i,timeout:s,signal:o}=t,a=await r.post("pin/remote/service/ls",{timeout:s,signal:o,headers:i,searchParams:n===!0?L({stat:n}):void 0}),{RemoteServices:c}=await a.json();return c.map(BJ)}return e}l();function FJ(r){async function e(t,n={}){await r.post("pin/remote/service/rm",{signal:n.signal,headers:n.headers,searchParams:L({arg:t})})}return e}function VJ(r){let e=new Tf(r);return{add:UJ(e),ls:MJ(e),rm:FJ(e)}}function zJ(r){let e=new Tf(r);return{add:kJ(e),ls:OJ(e),rm:NJ(e),rmAll:DJ(e),service:VJ(r)}}function KJ(r){return{addAll:L8(r),add:xJ(r),ls:TJ(r),rmAll:B8(r),rm:IJ(r),remote:zJ(r)}}l();l();l();var qJ=r=>Array.isArray(r)?r.map(M8):r,M8=r=>C(_1(r)),_1=r=>Ql.decode(r),$J=r=>BigInt(`0x${C(Ql.decode(r),"base16")}`),v1=r=>Ql.encode(U(r));var HJ=N(r=>{async function e(t={}){let{Strings:n}=await(await r.post("pubsub/ls",{signal:t.signal,searchParams:L(t),headers:t.headers})).json();return qJ(n)||[]}return e});l();var GJ=N(r=>{async function e(t,n={}){let i=await r.post("pubsub/peers",{signal:n.signal,searchParams:L({arg:v1(t),...n}),headers:n.headers}),{Strings:s}=await i.json();return s||[]}return e});l();var jJ=N(r=>{async function e(t,n,i={}){let s=L({arg:v1(t),...i}),o=new AbortController,a=gn(o.signal,i.signal);await(await r.post("pubsub/pub",{signal:a,searchParams:s,...await mn([n],o,i.headers)})).text()}return e});l();var V9e=k("ipfs-http-client:pubsub:subscribe"),WJ=(r,e)=>N(t=>{async function n(i,s,o={}){o.signal=e.subscribe(i,s,o.signal);let a,c,u=new Promise((h,p)=>{a=h,c=p}),f=setTimeout(()=>a(),1e3);return t.post("pubsub/sub",{signal:o.signal,searchParams:L({arg:v1(i),...o}),headers:o.headers}).catch(h=>{e.unsubscribe(i,s),c(h)}).then(h=>{clearTimeout(f),h&&(z9e(h,{onMessage:p=>{if(s){if(typeof s=="function"){s(p);return}typeof s.handleEvent=="function"&&s.handleEvent(p)}},onEnd:()=>e.unsubscribe(i,s),onError:o.onError}),a())}),u}return n})(r);async function z9e(r,{onMessage:e,onEnd:t,onError:n}){n=n||V9e;try{for await(let i of r.ndjson())try{if(!i.from)continue;i.from!=null&&i.seqno!=null?e({type:"signed",from:ae(i.from),data:_1(i.data),sequenceNumber:$J(i.seqno),topic:M8(i.topicIDs[0]),key:_1(i.key??"u"),signature:_1(i.signature??"u")}):e({type:"unsigned",data:_1(i.data),topic:M8(i.topicIDs[0])})}catch(s){s.message=`Failed to parse pubsub message: ${s.message}`,n(s,!1,i)}}catch(i){K9e(i)||n(i,!0)}finally{t()}}var K9e=r=>{switch(r.type){case"aborted":return!0;case"abort":return!0;default:return r.name==="AbortError"}};l();var YJ=(r,e)=>{async function t(n,i){e.unsubscribe(n,i)}return t};l();var F8=class{constructor(){this._subs=new Map}subscribe(e,t,n){let i=this._subs.get(e)||[];if(i.find(o=>o.handler===t))throw new Error(`Already subscribed to ${e} with this handler`);let s=new AbortController;return this._subs.set(e,[{handler:t,controller:s}].concat(i)),n&&n.addEventListener("abort",()=>this.unsubscribe(e,t)),s.signal}unsubscribe(e,t){let n=this._subs.get(e)||[],i;t?(this._subs.set(e,n.filter(s=>s.handler!==t)),i=n.filter(s=>s.handler===t)):(this._subs.set(e,[]),i=n),(this._subs.get(e)||[]).length||this._subs.delete(e),i.forEach(s=>s.controller.abort())}};function QJ(r){let e=new F8;return{ls:HJ(r),peers:GJ(r),publish:jJ(r),subscribe:WJ(r,e),unsubscribe:YJ(r,e)}}l();l();var XJ=N(r=>{async function*e(t={}){yield*(await r.post("refs/local",{signal:t.signal,transform:ot,searchParams:L(t),headers:t.headers})).ndjson()}return e});var ZJ=N((r,e)=>Object.assign(async function*(n,i={}){let s=Array.isArray(n)?n:[n];yield*(await r.post("refs",{signal:i.signal,searchParams:L({arg:s.map(a=>`${a instanceof Uint8Array?T.decode(a):a}`),...i}),headers:i.headers,transform:ot})).ndjson()},{local:XJ(e)}));l();l();var JJ=N(r=>{async function*e(t={}){yield*(await r.post("repo/gc",{signal:t.signal,searchParams:L(t),headers:t.headers,transform:i=>({err:i.Error?new Error(i.Error):null,cid:(i.Key||{})["/"]?T.parse(i.Key["/"]):null})})).ndjson()}return e});l();var V8=N(r=>{async function e(t={}){let i=await(await r.post("repo/stat",{signal:t.signal,searchParams:L(t),headers:t.headers})).json();return{numObjects:BigInt(i.NumObjects),repoSize:BigInt(i.RepoSize),repoPath:i.RepoPath,version:i.Version,storageMax:BigInt(i.StorageMax)}}return e});l();var eee=N(r=>{async function e(t={}){return(await(await r.post("repo/version",{signal:t.signal,searchParams:L(t),headers:t.headers})).json()).Version}return e});function tee(r){return{gc:JJ(r),stat:V8(r),version:eee(r)}}l();l();var ree=N(r=>{async function*e(t={}){yield*(await r.post("stats/bw",{signal:t.signal,searchParams:L(t),headers:t.headers,transform:i=>({totalIn:BigInt(i.TotalIn),totalOut:BigInt(i.TotalOut),rateIn:parseFloat(i.RateIn),rateOut:parseFloat(i.RateOut)})})).ndjson()}return e});function nee(r){return{bitswap:k8(r),repo:V8(r),bw:ree(r)}}l();l();var iee=N(r=>{async function e(t={}){let n=await r.post("swarm/addrs",{signal:t.signal,searchParams:L(t),headers:t.headers}),{Addrs:i}=await n.json();return Object.keys(i).map(s=>({id:ae(s),addrs:(i[s]||[]).map(o=>se(o))}))}return e});l();var see=N(r=>{async function e(t,n={}){let i=await r.post("swarm/connect",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers}),{Strings:s}=await i.json();return s||[]}return e});l();var oee=N(r=>{async function e(t,n={}){let i=await r.post("swarm/disconnect",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers}),{Strings:s}=await i.json();return s||[]}return e});l();var aee=N(r=>{async function e(t={}){let n=await r.post("swarm/addrs/local",{signal:t.signal,searchParams:L(t),headers:t.headers}),{Strings:i}=await n.json();return(i||[]).map(s=>se(s))}return e});l();var cee=N(r=>{async function e(t={}){let n=await r.post("swarm/peers",{signal:t.signal,searchParams:L(t),headers:t.headers}),{Peers:i}=await n.json();return(i||[]).map(s=>({addr:se(s.Addr),peer:ae(s.Peer),muxer:s.Muxer,latency:s.Latency,streams:s.Streams,direction:s.Direction==null?void 0:s.Direction===0?"inbound":"outbound"}))}return e});function lee(r){return{addrs:iee(r),connect:see(r),disconnect:oee(r),localAddrs:aee(r),peers:cee(r)}}l();l();var z8=N(r=>{async function*e(t,n={}){let i=new AbortController,s=gn(i.signal,n.signal),{headers:o,body:a,total:c,parts:u}=await mn(t,i,n.headers),[f,h]=typeof n.progress=="function"?q9e(c,u,n.progress):[void 0,void 0],p=await r.post("add",{searchParams:L({"stream-channels":!0,...n,progress:Boolean(f)}),onUploadProgress:h,signal:s,headers:o,body:a});for await(let d of p.ndjson())d=ot(d),d.hash!==void 0?yield H9e(d):f&&f(d.bytes||0,d.name)}return e}),q9e=(r,e,t)=>e?[void 0,$9e(r,e,t)]:[t,void 0],$9e=(r,e,t)=>{let n=0,i=e.length;return({loaded:s,total:o})=>{let a=Math.floor(s/o*r);for(;n<i;){let{start:c,end:u,name:f}=e[n];if(a<u){t(a-c,f);break}else t(u-c,f),n+=1}}};function H9e({name:r,hash:e,size:t,mode:n,mtime:i,mtimeNsecs:s}){let o={path:r,cid:T.parse(e),size:parseInt(t)};return n!=null&&(o.mode=parseInt(n,8)),i!=null&&(o.mtime={secs:i,nsecs:s||0}),o}function uee(r){let e=z8(r);return N(()=>{async function t(n,i={}){return await ir(e(m6(n),i))}return t})(r)}l();var fee=N(r=>{async function*e(t,n={}){yield*(await r.post("cat",{signal:n.signal,searchParams:L({arg:t.toString(),...n}),headers:n.headers})).iterator()}return e});l();var hee=N(r=>async(t={})=>(await r.post("commands",{signal:t.signal,searchParams:L(t),headers:t.headers})).json());l();var dee=N(r=>async(t,n={})=>(await(await r.post("dns",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers})).json()).Path);l();var pee=N(r=>()=>{let e=new URL(r.opts.base||"");return{host:e.hostname,port:e.port,protocol:e.protocol,pathname:e.pathname,"api-path":e.pathname}});l();var mee=N(r=>{async function*e(t,n={}){let i={arg:`${t instanceof Uint8Array?T.decode(t):t}`,...n};i.compressionLevel&&(i["compression-level"]=i.compressionLevel,delete i.compressionLevel),yield*(await r.post("get",{signal:n.signal,searchParams:L(i),headers:n.headers})).iterator()}return e});l();var K8=N(r=>{async function e(t={}){let i=await(await r.post("id",{signal:t.signal,searchParams:L({arg:t.peerId?t.peerId.toString():void 0,...t}),headers:t.headers})).json(),s={...ot(i)};return s.id=ae(s.id),s.addresses&&(s.addresses=s.addresses.map(o=>se(o))),s}return e});l();var gee=r=>{let e=K8(r);async function t(n={}){let i=await e(n);return Boolean(i&&i.addresses&&i.addresses.length)}return t};l();var yee=N((r,e)=>{async function*t(n,i={}){let s=`${n instanceof Uint8Array?T.decode(n):n}`;async function o(c){let u=c.Hash;if(u.includes("/")){let h=u.startsWith("/ipfs/")?u:`/ipfs/${u}`;u=(await D8(e)(h)).cid}else u=T.parse(u);let f={name:c.Name,path:s+(c.Name?`/${c.Name}`:""),size:c.Size,cid:u,type:G9e(c)};return c.Mode&&(f.mode=parseInt(c.Mode,8)),c.Mtime!==void 0&&c.Mtime!==null&&(f.mtime={secs:c.Mtime},c.MtimeNsecs!==void 0&&c.MtimeNsecs!==null&&(f.mtime.nsecs=c.MtimeNsecs)),f}let a=await r.post("ls",{signal:i.signal,searchParams:L({arg:s,...i}),headers:i.headers});for await(let c of a.ndjson()){if(c=c.Objects,!c)throw new Error("expected .Objects in results");if(c=c[0],!c)throw new Error("expected one array in results.Objects");let u=c.Links;if(!Array.isArray(u))throw new Error("expected one array in results.Objects[0].Links");if(!u.length){yield o(c);return}yield*u.map(o)}}return t});function G9e(r){switch(r.Type){case 1:case 5:return"dir";case 2:return"file";default:return"file"}}l();var wee=N(r=>{async function e(t={}){let n=await r.post("dns",{signal:t.signal,searchParams:L(t),headers:t.headers});return ot(await n.json())}return e});l();var bee=N(r=>{async function*e(t,n={}){yield*(await r.post("ping",{signal:n.signal,searchParams:L({arg:`${t}`,...n}),headers:n.headers,transform:ot})).ndjson()}return e});l();var Eee=N(r=>{async function e(t,n={}){let i=await r.post("resolve",{signal:n.signal,searchParams:L({arg:t,...n}),headers:n.headers}),{Path:s}=await i.json();return s}return e});l();var _ee=S(W(),1),vee=N(r=>async(t={})=>{throw(0,_ee.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")});l();var See=N(r=>{async function e(t={}){await(await r.post("shutdown",{signal:t.signal,searchParams:L(t),headers:t.headers})).text()}return e});l();var xee=N(r=>{async function e(t={}){let n=await r.post("version",{signal:t.signal,searchParams:L(t),headers:t.headers});return{...ot(await n.json()),"ipfs-http-client":"1.0.0"}}return e});var Q9e=S(hR(),1),X9e=S(dR(),1);function Tee(r={}){let e={name:un.name,code:un.code,encode:u=>u,decode:u=>u},t=Object.values(Ar);(r.ipld&&r.ipld.bases?r.ipld.bases:[]).forEach(u=>t.push(u));let n=new y1({bases:t,loadBase:r.ipld&&r.ipld.loadBase}),i=Object.values(d4);[ut,Cc,Op,Om,e].concat(r.ipld&&r.ipld.codecs||[]).forEach(u=>i.push(u));let s=new w1({codecs:i,loadCodec:r.ipld&&r.ipld.loadCodec}),o=Object.values(h4);(r.ipld&&r.ipld.hashers?r.ipld.hashers:[]).forEach(u=>o.push(u));let a=new b1({hashers:o,loadHasher:r.ipld&&r.ipld.loadHasher});return{add:uee(r),addAll:z8(r),bitswap:zX(r),block:XX(r),bootstrap:nZ(r),cat:fee(r),commands:hee(r),config:fZ(r),dag:yZ(s,r),dht:xZ(r),diag:RZ(r),dns:dee(r),files:$Z(r),get:mee(r),getEndpointConfig:pee(r),id:K8(r),isOnline:gee(r),key:eJ(r),log:iJ(r),ls:yee(r),mount:wee(r),name:fJ(r),object:SJ(s,r),pin:KJ(r),ping:bee(r),pubsub:QJ(r),refs:ZJ(r),repo:tee(r),resolve:Eee(r),start:vee(r),stats:nee(r),stop:See(r),swarm:lee(r),version:xee(r),bases:n,codecs:s,hashers:a}}l();l();l();var Ty=S(W(),1);l();l();var pte=S(W(),1);l();l();l();l();l();l();l();l();l();l();var Zo=Object.create(null);Zo.open="0";Zo.close="1";Zo.ping="2";Zo.pong="3";Zo.message="4";Zo.upgrade="5";Zo.noop="6";var py=Object.create(null);Object.keys(Zo).forEach(r=>{py[Zo[r]]=r});var Iee={type:"error",data:"parser error"};var Z9e=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",J9e=typeof ArrayBuffer=="function",eve=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,tve=({type:r,data:e},t,n)=>Z9e&&e instanceof Blob?t?n(e):Ree(e,n):J9e&&(e instanceof ArrayBuffer||eve(e))?t?n(e):Ree(new Blob([e]),n):n(Zo[r]+(e||"")),Ree=(r,e)=>{let t=new FileReader;return t.onload=function(){let n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)},q8=tve;l();l();var Cee="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",my=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<Cee.length;r++)my[Cee.charCodeAt(r)]=r;var Pee=r=>{let e=r.length*.75,t=r.length,n,i=0,s,o,a,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);let u=new ArrayBuffer(e),f=new Uint8Array(u);for(n=0;n<t;n+=4)s=my[r.charCodeAt(n)],o=my[r.charCodeAt(n+1)],a=my[r.charCodeAt(n+2)],c=my[r.charCodeAt(n+3)],f[i++]=s<<2|o>>4,f[i++]=(o&15)<<4|a>>2,f[i++]=(a&3)<<6|c&63;return u};var rve=typeof ArrayBuffer=="function",nve=(r,e)=>{if(typeof r!="string")return{type:"message",data:kee(r,e)};let t=r.charAt(0);return t==="b"?{type:"message",data:ive(r.substring(1),e)}:py[t]?r.length>1?{type:py[t],data:r.substring(1)}:{type:py[t]}:Iee},ive=(r,e)=>{if(rve){let t=Pee(r);return kee(t,e)}else return{base64:!0,data:r}},kee=(r,e)=>{switch(e){case"blob":return r instanceof ArrayBuffer?new Blob([r]):r;case"arraybuffer":default:return r}},$8=nve;var Oee=String.fromCharCode(30),Nee=(r,e)=>{let t=r.length,n=new Array(t),i=0;r.forEach((s,o)=>{q8(s,!1,a=>{n[o]=a,++i===t&&e(n.join(Oee))})})},Dee=(r,e)=>{let t=r.split(Oee),n=[];for(let i=0;i<t.length;i++){let s=$8(t[i],e);if(n.push(s),s.type==="error")break}return n},pR=4;l();function mr(r){if(r)return sve(r)}function sve(r){for(var e in mr.prototype)r[e]=mr.prototype[e];return r}mr.prototype.on=mr.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};mr.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};mr.prototype.off=mr.prototype.removeListener=mr.prototype.removeAllListeners=mr.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,i=0;i<t.length;i++)if(n=t[i],n===e||n.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+r],this};mr.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,i=t.length;n<i;++n)t[n].apply(this,e)}return this};mr.prototype.emitReserved=mr.prototype.emit;mr.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};mr.prototype.hasListeners=function(r){return!!this.listeners(r).length};l();l();var Si=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function H8(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}var ove=Si.setTimeout,ave=Si.clearTimeout;function wl(r,e){e.useNativeTimers?(r.setTimeoutFn=ove.bind(Si),r.clearTimeoutFn=ave.bind(Si)):(r.setTimeoutFn=Si.setTimeout.bind(Si),r.clearTimeoutFn=Si.clearTimeout.bind(Si))}var cve=1.33;function Lee(r){return typeof r=="string"?lve(r):Math.ceil((r.byteLength||r.size)*cve)}function lve(r){let e=0,t=0;for(let n=0,i=r.length;n<i;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}var mR=class extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}},kd=class extends mr{constructor(e){super(),this.writable=!1,wl(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new mR(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=$8(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}};l();var Fee="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),gR=64,uve={},Bee=0,G8=0,Uee;function Mee(r){let e="";do e=Fee[r%gR]+e,r=Math.floor(r/gR);while(r>0);return e}function j8(){let r=Mee(+new Date);return r!==Uee?(Bee=0,Uee=r):r+"."+Mee(Bee++)}for(;G8<gR;G8++)uve[Fee[G8]]=G8;l();function W8(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function Vee(r){let e={},t=r.split("&");for(let n=0,i=t.length;n<i;n++){let s=t[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}l();l();var zee=!1;try{zee=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var Kee=zee;function yR(r){let e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Kee))return new XMLHttpRequest}catch{}if(!e)try{return new Si[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function fve(){}var hve=function(){return new yR({xdomain:!1}).responseType!=null}(),Y8=class extends kd{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){let n=location.protocol==="https:",i=location.port;i||(i=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==n}let t=e&&e.forceBase64;this.supportsBinary=hve&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";let t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){let t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Dee(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){let e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Nee(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{},t=this.opts.secure?"https":"http",n="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=j8()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port);let i=W8(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new lo(this.uri(),e)}doWrite(e,t){let n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}},lo=class extends mr{constructor(e,t){super(),wl(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){let e=H8(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;let t=this.xhr=new yR(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.opts.extraHeaders[n])}}catch{}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{t.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document<"u"&&(this.index=lo.requestsCount++,lo.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=fve,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete lo.requests[this.index],this.xhr=null}}onLoad(){let e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};lo.requestsCount=0;lo.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",qee);else if(typeof addEventListener=="function"){let r="onpagehide"in Si?"pagehide":"unload";addEventListener(r,qee,!1)}}function qee(){for(let r in lo.requests)lo.requests.hasOwnProperty(r)&&lo.requests[r].abort()}l();l();var gy=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),yy=Si.WebSocket||Si.MozWebSocket,Q8=!0,$ee="arraybuffer";var Hee=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",X8=class extends kd{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let e=this.uri(),t=this.opts.protocols,n=Hee?{}:H8(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Q8&&!Hee?t?new yy(e,t):new yy(e):new yy(e,t,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||$ee,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let n=e[t],i=t===e.length-1;q8(n,this.supportsBinary,s=>{let o={};Q8||(n.options&&(o.compress=n.options.compress),this.opts.perMessageDeflate&&(typeof s=="string"?Buffer.byteLength(s):s.length)<this.opts.perMessageDeflate.threshold&&(o.compress=!1));try{Q8?this.ws.send(s):this.ws.send(s,o)}catch{}i&&gy(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{},t=this.opts.secure?"wss":"ws",n="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=j8()),this.supportsBinary||(e.b64=1);let i=W8(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}check(){return!!yy}};var wR={websocket:X8,polling:Y8};l();var dve=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,pve=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function S1(r){let e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let i=dve.exec(r||""),s={},o=14;for(;o--;)s[pve[o]]=i[o]||"";return t!=-1&&n!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=mve(s,s.path),s.queryKey=gve(s,s.query),s}function mve(r,e){let t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function gve(r,e){let t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(t[i]=s)}),t}var Rs=class extends mr{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=S1(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=S1(t.host).host),wl(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Vee(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){let t=Object.assign({},this.opts.query);t.EIO=pR,t.transport=e,this.id&&(t.sid=this.id);let n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new wR[e](n)}open(){let e;if(this.opts.rememberUpgrade&&Rs.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;Rs.priorWebsocketSuccess=!1;let i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!n)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Rs.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(f(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{let p=new Error("probe error");p.transport=t.name,this.emitReserved("upgradeError",p)}}))};function s(){n||(n=!0,f(),t.close(),t=null)}let o=h=>{let p=new Error("probe error: "+h);p.transport=t.name,s(),this.emitReserved("upgradeError",p)};function a(){o("transport closed")}function c(){o("socket closed")}function u(h){t&&h.name!==t.name&&s()}let f=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",u)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",u),t.open()}onOpen(){if(this.readyState="open",Rs.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0,t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){let i=this.writeBuffer[n].data;if(i&&(t+=Lee(i)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,i){if(typeof t=="function"&&(i=t,t=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;let s={type:e,data:t,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){let e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){Rs.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){let t=[],n=0,i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}};Rs.protocol=pR;var MPt=Rs.protocol;function Gee(r,e="",t){let n=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),n=S1(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";let s=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+e,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}l();l();var SR={};jt(SR,{Decoder:()=>Ey,Encoder:()=>_R,PacketType:()=>at,protocol:()=>Qee});l();l();l();var yve=typeof ArrayBuffer=="function",wve=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,jee=Object.prototype.toString,bve=typeof Blob=="function"||typeof Blob<"u"&&jee.call(Blob)==="[object BlobConstructor]",Eve=typeof File=="function"||typeof File<"u"&&jee.call(File)==="[object FileConstructor]";function by(r){return yve&&(r instanceof ArrayBuffer||wve(r))||bve&&r instanceof Blob||Eve&&r instanceof File}function wy(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(wy(r[t]))return!0;return!1}if(by(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return wy(r.toJSON(),!0);for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&wy(r[t]))return!0;return!1}function Wee(r){let e=[],t=r.data,n=r;return n.data=bR(t,e),n.attachments=e.length,{packet:n,buffers:e}}function bR(r,e){if(!r)return r;if(by(r)){let t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=bR(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){let t={};for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=bR(r[n],e));return t}return r}function Yee(r,e){return r.data=ER(r.data,e),delete r.attachments,r}function ER(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=ER(r[t],e);else if(typeof r=="object")for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=ER(r[t],e));return r}var Qee=5,at;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(at||(at={}));var _R=class{constructor(e){this.replacer=e}encode(e){return(e.type===at.EVENT||e.type===at.ACK)&&wy(e)?this.encodeAsBinary({type:e.type===at.EVENT?at.BINARY_EVENT:at.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===at.BINARY_EVENT||e.type===at.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t=Wee(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}},Ey=class extends mr{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let n=t.type===at.BINARY_EVENT;n||t.type===at.BINARY_ACK?(t.type=n?at.EVENT:at.ACK,this.reconstructor=new vR(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(by(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,n={type:Number(e.charAt(0))};if(at[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===at.BINARY_EVENT||n.type===at.BINARY_ACK){let s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(t+1)==="/"){let s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(s,t)}else n.nsp="/";let i=e.charAt(t+1);if(i!==""&&Number(i)==i){let s=t+1;for(;++t;){let o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}n.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){let s=this.tryParse(e.substr(t));if(Ey.isPayloadValid(n.type,s))n.data=s;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case at.CONNECT:return typeof t=="object";case at.DISCONNECT:return t===void 0;case at.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case at.EVENT:case at.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="string"||typeof t[0]=="number");case at.ACK:case at.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},vR=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=Yee(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};l();function Cs(r,e,t){return r.on(e,t),function(){r.off(e,t)}}var _ve=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),x1=class extends mr{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[Cs(e,"open",this.onopen.bind(this)),Cs(e,"packet",this.onpacket.bind(this)),Cs(e,"error",this.onerror.bind(this)),Cs(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(_ve.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let n={type:at.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let o=this.ids++,a=t.pop();this._registerAckCallback(o,a),n.id=o}let i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;let i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}let s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}emitWithAck(e,...t){let n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{t.push((o,a)=>n?o?s(o):i(a):i(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());let n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;let t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:at.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case at.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case at.EVENT:case at.BINARY_EVENT:this.onevent(e);break;case at.ACK:case at.BINARY_ACK:this.onack(e);break;case at.DISCONNECT:this.ondisconnect();break;case at.CONNECT_ERROR:this.destroy();let n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){let t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,n=!1;return function(...i){n||(n=!0,t.packet({type:at.ACK,id:e,data:i}))}}onack(e){let t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:at.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let n of t)n.apply(this,e.data)}}};l();function Od(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Od.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};Od.prototype.reset=function(){this.attempts=0};Od.prototype.setMin=function(r){this.ms=r};Od.prototype.setMax=function(r){this.max=r};Od.prototype.setJitter=function(r){this.jitter=r};var A1=class extends mr{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,wl(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new Od({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let i=t.parser||SR;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Rs(this.uri,this.opts);let t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;let i=Cs(t,"open",function(){n.onopen(),e&&e()}),s=Cs(t,"error",o=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",o),e?e(o):n.maybeReconnectOnOpen()});if(this._timeout!==!1){let o=this._timeout;o===0&&i();let a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(Cs(e,"ping",this.onping.bind(this)),Cs(e,"data",this.ondata.bind(this)),Cs(e,"error",this.onerror.bind(this)),Cs(e,"close",this.onclose.bind(this)),Cs(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){gy(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new x1(this,e,t),this.nsps[e]=n),n}_destroy(e){let t=Object.keys(this.nsps);for(let n of t)if(this.nsps[n].active)return;this._close()}_packet(e){let t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var _y={};function vy(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};let t=Gee(r,e.path||"/socket.io"),n=t.source,i=t.id,s=t.path,o=_y[i]&&s in _y[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o,c;return a?c=new A1(n,e):(_y[i]||(_y[i]=new A1(n,e)),c=_y[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(vy,{Manager:A1,Socket:x1,io:vy,connect:vy});l();l();l();var Sy=S(W(),1),nte=S(Z8(),1);l();var Jee=S(W(),1);var Zee=64*1024,Sve=5*1e3,J8=class{constructor(e,t){this.label=e.label,this.open=bt(),this.channel=e,this.channel.binaryType="arraybuffer",this.log=t.log,typeof this.channel.bufferedAmountLowThreshold=="number"&&(this.channel.bufferedAmountLowThreshold=Zee),e.addEventListener("message",i=>{t.onMessage(i)}),e.addEventListener("bufferedamountlow",()=>{this.log("stop backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open.resolve()}),e.addEventListener("open",()=>{this.open.resolve(),t.onOpen()}),e.addEventListener("close",()=>{t.onClose()}),e.addEventListener("error",i=>{if(i.error?.message==="Transport channel closed")return this.close();t.log.error('channel encounter an error in state "%s" message: "%s" detail: "%s',e.readyState,i.error?.message,i.error?.errorDetail);let s=i.error instanceof Error?i.error:new Error(`datachannel error: ${i.error?.message} ${i.error?.errorDetail}`);t.onError((0,Jee.default)(s,"ERR_DATA_CHANNEL"))});let n=!1;this.closingInterval=setInterval(()=>{e.readyState==="closing"?(n&&t.onClose(),n=!0):n=!1},Sve)}async send(e){await this.open.promise,this.channel.send(e),this.channel.bufferedAmount>Zee&&(this.log("start backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open=bt())}close(){clearInterval(this.closingInterval),this.channel.close()}get bufferedAmount(){return this.channel.bufferedAmount}};var ite=S(TR(),1),Ave={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}]};function Tve(){if(typeof globalThis>"u")throw(0,Sy.default)(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");let r={RTCPeerConnection:globalThis.RTCPeerConnection??globalThis.mozRTCPeerConnection??globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription??globalThis.mozRTCSessionDescription??globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate??globalThis.mozRTCIceCandidate??globalThis.webkitRTCIceCandidate};if(r.RTCPeerConnection==null)throw(0,Sy.default)(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");return r}var Nd=class extends Fe{constructor(e){super(),this.id=e.id??C((0,nte.default)(4),"hex").slice(0,7),this.log=k(`libp2p:webrtc-peer:${e.logPrefix}:${this.id}`),this.wrtc=e.wrtc??Tve(),this.peerConnection=new this.wrtc.RTCPeerConnection(Object.assign({},Ave,e.peerConnectionConfig)),this.closed=!1,this.connected=bt(),this.source=dt(),this.sink=async t=>{if(await this.connected.promise,this.channel==null)throw(0,Sy.default)(new Error("Connected but no channel?!"),"ERR_DATA_CHANNEL");for await(let n of t)await this.channel.send(n);await this.close()}}handleDataChannelEvent(e){let t=e.channel;if(t==null){this.close((0,Sy.default)(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL")).catch(n=>{this.log("Error closing after event channel was found to be null",n)});return}this.channel=new J8(t,{log:this.log,onMessage:n=>{this.source.push(new Uint8Array(n.data))},onOpen:()=>{this.connected.resolve(),this.dispatchEvent(new ne("ready"))},onClose:()=>{this.close().catch(n=>{this.log("error closing connection after channel close",n)})},onError:n=>{this.close(n).catch(i=>{this.log("error closing connection after channel error",i)})}})}async close(e){if(this.closed=!0,e==null&&this.channel!=null)for(;this.channel.bufferedAmount>0;)await(0,ite.default)(100);this.channel?.close(),this.peerConnection.close(),this.source.end(e),this.dispatchEvent(new ne("close"))}};l();var ste=S(W(),1),T1=class extends Fe{constructor(e){super(),this.log=e.log,this.peerConnection=e.peerConnection,this.wrtc=e.wrtc,this.status="idle",this.peerConnection.addEventListener("negotiationneeded",()=>{this.log("peer connection negotiation needed"),this.handleRenegotiate({type:"renegotiate"}).catch(t=>{this.log.error("could not renegotiate %o",t)})})}async handleSignal(e){if(this.log('incoming signal "%s"',e.type),e.type==="offer")return await this.handleOffer(e);if(e.type==="answer")return await this.handleAnswer(e);if(e.type==="candidate")return await this.handleCandidate(e);if(e.type==="renegotiate")return await this.handleRenegotiate(e);if(e.type==="goodbye")return await this.handleGoodye(e);this.log(`Unknown signal type ${e.type}`)}async handleOffer(e){}async handleAnswer(e){}async handleRenegotiate(e){}async handleGoodye(e){this.peerConnection.close()}async handleCandidate(e){let t=new this.wrtc.RTCIceCandidate(e.candidate);try{await this.peerConnection.addIceCandidate(t)}catch(n){if(t.address==null||t.address.endsWith(".local"))this.log("ignoring unsupported ICE candidate.");else throw(0,ste.default)(n,"ERR_ADD_ICE_CANDIDATE")}}};var ote=k("libp2p:webrtc-peer:receiver"),xy=class extends Nd{constructor(e={}){super({...e,logPrefix:"receiver"}),this.handshake=new IR({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,answerOptions:e.answerOptions}),this.handshake.addEventListener("signal",t=>this.dispatchEvent(new ne("signal",{detail:t.detail}))),this.peerConnection.addEventListener("datachannel",t=>{this.handleDataChannelEvent(t)})}handleSignal(e){this.handshake.handleSignal(e).catch(t=>{this.log("error handling signal %o %o",e,t)})}},IR=class extends T1{constructor(e){super(e),this.options=e,this.status="idle",this.iceCandidates=[]}async handleRenegotiate(){ote.trace("renegotiate"),this.dispatchEvent(new ne("signal",{detail:{type:"renegotiate"}}))}async handleOffer(e){await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e));for(let n of this.iceCandidates)await this.handleCandidate(n);this.iceCandidates=[];let t=await this.peerConnection.createAnswer(this.options.answerOptions);await this.peerConnection.setLocalDescription(t),ote.trace("handle offer",this.peerConnection.localDescription),this.dispatchEvent(new ne("signal",{detail:this.peerConnection.localDescription??t}))}async handleCandidate(e){if(this.peerConnection.remoteDescription==null||this.peerConnection.remoteDescription.type==null){this.iceCandidates.push(e);return}await super.handleCandidate(e)}};l();var ute=S(Z8(),1);l();l();var eb=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},RR=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},ate=r=>globalThis.DOMException===void 0?new RR(r):new DOMException(r),cte=r=>{let e=r.reason===void 0?ate("This operation was aborted."):r.reason;return e instanceof Error?e:ate(e)};function CR(r,e,t,n){let i,s=new Promise((o,a)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){o(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){let{signal:c}=n;c.aborted&&a(cte(c)),c.addEventListener("abort",()=>{a(cte(c))})}i=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{o(t())}catch(f){a(f)}return}let c=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,u=t instanceof Error?t:new eb(c);typeof r.cancel=="function"&&r.cancel(),a(u)},e),(async()=>{try{o(await r)}catch(c){a(c)}finally{n.customTimers.clearTimeout.call(void 0,i)}})()});return s.clear=()=>{clearTimeout(i),i=void 0},s}var Ive=r=>{let e=r.on||r.addListener||r.addEventListener,t=r.off||r.removeListener||r.removeEventListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function Rve(r,e,t){let n,i=new Promise((s,o)=>{if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");let a=[e].flat(),c=[],{addListener:u,removeListener:f}=Ive(r),h=(...d)=>{let m=t.multiArgs?d:d[0];t.filter&&!t.filter(m)||(c.push(m),t.count===c.length&&(n(),s(c)))},p=d=>{n(),o(d)};n=()=>{for(let d of a)f(d,h);for(let d of t.rejectionEvents)f(d,p)};for(let d of a)u(d,h);for(let d of t.rejectionEvents)u(d,p);t.resolveImmediately&&s(c)});if(i.cancel=n,typeof t.timeout=="number"){let s=CR(i,t.timeout);return s.cancel=n,s}return i}function lte(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};let n=Rve(r,e,t),i=n.then(s=>s[0]);return i.cancel=n.cancel,i}var fte=S(TR(),1);var PR=k("libp2p:webrtc-peer:initator"),Cve=1e3,Ay=class extends Nd{constructor(e={}){super({...e,logPrefix:"initiator"}),this.handleDataChannelEvent({channel:this.peerConnection.createDataChannel(e.dataChannelLabel??C((0,ute.default)(20),"hex").slice(0,7),e.dataChannelInit)}),this.handshake=new kR({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,offerOptions:e.offerOptions}),this.handshake.addEventListener("signal",t=>{this.dispatchEvent(new ne("signal",{detail:t.detail}))})}handleSignal(e){this.handshake.handleSignal(e).catch(t=>{this.log("error handling signal %o %o",e,t)})}},kR=class extends T1{constructor(e){super(e),this.options=e,this.status="idle",this.peerConnection.addEventListener("icecandidate",t=>{if(t.candidate==null)return;let n={type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}};PR.trace("create candidate",n),this.dispatchEvent(new ne("signal",{detail:n})),this.dispatchEvent(new ne("ice-candidate"))})}async handleRenegotiate(){if(this.status==="negotiating"){this.log("already negotiating, queueing");return}this.status="negotiating";let e=await this.peerConnection.createOffer(this.options.offerOptions);await this.peerConnection.setLocalDescription(e),await lte(this,"ice-candidate"),await(0,fte.default)(Cve),PR.trace("renegotiate",this.peerConnection.localDescription),this.dispatchEvent(new ne("signal",{detail:this.peerConnection.localDescription??e}))}async handleAnswer(e){PR.trace("handle answer",e),await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e)),this.status="idle"}};l();var OR=k("libp2p:webrtc-star:socket");function tb(r,e){let{sink:t,source:n}=r,i={remoteAddr:e.remoteAddr,async sink(s){e.signal!=null&&(s=ni(s,e.signal));try{await t(s)}catch(o){o.type!=="aborted"&&OR.error(o)}},source:e.signal!=null?ni(n,e.signal):n,timeline:{open:Date.now()},async close(){if(r.closed)return;let s=Date.now(),o=setTimeout(()=>{if(i.remoteAddr!=null){let{host:a,port:c}=i.remoteAddr.toOptions();OR("timeout closing socket to %s:%s after %dms, destroying it manually",a,c,Date.now()-s)}r.closed||r.close().catch(a=>{OR.error("could not close socket",a)})},2e3);try{await r.close()}finally{clearTimeout(o)}}};return r.addEventListener("close",()=>{i.timeline.close==null&&(i.timeline.close=Date.now())},{once:!0}),i}l();function rb(r){let e=r.toString().split("/"),t=r.protos()[1].name,n=r.protos()[2].name,i=r.stringTuples()[1][1];if(t!=="tcp"||n!=="ws"&&n!=="wss")throw new Error(`invalid multiaddr: ${r.toString()}`);if(!jL(r))return`http://${e[2]}:${e[4]}`;if(n==="ws")return`http://${e[2]}${i==null||i==="80"?"":`:${i}`}`;if(n==="wss")return`https://${e[2]}${i==null||i==="443"?"":`:${i}`}`;throw new Error("invalid multiaddr: "+r.toString())}function hte(r){let e="/libp2p-webrtc-star";if(r.startsWith(e)){r=r.substring(e.length,r.length);let t=se(r),n=t.stringTuples().filter(i=>i[0]===421)[0];if(n[1]==null)throw new Error("invalid multiaddr: "+r);t=t.decapsulate("p2p"),t=t.encapsulate("/p2p-webrtc-star"),t=t.encapsulate(`/p2p/${n[1]}`),r=t.toString()}return r}var xi=k("libp2p:webrtc-star:listener"),kve={transports:["websocket"],path:"/socket.io-next/"},NR=class extends Fe{constructor(e,t,n,i,s){super(),this.signallingAddr=t,this.socket=vy(e,kve),this.connections=[],this.channels=new Map,this.pendingSignals=new Map,this.upgrader=n,this.handler=i,this.channelOptions=s,this.handleWsHandshake=this.handleWsHandshake.bind(this);let o=!1;this.socket.on("connect_error",a=>{o&&a.type==="TransportError"||this.dispatchEvent(new ne("error",{detail:a}))}),this.socket.on("error",a=>{this.dispatchEvent(new ne("error",{detail:a}))}),this.socket.on("ws-handshake",this.handleWsHandshake),this.socket.on("ws-peer",a=>{this.dispatchEvent(new ne("peer",{detail:a}))}),this.socket.on("connect",()=>{this.socket.emit("ss-join",this.signallingAddr.toString()),o&&this.dispatchEvent(new ne("reconnect"))}),this.socket.once("connect",()=>{o=!0,this.dispatchEvent(new ne("listening"))}),this.socket.on("disconnect",()=>{this.dispatchEvent(new ne("disconnect"))})}_createChannel(e,t,n){let i={...this.channelOptions},s=new xy(i),o=a=>{let c=a.detail;xi.error("incoming connection errored",c)};return s.addEventListener("error",o),s.addEventListener("close",()=>{s.removeEventListener("error",o)},{once:!0}),s.addEventListener("signal",a=>{let c=a.detail;this.socket.emit("ss-handshake",{intentId:e,srcMultiaddr:t,dstMultiaddr:n,answer:!0,signal:c})}),s.addEventListener("ready",()=>{let a=tb(s,{remoteAddr:this.signallingAddr});xi("new inbound connection %s",a.remoteAddr);try{this.upgrader.upgradeInbound(a).then(c=>{xi("inbound connection %s upgraded",a.remoteAddr),this.connections.push(a);let u=()=>{this.connections=this.connections.filter(f=>f!==a),this.channels.delete(e),this.pendingSignals.delete(e)};s.addEventListener("close",u,{once:!0}),this.dispatchEvent(new ne("connection",{detail:c})),this.handler(c)}).catch(c=>{xi.error("inbound connection failed to upgrade",c),a.close().catch(u=>{xi.error("inbound connection failed to close after failing to upgrade",u)})})}catch(c){xi.error("inbound connection failed to upgrade",c),a.close().catch(u=>{xi.error("inbound connection failed to close after failing to upgrade",u)})}},{once:!0}),s}handleWsHandshake(e){if(xi('incoming handshake. signal type "%s" is answer %s',e.signal.type,e.answer),e.answer===!0||e.err!=null||e.intentId==null)return;let t=e.intentId,n=this.pendingSignals.get(t);n==null&&(n=[],this.pendingSignals.set(t,n)),n.push(e);let i=this.channels.get(t);if(i==null){if(e.signal.type!=="offer"){xi("handshake is not an offer and channel does not exist, buffering until we receive an offer");return}xi("creating new channel to handle offer handshake"),i=this._createChannel(e.intentId,e.srcMultiaddr,e.dstMultiaddr),this.channels.set(t,i)}else xi("channel already exists, using it to handle handshake");for(;n.length>0;){let s=n.shift();s?.signal!=null&&i.handleSignal(s.signal)}}async close(){this.socket.emit("ss-leave",this.signallingAddr.toString()),this.socket.removeAllListeners(),this.socket.close(),await Promise.all([...this.connections.map(async e=>await e.close()),...Array.from(this.channels.values()).map(async e=>await e.close())]),this.dispatchEvent(new ne("close"))}},DR=class extends Fe{constructor(e,t,n,i,s){super(),this.upgrader=e,this.handler=t,this.peerId=n,this.transport=i,this.options=s}async listen(e){if(this.listeningAddr!=null)throw(0,pte.default)(new Error("listener already in use"),"ERR_ALREADY_LISTENING");let t=bt();this.listeningAddr=e;let n;e.protoCodes().includes(421)?n=e:n=e.encapsulate(`/p2p/${this.peerId.toString()}`);let i=this.signallingUrl=rb(e);xi("connecting to signalling server on: %s",this.signallingUrl);let s=new NR(this.signallingUrl,n,this.upgrader,this.handler,this.options.channelOptions);return s.addEventListener("error",o=>{let a=o.detail;xi("error connecting to signalling server %o",a),s.close().catch(c=>{xi.error("error closing server after error",c)}),t.reject(a)}),s.addEventListener("listening",()=>{xi("connected to signalling server"),this.dispatchEvent(new ne("listening")),t.resolve()}),s.addEventListener("peer",o=>{this.transport.peerDiscovered(o.detail)}),s.addEventListener("connection",o=>{let a=o.detail;if(a.remoteAddr==null)try{a.remoteAddr=e.decapsulateCode(421).encapsulate(`/p2p/${a.remotePeer.toString()}`)}catch(c){xi.error("could not determine remote address",c)}this.dispatchEvent(new ne("connection",{detail:a}))}),s.addEventListener("disconnect",()=>{this.transport.sigServers.delete(i)}),s.addEventListener("reconnect",()=>{this.transport.sigServers.set(i,s)}),this.transport.sigServers.set(this.signallingUrl,s),await t.promise}async close(){if(this.signallingUrl!=null){let e=this.transport.sigServers.get(this.signallingUrl);e!=null&&(await e.close(),this.transport.sigServers.delete(this.signallingUrl))}this.dispatchEvent(new ne("close")),this.listeningAddr=void 0}getAddrs(){return this.listeningAddr!=null?[this.listeningAddr]:[]}};function mte(r,e,t,n,i){return new DR(r,e,t,n,i)}var gte=S(Z8(),1);l();l();function bl(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");let t=Ri(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return Oc(t)}l();var I1=Symbol.for("@libp2p/transport");var If;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(If||(If={}));l();var jOt=Symbol.for("@libp2p/peer-discovery"),sc=Symbol.for("@libp2p/peer-discovery");var Nve="RTCPeerConnection"in globalThis,Dd=k("libp2p:webrtc-star"),Dve=()=>{},LR=class extends Fe{constructor(){super(...arguments),this.started=!1}get[sc](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star-discovery"}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}dispatchEvent(e){return this.isStarted()?super.dispatchEvent(e):!1}},nb=class{constructor(e){e?.wrtc!=null&&(this.wrtc=e.wrtc),this.sigServers=new Map,this._discovery=new LR,this.discovery=()=>this._discovery,this.peerDiscovered=this.peerDiscovered.bind(this)}get[I1](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star"}async dial(e,t){let n=await this._connect(e,t),i=tb(n,{remoteAddr:e,signal:t.signal});Dd("new outbound connection %s",i.remoteAddr);let s=await t.upgrader.upgradeOutbound(i);return Dd("outbound connection %s upgraded",i.remoteAddr),s}async _connect(e,t){if(t.signal?.aborted===!0)throw new Af;let n={...t.channelOptions??{}};this.wrtc!=null&&(n.wrtc=this.wrtc);let i=e.toOptions(),s=C((0,gte.default)(36),"hex");return await new Promise((o,a)=>{let c=this.sigServers.get(rb(e));if(c?.socket==null)return a((0,Ty.default)(new Error("unknown signal server to use"),"ERR_UNKNOWN_SIGNAL_SERVER"));let u=!1;Dd("dialing %s:%s",i.host,i.port);let f=new Ay(n),h=g=>{let y=g.detail;if(!u){let w=`connection error ${i.host}:${i.port}: ${y.message}`;Dd.error(w),m(y)}},p=()=>{u=!0,Dd("connection opened %s:%s",i.host,i.port),m()},d=()=>{Dd.error("connection aborted %s:%s",i.host,i.port),f.close().finally(()=>{m(new Af)})},m=g=>{f.removeEventListener("ready",p),t.signal?.removeEventListener("abort",d),g==null?o(f):a(g)};f.addEventListener("ready",p,{once:!0}),f.addEventListener("close",()=>{f.removeEventListener("error",h)}),t.signal?.addEventListener("abort",d),f.addEventListener("signal",g=>{let y=g.detail;c.socket.emit("ss-handshake",{intentId:s,srcMultiaddr:c.signallingAddr.toString(),dstMultiaddr:e.toString(),signal:y})}),c.socket.on("ws-handshake",g=>{g.intentId===s&&g.err!=null&&f.close().finally(()=>{a((0,Ty.default)(new Error(g.err),"ERR_SIGNALLING_FAILED"))}),!(g.intentId!==s||g.answer==null||f.closed)&&f.handleSignal(g.signal)})})}createListener(e){if(!Nve&&this.wrtc==null)throw(0,Ty.default)(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");if(e.channelOptions=e.channelOptions??{},this.wrtc!=null&&(e.channelOptions.wrtc=this.wrtc),this.peerId==null)throw(0,Ty.default)(new Error("PeerId not set"),"ERR_MISSING_PEER_ID");return mte(e.upgrader,e.handler??Dve,this.peerId,this,e)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(290)?!1:I4.matches(t))}peerDiscovered(e){Dd("peer discovered: %s",e),e=hte(e);let t=se(e),n=t.getPeerId();if(n==null)return;let i=ae(n);this._discovery.dispatchEvent(new ne("peer",{detail:{id:i,multiaddrs:[t],protocols:[]}}))}};function yte(r={}){let e=new nb(r);return{transport:t=>(e.peerId=t.peerId,e),discovery:e.discovery}}function wte(){let r=yte();return{transports:[r.transport],peerDiscovery:[r.discovery],connectionManager:{maxParallelDials:150,maxDialsPerPeer:4,dialTimeout:1e4,autoDial:!0},nat:{enabled:!1}}}l();l();l();function El(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}l();var Ry=S(W(),1);l();var rt;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.DHT_DISABLED="DHT is not available",r.PUBSUB_DISABLED="PubSub is not available",r.CONN_ENCRYPTION_REQUIRED="At least one connection encryption module is required",r.ERR_TRANSPORTS_REQUIRED="At least one transport module is required",r.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",r.NOT_FOUND="Not found"})(rt||(rt={}));var K;(function(r){r.DHT_DISABLED="ERR_DHT_DISABLED",r.ERR_PUBSUB_DISABLED="ERR_PUBSUB_DISABLED",r.PUBSUB_NOT_STARTED="ERR_PUBSUB_NOT_STARTED",r.DHT_NOT_STARTED="ERR_DHT_NOT_STARTED",r.CONN_ENCRYPTION_REQUIRED="ERR_CONN_ENCRYPTION_REQUIRED",r.ERR_TRANSPORTS_REQUIRED="ERR_TRANSPORTS_REQUIRED",r.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",r.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",r.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",r.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",r.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",r.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",r.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",r.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",r.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",r.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",r.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",r.ERR_DIALED_SELF="ERR_DIALED_SELF",r.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",r.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",r.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",r.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",r.ERR_INVALID_KEY="ERR_INVALID_KEY",r.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",r.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",r.ERR_INVALID_PEER="ERR_INVALID_PEER",r.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",r.ERR_NOT_FOUND="ERR_NOT_FOUND",r.ERR_TIMEOUT="ERR_TIMEOUT",r.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",r.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",r.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",r.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",r.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",r.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",r.ERR_FIND_SELF="ERR_FIND_SELF",r.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",r.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",r.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",r.ERR_KEYCHAIN_REQUIRED="ERR_KEYCHAIN_REQUIRED",r.ERR_INVALID_CMS="ERR_INVALID_CMS",r.ERR_MISSING_KEYS="ERR_MISSING_KEYS",r.ERR_NO_KEY="ERR_NO_KEY",r.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",r.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",r.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",r.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",r.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",r.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",r.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",r.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",r.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",r.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",r.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",r.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",r.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",r.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",r.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",r.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",r.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",r.ERR_INVALID_RECORD="ERR_INVALID_RECORD",r.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",r.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",r.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",r.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",r.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED"})(K||(K={}));l();var bte=S(W(),1);async function*Iy(r,e){yield*Zt(r,async t=>(await e.addressBook.add(t.id,t.multiaddrs),t))}function ib(r){let e=new Set;return ht(r,t=>e.has(t.id.toString())?!1:(e.add(t.id.toString()),!0))}async function*sb(r,e=1){let t=0;for await(let n of r)t++,yield n;if(t<e)throw(0,bte.default)(new Error("not found"),"NOT_FOUND")}var vte=S(_n(),1);var ab=S(BR(),1),Ste=S(ri(),1),_te=k("libp2p:peer-routing"),ob=class{constructor(e,t){this.components=e,this.routers=t.routers??[],this.refreshManagerInit=t.refreshManager??{},this.started=!1,this._findClosestPeersTask=this._findClosestPeersTask.bind(this)}isStarted(){return this.started}async start(){this.started||this.routers.length===0||this.timeoutId!=null||this.refreshManagerInit.enabled===!1||(this.timeoutId=(0,ab.setDelayedInterval)(this._findClosestPeersTask,this.refreshManagerInit.interval,this.refreshManagerInit.bootDelay),this.started=!0)}async _findClosestPeersTask(){if(this.abortController==null)try{this.abortController=new vte.TimeoutController(this.refreshManagerInit.timeout??1e4);try{(0,Ste.setMaxListeners)?.(1/0,this.abortController.signal)}catch{}await Ct(this.getClosestPeers(this.components.peerId.toBytes(),{signal:this.abortController.signal}))}catch(e){_te.error(e)}finally{this.abortController?.clear(),this.abortController=void 0}}async stop(){(0,ab.clearDelayedInterval)(this.timeoutId),this.abortController?.abort(),this.started=!1}async findPeer(e,t){if(this.routers.length===0)throw(0,Ry.default)(new Error("No peer routers available"),K.ERR_NO_ROUTERS_AVAILABLE);if(e.toString()===this.components.peerId.toString())throw(0,Ry.default)(new Error("Should not try to find self"),K.ERR_FIND_SELF);let n=await _e(Fr(...this.routers.map(i=>async function*(){try{yield await i.findPeer(e,t)}catch(s){_te.error(s)}}())),i=>ht(i,Boolean),i=>Iy(i,this.components.peerStore),async i=>await hn(i));if(n!=null)return n;throw(0,Ry.default)(new Error(rt.NOT_FOUND),K.ERR_NOT_FOUND)}async*getClosestPeers(e,t){if(this.routers.length===0)throw(0,Ry.default)(new Error("No peer routers available"),K.ERR_NO_ROUTERS_AVAILABLE);yield*_e(Fr(...this.routers.map(n=>n.getClosestPeers(e,t))),n=>Iy(n,this.components.peerStore),n=>ib(n),n=>sb(n))}};l();var Rf=S(W(),1);var cb=class{constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw(0,Rf.default)(new Error("No content this.routers available"),K.ERR_NO_ROUTERS_AVAILABLE);yield*_e(Fr(...this.routers.map(n=>n.findProviders(e,t))),n=>Iy(n,this.components.peerStore),n=>ib(n),n=>sb(n))}async provide(e,t={}){if(this.routers.length===0)throw(0,Rf.default)(new Error("No content routers available"),K.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map(async n=>await n.provide(e,t)))}async put(e,t,n){if(!this.isStarted())throw(0,Rf.default)(new Error(rt.NOT_STARTED_YET),K.DHT_NOT_STARTED);let i=this.components.dht;i!=null&&await Ct(i.put(e,t,n))}async get(e,t){if(!this.isStarted())throw(0,Rf.default)(new Error(rt.NOT_STARTED_YET),K.DHT_NOT_STARTED);let n=this.components.dht;if(n!=null){for await(let i of n.get(e,t))if(i.name==="VALUE")return i.value}throw(0,Rf.default)(new Error(rt.NOT_FOUND),K.ERR_NOT_FOUND)}async*getMany(e,t,n){if(!this.isStarted())throw(0,Rf.default)(new Error(rt.NOT_STARTED_YET),K.DHT_NOT_STARTED);if(t==null||t===0)return;let i=0,s=this.components.dht;if(s!=null){for await(let o of s.get(e,n))if(o.name==="VALUE"&&(yield{from:o.from,val:o.value},i++,i===t))break}if(i===0)throw(0,Rf.default)(new Error(rt.NOT_FOUND),K.ERR_NOT_FOUND)}};l();var Fve=r=>r,lb=class extends Fe{constructor(e,t){super();let{listen:n=[],announce:i=[]}=t;this.components=e,this.listen=n.map(s=>s.toString()),this.announce=new Set(i.map(s=>s.toString())),this.observed=new Set,this.announceFilter=t.announceFilter??Fve}getListenAddrs(){return Array.from(this.listen).map(e=>se(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>se(e))}getObservedAddrs(){return Array.from(this.observed).map(e=>se(e))}confirmObservedAddr(e){}removeObservedAddr(e){}addObservedAddr(e){let t=se(e),n=t.getPeerId();n!=null&&ae(n).equals(this.components.peerId)&&(t=t.decapsulate(se(`/p2p/${this.components.peerId.toString()}`)));let i=t.toString();this.observed.has(i)||(this.observed.add(i),this.dispatchEvent(new ne("change:addresses")))}getAddresses(){let e=this.getAnnounceAddrs().map(n=>n.toString());e.length===0&&(e=this.components.transportManager.getAddrs().map(n=>n.toString())),e=e.concat(this.getObservedAddrs().map(n=>n.toString()));let t=new Set(e);return this.announceFilter(Array.from(t).map(n=>se(n))).map(n=>n.protos().pop()?.path===!0||n.getPeerId()===this.components.peerId.toString()?n:n.encapsulate(`/p2p/${this.components.peerId.toString()}`))}};l();var gb=S(W(),1);l();l();var xte=k("libp2p:connection-manager:latency-monitor:visibility-change-emitter"),ub=class extends Fe{constructor(){super(),this.hidden="hidden",this.visibilityChange="visibilityChange",globalThis.document!=null&&(this._initializeVisibilityVarNames(),this._addVisibilityChangeListener())}_initializeVisibilityVarNames(){let e="hidden",t="visibilitychange";typeof globalThis.document.hidden<"u"?(e="hidden",t="visibilitychange"):typeof globalThis.document.mozHidden<"u"?(e="mozHidden",t="mozvisibilitychange"):typeof globalThis.document.msHidden<"u"?(e="msHidden",t="msvisibilitychange"):typeof globalThis.document.webkitHidden<"u"&&(e="webkitHidden",t="webkitvisibilitychange"),this.hidden=e,this.visibilityChange=t}_addVisibilityChangeListener(){typeof globalThis.document.addEventListener>"u"||typeof document[this.hidden]>"u"?xte("Checking page visibility requires a browser that supports the Page Visibility API."):globalThis.document.addEventListener(this.visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){if(!(this.hidden===void 0||document[this.hidden]===void 0))return document[this.hidden]==null}_handleVisibilityChange(){let e=globalThis.document[this.hidden]===!1;xte(e?"Page Visible":"Page Hidden"),this.dispatchEvent(new ne("visibilityChange",{detail:e}))}};var _l=k("libp2p:connection-manager:latency-monitor"),fb=class extends Fe{constructor(e={}){super();let{latencyCheckIntervalMs:t,dataEmitIntervalMs:n,asyncTestFn:i,latencyRandomPercentage:s}=e;this.latencyCheckIntervalMs=t??500,this.latencyRandomPercentage=s??10,this.latencyCheckMultiply=2*(this.latencyRandomPercentage/100)*this.latencyCheckIntervalMs,this.latencyCheckSubtract=this.latencyCheckMultiply/2,this.dataEmitIntervalMs=n===null||n===0?void 0:n??5*1e3,_l("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",this.latencyCheckIntervalMs,this.dataEmitIntervalMs),this.dataEmitIntervalMs!=null?_l("Expecting ~%s events per summary",this.latencyCheckIntervalMs/this.dataEmitIntervalMs):_l("Not emitting summaries"),this.asyncTestFn=i,globalThis.process?.hrtime!=null?(_l("Using process.hrtime for timing"),this.now=globalThis.process.hrtime,this.getDeltaMS=o=>{let a=this.now(o);return a[0]*1e3+a[1]/1e6}):typeof window<"u"&&window.performance?.now!=null?(_l("Using performance.now for timing"),this.now=window.performance.now.bind(window.performance),this.getDeltaMS=o=>Math.round(this.now()-o)):(_l("Using Date.now for timing"),this.now=Date.now,this.getDeltaMS=o=>this.now()-o),this.latencyData=this.initLatencyData()}start(){Vve()&&(this.visibilityChangeEmitter=new ub,this.visibilityChangeEmitter.addEventListener("visibilityChange",e=>{let{detail:t}=e;t?this._startTimers():(this._emitSummary(),this._stopTimers())})),this.visibilityChangeEmitter?.isVisible()===!0&&this._startTimers()}stop(){this._stopTimers()}_startTimers(){this.checkLatencyID==null&&(this.checkLatency(),this.dataEmitIntervalMs!=null&&(this.emitIntervalID=setInterval(()=>this._emitSummary(),this.dataEmitIntervalMs),typeof this.emitIntervalID.unref=="function"&&this.emitIntervalID.unref()))}_stopTimers(){this.checkLatencyID!=null&&(clearTimeout(this.checkLatencyID),this.checkLatencyID=void 0),this.emitIntervalID!=null&&(clearInterval(this.emitIntervalID),this.emitIntervalID=void 0)}_emitSummary(){let e=this.getSummary();e.events>0&&this.dispatchEvent(new ne("data",{detail:e}))}getSummary(){let e={events:this.latencyData.events,minMs:this.latencyData.minMs,maxMs:this.latencyData.maxMs,avgMs:this.latencyData.events>0?this.latencyData.totalMs/this.latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this.latencyData.startTime)};return this.latencyData=this.initLatencyData(),_l.trace("Summary: %O",e),e}checkLatency(){let e=Math.random()*this.latencyCheckMultiply-this.latencyCheckSubtract,t={deltaOffset:Math.ceil(this.latencyCheckIntervalMs+e),startTime:this.now()},n=()=>{if(this.checkLatencyID==null)return;let i=this.getDeltaMS(t.startTime)-t.deltaOffset;this.checkLatency(),this.latencyData.events++,this.latencyData.minMs=Math.min(this.latencyData.minMs,i),this.latencyData.maxMs=Math.max(this.latencyData.maxMs,i),this.latencyData.totalMs+=i,_l.trace("MS: %s Data: %O",i,this.latencyData)};_l.trace("localData: %O",t),this.checkLatencyID=setTimeout(()=>{this.asyncTestFn!=null?(t.deltaOffset=0,t.startTime=this.now(),this.asyncTestFn(n)):(t.deltaOffset-=1,n())},t.deltaOffset),typeof this.checkLatencyID.unref=="function"&&this.checkLatencyID.unref()}initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}};function Vve(){return typeof globalThis.window<"u"}var yb=S(ri(),1);l();var hb="OPEN",UR="CLOSING",db="CLOSED";l();l();l();function vl(r,e){let t={[Symbol.iterator]:()=>t,next:()=>{let n=r.next(),i=n.value;return n.done===!0||i==null?{done:!0,value:void 0}:{done:!1,value:e(i)}}};return t}var Cy=class{constructor(e){if(this.map=new Map,e!=null)for(let[t,n]of e.entries())this.map.set(t.toString(),n)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){this.map.delete(e.toString())}entries(){return vl(this.map.entries(),e=>[ae(e[0]),e[1]])}forEach(e){this.map.forEach((t,n)=>{e(t,ae(n),this)})}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return vl(this.map.keys(),e=>ae(e))}values(){return this.map.values()}get size(){return this.map.size}};l();var ts=class{constructor(e){if(this.set=new Set,e!=null)for(let t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return vl(this.set.entries(),e=>{let t=ae(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{let n=ae(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return vl(this.set.values(),e=>ae(e))}intersection(e){let t=new ts;for(let n of e)this.has(n)&&t.add(n);return t}difference(e){let t=new ts;for(let n of this)e.has(n)||t.add(n);return t}union(e){let t=new ts;for(let n of e)t.add(n);for(let n of this)t.add(n);return t}};l();var C1=class{constructor(e){if(this.list=[],e!=null)for(let t of e)this.list.push(t.toString())}[Symbol.iterator](){return vl(this.list.entries(),e=>ae(e[1]))}concat(e){let t=new C1(this);for(let n of e)t.push(n);return t}entries(){return vl(this.list.entries(),e=>[e[0],ae(e[1])])}every(e){return this.list.every((t,n)=>e(ae(t),n,this))}filter(e){let t=new C1;return this.list.forEach((n,i)=>{let s=ae(n);e(s,i,this)&&t.push(s)}),t}find(e){let t=this.list.find((n,i)=>e(ae(n),i,this));if(t!=null)return ae(t)}findIndex(e){return this.list.findIndex((t,n)=>e(ae(t),n,this))}forEach(e){this.list.forEach((t,n)=>{e(ae(t),n,this)})}includes(e){return this.list.includes(e.toString())}indexOf(e){return this.list.indexOf(e.toString())}pop(){let e=this.list.pop();if(e!=null)return ae(e)}push(...e){for(let t of e)this.list.push(t.toString())}shift(){let e=this.list.shift();if(e!=null)return ae(e)}unshift(...e){let t=this.list.length;for(let n=e.length-1;n>-1;n--)t=this.list.unshift(e[n].toString());return t}get length(){return this.list.length}};var ZR=S(_n(),1);l();var Ate="keep-alive";var _re=S(XR(),1);l();var Ere=S(W(),1);function mb(r){if(Pi(r))return{peerId:r};if(pi(r)){let e=r.getPeerId();return{multiaddr:r,peerId:e==null?void 0:ae(e)}}throw(0,Ere.default)(new Error(`${r} is not a PeerId or a Multiaddr`),K.ERR_INVALID_MULTIADDR)}var yn=k("libp2p:connection-manager"),SSe={maxConnections:1/0,minConnections:0,maxEventLoopDelay:1/0,pollInterval:2e3,autoDialInterval:1e4,inboundConnectionThreshold:5,maxIncomingPendingConnections:10},xSe=6e4,wb=class extends Fe{constructor(e,t){if(super(),this.opts=Ve.call({ignoreUndefined:!0},SSe,t),this.opts.maxConnections<this.opts.minConnections)throw(0,gb.default)(new Error("Connection Manager maxConnections must be greater than minConnections"),K.ERR_INVALID_PARAMETERS);yn("options: %o",this.opts),this.components=e,this.connections=new Map,this.started=!1,t.maxEventLoopDelay!=null&&t.maxEventLoopDelay>0&&t.maxEventLoopDelay!==1/0&&(this.latencyMonitor=new fb({latencyCheckIntervalMs:t.pollInterval,dataEmitIntervalMs:t.pollInterval}));try{(0,yb.setMaxListeners)?.(1/0,this)}catch{}this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.startupReconnectTimeout=t.startupReconnectTimeout??xSe,this.dialTimeout=t.dialTimeout??3e4,this.allow=(t.allow??[]).map(n=>se(n)),this.deny=(t.deny??[]).map(n=>se(n)),this.inboundConnectionRateLimiter=new _re.RateLimiterMemory({points:this.opts.inboundConnectionThreshold,duration:1}),this.incomingPendingConnections=0}isStarted(){return this.started}async start(){this.components.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{let e={inbound:0,outbound:0};for(let t of this.connections.values())for(let n of t)n.stat.direction==="inbound"?e.inbound++:e.outbound++;return e}}),this.components.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{let e={};for(let t of this.connections.values())for(let n of t)for(let i of n.streams){let s=`${i.stat.direction} ${i.stat.protocol??"unnegotiated"}`;e[s]=(e[s]??0)+1}return e}}),this.components.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{let e={};for(let n of this.connections.values())for(let i of n){let s={};for(let o of i.streams){let a=`${o.stat.direction} ${o.stat.protocol??"unnegotiated"}`;s[a]=(s[a]??0)+1}for(let[o,a]of Object.entries(s))e[o]=e[o]??[],e[o].push(a)}let t={};for(let[n,i]of Object.entries(e)){i=i.sort((o,a)=>o-a);let s=Math.floor(i.length*.9);t[n]=i[s]}return t}}),this.latencyMonitor?.start(),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this.latencyMonitor?.addEventListener("data",this._onLatencyMeasure),this.started=!0,yn("started")}async afterStart(){this.components.upgrader.addEventListener("connection",this.onConnect),this.components.upgrader.addEventListener("connectionEnd",this.onDisconnect),Promise.resolve().then(async()=>{let e=[];for(let t of await this.components.peerStore.all())(await this.components.peerStore.getTags(t.id)).filter(s=>s.name===Ate).length>0&&e.push(t.id);this.connectOnStartupController?.clear(),this.connectOnStartupController=new ZR.TimeoutController(this.startupReconnectTimeout);try{(0,yb.setMaxListeners)?.(1/0,this.connectOnStartupController.signal)}catch{}await Promise.all(e.map(async t=>{await this.openConnection(t,{signal:this.connectOnStartupController?.signal}).catch(n=>{yn.error(n)})}))}).catch(e=>{yn.error(e)}).finally(()=>{this.connectOnStartupController?.clear()})}async beforeStop(){this.connectOnStartupController?.abort(),this.components.upgrader.removeEventListener("connection",this.onConnect),this.components.upgrader.removeEventListener("connectionEnd",this.onDisconnect)}async stop(){this.latencyMonitor?.removeEventListener("data",this._onLatencyMeasure),this.latencyMonitor?.stop(),this.started=!1,await this._close(),yn("stopped")}async _close(){let e=[];for(let t of this.connections.values())for(let n of t)e.push((async()=>{try{await n.close()}catch(i){yn.error(i)}})());yn("closing %d connections",e.length),await Promise.all(e),this.connections.clear()}onConnect(e){this._onConnect(e).catch(t=>{yn.error(t)})}async _onConnect(e){let{detail:t}=e;if(!this.started){await t.close();return}let n=t.remotePeer,i=n.toString(),s=this.connections.get(i);s!=null?s.push(t):this.connections.set(i,[t]),n.publicKey!=null&&await this.components.peerStore.keyBook.set(n,n.publicKey);let o=this.getConnections().length,a=o-this.opts.maxConnections;await this._checkMaxLimit("maxConnections",o,a),this.dispatchEvent(new ne("peer:connect",{detail:t}))}onDisconnect(e){let{detail:t}=e;if(!this.started)return;let n=t.remotePeer.toString(),i=this.connections.get(n);i!=null&&i.length>1?(i=i.filter(s=>s.id!==t.id),this.connections.set(n,i)):i!=null&&(this.connections.delete(n),this.dispatchEvent(new ne("peer:disconnect",{detail:t})))}getConnections(e){if(e!=null)return this.connections.get(e.toString())??[];let t=[];for(let n of this.connections.values())t=t.concat(n);return t}async openConnection(e,t={}){let{peerId:n,multiaddr:i}=mb(e);if(n==null&&i==null)throw(0,gb.default)(new TypeError("Can only open connections to PeerIds or Multiaddrs"),K.ERR_INVALID_PARAMETERS);if(n!=null){yn("dial to",n);let o=this.getConnections(n);if(o.length>0)return yn("had an existing connection to %p",n),o[0]}let s;if(t?.signal==null){s=new ZR.TimeoutController(this.dialTimeout),t.signal=s.signal;try{(0,yb.setMaxListeners)?.(1/0,s.signal)}catch{}}try{let o=await this.components.dialer.dial(e,t),a=this.connections.get(o.remotePeer.toString());a==null&&(a=[],this.connections.set(o.remotePeer.toString(),a));let c=!1;for(let u of a)u.id===o.id&&(c=!0);return c||a.push(o),o}finally{s?.clear()}}async closeConnections(e){let t=this.connections.get(e.toString())??[];await Promise.all(t.map(async n=>await n.close()))}getAll(e){if(!Pi(e))throw(0,gb.default)(new Error("peerId must be an instance of peer-id"),K.ERR_INVALID_PARAMETERS);let t=e.toString(),n=this.connections.get(t);return n!=null?n.filter(i=>i.stat.status===hb):[]}_onLatencyMeasure(e){let{detail:t}=e;this._checkMaxLimit("maxEventLoopDelay",t.avgMs,1).catch(n=>{yn.error(n)})}async _checkMaxLimit(e,t,n=1){let i=this.opts[e];if(i==null){yn.trace("limit %s was not set so it cannot be applied",e);return}yn.trace("checking limit of %s. current value: %d of %d",e,t,i),t>i&&(yn("%s: limit exceeded: %p, %d/%d, pruning %d connection(s)",this.components.peerId,e,t,i,n),await this._pruneConnections(n))}async _pruneConnections(e){let t=this.getConnections(),n=new Cy;for(let o of t){let a=o.remotePeer;if(n.has(a))continue;let c=await this.components.peerStore.getTags(a);n.set(a,c.reduce((u,f)=>u+f.value,0))}let i=t.sort((o,a)=>{let c=n.get(o.remotePeer)??0,u=n.get(a.remotePeer)??0;if(c>u)return 1;if(c<u)return-1;let f=o.stat.timeline.open,h=a.stat.timeline.open;return f<h?1:f>h?-1:0}),s=[];for(let o of i)if(yn("too many connections open - closing a connection to %p",o.remotePeer),s.push(o),s.length===e)break;await Promise.all(s.map(async o=>{try{await o.close()}catch(a){yn.error(a)}this.onDisconnect(new ne("connectionEnd",{detail:o}))}))}async acceptIncomingConnection(e){if(this.deny.some(i=>e.remoteAddr.toString().startsWith(i.toString())))return yn("connection from %s refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(i=>e.remoteAddr.toString().startsWith(i.toString())))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.opts.maxIncomingPendingConnections)return yn("connection from %s refused - incomingPendingConnections exceeded by peer %s",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){let i=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(i,1)}catch{return yn("connection from %s refused - inboundConnectionThreshold exceeded by host %s",i,e.remoteAddr),!1}}return this.getConnections().length<this.opts.maxConnections?(this.incomingPendingConnections++,!0):(yn("connection from %s refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}};l();var JR=S(w9(),1);var Cf=k("libp2p:connection-manager:auto-dialler"),ASe={enabled:!0,minConnections:0,autoDialInterval:1e4},bb=class{constructor(e,t){this.components=e,this.options=Ve.call({ignoreUndefined:!0},ASe,t),this.running=!1,this._autoDial=this._autoDial.bind(this),Cf("options: %j",this.options)}isStarted(){return this.running}async start(){if(!this.options.enabled){Cf("not enabled");return}this.running=!0,this._autoDial().catch(e=>{Cf.error("could start autodial",e)}),Cf("started")}async stop(){if(!this.options.enabled){Cf("not enabled");return}this.running=!1,this.autoDialTimeout!=null&&this.autoDialTimeout.clear(),Cf("stopped")}async _autoDial(){this.autoDialTimeout!=null&&this.autoDialTimeout.clear();let e=this.options.minConnections;if(this.components.connectionManager.getConnections().length>=e){this.autoDialTimeout=(0,JR.default)(this._autoDial,this.options.autoDialInterval);return}let t=await this.components.peerStore.all(),n=await _e(t.sort(()=>Math.random()>.5?1:-1),i=>ht(i,s=>!s.id.equals(this.components.peerId)),i=>lf(i,(s,o)=>o.protocols.length>s.protocols.length||o.id.publicKey!=null&&s.id.publicKey==null?1:-1),async i=>await Zn(i));for(let i=0;this.running&&i<n.length&&this.components.connectionManager.getConnections().length<e;i++){if(!this.running)return;let s=n[i];if(this.components.connectionManager.getConnections(s.id).length===0){Cf("connecting to a peerStore stored peer %p",s.id);try{await this.components.connectionManager.openConnection(s.id)}catch(o){Cf.error("could not connect to peerStore stored peer",o)}}}this.running&&(this.autoDialTimeout=(0,JR.default)(this._autoDial,this.options.autoDialInterval))}};l();var ene=S(W(),1);l();l();l();l();var fC=S(nC(),1),Kre=S(Dre(),1),hC=S(uC(),1),qre=S(zre(),1),$re=S(Bd(),1);function OSe(){$re.default._configure(),fC.default._configure(Kre.default),hC.default._configure(qre.default)}OSe();var Hre=["uint64","int64","sint64","fixed64","sfixed64"];function NSe(r){for(let e of Hre){if(r[e]==null)continue;let t=r[e];r[e]=function(){return BigInt(t.call(this).toString())}}return r}function dC(r){return NSe(new fC.default(r))}function DSe(r){for(let e of Hre){if(r[e]==null)continue;let t=r[e];r[e]=function(n){return t.call(this,n.toString())}}return r}function pC(){return DSe(hC.default.create())}function Sl(r,e){let t=dC(r instanceof Uint8Array?r:r.subarray());return e.decode(t)}l();function xl(r,e){let t=pC();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}l();l();var D1;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(D1||(D1={}));function vb(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function L1(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}let t=function(s,o){let a=e(s);o.int32(a)},n=function(s){let o=s.int32();return e(o)};return vb("enum",D1.VARINT,t,n)}l();function Al(r,e){return vb("message",D1.LENGTH_DELIMITED,r,e)}var He;(function(r){let e;(function(a){a.SUCCESS="SUCCESS",a.HOP_SRC_ADDR_TOO_LONG="HOP_SRC_ADDR_TOO_LONG",a.HOP_DST_ADDR_TOO_LONG="HOP_DST_ADDR_TOO_LONG",a.HOP_SRC_MULTIADDR_INVALID="HOP_SRC_MULTIADDR_INVALID",a.HOP_DST_MULTIADDR_INVALID="HOP_DST_MULTIADDR_INVALID",a.HOP_NO_CONN_TO_DST="HOP_NO_CONN_TO_DST",a.HOP_CANT_DIAL_DST="HOP_CANT_DIAL_DST",a.HOP_CANT_OPEN_DST_STREAM="HOP_CANT_OPEN_DST_STREAM",a.HOP_CANT_SPEAK_RELAY="HOP_CANT_SPEAK_RELAY",a.HOP_CANT_RELAY_TO_SELF="HOP_CANT_RELAY_TO_SELF",a.STOP_SRC_ADDR_TOO_LONG="STOP_SRC_ADDR_TOO_LONG",a.STOP_DST_ADDR_TOO_LONG="STOP_DST_ADDR_TOO_LONG",a.STOP_SRC_MULTIADDR_INVALID="STOP_SRC_MULTIADDR_INVALID",a.STOP_DST_MULTIADDR_INVALID="STOP_DST_MULTIADDR_INVALID",a.STOP_RELAY_REFUSED="STOP_RELAY_REFUSED",a.MALFORMED_MESSAGE="MALFORMED_MESSAGE"})(e=r.Status||(r.Status={}));let t;(function(a){a[a.SUCCESS=100]="SUCCESS",a[a.HOP_SRC_ADDR_TOO_LONG=220]="HOP_SRC_ADDR_TOO_LONG",a[a.HOP_DST_ADDR_TOO_LONG=221]="HOP_DST_ADDR_TOO_LONG",a[a.HOP_SRC_MULTIADDR_INVALID=250]="HOP_SRC_MULTIADDR_INVALID",a[a.HOP_DST_MULTIADDR_INVALID=251]="HOP_DST_MULTIADDR_INVALID",a[a.HOP_NO_CONN_TO_DST=260]="HOP_NO_CONN_TO_DST",a[a.HOP_CANT_DIAL_DST=261]="HOP_CANT_DIAL_DST",a[a.HOP_CANT_OPEN_DST_STREAM=262]="HOP_CANT_OPEN_DST_STREAM",a[a.HOP_CANT_SPEAK_RELAY=270]="HOP_CANT_SPEAK_RELAY",a[a.HOP_CANT_RELAY_TO_SELF=280]="HOP_CANT_RELAY_TO_SELF",a[a.STOP_SRC_ADDR_TOO_LONG=320]="STOP_SRC_ADDR_TOO_LONG",a[a.STOP_DST_ADDR_TOO_LONG=321]="STOP_DST_ADDR_TOO_LONG",a[a.STOP_SRC_MULTIADDR_INVALID=350]="STOP_SRC_MULTIADDR_INVALID",a[a.STOP_DST_MULTIADDR_INVALID=351]="STOP_DST_MULTIADDR_INVALID",a[a.STOP_RELAY_REFUSED=390]="STOP_RELAY_REFUSED",a[a.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE"})(t||(t={})),function(a){a.codec=()=>L1(t)}(e=r.Status||(r.Status={}));let n;(function(a){a.HOP="HOP",a.STOP="STOP",a.STATUS="STATUS",a.CAN_HOP="CAN_HOP"})(n=r.Type||(r.Type={}));let i;(function(a){a[a.HOP=1]="HOP",a[a.STOP=2]="STOP",a[a.STATUS=3]="STATUS",a[a.CAN_HOP=4]="CAN_HOP"})(i||(i={})),function(a){a.codec=()=>L1(i)}(n=r.Type||(r.Type={}));let s;(function(a){let c;a.codec=()=>(c==null&&(c=Al((u,f,h={})=>{if(h.lengthDelimited!==!1&&f.fork(),(h.writeDefaults===!0||u.id!=null&&u.id.byteLength>0)&&(f.uint32(10),f.bytes(u.id)),u.addrs!=null)for(let p of u.addrs)f.uint32(18),f.bytes(p);h.lengthDelimited!==!1&&f.ldelim()},(u,f)=>{let h={id:new Uint8Array(0),addrs:[]},p=f==null?u.len:u.pos+f;for(;u.pos<p;){let d=u.uint32();switch(d>>>3){case 1:h.id=u.bytes();break;case 2:h.addrs.push(u.bytes());break;default:u.skipType(d&7);break}}return h})),c),a.encode=u=>xl(u,a.codec()),a.decode=u=>Sl(u,a.codec())})(s=r.Peer||(r.Peer={}));let o;r.codec=()=>(o==null&&(o=Al((a,c,u={})=>{u.lengthDelimited!==!1&&c.fork(),a.type!=null&&(c.uint32(8),r.Type.codec().encode(a.type,c)),a.srcPeer!=null&&(c.uint32(18),r.Peer.codec().encode(a.srcPeer,c,{writeDefaults:!1})),a.dstPeer!=null&&(c.uint32(26),r.Peer.codec().encode(a.dstPeer,c,{writeDefaults:!1})),a.code!=null&&(c.uint32(32),r.Status.codec().encode(a.code,c)),u.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{let u={},f=c==null?a.len:a.pos+c;for(;a.pos<f;){let h=a.uint32();switch(h>>>3){case 1:u.type=r.Type.codec().decode(a);break;case 2:u.srcPeer=r.Peer.codec().decode(a,a.uint32());break;case 3:u.dstPeer=r.Peer.codec().decode(a,a.uint32());break;case 4:u.code=r.Status.codec().decode(a);break;default:a.skipType(h&7);break}}return u})),o),r.encode=a=>xl(a,r.codec()),r.decode=a=>Sl(a,r.codec())})(He||(He={}));l();l();l();var Dy=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function mC(r,e,t){let n=t??{},i=p1(r);async function*s(){let o,a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){let{abortMessage:f,abortCode:h}=n;throw new Dy(f,h)}let u=new Promise((f,h)=>{o=()=>{let{abortMessage:p,abortCode:d}=n;h(new Dy(p,d))}});c=await Promise.race([u,i.next()]),o=null}catch(u){e.removeEventListener("abort",a);let f=u.type==="aborted"&&e.aborted;if(f&&n.onAbort!=null&&n.onAbort(r),typeof i.return=="function")try{let h=i.return();h instanceof Promise&&h.catch(p=>{n.onReturnError!=null&&n.onReturnError(p)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(f&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return s()}var LSe=k("libp2p:stream:converter");function gC(r,e={}){let{stream:t,remoteAddr:n}=r,{sink:i,source:s}=t,o=async function*(){for await(let u of s)u instanceof Uint8Array?yield u:yield*u}(),a={async sink(u){e.signal!=null&&(u=mC(u,e.signal));try{await i(u),await c()}catch(f){f.type!=="aborted"&&LSe(f)}},source:e.signal!=null?mC(o,e.signal):o,remoteAddr:n,timeline:{open:Date.now(),close:void 0},async close(){await i(async function*(){yield new Uint8Array(0)}()),await c()}};async function c(){a.timeline.close==null&&(a.timeline.close=Date.now()),await Promise.resolve()}return a}l();var cc="/libp2p/circuit/relay/0.1.0";l();function Gre(r){let e=new Map;async function t(s){let o=s.toString().split("/p2p-circuit").find(p=>p!==""),a=se(o),c=a.getPeerId();if(c==null)throw new Error("Could not determine relay peer from multiaddr");let u=ae(c);await r.peerStore.addressBook.add(u,[a]);let f=await r.connectionManager.openConnection(u),h=f.remoteAddr.encapsulate("/p2p-circuit");e.set(f.remotePeer.toString(),h),i.dispatchEvent(new ne("listening"))}function n(){let s=[];for(let o of e.values())s.push(o);return s}let i=Object.assign(new Fe,{close:async()=>await Promise.resolve(),listen:t,getAddrs:n});return r.connectionManager.addEventListener("peer:disconnect",s=>{let{detail:o}=s;e.delete(o.remotePeer.toString())&&i.dispatchEvent(new ne("close"))}),i}l();var yC=S(W(),1);l();function jre(r,e){r.write({type:He.Type.STATUS,code:e})}function Sb(r,e){try{r.dstPeer?.addrs!=null&&r.dstPeer.addrs.forEach(t=>se(t))}catch(t){throw jre(e,r.type===He.Type.HOP?He.Status.HOP_DST_MULTIADDR_INVALID:He.Status.STOP_DST_MULTIADDR_INVALID),t}try{r.srcPeer?.addrs!=null&&r.srcPeer.addrs.forEach(t=>se(t))}catch(t){throw jre(e,r.type===He.Type.HOP?He.Status.HOP_SRC_MULTIADDR_INVALID:He.Status.STOP_SRC_MULTIADDR_INVALID),t}}l();l();function B1(r){let e=dt(),t=R6(r.source),n=bt(),i,s=r.sink(async function*(){yield*e,yield*await n.promise}());return s.catch(a=>{i=a}),{reader:t,writer:e,stream:{sink:async a=>{if(i!=null){await Promise.reject(i);return}n.resolve(a),await s},source:t},rest:()=>e.end(),write:e.push,read:async()=>{let a=await t.next();if(a.value!=null)return a.value}}}var Ly=k("libp2p:circuit:stream-handler"),Tl=class{constructor(e){let{stream:t,maxLength:n=4096}=e;this.stream=t,this.shake=B1(this.stream),this.decoder=on.fromReader(this.shake.reader,{maxDataLength:n})}async read(){let e=await this.decoder.next();if(e.value!=null){let t=He.decode(e.value);return Ly("read message type",t.type),t}Ly("read received no value, closing stream"),this.close()}write(e){Ly("write message type %s",e.type),this.shake.write(xn.single(He.encode(e)))}rest(){return this.shake.rest(),this.shake.stream}end(e){this.write(e),this.close()}close(){Ly("closing the stream"),this.rest().sink([]).catch(e=>{Ly.error(e)})}};l();var By=k("libp2p:circuit:stop");function Wre(r){let{connection:e,request:t,streamHandler:n}=r;try{Sb(t,n)}catch(i){By.error("invalid stop request via peer %p %o",e.remotePeer,i);return}return By("stop request is valid"),n.write({type:He.Type.STATUS,code:He.Status.SUCCESS}),n.rest()}async function Yre(r){let{connection:e,request:t,signal:n}=r,i=await e.newStream(cc,{signal:n});By("starting stop request to %p",e.remotePeer);let s=new Tl({stream:i});s.write(t);let o=await s.read();if(o==null){s.close();return}if(o.code===He.Status.SUCCESS)return By("stop request to %p was successful",e.remotePeer),s.rest();By("stop request failed with code %d",o.code),s.close()}var ho=k("libp2p:circuit:hop");async function Qre(r){let{connection:e,request:t,streamHandler:n,circuit:i,connectionManager:s}=r;if(!i.hopEnabled())return ho("HOP request received but we are not acting as a relay"),n.end({type:He.Type.STATUS,code:He.Status.HOP_CANT_SPEAK_RELAY});try{Sb(t,n)}catch(h){ho.error("invalid hop request via peer %p %o",e.remotePeer,h);return}if(t.dstPeer==null){ho("HOP request received but we do not receive a dstPeer");return}let o=Br(t.dstPeer.id),a=s.getConnections(o);if(a.length===0&&!i.hopActive())return ho("HOP request received but we are not connected to the destination peer"),n.end({type:He.Type.STATUS,code:He.Status.HOP_NO_CONN_TO_DST});if(a.length===0)return ho("did not have connection to remote peer"),n.end({type:He.Type.STATUS,code:He.Status.HOP_NO_CONN_TO_DST});let c={type:He.Type.STOP,dstPeer:t.dstPeer,srcPeer:t.srcPeer},u;try{ho("performing STOP request");let h=await Yre({connection:a[0],request:c});if(h==null)throw new Error("Could not stop");u=h}catch(h){ho.error(h);return}ho("hop request from %p is valid",e.remotePeer),n.write({type:He.Type.STATUS,code:He.Status.SUCCESS});let f=n.rest();return ho("creating related connections"),await _e(f,u,f)}async function Xre(r){let{connection:e,request:t,signal:n}=r,i=await e.newStream(cc,{signal:n}),s=new Tl({stream:i});s.write(t);let o=await s.read();if(o==null)throw(0,yC.default)(new Error("HOP request had no response"),K.ERR_HOP_REQUEST_FAILED);if(o.code===He.Status.SUCCESS)return ho("hop request was successful"),s.rest();throw ho("hop request failed with code %d, closing stream",o.code),s.close(),(0,yC.default)(new Error(`HOP request failed with code "${o.code??"unknown"}"`),K.ERR_HOP_REQUEST_FAILED)}async function Zre(r){let{connection:e,signal:t}=r,n=await e.newStream(cc,{signal:t}),i=new Tl({stream:n});i.write({type:He.Type.CAN_HOP});let s=await i.read();return await i.close(),!(s==null||s.code!==He.Status.SUCCESS)}function Jre(r){let{connection:e,streamHandler:t,circuit:n}=r,i=n.hopEnabled();ho("can hop (%s) request from %p",i,e.remotePeer),t.end({type:He.Type.STATUS,code:i?He.Status.SUCCESS:He.Status.HOP_CANT_SPEAK_RELAY})}var tne=S(_n(),1),rne=S(ri(),1),po=k("libp2p:circuit"),xb=class{constructor(e,t){this._init=t,this.components=e,this._started=!1}isStarted(){return this._started}async start(){this._started||(this._started=!0,await this.components.registrar.handle(cc,e=>{this._onProtocol(e).catch(t=>{po.error(t)})},{...this._init}).catch(e=>{po.error(e)}))}async stop(){await this.components.registrar.unhandle(cc)}hopEnabled(){return!0}hopActive(){return!0}get[I1](){return!0}get[Symbol.toStringTag](){return"libp2p/circuit-relay-v1"}async _onProtocol(e){let{connection:t,stream:n}=e,i=new tne.TimeoutController(this._init.hop.timeout);try{(0,rne.setMaxListeners)?.(1/0,i.signal)}catch{}try{let s=vi(n,i.signal),o=new Tl({stream:{...n,...s}}),a=await o.read();if(a==null){po("request was invalid, could not read from stream"),o.write({type:He.Type.STATUS,code:He.Status.MALFORMED_MESSAGE}),o.close();return}let c;switch(a.type){case He.Type.CAN_HOP:{po("received CAN_HOP request from %p",t.remotePeer),await Jre({circuit:this,connection:t,streamHandler:o});break}case He.Type.HOP:{po("received HOP request from %p",t.remotePeer),await Qre({connection:t,request:a,streamHandler:o,circuit:this,connectionManager:this.components.connectionManager});break}case He.Type.STOP:{po("received STOP request from %p",t.remotePeer),c=await Wre({connection:t,request:a,streamHandler:o});break}default:{po("Request of type %s not supported",a.type),o.write({type:He.Type.STATUS,code:He.Status.MALFORMED_MESSAGE}),o.close();return}}if(c!=null){let u=t.remoteAddr.encapsulate("/p2p-circuit").encapsulate(se(a.dstPeer?.addrs[0])),f=se(a.srcPeer?.addrs[0]),h=gC({stream:c,remoteAddr:u,localAddr:f}),p=a.type===He.Type.HOP?"relay":"inbound";po("new %s connection %s",p,h.remoteAddr);let d=await this.components.upgrader.upgradeInbound(h);po("%s connection %s upgraded",p,h.remoteAddr),this.handler!=null&&this.handler(d)}}finally{i.clear()}}async dial(e,t={}){let n=e.toString().split("/p2p-circuit"),i=se(n[0]),s=se(n[n.length-1]),o=i.getPeerId(),a=s.getPeerId();if(o==null||a==null){let d="Circuit relay dial failed as addresses did not have peer id";throw po.error(d),(0,ene.default)(new Error(d),K.ERR_RELAYED_DIAL)}let c=ae(o),u=ae(a),f=!1,p=this.components.connectionManager.getConnections(c)[0];p==null&&(await this.components.peerStore.addressBook.add(c,[i]),p=await this.components.connectionManager.openConnection(c,t),f=!0);try{let d=await Xre({...t,connection:p,request:{type:He.Type.HOP,srcPeer:{id:this.components.peerId.toBytes(),addrs:this.components.addressManager.getAddresses().map(y=>y.bytes)},dstPeer:{id:u.toBytes(),addrs:[se(s).bytes]}}}),m=i.encapsulate(`/p2p-circuit/p2p/${this.components.peerId.toString()}`),g=gC({stream:d,remoteAddr:e,localAddr:m});return po("new outbound connection %s",g.remoteAddr),await this.components.upgrader.upgradeOutbound(g)}catch(d){throw po.error("Circuit relay dial failed",d),f&&await p.close(),d}}createListener(e){return this.handler=e.handler,Gre({connectionManager:this.components.connectionManager,peerStore:this.components.peerStore})}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>ch.matches(t))}};l();var kb=S(BR(),1);l();l();async function Ab(r){let e=new TextEncoder().encode(r),t=await Le.digest(e);return T.createV0(t)}l();var wC="hop_relay",bC="true",Tb="/libp2p/relay";l();l();l();l();var lne=S(nne(),1);l();var ine="[a-fA-F\\d:]",Of=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${ine})|(?<=${ine})(?=\\s|$))`:"",ea="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",wn="[a-fA-F\\d]{1,4}",Ib=`
(?:
(?:${wn}:){7}(?:${wn}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${wn}:){6}(?:${ea}|:${wn}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${wn}:){5}(?::${ea}|(?::${wn}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${wn}:){4}(?:(?::${wn}){0,1}:${ea}|(?::${wn}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${wn}:){3}(?:(?::${wn}){0,2}:${ea}|(?::${wn}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${wn}:){2}(?:(?::${wn}){0,3}:${ea}|(?::${wn}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${wn}:){1}(?:(?::${wn}){0,4}:${ea}|(?::${wn}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${wn}){0,5}:${ea}|(?::${wn}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),USe=new RegExp(`(?:^${ea}$)|(?:^${Ib}$)`),MSe=new RegExp(`^${ea}$`),FSe=new RegExp(`^${Ib}$`),EC=r=>r&&r.exact?USe:new RegExp(`(?:${Of(r)}${ea}${Of(r)})|(?:${Of(r)}${Ib}${Of(r)})`,"g");EC.v4=r=>r&&r.exact?MSe:new RegExp(`${Of(r)}${ea}${Of(r)}`,"g");EC.v6=r=>r&&r.exact?FSe:new RegExp(`${Of(r)}${Ib}${Of(r)}`,"g");var sne=EC;var une=S(ane(),1),{isValid:VSe,parse:zSe}=une.default,KSe=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],qSe=KSe.map(r=>new lne.Netmask(r));function $Se(r){for(let e of qSe)if(e.contains(r))return!0;return!1}function cne(r){return/^::$/.test(r)||/^::1$/.test(r)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}var fne=r=>{if(VSe(r)){let e=zSe(r);if(e.kind()==="ipv4")return $Se(e.toNormalizedString());if(e.kind()==="ipv6")return cne(r)}else if(Xt(r)&&sne.v6().test(r))return cne(r)};var Md=fne;function _C(r){try{let{address:e}=r.nodeAddress();return Boolean(Md(e))}catch{return!0}}function U1(r,e){let t=_C(r.multiaddr),n=_C(e.multiaddr);return t&&!n?1:!t&&n||r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}var My=k("libp2p:auto-relay"),GSe=()=>{},Cb=class{constructor(e,t){this.components=e,this.addressSorter=t.addressSorter??U1,this.maxListeners=t.maxListeners??1,this.listenRelays=new Set,this.onError=t.onError??GSe,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this),this.components.peerStore.addEventListener("change:protocols",n=>{this._onProtocolChange(n).catch(i=>{My.error(i)})}),this.components.connectionManager.addEventListener("peer:disconnect",this._onPeerDisconnected)}async _onProtocolChange(e){let{peerId:t,protocols:n}=e.detail,i=t.toString();if(n.find(o=>o===cc)==null){this.listenRelays.has(i)&&await this._removeListenRelay(i);return}if(!this.listenRelays.has(i))try{let o=this.components.connectionManager.getConnections(t);if(o.length===0)return;let a=o[0];if(a.remoteAddr.protoCodes().includes(290)){My(`relayed connection to ${i} will not be used to hop on`);return}await Zre({connection:a})&&(await this.components.peerStore.metadataBook.setValue(t,wC,U(bC)),await this._addListenRelay(a,i))}catch(o){this.onError(o)}}_onPeerDisconnected(e){let i=e.detail.remotePeer.toString();this.listenRelays.has(i)&&this._removeListenRelay(i).catch(s=>{My.error(s)})}async _addListenRelay(e,t){try{if(this.listenRelays.size>=this.maxListeners)return;let n=await _e(await this.components.peerStore.addressBook.get(e.remotePeer),s=>lf(s,this.addressSorter),async s=>await Zn(s));(await Promise.all(n.map(async s=>{try{let o=s.multiaddr;return o.getPeerId()==null&&(o=o.encapsulate(`/p2p/${e.remotePeer.toString()}`)),o=o.encapsulate("/p2p-circuit"),await this.components.transportManager.listen([o]),!0}catch(o){My.error("error listening on circuit address",o),this.onError(o)}return!1}))).includes(!0)&&this.listenRelays.add(t)}catch(n){this.onError(n),this.listenRelays.delete(t)}}async _removeListenRelay(e){this.listenRelays.delete(e)&&await this._listenOnAvailableHopRelays([e])}async _listenOnAvailableHopRelays(e=[]){if(this.listenRelays.size>=this.maxListeners)return;let t=[],n=await this.components.peerStore.all();for(let{id:i,metadata:s}of n){let o=i.toString();if(this.listenRelays.has(o)||e.includes(o))continue;let a=s.get(wC);if(a==null||C(a)!==bC)continue;let c=this.components.connectionManager.getConnections(i);if(c.length===0){t.push(i);continue}if(await this._addListenRelay(c[0],o),this.listenRelays.size>=this.maxListeners)return}for(let i of t)if(await this._tryToListenOnRelay(i),this.listenRelays.size>=this.maxListeners)return;try{let i=await Ab(Tb);for await(let s of this.components.contentRouting.findProviders(i)){if(s.multiaddrs.length===0)continue;let o=s.id;if(!o.equals(this.components.peerId)&&(await this.components.peerStore.addressBook.add(o,s.multiaddrs),await this._tryToListenOnRelay(o),this.listenRelays.size>=this.maxListeners))return}}catch(i){this.onError(i)}}async _tryToListenOnRelay(e){try{let t=await this.components.connectionManager.openConnection(e);await this._addListenRelay(t,e.toString())}catch(t){My.error("Could not use %p as relay",e,t),this.onError(t,`could not connect and listen on known hop relay ${e.toString()}`)}}};var hne=k("libp2p:relay"),Pb=class{constructor(e,t){this.components=e,this.autoRelay=t.autoRelay?.enabled!==!1?new Cb(e,{addressSorter:t.addressSorter,...t.autoRelay}):void 0,this.started=!1,this.init=t,this._advertiseService=this._advertiseService.bind(this)}isStarted(){return this.started}async start(){this.init.hop.enabled!==!1&&this.init.advertise.enabled!==!1&&(this.timeout=(0,kb.setDelayedInterval)(this._advertiseService,this.init.advertise.ttl,this.init.advertise.bootDelay)),this.started=!0}async stop(){this.timeout!=null&&(0,kb.clearDelayedInterval)(this.timeout),this.started=!1}async _advertiseService(){try{let e=await Ab(Tb);await this.components.contentRouting.provide(e)}catch(e){e.code===K.ERR_NO_ROUTERS_AVAILABLE?(hne.error("a content router, such as a DHT, must be provided in order to advertise the relay service",e),await this.stop()):hne.error(e)}}};l();var Hne=S(_ne(),1);l();var Il="/",vne=new TextEncoder().encode(Il),Ob=vne[0],ii=class{constructor(e,t){if(typeof e=="string")this._buf=U(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Ob)throw new Error("Invalid key")}toString(e="utf8"){return C(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new ii(e.join(Il))}static random(){return new ii(Tr().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new ii(e):typeof e.uint8Array=="function"?new ii(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=vne),this._buf[0]!==Ob){let e=new Uint8Array(this._buf.byteLength+1);e.fill(Ob,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Ob;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return ii.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Il).slice(1)}type(){return sxe(this.baseNamespace())}name(){return oxe(this.baseNamespace())}instance(e){return new ii(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Il)||(e+=Il),e+=this.type(),new ii(e)}parent(){let e=this.list();return e.length===1?new ii(Il):new ii(e.slice(0,-1).join(Il))}child(e){return this.toString()===Il?e:e.toString()===Il?this:new ii(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return ii.withNamespaces([...this.namespaces(),...axe(e.map(t=>t.namespaces()))])}};function sxe(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function oxe(r){let e=r.split(":");return e[e.length-1]}function axe(r){return[].concat(...r)}l();var lFt=S(Vne(),1),uFt=S(Kv(),1),Rl=S(Je(),1);l();var oFt=S(SC(),1),Kne=S(Je(),1),zne=Kne.default.pki,qne=(r,e)=>{let t=zne.rsa.setPublicKey(e.n,e.e),n=zne.createCertificate();n.publicKey=t,n.serialNumber="01",n.validity.notBefore=new Date,n.validity.notAfter=new Date,n.validity.notAfter.setFullYear(n.validity.notBefore.getFullYear()+10);let i=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:r.id}];return n.setSubject(i),n.setIssuer(i),n.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),n.sign(e),n};async function $ne(r,e){let t=r.map(e),i=(await Promise.all(t)).findIndex(s=>s);return r[i]}var Cl=S(W(),1);var Axe=k("libp2p:keychain:cms"),TC=new WeakMap,Bb=class{constructor(e,t){if(e==null)throw(0,Cl.default)(new Error("keychain is required"),K.ERR_KEYCHAIN_REQUIRED);this.keychain=e,TC.set(this,{dek:t})}async encrypt(e,t){if(!(t instanceof Uint8Array))throw(0,Cl.default)(new Error("Plain data must be a Uint8Array"),K.ERR_INVALID_PARAMETERS);let n=await this.keychain.findKeyByName(e),i=await this.keychain.getPrivateKey(e),s=TC.get(this);if(s==null)throw(0,Cl.default)(new Error("dek missing"),K.ERR_INVALID_PARAMETERS);let o=s.dek,a=Rl.default.pki.decryptRsaPrivateKey(i,o),c=await qne(n,a),u=Rl.default.pkcs7.createEnvelopedData();u.addRecipient(c),u.content=Rl.default.util.createBuffer(t),u.encrypt();let f=Rl.default.asn1.toDer(u.toAsn1()).getBytes();return U(f,"ascii")}async decrypt(e){if(!(e instanceof Uint8Array))throw(0,Cl.default)(new Error("CMS data is required"),K.ERR_INVALID_PARAMETERS);let t;try{let f=Rl.default.util.createBuffer(C(e,"ascii")),h=Rl.default.asn1.fromDer(f);t=Rl.default.pkcs7.messageFromAsn1(h)}catch(f){throw Axe.error(f),(0,Cl.default)(new Error("Invalid CMS"),K.ERR_INVALID_CMS)}let n=t.recipients.filter(f=>f.issuer.find(h=>h.shortName==="O"&&h.value==="ipfs")).filter(f=>f.issuer.find(h=>h.shortName==="CN")).map(f=>({recipient:f,keyId:f.issuer.find(h=>h.shortName==="CN").value})),i=await $ne(n,async f=>{try{if(await this.keychain.findKeyById(f.keyId)!=null)return!0}catch{return!1}return!1});if(i==null){let f=n.map(h=>h.keyId);throw(0,Cl.default)(new Error(`Decryption needs one of the key(s): ${f.join(", ")}`),K.ERR_MISSING_KEYS,{missingKeys:f})}let s=await this.keychain.findKeyById(i.keyId);if(s==null)throw(0,Cl.default)(new Error("No key available to decrypto"),K.ERR_NO_KEY);let o=await this.keychain.getPrivateKey(s.name),a=TC.get(this);if(a==null)throw(0,Cl.default)(new Error("dek missing"),K.ERR_INVALID_PARAMETERS);let c=a.dek,u=Rl.default.pki.decryptRsaPrivateKey(o,c);return t.decrypt(i.recipient,u),U(t.content.getBytes(),"ascii")}};var Vt=S(W(),1);var Ub=k("libp2p:keychain"),Txe="/pkcs8/",Gne="/info/",Df=new WeakMap,zd={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},IC={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function Pl(r){return r==null||typeof r!="string"?!1:r===(0,Hne.default)(r.trim())&&r.length>0}async function rr(){let t=Math.random()*800+200;await new Promise(n=>setTimeout(n,t))}function lc(r){return new ii(Txe+r)}function kl(r){return new ii(Gne+r)}var Kd=class{constructor(e,t){if(this.components=e,this.init=Ve(IC,t),this.init.pass!=null&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(this.init.dek?.keyLength!=null&&this.init.dek.keyLength<zd.minKeyLength)throw new Error(`dek.keyLength must be least ${zd.minKeyLength} bytes`);if(this.init.dek?.salt?.length!=null&&this.init.dek.salt.length<zd.minSaltLength)throw new Error(`dek.saltLength must be least ${zd.minSaltLength} bytes`);if(this.init.dek?.iterationCount!=null&&this.init.dek.iterationCount<zd.minIterationCount)throw new Error(`dek.iterationCount must be least ${zd.minIterationCount}`);let n=this.init.pass!=null&&this.init.dek?.salt!=null?ly(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";Df.set(this,{dek:n}),this.started=!1}isStarted(){return this.started}async start(){let e=kl("self");await this.components.datastore.has(e)||await this.importPeer("self",this.components.peerId),this.started=!0}stop(){this.started=!1}get cms(){let e=Df.get(this);if(e==null)throw(0,Vt.default)(new Error("dek missing"),K.ERR_INVALID_PARAMETERS);let t=e.dek;return new Bb(this,t)}static generateOptions(){let e=Object.assign({},IC),t=Math.ceil(zd.minSaltLength/3)*3;return e.dek.salt=C($i(t),"base64"),e}static get options(){return IC}async createKey(e,t,n=2048){if(!Pl(e)||e==="self")throw await rr(),(0,Vt.default)(new Error("Invalid key name"),K.ERR_INVALID_KEY_NAME);if(typeof t!="string")throw await rr(),(0,Vt.default)(new Error("Invalid key type"),K.ERR_INVALID_KEY_TYPE);let i=lc(e);if(await this.components.datastore.has(i))throw await rr(),(0,Vt.default)(new Error("Key name already exists"),K.ERR_KEY_ALREADY_EXISTS);switch(t.toLowerCase()){case"rsa":if(!Number.isSafeInteger(n)||n<2048)throw await rr(),(0,Vt.default)(new Error("Invalid RSA key size"),K.ERR_INVALID_KEY_SIZE);break;default:break}let o;try{let a=await c0(t,n),c=await a.id(),u=Df.get(this);if(u==null)throw(0,Vt.default)(new Error("dek missing"),K.ERR_INVALID_PARAMETERS);let f=u.dek,h=await a.export(f);o={name:e,id:c};let p=this.components.datastore.batch();p.put(i,U(h)),p.put(kl(e),U(JSON.stringify(o))),await p.commit()}catch(a){throw await rr(),a}return o}async listKeys(){let e={prefix:Gne},t=[];for await(let n of this.components.datastore.query(e))t.push(JSON.parse(C(n.value)));return t}async findKeyById(e){try{return(await this.listKeys()).find(n=>n.id===e)}catch(t){throw await rr(),t}}async findKeyByName(e){if(!Pl(e))throw await rr(),(0,Vt.default)(new Error(`Invalid key name '${e}'`),K.ERR_INVALID_KEY_NAME);let t=kl(e);try{let n=await this.components.datastore.get(t);return JSON.parse(C(n))}catch(n){throw await rr(),Ub.error(n),(0,Vt.default)(new Error(`Key '${e}' does not exist.`),K.ERR_KEY_NOT_FOUND)}}async removeKey(e){if(!Pl(e)||e==="self")throw await rr(),(0,Vt.default)(new Error(`Invalid key name '${e}'`),K.ERR_INVALID_KEY_NAME);let t=lc(e),n=await this.findKeyByName(e),i=this.components.datastore.batch();return i.delete(t),i.delete(kl(e)),await i.commit(),n}async renameKey(e,t){if(!Pl(e)||e==="self")throw await rr(),(0,Vt.default)(new Error(`Invalid old key name '${e}'`),K.ERR_OLD_KEY_NAME_INVALID);if(!Pl(t)||t==="self")throw await rr(),(0,Vt.default)(new Error(`Invalid new key name '${t}'`),K.ERR_NEW_KEY_NAME_INVALID);let n=lc(e),i=lc(t),s=kl(e),o=kl(t);if(await this.components.datastore.has(i))throw await rr(),(0,Vt.default)(new Error(`Key '${t}' already exists`),K.ERR_KEY_ALREADY_EXISTS);try{let c=await this.components.datastore.get(n),u=await this.components.datastore.get(s),f=JSON.parse(C(u));f.name=t;let h=this.components.datastore.batch();return h.put(i,c),h.put(o,U(JSON.stringify(f))),h.delete(n),h.delete(s),await h.commit(),f}catch(c){throw await rr(),c}}async exportKey(e,t){if(!Pl(e))throw await rr(),(0,Vt.default)(new Error(`Invalid key name '${e}'`),K.ERR_INVALID_KEY_NAME);if(t==null)throw await rr(),(0,Vt.default)(new Error("Password is required"),K.ERR_PASSWORD_REQUIRED);let n=lc(e);try{let i=await this.components.datastore.get(n),s=C(i),o=Df.get(this);if(o==null)throw(0,Vt.default)(new Error("dek missing"),K.ERR_INVALID_PARAMETERS);let a=o.dek;return await(await ka(s,a)).export(t)}catch(i){throw await rr(),i}}async exportPeerId(e){let t="temporary-password",n=await this.exportKey(e,t),i=await ka(n,t);return await Ur(i.public.bytes,i.bytes)}async importKey(e,t,n){if(!Pl(e)||e==="self")throw await rr(),(0,Vt.default)(new Error(`Invalid key name '${e}'`),K.ERR_INVALID_KEY_NAME);if(t==null)throw await rr(),(0,Vt.default)(new Error("PEM encoded key is required"),K.ERR_PEM_REQUIRED);let i=lc(e);if(await this.components.datastore.has(i))throw await rr(),(0,Vt.default)(new Error(`Key '${e}' already exists`),K.ERR_KEY_ALREADY_EXISTS);let o;try{o=await ka(t,n)}catch{throw await rr(),(0,Vt.default)(new Error("Cannot read the key, most likely the password is wrong"),K.ERR_CANNOT_READ_KEY)}let a;try{a=await o.id();let f=Df.get(this);if(f==null)throw(0,Vt.default)(new Error("dek missing"),K.ERR_INVALID_PARAMETERS);let h=f.dek;t=await o.export(h)}catch(f){throw await rr(),f}let c={name:e,id:a},u=this.components.datastore.batch();return u.put(i,U(t)),u.put(kl(e),U(JSON.stringify(c))),await u.commit(),c}async importPeer(e,t){try{if(!Pl(e))throw(0,Vt.default)(new Error(`Invalid key name '${e}'`),K.ERR_INVALID_KEY_NAME);if(t==null)throw(0,Vt.default)(new Error("PeerId is required"),K.ERR_MISSING_PRIVATE_KEY);if(t.privateKey==null)throw(0,Vt.default)(new Error("PeerId.privKey is required"),K.ERR_MISSING_PRIVATE_KEY);let n=await Mn(t.privateKey),i=lc(e);if(await this.components.datastore.has(i))throw await rr(),(0,Vt.default)(new Error(`Key '${e}' already exists`),K.ERR_KEY_ALREADY_EXISTS);let o=Df.get(this);if(o==null)throw(0,Vt.default)(new Error("dek missing"),K.ERR_INVALID_PARAMETERS);let a=o.dek,c=await n.export(a),u={name:e,id:t.toString()},f=this.components.datastore.batch();return f.put(i,U(c)),f.put(kl(e),U(JSON.stringify(u))),await f.commit(),u}catch(n){throw await rr(),n}}async getPrivateKey(e){if(!Pl(e))throw await rr(),(0,Vt.default)(new Error(`Invalid key name '${e}'`),K.ERR_INVALID_KEY_NAME);try{let t=lc(e),n=await this.components.datastore.get(t);return C(n)}catch(t){throw await rr(),Ub.error(t),(0,Vt.default)(new Error(`Key '${e}' does not exist.`),K.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(e,t){if(typeof e!="string")throw await rr(),(0,Vt.default)(new Error(`Invalid old pass type '${typeof e}'`),K.ERR_INVALID_OLD_PASS_TYPE);if(typeof t!="string")throw await rr(),(0,Vt.default)(new Error(`Invalid new pass type '${typeof t}'`),K.ERR_INVALID_NEW_PASS_TYPE);if(t.length<20)throw await rr(),(0,Vt.default)(new Error(`Invalid pass length ${t.length}`),K.ERR_INVALID_PASS_LENGTH);Ub("recreating keychain");let n=Df.get(this);if(n==null)throw(0,Vt.default)(new Error("dek missing"),K.ERR_INVALID_PARAMETERS);let i=n.dek;this.init.pass=t;let s=t!=null&&this.init.dek?.salt!=null?ly(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";Df.set(this,{dek:s});let o=await this.listKeys();for(let a of o){let c=await this.components.datastore.get(lc(a.name)),u=C(c),f=await ka(u,i),h=s.toString(),p=await f.export(h),d=this.components.datastore.batch(),m={name:a.name,id:a.id};d.put(lc(a.name),U(p)),d.put(kl(a.name),U(JSON.stringify(m))),await d.commit()}Ub("keychain reconstructed")}};l();l();l();async function Fy(r){try{return{status:"fulfilled",value:await r,isFulfilled:!0,isRejected:!1}}catch(e){return{status:"rejected",reason:e,isFulfilled:!1,isRejected:!0}}}l();l();var RC=class{value;next;constructor(e){this.value=e}},Vy=class{#e;#r;#n;constructor(){this.clear()}enqueue(e){let t=new RC(e);this.#e?(this.#r.next=t,this.#r=t):(this.#e=t,this.#r=t),this.#n++}dequeue(){let e=this.#e;if(e)return this.#e=this.#e.next,this.#n--,e.value}clear(){this.#e=void 0,this.#r=void 0,this.#n=0}get size(){return this.#n}*[Symbol.iterator](){let e=this.#e;for(;e;)yield e.value,e=e.next}};function CC(r){if(!((Number.isInteger(r)||r===Number.POSITIVE_INFINITY)&&r>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");let e=new Vy,t=0,n=()=>{t--,e.size>0&&e.dequeue()()},i=async(a,c,u)=>{t++;let f=(async()=>a(...u))();c(f);try{await f}catch{}n()},s=(a,c,u)=>{e.enqueue(i.bind(void 0,a,c,u)),(async()=>(await Promise.resolve(),t<r&&e.size>0&&e.dequeue()()))()},o=(a,...c)=>new Promise(u=>{s(a,u,c)});return Object.defineProperties(o,{activeCount:{get:()=>t},pendingCount:{get:()=>e.size},clearQueue:{value:()=>{e.clear()}}}),o}async function PC(r,e={}){let{concurrency:t=Number.POSITIVE_INFINITY}=e,n=CC(t);return Promise.all(r.map(i=>i&&typeof i.then=="function"?Fy(i):typeof i=="function"?Fy(n(()=>i())):Fy(Promise.resolve(i))))}var z1=S(W(),1);l();var kC=class extends Map{constructor(e){super();let{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){let t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}};function ks(r){let{name:e,metrics:t}=r,n;return t!=null?n=new kC({name:e,metrics:t}):n=new Map,n}var qd=k("libp2p:transports"),Mb=class extends Fe{constructor(e,t={}){super(),this.components=e,this.started=!1,this.transports=new Map,this.listeners=ks({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??If.FATAL_ALL}add(e){let t=e[Symbol.toStringTag];if(t==null)throw(0,z1.default)(new Error("Transport must have a valid tag"),K.ERR_INVALID_KEY);if(this.transports.has(t))throw(0,z1.default)(new Error("There is already a transport with this tag"),K.ERR_DUPLICATE_TRANSPORT);qd("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}async start(){let e=this.components.addressManager.getListenAddrs();await this.listen(e),this.started=!0}async stop(){let e=[];for(let[t,n]of this.listeners)for(qd("closing listeners for %s",t);n.length>0;){let i=n.pop();i!=null&&e.push(i.close())}await Promise.all(e),qd("all listeners closed");for(let t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){let n=this.transportForMultiaddr(e);if(n==null)throw(0,z1.default)(new Error(`No transport available for address ${String(e)}`),K.ERR_TRANSPORT_UNAVAILABLE);try{return await n.dial(e,{...t,upgrader:this.components.upgrader})}catch(i){throw i.code==null&&(i.code=K.ERR_TRANSPORT_DIAL_FAILED),i}}getAddrs(){let e=[];for(let t of this.listeners.values())for(let n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}transportForMultiaddr(e){for(let t of this.transports.values())if(t.filter([e]).length>0)return t}async listen(e){if(e==null||e.length===0){qd("no addresses were provided for listening, this node is dial only");return}let t=[];for(let[n,i]of this.transports.entries()){let s=i.filter(e),o=[];for(let u of s){qd("creating listener for %s on %s",n,u);let f=i.createListener({upgrader:this.components.upgrader}),h=this.listeners.get(n);h==null&&(h=[],this.listeners.set(n,h)),h.push(f),f.addEventListener("listening",()=>{this.dispatchEvent(new ne("listener:listening",{detail:f}))}),f.addEventListener("close",()=>{this.dispatchEvent(new ne("listener:close",{detail:f}))}),o.push(f.listen(u))}if(o.length===0){t.push(n);continue}if((await PC(o)).find(u=>u.isFulfilled)==null&&this.faultTolerance!==If.NO_FATAL)throw(0,z1.default)(new Error(`Transport (${n}) could not listen on any available address`),K.ERR_NO_VALID_ADDRESSES)}if(t.length===this.transports.size){let n=`no valid addresses were provided for transports [${t.join(", ")}]`;if(this.faultTolerance===If.FATAL_ALL)throw(0,z1.default)(new Error(n),K.ERR_NO_VALID_ADDRESSES);qd(`libp2p in dial mode only: ${n}`)}}async remove(e){qd("removing %s",e);for(let t of this.listeners.get(e)??[])await t.close();this.transports.delete(e),this.listeners.delete(e)}async removeAll(){let e=[];for(let t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}};l();var An=S(W(),1);l();l();var Ol="/multistream/1.0.0";l();l();l();l();l();function Fb(r){return r[Symbol.asyncIterator]!=null}var Vb=r=>{let e=xr.encodingLength(r),t=Ri(e);return xr.encode(r,t),Vb.bytes=e,t};Vb.bytes=0;function zb(r,e){e=e??{};let t=e.lengthEncoder??Vb;function*n(i){let s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}return Fb(r)?async function*(){for await(let i of r)yield*n(i)}():function*(){for(let i of r)yield*n(i)}()}zb.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??Vb;return new ke(t(r.byteLength),r)};l();var K1=S(W(),1);var Ixe=8,Rxe=1024*1024*4,$d;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})($d||($d={}));var OC=r=>{let e=xr.decode(r);return OC.bytes=xr.encodingLength(e),e};OC.bytes=0;function zy(r,e){let t=new ke,n=$d.LENGTH,i=-1,s=e?.lengthDecoder??OC,o=e?.maxLengthLength??Ixe,a=e?.maxDataLength??Rxe;function*c(){for(;t.byteLength>0;){if(n===$d.LENGTH)try{if(i=s(t),i<0)throw(0,K1.default)(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(i>a)throw(0,K1.default)(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");let u=s.bytes;t.consume(u),e?.onLength!=null&&e.onLength(i),n=$d.DATA}catch(u){if(u instanceof RangeError){if(t.byteLength>o)throw(0,K1.default)(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw u}if(n===$d.DATA){if(t.byteLength<i)break;let u=t.sublist(0,i);t.consume(i),e?.onData!=null&&e.onData(u),yield u,n=$d.LENGTH}}}return Fb(r)?async function*(){for await(let u of r)t.append(u),yield*c();if(t.byteLength>0)throw(0,K1.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}():function*(){for(let u of r)t.append(u),yield*c();if(t.byteLength>0)throw(0,K1.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}()}zy.fromReader=(r,e)=>{let t=1,n=async function*(){for(;;)try{let{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return zy(n,{...e??{},onLength:s=>{t=s}})};l();l();function Pxe(r){return r[Symbol.asyncIterator]!=null}function kxe(...r){let e=[];for(let t of r)Pxe(t)||e.push(t);return e.length===r.length?function*(){for(let t of e)yield*t}():async function*(){let t=dt({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async n=>{for await(let i of n)t.push(i)})),t.end()}catch(n){t.end(n)}}),yield*t}()}var NC=kxe;function jne(r,...e){if(r==null)throw new Error("Empty pipeline");if(DC(r)){let n=r;r=()=>n.source}else if(Yne(r)||Wne(r)){let n=r;r=()=>n}let t=[r,...e];if(t.length>1&&DC(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)DC(t[n])&&(t[n]=Nxe(t[n]));return Oxe(...t)}var Oxe=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},Wne=r=>r?.[Symbol.asyncIterator]!=null,Yne=r=>r?.[Symbol.iterator]!=null,DC=r=>r==null?!1:r.sink!=null&&r.source!=null,Nxe=r=>e=>{let t=r.sink(e);if(t?.then!=null){let n=dt({objectMode:!0});t.then(()=>{n.end()},o=>{n.end(o)});let i,s=r.source;if(Wne(s))i=async function*(){yield*s,n.end()};else if(Yne(s))i=function*(){yield*s,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return NC(n,i())}return r.source};l();function Dxe(r){return r[Symbol.asyncIterator]!=null}function Lxe(r){if(Dxe(r))return(async()=>{for await(let e of r)return e})();for(let e of r)return e}var Qne=Lxe;l();l();var Ky=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function Xne(r,e,t){let n=t??{},i=p1(r);async function*s(){let o,a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){let{abortMessage:f,abortCode:h}=n;throw new Ky(f,h)}let u=new Promise((f,h)=>{o=()=>{let{abortMessage:p,abortCode:d}=n;h(new Ky(p,d))}});c=await Promise.race([u,i.next()]),o=null}catch(u){e.removeEventListener("abort",a);let f=u.type==="aborted"&&e.aborted;if(f&&n.onAbort!=null&&n.onAbort(r),typeof i.return=="function")try{let h=i.return();h instanceof Promise&&h.catch(p=>{n.onReturnError!=null&&n.onReturnError(p)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(f&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return s()}var Uxe=k("libp2p:mss"),Zne=U(`
`);function qy(r){let e=new ke(r,Zne);return zb.single(e)}function Hd(r,e,t={}){let n=qy(e);t.writeBytes===!0?r.push(n.subarray()):r.push(n)}function Jne(r,e,t={}){let n=new ke;for(let i of e)n.append(qy(i));t.writeBytes===!0?r.push(n.subarray()):r.push(n)}async function Mxe(r,e){let t=1,n={[Symbol.asyncIterator]:()=>n,next:async()=>await r.next(t)},i=n;e?.signal!=null&&(i=Xne(n,e.signal));let s=a=>{t=a},o=await jne(i,a=>zy(a,{onLength:s,maxDataLength:1024}),async a=>await Qne(a));if(o==null||o.length===0)throw new F("no buffer returned","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");if(o.get(o.byteLength-1)!==Zne[0])throw Uxe.error("Invalid mss message - missing newline - %s",o.subarray()),new F("missing newline","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.sublist(0,-1)}async function q1(r,e){let t=await Mxe(r,e);return C(t.subarray())}var $y=k("libp2p:mss:select");async function Hy(r,e,t={}){e=Array.isArray(e)?[...e]:[e];let{reader:n,writer:i,rest:s,stream:o}=B1(r),a=e.shift();if(a==null)throw new Error("At least one protocol must be specified");$y.trace('select: write ["%s", "%s"]',Ol,a);let c=U(Ol),u=U(a);Jne(i,[c,u],t);let f=await q1(n,t);if($y.trace('select: read "%s"',f),f===Ol&&(f=await q1(n,t),$y.trace('select: read "%s"',f)),f===a)return s(),{stream:o,protocol:a};for(let h of e){$y.trace('select: write "%s"',h),Hd(i,U(h),t);let p=await q1(n,t);if($y.trace('select: read "%s" for "%s"',p,h),p===h)return s(),{stream:o,protocol:h}}throw s(),new F("protocol selection failed","ERR_UNSUPPORTED_PROTOCOL")}l();var Gy=k("libp2p:mss:handle");async function jy(r,e,t){e=Array.isArray(e)?e:[e];let{writer:n,reader:i,rest:s,stream:o}=B1(r);for(;;){let a=await q1(i,t);if(Gy.trace('read "%s"',a),a===Ol){Gy.trace('respond with "%s" for "%s"',Ol,a),Hd(n,U(Ol),t);continue}if(e.includes(a))return Hd(n,U(a),t),Gy.trace('respond with "%s" for "%s"',a,a),s(),{stream:o,protocol:a};if(a==="ls"){Hd(n,new ke(...e.map(c=>qy(U(c)))),t),Gy.trace('respond with "%s" for %s',e,a);continue}Hd(n,U("na"),t),Gy('respond with "na" for "%s"',a)}}l();var LC=S(W(),1);l();var tie=Symbol.for("@libp2p/connection");var Vxe=k("libp2p:connection"),BC=class{constructor(e){let{remoteAddr:t,remotePeer:n,newStream:i,close:s,getStreams:o,stat:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.stat={...a,status:hb},this._newStream=i,this._close=s,this._getStreams=o,this.tags=[],this._closing=!1}get[Symbol.toStringTag](){return"Connection"}get[tie](){return!0}get streams(){return this._getStreams()}async newStream(e,t){if(this.stat.status===UR)throw(0,LC.default)(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===db)throw(0,LC.default)(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(e)||(e=[e]);let n=await this._newStream(e,t);return n.stat.direction="outbound",n}addStream(e){e.stat.direction="inbound"}removeStream(e){}async close(){if(!(this.stat.status===db||this._closing)){this.stat.status=UR;try{this.streams.forEach(e=>e.close())}catch(e){Vxe.error(e)}this._closing=!0,await this._close(),this._closing=!1,this.stat.timeline.close=Date.now(),this.stat.status=db}}};function rie(r){return new BC(r)}l();var Kb=S(W(),1);var UC=k("libp2p:registrar"),MC=32,FC=64,qb=class{constructor(e){this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onProtocolChange=this._onProtocolChange.bind(this),this._onConnect=this._onConnect.bind(this),this.components.connectionManager.addEventListener("peer:disconnect",this._onDisconnect),this.components.connectionManager.addEventListener("peer:connect",this._onConnect),this.components.peerStore.addEventListener("change:protocols",this._onProtocolChange)}getProtocols(){return Array.from(new Set([...this.topologies.keys(),...this.handlers.keys()])).sort()}getHandler(e){let t=this.handlers.get(e);if(t==null)throw(0,Kb.default)(new Error(`No handler registered for protocol ${e}`),K.ERR_NO_HANDLER_FOR_PROTOCOL);return t}getTopologies(e){let t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e))throw(0,Kb.default)(new Error(`Handler already registered for protocol ${e}`),K.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);let i=Ve.bind({ignoreUndefined:!0})({maxInboundStreams:MC,maxOutboundStreams:FC},n);this.handlers.set(e,{handler:t,options:i}),await this.components.peerStore.protoBook.add(this.components.peerId,[e])}async unhandle(e){let t=Array.isArray(e)?e:[e];t.forEach(n=>{this.handlers.delete(n)}),await this.components.peerStore.protoBook.remove(this.components.peerId,t)}async register(e,t){if(!lQ(t))throw UC.error("topology must be an instance of interfaces/topology"),(0,Kb.default)(new Error("topology must be an instance of interfaces/topology"),K.ERR_INVALID_PARAMETERS);let n=`${(Math.random()*1e9).toString(36)}${Date.now()}`,i=this.topologies.get(e);return i==null&&(i=new Map,this.topologies.set(e,i)),i.set(n,t),await t.setRegistrar(this),n}unregister(e){for(let[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){let t=e.detail;this.components.peerStore.protoBook.get(t.remotePeer).then(n=>{for(let i of n){let s=this.topologies.get(i);if(s!=null)for(let o of s.values())o.onDisconnect(t.remotePeer)}}).catch(n=>{UC.error(n)})}_onConnect(e){let t=e.detail;this.components.peerStore.protoBook.get(t.remotePeer).then(n=>{for(let i of n){let s=this.topologies.get(i);if(s!=null)for(let o of s.values())o.onConnect(t.remotePeer,t)}}).catch(n=>{UC.error(n)})}_onProtocolChange(e){let{peerId:t,protocols:n,oldProtocols:i}=e.detail,s=i.filter(a=>!n.includes(a)),o=n.filter(a=>!i.includes(a));for(let a of s){let c=this.topologies.get(a);if(c!=null)for(let u of c.values())u.onDisconnect(t)}for(let a of o){let c=this.topologies.get(a);if(c!=null)for(let u of c.values()){let f=this.components.connectionManager.getConnections(t)[0];f!=null&&u.onConnect(t,f)}}}};var VC=S(_n(),1);var zC=S(ri(),1),gr=k("libp2p:upgrader");function zxe(r,e){try{let{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.code!==K.ERR_NO_HANDLER_FOR_PROTOCOL)throw t}return MC}function Kxe(r,e){try{let{options:t}=e.getHandler(r);return t.maxOutboundStreams}catch(t){if(t.code!==K.ERR_NO_HANDLER_FOR_PROTOCOL)throw t}return FC}function nie(r,e,t){let n=0;return t.streams.forEach(i=>{i.stat.direction===e&&i.stat.protocol===r&&n++}),n}var $b=class extends Fe{constructor(e,t){super(),this.components=e,this.connectionEncryption=new Map,t.connectionEncryption.forEach(n=>{this.connectionEncryption.set(n.protocol,n)}),this.muxers=new Map,t.muxers.forEach(n=>{this.muxers.set(n.protocol,n)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout}async upgradeInbound(e,t){if(!await this.components.connectionManager.acceptIncomingConnection(e))throw(0,An.default)(new Error("connection denied"),K.ERR_CONNECTION_DENIED);let i,s,o,a,c,u=new VC.TimeoutController(this.inboundUpgradeTimeout);try{(0,zC.setMaxListeners)?.(1/0,u.signal)}catch{}try{let f=vi(e,u.signal);if(e.source=f.source,e.sink=f.sink,await this.components.connectionGater.denyInboundConnection(e))throw(0,An.default)(new Error("The multiaddr connection is blocked by gater.acceptConnection"),K.ERR_CONNECTION_INTERCEPTED);this.components.metrics?.trackMultiaddrConnection(e),gr("starting the inbound connection upgrade");let h=e;if(t?.skipProtection!==!0){let p=this.components.connectionProtector;p!=null&&(gr("protecting the inbound connection"),h=await p.protect(e))}try{if(i=h,t?.skipEncryption!==!0){if({conn:i,remotePeer:s,protocol:c}=await this._encryptInbound(h),await this.components.connectionGater.denyInboundEncryptedConnection(s,{...h,...i}))throw(0,An.default)(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),K.ERR_CONNECTION_INTERCEPTED)}else{let p=e.remoteAddr.getPeerId();if(p==null)throw(0,An.default)(new Error("inbound connection that skipped encryption must have a peer id"),K.ERR_INVALID_MULTIADDR);let d=ae(p);c="native",s=d}if(o=i,t?.muxerFactory!=null)a=t.muxerFactory;else if(this.muxers.size>0){let p=await this._multiplexInbound({...h,...i},this.muxers);a=p.muxerFactory,o=p.stream}}catch(p){throw gr.error("Failed to upgrade inbound connection",p),p}if(await this.components.connectionGater.denyInboundUpgradedConnection(s,{...h,...i}))throw(0,An.default)(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),K.ERR_CONNECTION_INTERCEPTED);return gr("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:c,direction:"inbound",maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:s})}finally{this.components.connectionManager.afterUpgradeInbound(),u.clear()}}async upgradeOutbound(e,t){let n=e.remoteAddr.getPeerId(),i;if(n!=null&&(i=ae(n),await this.components.connectionGater.denyOutboundConnection(i,e)))throw(0,An.default)(new Error("The multiaddr connection is blocked by connectionGater.denyOutboundConnection"),K.ERR_CONNECTION_INTERCEPTED);let s,o,a,c,u;this.components.metrics?.trackMultiaddrConnection(e),gr("Starting the outbound connection upgrade");let f=e;if(t?.skipProtection!==!0){let h=this.components.connectionProtector;h!=null&&(f=await h.protect(e))}try{if(s=f,t?.skipEncryption!==!0){if({conn:s,remotePeer:o,protocol:c}=await this._encryptOutbound(f,i),await this.components.connectionGater.denyOutboundEncryptedConnection(o,{...f,...s}))throw(0,An.default)(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),K.ERR_CONNECTION_INTERCEPTED)}else{if(i==null)throw(0,An.default)(new Error("Encryption was skipped but no peer id was passed"),K.ERR_INVALID_PEER);c="native",o=i}if(a=s,t?.muxerFactory!=null)u=t.muxerFactory;else if(this.muxers.size>0){let h=await this._multiplexOutbound({...f,...s},this.muxers);u=h.muxerFactory,a=h.stream}}catch(h){throw gr.error("Failed to upgrade outbound connection",h),await e.close(h),h}if(await this.components.connectionGater.denyOutboundUpgradedConnection(o,{...f,...s}))throw(0,An.default)(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),K.ERR_CONNECTION_INTERCEPTED);return gr("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:c,direction:"outbound",maConn:e,upgradedConn:a,muxerFactory:u,remotePeer:o})}_createConnection(e){let{cryptoProtocol:t,direction:n,maConn:i,upgradedConn:s,remotePeer:o,muxerFactory:a}=e,c,u,f;a!=null&&(c=a.createStreamMuxer({direction:n,onIncomingStream:d=>{f!=null&&Promise.resolve().then(async()=>{let m=this.components.registrar.getProtocols(),{stream:g,protocol:y}=await jy(d,m);if(gr("%s: incoming stream opened on %s",n,y),f==null)return;let w=zxe(y,this.components.registrar);if(nie(y,"inbound",f)===w){d.abort((0,An.default)(new Error(`Too many inbound protocol streams for protocol "${y}" - limit ${w}`),K.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS));return}d.source=g.source,d.sink=g.sink,d.stat.protocol=y,this.components.peerStore.protoBook.add(o,[y]).catch(_=>gr.error(_)),f.addStream(d),this.components.metrics?.trackProtocolStream(d,f),this._onStream({connection:f,stream:d,protocol:y})}).catch(m=>{gr.error(m),d.stat.timeline.close==null&&d.close()})},onStreamEnd:d=>{f?.removeStream(d.id)}}),u=async(d,m={})=>{if(c==null)throw(0,An.default)(new Error("Stream is not multiplexed"),K.ERR_MUXER_UNAVAILABLE);gr("%s: starting new stream on %s",n,d);let g=await c.newStream(),y;try{if(m.signal==null){gr("No abort signal was passed while trying to negotiate protocols %s falling back to default timeout",d),y=new VC.TimeoutController(3e4),m.signal=y.signal;try{(0,zC.setMaxListeners)?.(1/0,y.signal)}catch{}}let{stream:w,protocol:b}=await Hy(g,d,m),_=Kxe(b,this.components.registrar);if(nie(b,"outbound",f)===_){let I=(0,An.default)(new Error(`Too many outbound protocol streams for protocol "${b}" - limit ${_}`),K.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw g.abort(I),I}return this.components.peerStore.protoBook.add(o,[b]).catch(I=>gr.error(I)),g.source=w.source,g.sink=w.sink,g.stat.protocol=b,this.components.metrics?.trackProtocolStream(g,f),g}catch(w){throw gr.error("could not create new stream",w),g.stat.timeline.close==null&&g.close(),w.code!=null?w:(0,An.default)(w,K.ERR_UNSUPPORTED_PROTOCOL)}finally{y?.clear()}},Promise.all([c.sink(s.source),s.sink(c.source)]).catch(d=>{gr.error(d)}));let h=i.timeline;i.timeline=new Proxy(h,{set:(...d)=>(f!=null&&d[1]==="close"&&d[2]!=null&&h.close==null&&(async()=>{try{f.stat.status==="OPEN"&&await f.close()}catch(m){gr.error(m)}finally{this.dispatchEvent(new ne("connectionEnd",{detail:f}))}})().catch(m=>{gr.error(m)}),Reflect.set(...d))}),i.timeline.upgraded=Date.now();let p=()=>{throw(0,An.default)(new Error("connection is not multiplexed"),K.ERR_CONNECTION_NOT_MULTIPLEXED)};return f=rie({remoteAddr:i.remoteAddr,remotePeer:o,stat:{status:"OPEN",direction:n,timeline:i.timeline,multiplexer:c?.protocol,encryption:t},newStream:u??p,getStreams:()=>c!=null?c.streams:p(),close:async()=>{await i.close(),c?.close()}}),this.dispatchEvent(new ne("connection",{detail:f})),f}_onStream(e){let{connection:t,stream:n,protocol:i}=e,{handler:s}=this.components.registrar.getHandler(i);s({connection:t,stream:n})}async _encryptInbound(e){let t=Array.from(this.connectionEncryption.keys());gr("handling inbound crypto protocol selection",t);try{let{stream:n,protocol:i}=await jy(e,t,{writeBytes:!0}),s=this.connectionEncryption.get(i);if(s==null)throw new Error(`no crypto module found for ${i}`);return gr("encrypting inbound connection..."),{...await s.secureInbound(this.components.peerId,n),protocol:i}}catch(n){throw(0,An.default)(n,K.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t){let n=Array.from(this.connectionEncryption.keys());gr("selecting outbound crypto protocol",n);try{let{stream:i,protocol:s}=await Hy(e,n,{writeBytes:!0}),o=this.connectionEncryption.get(s);if(o==null)throw new Error(`no crypto module found for ${s}`);return gr("encrypting outbound connection to %p",t),{...await o.secureOutbound(this.components.peerId,i,t),protocol:s}}catch(i){throw(0,An.default)(i,K.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){let n=Array.from(t.keys());gr("outbound selecting muxer %s",n);try{let{stream:i,protocol:s}=await Hy(e,n,{writeBytes:!0});gr("%s selected as muxer protocol",s);let o=t.get(s);return{stream:i,muxerFactory:o}}catch(i){throw gr.error("error multiplexing outbound stream",i),(0,An.default)(i,K.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){let n=Array.from(t.keys());gr("inbound handling muxers %s",n);try{let{stream:i,protocol:s}=await jy(e,n,{writeBytes:!0}),o=t.get(s);return{stream:i,muxerFactory:o}}catch(i){throw gr.error("error multiplexing inbound stream",i),(0,An.default)(i,K.ERR_MUXER_UNAVAILABLE)}}};l();var jd=S(W(),1);l();var Gd;(function(r){let e;r.codec=()=>(e==null&&(e=Al((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(let s of t.listenAddrs)n.uint32(18),n.bytes(s);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(let s of t.protocols)n.uint32(26),n.string(s);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={listenAddrs:[],protocols:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 5:i.protocolVersion=t.string();break;case 6:i.agentVersion=t.string();break;case 1:i.publicKey=t.bytes();break;case 2:i.listenAddrs.push(t.bytes());break;case 4:i.observedAddr=t.bytes();break;case 3:i.protocols.push(t.string());break;case 8:i.signedPeerRecord=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>xl(t,r.codec()),r.decode=t=>Sl(t,r.codec())})(Gd||(Gd={}));l();l();var Hb="0.0.0",iie="libp2p";var KC=`js-libp2p/${Hb}`;var sie="0.1.0",oie="id",aie="id/push",cie="1.0.0",lie="1.0.0";var Wy=S(_n(),1);var Yy=S(ri(),1),lr=k("libp2p:identify"),uie=1024*8,$1=class{constructor(e,t){this.components=e,this.started=!1,this.init=t,this.identifyProtocolStr=`/${t.protocolPrefix}/${oie}/${cie}`,this.identifyPushProtocolStr=`/${t.protocolPrefix}/${aie}/${lie}`,this.host={protocolVersion:`${t.protocolPrefix}/${sie}`,...t.host},this.components.connectionManager.addEventListener("peer:connect",n=>{let i=n.detail;this.identify(i).catch(lr.error)}),this.components.peerStore.addEventListener("change:multiaddrs",n=>{let{peerId:i}=n.detail;this.components.peerId.equals(i)&&this.pushToPeerStore().catch(s=>lr.error(s))}),this.components.peerStore.addEventListener("change:protocols",n=>{let{peerId:i}=n.detail;this.components.peerId.equals(i)&&this.pushToPeerStore().catch(s=>lr.error(s))})}isStarted(){return this.started}async start(){this.started||(await this.components.peerStore.metadataBook.setValue(this.components.peerId,"AgentVersion",U(this.host.agentVersion)),await this.components.peerStore.metadataBook.setValue(this.components.peerId,"ProtocolVersion",U(this.host.protocolVersion)),await this.components.registrar.handle(this.identifyProtocolStr,e=>{this._handleIdentify(e).catch(t=>{lr.error(t)})},{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),await this.components.registrar.handle(this.identifyPushProtocolStr,e=>{this._handlePush(e).catch(t=>{lr.error(t)})},{maxInboundStreams:this.init.maxPushIncomingStreams,maxOutboundStreams:this.init.maxPushOutgoingStreams}),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.identifyProtocolStr),await this.components.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async push(e){let t=await this.components.peerStore.addressBook.getRawEnvelope(this.components.peerId),n=this.components.addressManager.getAddresses().map(o=>o.bytes),i=await this.components.peerStore.protoBook.get(this.components.peerId),s=e.map(async o=>{let a,c=new Wy.TimeoutController(this.init.timeout);try{(0,Yy.setMaxListeners)?.(1/0,c.signal)}catch{}try{a=await o.newStream([this.identifyPushProtocolStr],{signal:c.signal}),await vi(a,c.signal).sink(_e([Gd.encode({listenAddrs:n,signedPeerRecord:t,protocols:i})],xn()))}catch(u){lr.error("could not push identify update to peer",u)}finally{a?.close(),c.clear()}});await Promise.all(s)}async pushToPeerStore(){if(!this.isStarted())return;let e=[];for(let t of this.components.connectionManager.getConnections()){let n=t.remotePeer;(await this.components.peerStore.get(n)).protocols.includes(this.identifyPushProtocolStr)&&e.push(t)}await this.push(e)}async _identify(e,t={}){let n,i=t.signal,s;if(i==null){n=new Wy.TimeoutController(this.init.timeout),i=n.signal;try{(0,Yy.setMaxListeners)?.(1/0,n.signal)}catch{}}try{s=await e.newStream([this.identifyProtocolStr],{signal:i});let o=vi(s,i),a=await _e([],o,on({maxDataLength:this.init.maxIdentifyMessageSize??uie}),async c=>await hn(c));if(a==null)throw(0,jd.default)(new Error("No data could be retrieved"),K.ERR_CONNECTION_ENDED);try{return Gd.decode(a)}catch(c){throw(0,jd.default)(c,K.ERR_INVALID_MESSAGE)}}finally{n?.clear(),s?.close()}}async identify(e,t={}){let n=await this._identify(e,t),{publicKey:i,listenAddrs:s,protocols:o,observedAddr:a,signedPeerRecord:c,agentVersion:u,protocolVersion:f}=n;if(i==null)throw(0,jd.default)(new Error("public key was missing from identify message"),K.ERR_MISSING_PUBLIC_KEY);let h=await Ur(i);if(!e.remotePeer.equals(h))throw(0,jd.default)(new Error("identified peer does not match the expected peer"),K.ERR_INVALID_PEER);if(this.components.peerId.equals(h))throw(0,jd.default)(new Error("identified peer is our own peer id?"),K.ERR_INVALID_PEER);let p=$1.getCleanMultiaddr(a);if(c!=null){lr("received signed peer record from %p",h);try{let d=await nn.openAndCertify(c,pn.DOMAIN);if(!d.peerId.equals(h))throw(0,jd.default)(new Error("identified peer does not match the expected peer"),K.ERR_INVALID_PEER);if(await this.components.peerStore.addressBook.consumePeerRecord(d)){await this.components.peerStore.protoBook.set(h,o),u!=null&&await this.components.peerStore.metadataBook.setValue(h,"AgentVersion",U(u)),f!=null&&await this.components.peerStore.metadataBook.setValue(h,"ProtocolVersion",U(f)),lr("identify completed for peer %p and protocols %o",h,o);return}}catch(d){lr("received invalid envelope, discard it and fallback to listenAddrs is available",d)}}else lr("no signed peer record received from %p",h);lr("falling back to legacy addresses from %p",h);try{await this.components.peerStore.addressBook.set(h,s.map(d=>se(d)))}catch(d){lr.error("received invalid addrs",d)}await this.components.peerStore.protoBook.set(h,o),u!=null&&await this.components.peerStore.metadataBook.setValue(h,"AgentVersion",U(u)),f!=null&&await this.components.peerStore.metadataBook.setValue(h,"ProtocolVersion",U(f)),lr("identify completed for peer %p and protocols %o",h,o),lr("received observed address of %s",p?.toString())}async _handleIdentify(e){let{connection:t,stream:n}=e,i=new Wy.TimeoutController(this.init.timeout);try{(0,Yy.setMaxListeners)?.(1/0,i.signal)}catch{}try{let s=this.components.peerId.publicKey??new Uint8Array(0),o=await this.components.peerStore.get(this.components.peerId),a=this.components.addressManager.getAddresses().map(p=>p.decapsulateCode(Kt("p2p").code)),c=o.peerRecordEnvelope;if(a.length>0&&c==null){let p=new pn({peerId:this.components.peerId,multiaddrs:a}),d=await nn.seal(p,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(d),c=d.marshal().subarray()}let u=Gd.encode({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:s,listenAddrs:a.map(p=>p.bytes),signedPeerRecord:c,observedAddr:t.remoteAddr.bytes,protocols:o.protocols}),f=vi(n,i.signal),h=_e([u],xn());await f.sink(h)}catch(s){lr.error("could not respond to identify request",s)}finally{n.close(),i.clear()}}async _handlePush(e){let{connection:t,stream:n}=e,i=new Wy.TimeoutController(this.init.timeout);try{(0,Yy.setMaxListeners)?.(1/0,i.signal)}catch{}let s;try{let a=vi(n,i.signal),c=await _e([],a,on({maxDataLength:this.init.maxIdentifyMessageSize??uie}),async u=>await hn(u));c!=null&&(s=Gd.decode(c))}catch(a){return lr.error("received invalid message",a)}finally{n.close(),i.clear()}if(s==null)return lr.error("received invalid message");let o=t.remotePeer;if(this.components.peerId.equals(o)){lr("received push from ourselves?");return}if(lr("received push from %p",o),s.signedPeerRecord!=null){lr("received signedPeerRecord in push");try{let a=await nn.openAndCertify(s.signedPeerRecord,pn.DOMAIN);if(await this.components.peerStore.addressBook.consumePeerRecord(a)){lr("consumed signedPeerRecord sent in push"),await this.components.peerStore.protoBook.set(o,s.protocols);return}else lr("failed to consume signedPeerRecord sent in push")}catch(a){lr("received invalid envelope, discard it and fallback to listenAddrs is available",a)}}else lr("did not receive signedPeerRecord in push");try{await this.components.peerStore.addressBook.set(o,s.listenAddrs.map(a=>se(a)))}catch(a){lr.error("received invalid addrs",a)}try{await this.components.peerStore.protoBook.set(o,s.protocols)}catch(a){lr.error("received invalid protocols",a)}lr("handled push from %p",o)}static getCleanMultiaddr(e){if(e!=null&&e.length>0)try{return se(e)}catch{}}};l();var H1=S(W(),1);l();var Qy;(function(r){let e;r.codec=()=>(e==null&&(e=Al((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.identifier!=="")&&(n.uint32(10),n.string(t.identifier)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={identifier:""},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.identifier=t.string();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>xl(t,r.codec()),r.decode=t=>Sl(t,r.codec())})(Qy||(Qy={}));var ta;(function(r){let e;(function(i){i.OK="OK",i.NOT_FOUND="NOT_FOUND",i.ERROR="ERROR"})(e=r.StatusCode||(r.StatusCode={}));let t;(function(i){i[i.OK=0]="OK",i[i.NOT_FOUND=1]="NOT_FOUND",i[i.ERROR=2]="ERROR"})(t||(t={})),function(i){i.codec=()=>L1(t)}(e=r.StatusCode||(r.StatusCode={}));let n;r.codec=()=>(n==null&&(n=Al((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),(o.writeDefaults===!0||i.status!=null&&t[i.status]!==0)&&(s.uint32(8),r.StatusCode.codec().encode(i.status,s)),(o.writeDefaults===!0||i.data!=null&&i.data.byteLength>0)&&(s.uint32(18),s.bytes(i.data)),o.lengthDelimited!==!1&&s.ldelim()},(i,s)=>{let o={status:e.OK,data:new Uint8Array(0)},a=s==null?i.len:i.pos+s;for(;i.pos<a;){let c=i.uint32();switch(c>>>3){case 1:o.status=r.StatusCode.codec().decode(i);break;case 2:o.data=i.bytes();break;default:i.skipType(c&7);break}}return o})),n),r.encode=i=>xl(i,r.codec()),r.decode=i=>Sl(i,r.codec())})(ta||(ta={}));l();var fie="0.0.1",hie="fetch";var die=S(_n(),1),pie=S(ri(),1);var go=k("libp2p:fetch"),Gb=class{constructor(e,t){this.started=!1,this.components=e,this.protocol=`/${t.protocolPrefix??"libp2p"}/${hie}/${fie}`,this.lookupFunctions=new Map,this.handleMessage=this.handleMessage.bind(this),this.init=t}async start(){await this.components.registrar.handle(this.protocol,e=>{this.handleMessage(e).catch(t=>{go.error(t)}).finally(()=>{e.stream.close()})},{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}async fetch(e,t,n={}){go("dialing %s to %p",this.protocol,e);let i=await this.components.connectionManager.openConnection(e,n),s,o=n.signal,a;if(o==null){go("using default timeout of %d ms",this.init.timeout),s=new die.TimeoutController(this.init.timeout),o=s.signal;try{(0,pie.setMaxListeners)?.(1/0,s.signal)}catch{}}try{a=await i.newStream(this.protocol,{signal:o});let c=vi(a,o);return go("fetch %s",t),await _e([Qy.encode({identifier:t})],xn(),c,on(),async function(f){let h=await hn(f);if(h==null)throw(0,H1.default)(new Error("No data received"),K.ERR_INVALID_MESSAGE);let p=ta.decode(h);switch(p.status){case ta.StatusCode.OK:return go("received status for %s ok",t),p.data;case ta.StatusCode.NOT_FOUND:return go("received status for %s not found",t),null;case ta.StatusCode.ERROR:{go("received status for %s error",t);let d=C(p.data);throw(0,H1.default)(new Error("Error in fetch protocol response: "+d),K.ERR_INVALID_PARAMETERS)}default:throw go("received status for %s unknown",t),(0,H1.default)(new Error("Unknown response status"),K.ERR_INVALID_MESSAGE)}})??null}finally{s?.clear(),a?.close()}}async handleMessage(e){let{stream:t}=e,n=this;await _e(t,on(),async function*(i){let s=await hn(i);if(s==null)throw(0,H1.default)(new Error("No data received"),K.ERR_INVALID_MESSAGE);let o=Qy.decode(s),a,c=n._getLookupFunction(o.identifier);if(c!=null){go("look up data with identifier %s",o.identifier);let u=await c(o.identifier);u!=null?(go("sending status for %s ok",o.identifier),a={status:ta.StatusCode.OK,data:u}):(go("sending status for %s not found",o.identifier),a={status:ta.StatusCode.NOT_FOUND,data:new Uint8Array(0)})}else{go("sending status for %s error",o.identifier);let u=U(`No lookup function registered for key: ${o.identifier}`);a={status:ta.StatusCode.ERROR,data:u}}yield ta.encode(a)},xn(),t)}_getLookupFunction(e){for(let t of this.lookupFunctions.keys())if(e.startsWith(t))return this.lookupFunctions.get(t)}registerLookupFunction(e,t){if(this.lookupFunctions.has(e))throw(0,H1.default)(new Error("Fetch protocol handler for key prefix '"+e+"' already registered"),K.ERR_KEY_ALREADY_EXISTS);this.lookupFunctions.set(e,t)}unregisterLookupFunction(e,t){t!=null&&this.lookupFunctions.get(e)!==t||this.lookupFunctions.delete(e)}};l();var wie=S(W(),1);l();var mie="1.0.0",gie="ping";var bie=S(_n(),1),Eie=S(ri(),1),yie=k("libp2p:ping"),jb=class{constructor(e,t){this.components=e,this.started=!1,this.protocol=`/${t.protocolPrefix}/${gie}/${mie}`,this.init=t}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){let{stream:t}=e;_e(t,t).catch(n=>{yie.error(n)})}async ping(e,t={}){yie("dialing %s to %p",this.protocol,e);let n=Date.now(),i=$i(32),s=await this.components.connectionManager.openConnection(e,t),o,a=t.signal,c;if(a==null){o=new bie.TimeoutController(this.init.timeout),a=o.signal;try{(0,Eie.setMaxListeners)?.(1/0,o.signal)}catch{}}try{c=await s.newStream([this.protocol],{signal:a});let u=vi(c,a),f=await _e([i],u,async p=>await hn(p)),h=Date.now();if(f==null||!be(i,f.subarray()))throw(0,wie.default)(new Error("Received wrong ping ack"),K.ERR_WRONG_PING_ACK);return h-n}finally{o?.clear(),c?.close()}}};l();l();async function _ie(){throw new Error("Not supported in browsers")}l();var vie=S(f_(),1),qC=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,Wb=(0,vie.default)(),Wd=qC&&!Wb,Sie=Wb&&!qC,xie=Wb&&qC,Aie=typeof globalThis.process<"u"&&typeof globalThis.process.release<"u"&&globalThis.process.release.name==="node"&&!Wb,Yb=typeof importScripts=="function"&&typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,CKt=typeof globalThis.process<"u"&&typeof globalThis.process.env<"u"&&globalThis.process.env["NODE"+(()=>"_")()+"ENV"]==="test",Tie=typeof navigator<"u"&&navigator.product==="ReactNative";var Cie=S(W(),1);l();l();function Iie(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function Rie(r){let{address:e}=r.nodeAddress();return Iie(e)}var $C=k("libp2p:nat"),HC=7200;function Hxe(r=1024,e=65535){return Math.floor(Math.random()*(e-r+1)+r)}var Qb=class{constructor(e,t){if(this.components=e,this.started=!1,this.enabled=t.enabled,this.externalAddress=t.externalAddress,this.localAddress=t.localAddress,this.description=t.description??`${iie}@${Hb} ${this.components.peerId.toString()}`,this.ttl=t.ttl??HC,this.keepAlive=t.keepAlive??!0,this.gateway=t.gateway,this.ttl<HC)throw(0,Cie.default)(new Error(`NatManager ttl should be at least ${HC} seconds`),K.ERR_INVALID_PARAMETERS)}isStarted(){return this.started}start(){}afterStart(){Wd||!this.enabled||this.started||(this.started=!0,this._start().catch(e=>{$C.error(e)}))}async _start(){let e=this.components.transportManager.getAddrs();for(let t of e){let{family:n,host:i,port:s,transport:o}=t.toOptions();if(!t.isThinWaistAddress()||o!=="tcp"||Rie(t)||n!==4)continue;let a=await this._getClient(),c=this.externalAddress??await a.externalIp(),u=Md(c);if(u===!0)throw new Error(`${c} is private - please set config.nat.externalIp to an externally routable IP or ensure you are not behind a double NAT`);if(u==null)throw new Error(`${c} is not an IP address`);let f=Hxe();$C(`opening uPnP connection from ${c}:${f} to ${i}:${s}`),await a.map({publicPort:f,localPort:s,localAddress:this.localAddress,protocol:o.toUpperCase()==="TCP"?"TCP":"UDP"}),this.components.addressManager.addObservedAddr(GL({family:4,address:c,port:f},o))}}async _getClient(){return this.client!=null?this.client:(this.client=await _ie({description:this.description,ttl:this.ttl,keepAlive:this.keepAlive,gateway:this.gateway}),this.client)}async stop(){if(!(Wd||this.client==null))try{await this.client.close(),this.client=void 0}catch(e){$C.error(e)}}};l();var Gxe=k("libp2p:peer-record-updater"),Xb=class{constructor(e){this.components=e,this.started=!1,this.update=this.update.bind(this)}isStarted(){return this.started}async start(){this.started=!0,this.components.transportManager.addEventListener("listener:listening",this.update),this.components.transportManager.addEventListener("listener:close",this.update),this.components.addressManager.addEventListener("change:addresses",this.update)}async stop(){this.started=!1,this.components.transportManager.removeEventListener("listener:listening",this.update),this.components.transportManager.removeEventListener("listener:close",this.update),this.components.addressManager.removeEventListener("change:addresses",this.update)}update(){Promise.resolve().then(async()=>{let e=new pn({peerId:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map(n=>n.decapsulateCode(Kt("p2p").code))}),t=await nn.seal(e,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(t)}).catch(e=>{Gxe.error("Could not update self peer record: %o",e)})}};l();var Pie=S(W(),1);var Zb=class{constructor(e){this.dht=e}async findPeer(e,t={}){for await(let n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw(0,Pie.default)(new Error(rt.NOT_FOUND),K.ERR_NOT_FOUND)}async*getClosestPeers(e,t={}){for await(let n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}};l();l();l();var Qe={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_NOT_FOUND:"ERR_NOT_FOUND"};var nr=k("libp2p:peer-store:address-book"),Jb="change:multiaddrs";async function jxe(){return!0}var eE=class{constructor(e,t,n){this.dispatchEvent=e,this.store=t,this.addressFilter=n??jxe}async consumePeerRecord(e){nr.trace("consumePeerRecord await write lock");let t=await this.store.lock.writeLock();nr.trace("consumePeerRecord got write lock");let n,i,s;try{let o;try{o=pn.createFromProtobuf(e.payload)}catch{return nr.error("invalid peer record received"),!1}n=o.peerId;let a=o.multiaddrs;if(!n.equals(e.peerId))return nr("signing key does not match PeerId in the PeerRecord"),!1;if(a==null||a.length===0)return!1;if(await this.store.has(n)&&(i=await this.store.load(n),i.peerRecordEnvelope!=null)){let u=await nn.createFromProtobuf(i.peerRecordEnvelope),f=pn.createFromProtobuf(u.payload);if(f.seqNumber>=o.seqNumber)return nr("sequence number was lower or equal to existing sequence number - stored: %d received: %d",f.seqNumber,o.seqNumber),!1}let c=await GC(n,a,this.addressFilter,!0);s=await this.store.patchOrCreate(n,{addresses:c,peerRecordEnvelope:e.marshal().subarray()}),nr("stored provided peer record for %p",o.peerId)}finally{nr.trace("consumePeerRecord release write lock"),t()}return this.dispatchEvent(new ne(Jb,{detail:{peerId:n,multiaddrs:s.addresses.map(({multiaddr:o})=>o),oldMultiaddrs:i==null?[]:i.addresses.map(({multiaddr:o})=>o)}})),!0}async getRawEnvelope(e){nr.trace("getRawEnvelope await read lock");let t=await this.store.lock.readLock();nr.trace("getRawEnvelope got read lock");try{return(await this.store.load(e)).peerRecordEnvelope}catch(n){if(n.code!==Qe.ERR_NOT_FOUND)throw n}finally{nr.trace("getRawEnvelope release read lock"),t()}}async getPeerRecord(e){let t=await this.getRawEnvelope(e);if(t!=null)return await nn.createFromProtobuf(t)}async get(e){e=Zr(e),nr.trace("get wait for read lock");let t=await this.store.lock.readLock();nr.trace("get got read lock");try{return(await this.store.load(e)).addresses}catch(n){if(n.code!==Qe.ERR_NOT_FOUND)throw n}finally{nr.trace("get release read lock"),t()}return[]}async set(e,t){if(e=Zr(e),!Array.isArray(t))throw nr.error("multiaddrs must be an array of Multiaddrs"),new F("multiaddrs must be an array of Multiaddrs",Qe.ERR_INVALID_PARAMETERS);nr.trace("set await write lock");let n=await this.store.lock.writeLock();nr.trace("set got write lock");let i=!1,s,o;try{let a=await GC(e,t,this.addressFilter);if(a.length===0)return;try{if(s=await this.store.load(e),i=!0,new Set([...a.map(({multiaddr:c})=>c.toString()),...s.addresses.map(({multiaddr:c})=>c.toString())]).size===s.addresses.length&&a.length===s.addresses.length)return}catch(c){if(c.code!==Qe.ERR_NOT_FOUND)throw c}o=await this.store.patchOrCreate(e,{addresses:a}),nr("set multiaddrs for %p",e)}finally{nr.trace("set multiaddrs for %p",e),nr("set release write lock"),n()}this.dispatchEvent(new ne(Jb,{detail:{peerId:e,multiaddrs:o.addresses.map(a=>a.multiaddr),oldMultiaddrs:s==null?[]:s.addresses.map(({multiaddr:a})=>a)}})),i||this.dispatchEvent(new ne("peer",{detail:{id:e,multiaddrs:o.addresses.map(a=>a.multiaddr),protocols:o.protocols}}))}async add(e,t){if(e=Zr(e),!Array.isArray(t))throw nr.error("multiaddrs must be an array of Multiaddrs"),new F("multiaddrs must be an array of Multiaddrs",Qe.ERR_INVALID_PARAMETERS);nr.trace("add await write lock");let n=await this.store.lock.writeLock();nr.trace("add got write lock");let i,s,o;try{let a=await GC(e,t,this.addressFilter);if(a.length===0)return;try{if(s=await this.store.load(e),i=!0,new Set([...a.map(({multiaddr:c})=>c.toString()),...s.addresses.map(({multiaddr:c})=>c.toString())]).size===s.addresses.length)return}catch(c){if(c.code!==Qe.ERR_NOT_FOUND)throw c}o=await this.store.mergeOrCreate(e,{addresses:a}),nr("added multiaddrs for %p",e)}finally{nr.trace("set release write lock"),n()}this.dispatchEvent(new ne(Jb,{detail:{peerId:e,multiaddrs:o.addresses.map(a=>a.multiaddr),oldMultiaddrs:s==null?[]:s.addresses.map(({multiaddr:a})=>a)}})),i===!0&&this.dispatchEvent(new ne("peer",{detail:{id:e,multiaddrs:o.addresses.map(a=>a.multiaddr),protocols:o.protocols}}))}async delete(e){e=Zr(e),nr.trace("delete await write lock");let t=await this.store.lock.writeLock();nr.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(i){if(i.code!==Qe.ERR_NOT_FOUND)throw i}await this.store.patchOrCreate(e,{addresses:[]})}finally{nr.trace("delete release write lock"),t()}n!=null&&this.dispatchEvent(new ne(Jb,{detail:{peerId:e,multiaddrs:[],oldMultiaddrs:n==null?[]:n.addresses.map(({multiaddr:i})=>i)}}))}};async function GC(r,e,t,n=!1){let i=[];return await Promise.all(e.map(async s=>{if(!pi(s))throw nr.error("multiaddr must be an instance of Multiaddr"),new F("multiaddr must be an instance of Multiaddr",Qe.ERR_INVALID_PARAMETERS);await t(r,s)&&i.push({multiaddr:s,isCertified:n})})),i}l();var uc=k("libp2p:peer-store:key-book"),kie="change:pubkey",tE=class{constructor(e,t){this.dispatchEvent=e,this.store=t}async set(e,t){if(e=Zr(e),!(t instanceof Uint8Array))throw uc.error("publicKey must be an instance of Uint8Array to store data"),new F("publicKey must be an instance of PublicKey",Qe.ERR_INVALID_PARAMETERS);uc.trace("set await write lock");let n=await this.store.lock.writeLock();uc.trace("set got write lock");let i=!1,s;try{try{if(s=await this.store.load(e),s.pubKey!=null&&be(s.pubKey,t))return}catch(o){if(o.code!==Qe.ERR_NOT_FOUND)throw o}await this.store.patchOrCreate(e,{pubKey:t}),i=!0}finally{uc.trace("set release write lock"),n()}i&&this.dispatchEvent(new ne(kie,{detail:{peerId:e,publicKey:t,oldPublicKey:s?.pubKey}}))}async get(e){e=Zr(e),uc.trace("get await write lock");let t=await this.store.lock.readLock();uc.trace("get got write lock");try{return(await this.store.load(e)).pubKey}catch(n){if(n.code!==Qe.ERR_NOT_FOUND)throw n}finally{uc("get release write lock"),t()}}async delete(e){e=Zr(e),uc.trace("delete await write lock");let t=await this.store.lock.writeLock();uc.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(i){if(i.code!==Qe.ERR_NOT_FOUND)throw i}await this.store.patchOrCreate(e,{pubKey:void 0})}catch(i){if(i.code!==Qe.ERR_NOT_FOUND)throw i}finally{uc.trace("delete release write lock"),t()}this.dispatchEvent(new ne(kie,{detail:{peerId:e,publicKey:void 0,oldPublicKey:n?.pubKey}}))}};l();var bn=k("libp2p:peer-store:metadata-book"),rE="change:metadata",nE=class{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){e=Zr(e),bn.trace("get await read lock");let t=await this.store.lock.readLock();bn.trace("get got read lock");try{return(await this.store.load(e)).metadata}catch(n){if(n.code!==Qe.ERR_NOT_FOUND)throw n}finally{bn.trace("get release read lock"),t()}return new Map}async getValue(e,t){e=Zr(e),bn.trace("getValue await read lock");let n=await this.store.lock.readLock();bn.trace("getValue got read lock");try{return(await this.store.load(e)).metadata.get(t)}catch(i){if(i.code!==Qe.ERR_NOT_FOUND)throw i}finally{bn.trace("getValue release write lock"),n()}}async set(e,t){if(e=Zr(e),!(t instanceof Map))throw bn.error("valid metadata must be provided to store data"),new F("valid metadata must be provided",Qe.ERR_INVALID_PARAMETERS);bn.trace("set await write lock");let n=await this.store.lock.writeLock();bn.trace("set got write lock");let i;try{try{i=await this.store.load(e)}catch(s){if(s.code!==Qe.ERR_NOT_FOUND)throw s}await this.store.mergeOrCreate(e,{metadata:t})}finally{bn.trace("set release write lock"),n()}this.dispatchEvent(new ne(rE,{detail:{peerId:e,metadata:t,oldMetadata:i==null?new Map:i.metadata}}))}async setValue(e,t,n){if(e=Zr(e),typeof t!="string"||!(n instanceof Uint8Array))throw bn.error("valid key and value must be provided to store data"),new F("valid key and value must be provided",Qe.ERR_INVALID_PARAMETERS);bn.trace("setValue await write lock");let i=await this.store.lock.writeLock();bn.trace("setValue got write lock");let s,o;try{try{s=await this.store.load(e);let a=s.metadata.get(t);if(a!=null&&be(n,a))return}catch(a){if(a.code!==Qe.ERR_NOT_FOUND)throw a}o=await this.store.mergeOrCreate(e,{metadata:new Map([[t,n]])})}finally{bn.trace("setValue release write lock"),i()}this.dispatchEvent(new ne(rE,{detail:{peerId:e,metadata:o.metadata,oldMetadata:s==null?new Map:s.metadata}}))}async delete(e){e=Zr(e),bn.trace("delete await write lock");let t=await this.store.lock.writeLock();bn.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(i){if(i.code!==Qe.ERR_NOT_FOUND)throw i}n!=null&&await this.store.patch(e,{metadata:new Map})}finally{bn.trace("delete release write lock"),t()}n!=null&&this.dispatchEvent(new ne(rE,{detail:{peerId:e,metadata:new Map,oldMetadata:n.metadata}}))}async deleteValue(e,t){e=Zr(e),bn.trace("deleteValue await write lock");let n=await this.store.lock.writeLock();bn.trace("deleteValue got write lock");let i,s;try{s=await this.store.load(e),i=s.metadata,i.delete(t),await this.store.patch(e,{metadata:i})}catch(o){if(o.code!==Qe.ERR_NOT_FOUND)throw o}finally{bn.trace("deleteValue release write lock"),n()}i!=null&&this.dispatchEvent(new ne(rE,{detail:{peerId:e,metadata:i,oldMetadata:s==null?new Map:s.metadata}}))}};l();var En=k("libp2p:peer-store:proto-book"),iE="change:protocols",sE=class{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){En.trace("get wait for read lock");let t=await this.store.lock.readLock();En.trace("get got read lock");try{return(await this.store.load(e)).protocols}catch(n){if(n.code!==Qe.ERR_NOT_FOUND)throw n}finally{En.trace("get release read lock"),t()}return[]}async set(e,t){if(e=Zr(e),!Array.isArray(t))throw En.error("protocols must be provided to store data"),new F("protocols must be provided",Qe.ERR_INVALID_PARAMETERS);En.trace("set await write lock");let n=await this.store.lock.writeLock();En.trace("set got write lock");let i,s;try{try{if(i=await this.store.load(e),new Set([...t]).size===i.protocols.length)return}catch(o){if(o.code!==Qe.ERR_NOT_FOUND)throw o}s=await this.store.patchOrCreate(e,{protocols:t}),En("stored provided protocols for %p",e)}finally{En.trace("set release write lock"),n()}this.dispatchEvent(new ne(iE,{detail:{peerId:e,protocols:s.protocols,oldProtocols:i==null?[]:i.protocols}}))}async add(e,t){if(e=Zr(e),!Array.isArray(t))throw En.error("protocols must be provided to store data"),new F("protocols must be provided",Qe.ERR_INVALID_PARAMETERS);En.trace("add await write lock");let n=await this.store.lock.writeLock();En.trace("add got write lock");let i,s;try{try{if(i=await this.store.load(e),new Set([...i.protocols,...t]).size===i.protocols.length)return}catch(o){if(o.code!==Qe.ERR_NOT_FOUND)throw o}s=await this.store.mergeOrCreate(e,{protocols:t}),En("added provided protocols for %p",e)}finally{En.trace("add release write lock"),n()}this.dispatchEvent(new ne(iE,{detail:{peerId:e,protocols:s.protocols,oldProtocols:i==null?[]:i.protocols}}))}async remove(e,t){if(e=Zr(e),!Array.isArray(t))throw En.error("protocols must be provided to store data"),new F("protocols must be provided",Qe.ERR_INVALID_PARAMETERS);En.trace("remove await write lock");let n=await this.store.lock.writeLock();En.trace("remove got write lock");let i,s;try{try{i=await this.store.load(e);let o=new Set(i.protocols);for(let a of t)o.delete(a);if(i.protocols.length===o.size)return;t=Array.from(o)}catch(o){if(o.code!==Qe.ERR_NOT_FOUND)throw o}s=await this.store.patchOrCreate(e,{protocols:t})}finally{En.trace("remove release write lock"),n()}this.dispatchEvent(new ne(iE,{detail:{peerId:e,protocols:s.protocols,oldProtocols:i==null?[]:i.protocols}}))}async delete(e){e=Zr(e),En.trace("delete await write lock");let t=await this.store.lock.writeLock();En.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(i){if(i.code!==Qe.ERR_NOT_FOUND)throw i}await this.store.patchOrCreate(e,{protocols:[]})}finally{En.trace("delete release write lock"),t()}n!=null&&this.dispatchEvent(new ne(iE,{detail:{peerId:e,protocols:[],oldProtocols:n.protocols}}))}};l();l();var Nl="/",Oie=new TextEncoder().encode(Nl),oE=Oie[0],Ai=class{constructor(e,t){if(typeof e=="string")this._buf=U(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==oE)throw new Error("Invalid key")}toString(e="utf8"){return C(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Ai(e.join(Nl))}static random(){return new Ai(Tr().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Ai(e):typeof e.uint8Array=="function"?new Ai(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=Oie),this._buf[0]!==oE){let e=new Uint8Array(this._buf.byteLength+1);e.fill(oE,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===oE;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return Ai.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Nl).slice(1)}type(){return Wxe(this.baseNamespace())}name(){return Yxe(this.baseNamespace())}instance(e){return new Ai(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Nl)||(e+=Nl),e+=this.type(),new Ai(e)}parent(){let e=this.list();return e.length===1?new Ai(Nl):new Ai(e.slice(0,-1).join(Nl))}child(e){return this.toString()===Nl?e:e.toString()===Nl?this:new Ai(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Ai.withNamespaces([...this.namespaces(),...Qxe(e.map(t=>t.namespaces()))])}};function Wxe(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Yxe(r){let e=r.split(":");return e[e.length-1]}function Qxe(r){return[].concat(...r)}l();var Xy;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(let s of t.addresses)n.uint32(10),aE.codec().encode(s,n);if(t.protocols!=null)for(let s of t.protocols)n.uint32(18),n.string(s);if(t.metadata!=null)for(let s of t.metadata)n.uint32(26),cE.codec().encode(s,n);t.pubKey!=null&&(n.uint32(34),n.bytes(t.pubKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={addresses:[],protocols:[],metadata:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.addresses.push(aE.codec().decode(t,t.uint32()));break;case 2:i.protocols.push(t.string());break;case 3:i.metadata.push(cE.codec().decode(t,t.uint32()));break;case 4:i.pubKey=t.bytes();break;case 5:i.peerRecordEnvelope=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(Xy||(Xy={}));var aE;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={multiaddr:new Uint8Array(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.multiaddr=t.bytes();break;case 2:i.isCertified=t.bool();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(aE||(aE={}));var cE;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key!==""&&(n.uint32(10),n.string(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={key:"",value:new Uint8Array(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.key=t.string();break;case 2:i.value=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(cE||(cE={}));var Nie=k("libp2p:peer-store:store"),Die="/peers/",lE=class{constructor(e){this.components=e,this.lock=Wh({name:"peer-store",singleProcess:!0})}_peerIdToDatastoreKey(e){if(e.type==null)throw Nie.error("peerId must be an instance of peer-id to store data"),new F("peerId must be an instance of peer-id",Qe.ERR_INVALID_PARAMETERS);let t=e.toCID().toString();return new Ai(`${Die}${t}`)}async has(e){return await this.components.datastore.has(this._peerIdToDatastoreKey(e))}async delete(e){await this.components.datastore.delete(this._peerIdToDatastoreKey(e))}async load(e){let t=await this.components.datastore.get(this._peerIdToDatastoreKey(e)),n=Xy.decode(t),i=new Map;for(let s of n.metadata)i.set(s.key,s.value);return{...n,id:e,addresses:n.addresses.map(({multiaddr:s,isCertified:o})=>({multiaddr:se(s),isCertified:o??!1})),metadata:i,pubKey:n.pubKey??void 0,peerRecordEnvelope:n.peerRecordEnvelope??void 0}}async save(e){if(e.pubKey!=null&&e.id.publicKey!=null&&!be(e.pubKey,e.id.publicKey))throw Nie.error("peer publicKey bytes do not match peer id publicKey bytes"),new F("publicKey bytes do not match peer id publicKey bytes",Qe.ERR_INVALID_PARAMETERS);let t=new Set,n=e.addresses.filter(o=>t.has(o.multiaddr.toString())?!1:(t.add(o.multiaddr.toString()),!0)).sort((o,a)=>o.multiaddr.toString().localeCompare(a.multiaddr.toString())).map(({multiaddr:o,isCertified:a})=>({multiaddr:o.bytes,isCertified:a})),i=[];[...e.metadata.keys()].sort().forEach(o=>{let a=e.metadata.get(o);a!=null&&i.push({key:o,value:a})});let s=Xy.encode({addresses:n,protocols:e.protocols.sort(),pubKey:e.pubKey,metadata:i,peerRecordEnvelope:e.peerRecordEnvelope});return await this.components.datastore.put(this._peerIdToDatastoreKey(e.id),s.subarray()),await this.load(e.id)}async patch(e,t){let n=await this.load(e);return await this._patch(e,t,n)}async patchOrCreate(e,t){let n;try{n=await this.load(e)}catch(i){if(i.code!==Qe.ERR_NOT_FOUND)throw i;n={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._patch(e,t,n)}async _patch(e,t,n){return await this.save({...n,...t,id:e})}async merge(e,t){let n=await this.load(e);return await this._merge(e,t,n)}async mergeOrCreate(e,t){let n;try{n=await this.load(e)}catch(i){if(i.code!==Qe.ERR_NOT_FOUND)throw i;n={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._merge(e,t,n)}async _merge(e,t,n){let i=new Map;return n.addresses.forEach(s=>{i.set(s.multiaddr.toString(),s.isCertified)}),(t.addresses??[]).forEach(s=>{let o=s.multiaddr.toString(),c=Boolean(i.get(o))||s.isCertified;i.set(o,c)}),await this.save({id:e,addresses:Array.from(i.entries()).map(([s,o])=>({multiaddr:se(s),isCertified:o})),protocols:Array.from(new Set([...n.protocols??[],...t.protocols??[]])),metadata:new Map([...n.metadata?.entries()??[],...t.metadata?.entries()??[]]),pubKey:t.pubKey??n?.pubKey,peerRecordEnvelope:t.peerRecordEnvelope??n?.peerRecordEnvelope})}async*all(){for await(let e of this.components.datastore.queryKeys({prefix:Die})){let t=e.toString().split("/")[2],n=De.decode(t);yield this.load(Br(n))}}};l();var Dl;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.tags!=null)for(let s of t.tags)n.uint32(10),uE.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={tags:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.tags.push(uE.codec().decode(t,t.uint32()));break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(Dl||(Dl={}));var uE;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.name!=null&&t.name!==""&&(n.uint32(10),n.string(t.name)),t.value!=null&&(n.uint32(16),n.uint32(t.value)),t.expiry!=null&&(n.uint32(24),n.uint64(t.expiry)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={name:""},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.name=t.string();break;case 2:i.value=t.uint32();break;case 3:i.expiry=t.uint64();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(uE||(uE={}));var yo=k("libp2p:peer-store"),fE=class extends Fe{constructor(e,t={}){super(),this.components=e,this.store=new lE(e),this.addressBook=new eE(this.dispatchEvent.bind(this),this.store,t.addressFilter),this.keyBook=new tE(this.dispatchEvent.bind(this),this.store),this.metadataBook=new nE(this.dispatchEvent.bind(this),this.store),this.protoBook=new sE(this.dispatchEvent.bind(this),this.store)}async forEach(e){yo.trace("getPeers await read lock");let t=await this.store.lock.readLock();yo.trace("getPeers got read lock");try{for await(let n of this.store.all())n.id.equals(this.components.peerId)||e(n)}finally{yo.trace("getPeers release read lock"),t()}}async all(){let e=[];return await this.forEach(t=>{e.push(t)}),e}async delete(e){yo.trace("delete await write lock");let t=await this.store.lock.writeLock();yo.trace("delete got write lock");try{await this.store.delete(e)}finally{yo.trace("delete release write lock"),t()}}async get(e){yo.trace("get await read lock");let t=await this.store.lock.readLock();yo.trace("get got read lock");try{return await this.store.load(e)}finally{yo.trace("get release read lock"),t()}}async has(e){yo.trace("has await read lock");let t=await this.store.lock.readLock();yo.trace("has got read lock");try{return await this.store.has(e)}finally{yo.trace("has release read lock"),t()}}async tagPeer(e,t,n={}){let i=n.value??0,s=Math.round(i),o=n.ttl??void 0;if(s!==i||s<0||s>100)throw new F("Tag value must be between 0-100","ERR_TAG_VALUE_OUT_OF_BOUNDS");let a=await this.metadataBook.getValue(e,"tags"),c=[];a!=null&&(c=Dl.decode(a).tags),c=c.filter(u=>u.name!==t),c.push({name:t,value:s,expiry:o==null?void 0:BigInt(Date.now()+o)}),await this.metadataBook.setValue(e,"tags",Dl.encode({tags:c}).subarray())}async unTagPeer(e,t){let n=await this.metadataBook.getValue(e,"tags"),i=[];n!=null&&(i=Dl.decode(n).tags),i=i.filter(s=>s.name!==t),await this.metadataBook.setValue(e,"tags",Dl.encode({tags:i}).subarray())}async getTags(e){let t=await this.metadataBook.getValue(e,"tags"),n=[];t!=null&&(n=Dl.decode(t).tags);let i=BigInt(Date.now()),s=n.filter(o=>o.expiry==null||o.expiry>i);return s.length!==n.length&&await this.metadataBook.setValue(e,"tags",Dl.encode({tags:s}).subarray()),s.map(o=>({name:o.name,value:o.value??0}))}};l();var Lie=S(W(),1),hE=class{constructor(e){this.dht=e}async provide(e){await Ct(this.dht.provide(e))}async*findProviders(e,t={}){for await(let n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await Ct(this.dht.put(e,t,n))}async get(e,t){for await(let n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw(0,Lie.default)(new Error("Not found"),"ERR_NOT_FOUND")}};l();var Os=S(W(),1);var dE=class{constructor(e={}){this._started=!1,this._peerId=e.peerId,this._addressManager=e.addressManager,this._peerStore=e.peerStore,this._upgrader=e.upgrader,this._metrics=e.metrics,this._registrar=e.registrar,this._connectionManager=e.connectionManager,this._transportManager=e.transportManager,this._connectionGater=e.connectionGater,this._contentRouting=e.contentRouting,this._peerRouting=e.peerRouting,this._datastore=e.datastore,this._connectionProtector=e.connectionProtector,this._dht=e.dht,this._pubsub=e.pubsub,this._dialer=e.dialer}isStarted(){return this._started}async beforeStart(){await Promise.all(Object.values(this).filter(e=>El(e)).map(async e=>{e.beforeStart!=null&&await e.beforeStart()}))}async start(){await Promise.all(Object.values(this).filter(e=>El(e)).map(async e=>{await e.start()})),this._started=!0}async afterStart(){await Promise.all(Object.values(this).filter(e=>El(e)).map(async e=>{e.afterStart!=null&&await e.afterStart()}))}async beforeStop(){await Promise.all(Object.values(this).filter(e=>El(e)).map(async e=>{e.beforeStop!=null&&await e.beforeStop()}))}async stop(){await Promise.all(Object.values(this).filter(e=>El(e)).map(async e=>{await e.stop()})),this._started=!1}async afterStop(){await Promise.all(Object.values(this).filter(e=>El(e)).map(async e=>{e.afterStop!=null&&await e.afterStop()}))}get peerId(){if(this._peerId==null)throw(0,Os.default)(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this._peerId}set peerId(e){this._peerId=e}get addressManager(){if(this._addressManager==null)throw(0,Os.default)(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this._addressManager}set addressManager(e){this._addressManager=e}get peerStore(){if(this._peerStore==null)throw(0,Os.default)(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this._peerStore}set peerStore(e){this._peerStore=e}get upgrader(){if(this._upgrader==null)throw(0,Os.default)(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this._upgrader}set upgrader(e){this._upgrader=e}get registrar(){if(this._registrar==null)throw(0,Os.default)(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this._registrar}set registrar(e){this._registrar=e}get connectionManager(){if(this._connectionManager==null)throw(0,Os.default)(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this._connectionManager}set connectionManager(e){this._connectionManager=e}get transportManager(){if(this._transportManager==null)throw(0,Os.default)(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this._transportManager}set transportManager(e){this._transportManager=e}get connectionGater(){if(this._connectionGater==null)throw(0,Os.default)(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this._connectionGater}set connectionGater(e){this._connectionGater=e}get contentRouting(){if(this._contentRouting==null)throw(0,Os.default)(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this._contentRouting}set contentRouting(e){this._contentRouting=e}get peerRouting(){if(this._peerRouting==null)throw(0,Os.default)(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this._peerRouting}set peerRouting(e){this._peerRouting=e}get datastore(){if(this._datastore==null)throw(0,Os.default)(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this._datastore}set datastore(e){this._datastore=e}get connectionProtector(){return this._connectionProtector}set connectionProtector(e){this._connectionProtector=e}get dialer(){if(this._dialer==null)throw(0,Os.default)(new Error("dialer not set"),"ERR_SERVICE_MISSING");return this._dialer}set dialer(e){this._dialer=e}get metrics(){return this._metrics}set metrics(e){this._metrics=e}get dht(){return this._dht}set dht(e){this._dht=e}get pubsub(){return this._pubsub}set pubsub(e){this._pubsub=e}};l();l();l();l();var WC=S(Us(),1),YC=S(Mie(),1);l();l();var Fie=globalThis.fetch,Vie=globalThis.Headers,v$t=globalThis.Request,S$t=globalThis.Response;function pE(r,e,t){return`${r}?name=${e}&type=${t}`}async function zie(r,e){return await(await Fie(r,{headers:new Vie({accept:"application/dns-json"}),signal:e})).json()}function Yd(r,e){return`${e}_${r}`}var jC=Object.assign((0,WC.default)("dns-over-http-resolver"),{error:(0,WC.default)("dns-over-http-resolver:error")}),QC=class{constructor(e={}){this._cache=new YC.default({max:e?.maxCache??100}),this._TXTcache=new YC.default({max:e?.maxCache??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=e.request??zie,this._abortControllers=[]}cancel(){this._abortControllers.forEach(e=>e.abort())}getServers(){return this._servers}_getShuffledServers(){let e=[...this._servers];for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*t),i=e[t];e[t]=e[n],e[n]=i}return e}setServers(e){this._servers=e}async resolve(e,t="A"){switch(t){case"A":return await this.resolve4(e);case"AAAA":return await this.resolve6(e);case"TXT":return await this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){let t="A",n=this._cache.get(Yd(e,t));if(n!=null)return n;let i=!1;for(let s of this._getShuffledServers()){let o=new AbortController;this._abortControllers.push(o);try{let a=await this._request(pE(s,e,t),o.signal),c=a.Answer.map(f=>f.data),u=Math.min(...a.Answer.map(f=>f.TTL));return this._cache.set(Yd(e,t),c,{ttl:u}),c}catch{o.signal.aborted&&(i=!0),jC.error(`${s} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw i?Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}async resolve6(e){let t="AAAA",n=this._cache.get(Yd(e,t));if(n!=null)return n;let i=!1;for(let s of this._getShuffledServers()){let o=new AbortController;this._abortControllers.push(o);try{let a=await this._request(pE(s,e,t),o.signal),c=a.Answer.map(f=>f.data),u=Math.min(...a.Answer.map(f=>f.TTL));return this._cache.set(Yd(e,t),c,{ttl:u}),c}catch{o.signal.aborted&&(i=!0),jC.error(`${s} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw i?Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}async resolveTxt(e){let t="TXT",n=this._TXTcache.get(Yd(e,t));if(n!=null)return n;let i=!1;for(let s of this._getShuffledServers()){let o=new AbortController;this._abortControllers.push(o);try{let a=await this._request(pE(s,e,t),o.signal),c=a.Answer.map(f=>[f.data.replace(/['"]+/g,"")]),u=Math.min(...a.Answer.map(f=>f.TTL));return this._TXTcache.set(Yd(e,t),c,{ttl:u}),c}catch{o.signal.aborted&&(i=!0),jC.error(`${s} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw i?Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}},Kie=QC;var qie=Kie;var{code:tAe}=Kt("dnsaddr");async function $ie(r,e={}){let t=new qie;e.signal!=null&&e.signal.addEventListener("abort",()=>{t.cancel()});let n=r.getPeerId(),[,i]=r.stringTuples().find(([a])=>a===tAe)??[];if(i==null)throw new Error("No hostname found in multiaddr");let o=(await t.resolveTxt(`_dnsaddr.${i}`)).flat().map(a=>a.split("=")[1]).filter(Boolean);return n!=null&&(o=o.filter(a=>a.includes(n))),o}l();var mE=S(W(),1);var oAe={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{maxConnections:300,minConnections:50,autoDial:!0,autoDialInterval:1e4,maxParallelDials:100,maxDialsPerPeer:4,dialTimeout:3e4,inboundUpgradeTimeout:3e4,resolvers:{dnsaddr:$ie},addressSorter:U1},connectionGater:{},transportManager:{faultTolerance:If.FATAL_ALL},peerRouting:{refreshManager:{enabled:!0,interval:6e5,bootDelay:1e4}},nat:{enabled:!0,ttl:7200,keepAlive:!0},relay:{enabled:!0,advertise:{bootDelay:9e5,enabled:!1,ttl:18e5},hop:{enabled:!1,active:!1,timeout:3e4},autoRelay:{enabled:!1,maxListeners:2}},identify:{protocolPrefix:"ipfs",host:{agentVersion:KC},timeout:6e4,maxInboundStreams:1,maxOutboundStreams:1,maxPushIncomingStreams:1,maxPushOutgoingStreams:1},ping:{protocolPrefix:"ipfs",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4},fetch:{protocolPrefix:"libp2p",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4}};function Hie(r){let e=Ve(oAe,r);if(e.transports==null||e.transports.length<1)throw(0,mE.default)(new Error(rt.ERR_TRANSPORTS_REQUIRED),K.ERR_TRANSPORTS_REQUIRED);if(e.connectionEncryption==null||e.connectionEncryption.length===0)throw(0,mE.default)(new Error(rt.CONN_ENCRYPTION_REQUIRED),K.CONN_ENCRYPTION_REQUIRED);if(e.connectionProtector===null&&globalThis.process?.env?.LIBP2P_FORCE_PNET!=null)throw(0,mE.default)(new Error(rt.ERR_PROTECTOR_REQUIRED),K.ERR_PROTECTOR_REQUIRED);return e.identify.host.agentVersion===KC&&(Aie||Sie?e.identify.host.agentVersion+=` UserAgent=${globalThis.process.version}`:(Wd||Yb||xie||Tie)&&(e.identify.host.agentVersion+=` UserAgent=${globalThis.navigator.userAgent}`)),e}l();l();var eP;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.id!=null&&(n.uint32(10),n.bytes(t.id)),t.pubKey!=null&&(n.uint32(18),n.bytes(t.pubKey)),t.privKey!=null&&(n.uint32(26),n.bytes(t.privKey)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.id=t.bytes();break;case 2:i.pubKey=t.bytes();break;case 3:i.privKey=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(eP||(eP={}));var gE=async()=>{let r=await c0("Ed25519"),e=await jie(r);if(e.type==="Ed25519")return e;throw new Error(`Generated unexpected PeerId type "${e.type}"`)};var Gie=async r=>{let e=await c0("RSA",r?.bits??2048),t=await jie(e);if(t.type==="RSA")return t;throw new Error(`Generated unexpected PeerId type "${t.type}"`)};async function jie(r){return await Ur(S2(r.public),OS(r))}var Jy=S(W(),1);l();var wo=S(W(),1);var yE=class extends Fe{get[sc](){return!0}get[Symbol.toStringTag](){return"@libp2p/dummy-dht"}get wan(){throw(0,wo.default)(new Error(rt.DHT_DISABLED),K.DHT_DISABLED)}get lan(){throw(0,wo.default)(new Error(rt.DHT_DISABLED),K.DHT_DISABLED)}get(){throw(0,wo.default)(new Error(rt.DHT_DISABLED),K.DHT_DISABLED)}findProviders(){throw(0,wo.default)(new Error(rt.DHT_DISABLED),K.DHT_DISABLED)}findPeer(){throw(0,wo.default)(new Error(rt.DHT_DISABLED),K.DHT_DISABLED)}getClosestPeers(){throw(0,wo.default)(new Error(rt.DHT_DISABLED),K.DHT_DISABLED)}provide(){throw(0,wo.default)(new Error(rt.DHT_DISABLED),K.DHT_DISABLED)}put(){throw(0,wo.default)(new Error(rt.DHT_DISABLED),K.DHT_DISABLED)}async getMode(){throw(0,wo.default)(new Error(rt.DHT_DISABLED),K.DHT_DISABLED)}async setMode(){throw(0,wo.default)(new Error(rt.DHT_DISABLED),K.DHT_DISABLED)}async refreshRoutingTable(){throw(0,wo.default)(new Error(rt.DHT_DISABLED),K.DHT_DISABLED)}};l();var Ll=S(W(),1);var wE=class extends Fe{constructor(){super(...arguments),this.topicValidators=new Map}isStarted(){return!1}start(){}stop(){}get globalSignaturePolicy(){throw(0,Ll.default)(new Error(rt.PUBSUB_DISABLED),K.ERR_PUBSUB_DISABLED)}get multicodecs(){throw(0,Ll.default)(new Error(rt.PUBSUB_DISABLED),K.ERR_PUBSUB_DISABLED)}getPeers(){throw(0,Ll.default)(new Error(rt.PUBSUB_DISABLED),K.ERR_PUBSUB_DISABLED)}getTopics(){throw(0,Ll.default)(new Error(rt.PUBSUB_DISABLED),K.ERR_PUBSUB_DISABLED)}subscribe(){throw(0,Ll.default)(new Error(rt.PUBSUB_DISABLED),K.ERR_PUBSUB_DISABLED)}unsubscribe(){throw(0,Ll.default)(new Error(rt.PUBSUB_DISABLED),K.ERR_PUBSUB_DISABLED)}getSubscribers(){throw(0,Ll.default)(new Error(rt.PUBSUB_DISABLED),K.ERR_PUBSUB_DISABLED)}async publish(){throw(0,Ll.default)(new Error(rt.PUBSUB_DISABLED),K.ERR_PUBSUB_DISABLED)}};l();var G1=S(W(),1);var lse=S(_n(),1),rP=S(us(),1),use=S(ri(),1);l();var Zy=S(W(),1),ose=S(us(),1),ase=S(ise(),1),tP=S(ri(),1);var sse=k("libp2p:dialer:dial-request"),bE=class{constructor(e){let{addrs:t,dialAction:n,dialer:i}=e;this.addrs=t,this.dialer=i,this.dialAction=n}async run(e={}){let t=this.dialer.getTokens(this.addrs.length);if(t.length<1)throw(0,Zy.default)(new Error("No dial tokens available"),K.ERR_NO_DIAL_TOKENS);let n=new ase.default;for(let a of t)n.push(a).catch(c=>{sse.error(c)});let i=this.addrs.map(()=>{let a=new AbortController;try{(0,tP.setMaxListeners)?.(1/0,a.signal)}catch{}return a});if(e.signal!=null)try{(0,tP.setMaxListeners)?.(1/0,e.signal)}catch{}let s=0,o=!1;try{return await Promise.any(this.addrs.map(async(a,c)=>{let u=await n.shift();if(o)throw this.dialer.releaseToken(t.splice(t.indexOf(u),1)[0]),(0,Zy.default)(new Error("dialAction already succeeded"),K.ERR_ALREADY_SUCCEEDED);let f=i[c];if(f==null)throw(0,Zy.default)(new Error("dialAction did not come with an AbortController"),K.ERR_INVALID_PARAMETERS);let h;try{let p=f.signal;h=await this.dialAction(a,{...e,signal:e.signal!=null?(0,ose.anySignal)([p,e.signal]):p}),i[c]=void 0}finally{s++,this.addrs.length-s>=t.length?n.push(u).catch(p=>{sse.error(p)}):this.dialer.releaseToken(t.splice(t.indexOf(u),1)[0])}if(h==null)throw(0,Zy.default)(new Error("dialAction led to empty object"),K.ERR_TRANSPORT_DIAL_FAILED);return o=!0,h}))}finally{i.forEach(a=>{a!==void 0&&a.abort()}),t.forEach(a=>this.dialer.releaseToken(a))}}};var fc=k("libp2p:dialer"),EE=class{constructor(e,t={}){this.started=!1,this.addressSorter=t.addressSorter??U1,this.maxAddrsToDial=t.maxAddrsToDial??25,this.timeout=t.dialTimeout??3e4,this.maxDialsPerPeer=t.maxDialsPerPeer??4,this.tokens=[...new Array(t.maxParallelDials??100)].map((n,i)=>i),this.components=e,this.pendingDials=ks({name:"libp2p_dialler_pending_dials",metrics:e.metrics}),this.pendingDialTargets=ks({name:"libp2p_dialler_pending_dial_targets",metrics:e.metrics});for(let[n,i]of Object.entries(t.resolvers??{}))D9.set(n,i)}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1;for(let e of this.pendingDials.values())try{e.controller.abort()}catch(t){fc.error(t)}this.pendingDials.clear();for(let e of this.pendingDialTargets.values())e.abort();this.pendingDialTargets.clear()}async dial(e,t={}){let{peerId:n,multiaddr:i}=mb(e);if(n!=null){if(this.components.peerId.equals(n))throw(0,G1.default)(new Error("Tried to dial self"),K.ERR_DIALED_SELF);if(i!=null&&(fc("storing multiaddrs %p",n,i),await this.components.peerStore.addressBook.add(n,[i])),await this.components.connectionGater.denyDialPeer(n))throw(0,G1.default)(new Error("The dial request is blocked by gater.allowDialPeer"),K.ERR_PEER_DIAL_INTERCEPTED)}fc("creating dial target for %p",n);let s=new AbortController,o=cse();this.pendingDialTargets.set(o,s);let a=s.signal;t.signal!=null&&(a=(0,rP.anySignal)([a,t.signal]));let c;try{c=await this._createDialTarget({peerId:n,multiaddr:i},{...t,signal:a})}finally{this.pendingDialTargets.delete(o)}if(c.addrs.length===0)throw(0,G1.default)(new Error("The dial request has no valid addresses"),K.ERR_NO_VALID_ADDRESSES);let u=this.pendingDials.get(c.id)??this._createPendingDial(c,t);try{let f=await u.promise;return fc("dial succeeded to %s",c.id),f}catch(f){throw fc("dial failed to %s",c.id,f),u.controller.signal.aborted&&(f.code=K.ERR_TIMEOUT),fc.error(f),f}finally{u.destroy()}}async _createDialTarget(e,t){let n=[];if(pi(e.multiaddr)&&n.push(e.multiaddr),!pi(e.multiaddr)&&Pi(e.peerId)&&n.push(...await this._loadAddresses(e.peerId)),n=(await Promise.all(n.map(async s=>await this._resolve(s,t)))).flat().filter(s=>Boolean(this.components.transportManager.transportForMultiaddr(s))),n=[...new Set(n.map(s=>s.toString()))].map(s=>se(s)),n.length>this.maxAddrsToDial)throw(0,G1.default)(new Error("dial with more addresses than allowed"),K.ERR_TOO_MANY_ADDRESSES);let i=Pi(e.peerId)?e.peerId:void 0;if(i!=null){let s=`/p2p/${i.toString()}`;n=n.map(o=>{let a=o.getPeerId();return a==null||!i.equals(a)?o.encapsulate(s):o})}return{id:i==null?cse():i.toString(),addrs:n}}async _loadAddresses(e){let t=await this.components.peerStore.addressBook.get(e);return(await Promise.all(t.map(async n=>await this.components.connectionGater.denyDialMultiaddr(e,n.multiaddr)?!1:n))).filter(lAe).sort(this.addressSorter).map(n=>n.multiaddr)}_createPendingDial(e,t={}){let n=async(u,f={})=>{if(f.signal?.aborted===!0)throw(0,G1.default)(new Error("already aborted"),K.ERR_ALREADY_ABORTED);return await this.components.transportManager.dial(u,f).catch(h=>{throw fc.error("dial to %s failed",u,h),h})},i=new bE({addrs:e.addrs,dialAction:n,dialer:this}),s=new lse.TimeoutController(this.timeout),o=[s.signal];t.signal!=null&&o.push(t.signal);let a=(0,rP.anySignal)(o);try{(0,use.setMaxListeners)?.(1/0,a)}catch{}let c={dialRequest:i,controller:s,promise:i.run({...t,signal:a}),destroy:()=>{s.clear(),this.pendingDials.delete(e.id)}};return this.pendingDials.set(e.id,c),c}getTokens(e){let t=Math.min(e,this.maxDialsPerPeer,this.tokens.length),n=this.tokens.splice(0,t);return fc("%d tokens request, returning %d, %d remaining",e,t,this.tokens.length),n}releaseToken(e){this.tokens.includes(e)||(fc("token %d released",e),this.tokens.push(e))}async _resolve(e,t){if(!e.protoNames().includes("dnsaddr"))return[e];let i=await this._resolveRecord(e,t);return(await Promise.all(i.map(async a=>await this._resolve(a,t)))).flat().reduce((a,c)=>(a.find(u=>u.equals(c))==null&&a.push(c),a),[])}async _resolveRecord(e,t){try{return e=se(e.toString()),await e.resolve(t)}catch(n){return fc.error(`multiaddr ${e.toString()} could not be resolved`,n),[]}}};function lAe(r){return Boolean(r)}function cse(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}var Bl=k("libp2p"),nP=class extends Fe{constructor(e){super(),this.started=!1,this.peerId=e.peerId;let t=this.components=new dE({peerId:e.peerId,datastore:e.datastore??new D2,connectionGater:{denyDialPeer:async()=>await Promise.resolve(!1),denyDialMultiaddr:async()=>await Promise.resolve(!1),denyInboundConnection:async()=>await Promise.resolve(!1),denyOutboundConnection:async()=>await Promise.resolve(!1),denyInboundEncryptedConnection:async()=>await Promise.resolve(!1),denyOutboundEncryptedConnection:async()=>await Promise.resolve(!1),denyInboundUpgradedConnection:async()=>await Promise.resolve(!1),denyOutboundUpgradedConnection:async()=>await Promise.resolve(!1),filterMultiaddrForPeer:async()=>await Promise.resolve(!0),...e.connectionGater}});t.peerStore=new fE(t,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore}),this.services=[t],e.metrics!=null&&(this.metrics=this.components.metrics=this.configureComponent(e.metrics(this.components))),this.peerStore=this.components.peerStore,this.peerStore.addEventListener("peer",o=>{let{detail:a}=o;this.dispatchEvent(new ne("peer:discovery",{detail:a}))}),e.connectionProtector!=null&&(this.components.connectionProtector=e.connectionProtector(t)),this.components.upgrader=new $b(this.components,{connectionEncryption:(e.connectionEncryption??[]).map(o=>this.configureComponent(o(this.components))),muxers:(e.streamMuxers??[]).map(o=>this.configureComponent(o(this.components))),inboundUpgradeTimeout:e.connectionManager.inboundUpgradeTimeout}),this.components.dialer=new EE(this.components,e.connectionManager),this.connectionManager=this.components.connectionManager=new wb(this.components,e.connectionManager),this.components.connectionManager.addEventListener("peer:disconnect",o=>{this.dispatchEvent(new ne("peer:disconnect",{detail:o.detail}))}),this.components.connectionManager.addEventListener("peer:connect",o=>{this.dispatchEvent(new ne("peer:connect",{detail:o.detail}))}),this.registrar=this.components.registrar=new qb(this.components),this.components.transportManager=new Mb(this.components,e.transportManager),this.components.addressManager=new lb(this.components,e.addresses),this.configureComponent(new Xb(this.components)),this.configureComponent(new bb(this.components,{enabled:e.connectionManager.autoDial,minConnections:e.connectionManager.minConnections,autoDialInterval:e.connectionManager.autoDialInterval}));let n=Kd.generateOptions();this.keychain=this.configureComponent(new Kd(this.components,{...n,...e.keychain})),this.services.push(new Qb(this.components,e.nat)),e.transports.forEach(o=>{this.components.transportManager.add(this.configureComponent(o(this.components)))}),this.identifyService=new $1(this.components,{...e.identify}),this.configureComponent(this.identifyService),e.dht!=null?this.dht=this.components.dht=e.dht(this.components):this.dht=new yE,e.pubsub!=null?this.pubsub=this.components.pubsub=e.pubsub(this.components):this.pubsub=new wE;let i=(e.peerRouters??[]).map(o=>this.configureComponent(o(this.components)));e.dht!=null&&(i.push(this.configureComponent(new Zb(this.dht))),this.dht.addEventListener("peer",o=>{this.onDiscoveryPeer(o)})),this.peerRouting=this.components.peerRouting=this.configureComponent(new ob(this.components,{...e.peerRouting,routers:i}));let s=(e.contentRouters??[]).map(o=>this.configureComponent(o(this.components)));e.dht!=null&&s.push(this.configureComponent(new hE(this.dht))),this.contentRouting=this.components.contentRouting=this.configureComponent(new cb(this.components,{routers:s})),e.relay.enabled&&(this.components.transportManager.add(this.configureComponent(new xb(this.components,e.relay))),this.configureComponent(new Pb(this.components,{addressSorter:e.connectionManager.addressSorter,...e.relay}))),this.fetchService=this.configureComponent(new Gb(this.components,{...e.fetch})),this.pingService=this.configureComponent(new jb(this.components,{...e.ping}));for(let o of e.peerDiscovery??[])this.configureComponent(o(this.components)).addEventListener("peer",c=>{this.onDiscoveryPeer(c)})}configureComponent(e){return El(e)&&this.services.push(e),e}async start(){if(!this.started){this.started=!0,Bl("libp2p is starting");try{await Promise.all(this.services.map(async e=>{e.beforeStart!=null&&await e.beforeStart()})),await Promise.all(this.services.map(e=>e.start())),await Promise.all(this.services.map(async e=>{e.afterStart!=null&&await e.afterStart()})),Bl("libp2p has started")}catch(e){throw Bl.error("An error occurred starting libp2p",e),await this.stop(),e}}}async stop(){this.started&&(Bl("libp2p is stopping"),this.started=!1,await Promise.all(this.services.map(async e=>{e.beforeStop!=null&&await e.beforeStop()})),await Promise.all(this.services.map(e=>e.stop())),await Promise.all(this.services.map(async e=>{e.afterStop!=null&&await e.afterStop()})),Bl("libp2p has stopped"))}isStarted(){return this.started}getConnections(e){return this.components.connectionManager.getConnections(e)}getPeers(){let e=new ts;for(let t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){return await this.components.connectionManager.openConnection(e,t)}async dialProtocol(e,t,n={}){if(t==null)throw(0,Jy.default)(new Error("no protocols were provided to open a stream"),K.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(t=Array.isArray(t)?t:[t],t.length===0)throw(0,Jy.default)(new Error("no protocols were provided to open a stream"),K.ERR_INVALID_PROTOCOLS_FOR_STREAM);return await(await this.dial(e,n)).newStream(t,n)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e){pi(e)&&(e=ae(e.getPeerId()??"")),await this.components.connectionManager.closeConnections(e)}async getPublicKey(e,t={}){if(Bl("getPublicKey %p",e),e.publicKey!=null)return e.publicKey;let n=await this.peerStore.get(e);if(n.pubKey!=null)return n.pubKey;if(this.dht==null)throw(0,Jy.default)(new Error("Public key was not in the peer store and the DHT is not enabled"),K.ERR_NO_ROUTERS_AVAILABLE);let i=Z([U("/pk/"),e.multihash.digest]);for await(let s of this.dht.get(i,t))if(s.name==="VALUE"){let o=Hi(s.value);return await this.peerStore.keyBook.set(e,s.value),o.bytes}throw(0,Jy.default)(new Error(`Node not responding with its public key: ${e.toString()}`),K.ERR_INVALID_RECORD)}async fetch(e,t,n={}){if(pi(e)){let i=ae(e.getPeerId()??"");await this.components.peerStore.addressBook.add(i,[e]),e=i}return await this.fetchService.fetch(e,t,n)}async ping(e,t={}){if(pi(e)){let n=ae(e.getPeerId()??"");await this.components.peerStore.addressBook.add(n,[e]),e=n}return await this.pingService.ping(e,t)}async handle(e,t,n){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async i=>{await this.components.registrar.handle(i,t,n)}))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async t=>{await this.components.registrar.unhandle(t)}))}async register(e,t){return await this.registrar.register(e,t)}unregister(e){this.registrar.unregister(e)}onDiscoveryPeer(e){let{detail:t}=e;if(t.id.toString()===this.peerId.toString()){Bl.error(new Error(K.ERR_DISCOVERED_SELF));return}t.multiaddrs.length>0&&this.components.peerStore.addressBook.add(t.id,t.multiaddrs).catch(n=>Bl.error(n)),t.protocols.length>0&&this.components.peerStore.protoBook.set(t.id,t.protocols).catch(n=>Bl.error(n)),this.dispatchEvent(new ne("peer:discovery",{detail:t}))}};async function fse(r){if(r.peerId==null){let e=r.datastore;if(e!=null)try{let t=new Kd({datastore:e},{...Kd.generateOptions(),...r.keychain??{}});r.peerId=await t.exportPeerId("self")}catch(t){if(t.code!=="ERR_NOT_FOUND")throw t}}return r.peerId==null&&(r.peerId=await gE()),new nP(Hie(r))}async function hse(r){let e=await fse(r);return r.start!==!1&&await e.start(),e}l();l();l();var Lse=S(bse(),1);l();l();var Ml="/",Ese=new TextEncoder().encode(Ml),SE=Ese[0],Gn=class{constructor(e,t){if(typeof e=="string")this._buf=U(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==SE)throw new Error("Invalid key")}toString(e="utf8"){return C(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Gn(e.join(Ml))}static random(){return new Gn(Tr().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Gn(e):typeof e.uint8Array=="function"?new Gn(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=Ese),this._buf[0]!==SE){let e=new Uint8Array(this._buf.byteLength+1);e.fill(SE,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===SE;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return Gn.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Ml).slice(1)}type(){return gAe(this.baseNamespace())}name(){return yAe(this.baseNamespace())}instance(e){return new Gn(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Ml)||(e+=Ml),e+=this.type(),new Gn(e)}parent(){let e=this.list();return e.length===1?new Gn(Ml):new Gn(e.slice(0,-1).join(Ml))}child(e){return this.toString()===Ml?e:e.toString()===Ml?this:new Gn(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Gn.withNamespaces([...this.namespaces(),...wAe(e.map(t=>t.namespaces()))])}};function gAe(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function yAe(r){let e=r.split(":");return e[e.length-1]}function wAe(r){return[].concat(...r)}l();var _se="/lan",vse="/ipfs",Sse="/kad/1.0.0",xse="/dht/record",cP="/dht/provider";var Ase=Number(3e5),Tse=Number(30*1e3),Ise=Number(5*6e4),Rse=Number(30*1e3),Cse=Number(30*1e3);var bAe=U("/pk/");function Y1(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{let[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;let i=Md(n);return i==null?!0:!i})}}function Q1(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{let[[t,n]]=e.stringTuples();if(n==="localhost")return!0;if(t!==4&&t!==6||n==null)return!1;let i=Md(n);return i??!1})}}async function hc(r){return(await Le.digest(r)).digest}async function Ns(r){return await hc(r.toBytes())}function Fl(r){return new Gn(`${xse}/${C(r,"base32")}`,!1)}function Pse(r){return Z([bAe,r.toBytes()])}function kse(r){return C(r.subarray(0,4))==="/pk/"}function Ose(r){return Br(r.subarray(4))}function lP(r,e){let t=new Date;return new Vr(r,e,t).serialize()}function Nse(r,e=100){let t;return()=>{clearTimeout(t),t=setTimeout(()=>{r()},e)}}var Bse=S(_n(),1);var EAe="kad-close",_Ae=50,Dse=20,vAe=1e4,SAe=10,xE=class{constructor(e,t){let{kBucketSize:n,pingTimeout:i,lan:s,pingConcurrency:o,protocol:a,tagName:c,tagValue:u}=t;this.components=e,this.log=k(`libp2p:kad-dht:${s?"lan":"wan"}:routing-table`),this.kBucketSize=n??Dse,this.pingTimeout=i??vAe,this.pingConcurrency=o??SAe,this.lan=s,this.running=!1,this.protocol=a,this.tagName=c??EAe,this.tagValue=u??_Ae;let f=()=>{this.metrics?.pingQueueSize.update(this.pingQueue.size),this.metrics?.pingRunning.update(this.pingQueue.pending)};this.pingQueue=new qt({concurrency:this.pingConcurrency}),this.pingQueue.addListener("add",f),this.pingQueue.addListener("next",f),this._onPing=this._onPing.bind(this)}isStarted(){return this.running}async start(){this.running=!0,this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_routing_table_size`),pingQueueSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_queue_size`),pingRunning:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_running`)});let e=new Lse.default({localNodeId:await Ns(this.components.peerId),numberOfNodesPerKBucket:this.kBucketSize,numberOfNodesToPing:1});this.kb=e,e.on("ping",this._onPing),this._tagPeers(e)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(e){let t=new ts,n=Nse(()=>{let i=new ts(e.closest(e.localNodeId,Dse).map(a=>a.peer)),s=i.difference(t),o=t.difference(i);Promise.resolve().then(async()=>{for(let a of s)await this.components.peerStore.tagPeer(a,this.tagName,{value:this.tagValue});for(let a of o)await this.components.peerStore.unTagPeer(a,this.tagName)}).catch(a=>{this.log.error("Could not update peer tags",a)}),t=i});e.on("added",()=>{n()}),e.on("removed",()=>{n()})}_onPing(e,t){this.pingQueue.add(async()=>{if(!this.running)return;let n=0;try{await Promise.all(e.map(async i=>{let s;try{s=new Bse.TimeoutController(this.pingTimeout);let o={signal:s.signal};this.log("pinging old contact %p",i.peer),(await(await this.components.connectionManager.openConnection(i.peer,o)).newStream(this.protocol,o)).close(),n++}catch(o){this.running&&this.kb!=null&&(this.log.error("could not ping peer %p",i.peer,o),this.log("evicting old contact after ping failed %p",i),this.kb.remove(i.id))}finally{s?.clear(),this.metrics?.routingTableSize.update(this.size)}})),this.running&&n<e.length&&this.kb!=null&&(this.log("adding new contact %p",t.peer),this.kb.add(t))}catch(i){this.log.error("could not process k-bucket ping event",i)}}).catch(n=>{this.log.error("could not process k-bucket ping event",n)})}get size(){return this.kb==null?0:this.kb.count()}async find(e){let t=await Ns(e),n=this.closestPeer(t);if(n!=null&&e.equals(n))return n}closestPeer(e){let t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e,t=this.kBucketSize){return this.kb==null?[]:this.kb.closest(e,t).map(i=>i.peer)}async add(e){if(this.kb==null)throw new Error("RoutingTable is not started");let t=await Ns(e);this.kb.add({id:t,peer:e}),this.log("added %p with kad id %b",e,t),this.metrics?.routingTableSize.update(this.size)}async remove(e){if(this.kb==null)throw new Error("RoutingTable is not started");let t=await Ns(e);this.kb.remove(t),this.metrics?.routingTableSize.update(this.size)}};l();l();var Use=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782];var Mse=S(_n(),1);var AE=15,TE=class{constructor(e){let{peerRouting:t,routingTable:n,refreshInterval:i,refreshQueryTimeout:s,lan:o}=e;this.log=k(`libp2p:kad-dht:${o?"lan":"wan"}:routing-table:refresh`),this.peerRouting=t,this.routingTable=n,this.refreshInterval=i??Ise,this.refreshQueryTimeout=s??Rse,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async start(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");let t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map(i=>i.toISOString()).join(", ")} ]`),Promise.all(n.map(async(i,s)=>{try{if(await this._refreshCommonPrefixLength(s,i,e),this._numPeersForCpl(t)===0){let o=Math.min(2*(s+1),n.length-1);for(let a=s+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,i,e)}catch(c){this.log.error(c)}}}catch(o){this.log.error(o)}})).catch(i=>{this.log.error(i)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(i=>{this.log.error(i)})}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}let i=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,i,this.routingTable.size);let s=new Mse.TimeoutController(this.refreshQueryTimeout);try{let o=await qo(this.peerRouting.getClosestPeers(i.toBytes(),{signal:s.signal}));this.log(`found ${o} peers that were close to imaginary peer %p`,i),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,i,this.routingTable.size)}finally{s.clear()}}_getTrackedCommonPrefixLengthsForRefresh(e){e>AE&&(e=AE);let t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");let t=$i(2),n=(t[1]<<8)+t[0],i=await this._makePeerId(this.routingTable.kb.localNodeId,n,e);return Br(i)}async _makePeerId(e,t,n){if(n>AE)throw new Error(`Cannot generate peer ID for common prefix length greater than ${AE}`);let o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=o&a|t&~a,u=Use[c],f=new ArrayBuffer(34),h=new DataView(f,0,f.byteLength);return h.setUint8(0,Le.code),h.setUint8(1,32),h.setUint32(2,u,!1),new Uint8Array(h.buffer,h.byteOffset,h.byteLength)}_maxCommonPrefix(){let e=0;for(let t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(let n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){if(this.routingTable.kb!=null)for(let{id:e}of this.routingTable.kb.toIterable()){let t=bl(this.routingTable.kb.localNodeId,e),n=0;for(let i of t)if(i===0)n++;else break;yield n}}};l();l();l();var Fse;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.key=t.bytes();break;case 2:i.value=t.bytes();break;case 3:i.author=t.bytes();break;case 4:i.signature=t.bytes();break;case 5:i.timeReceived=t.string();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(Fse||(Fse={}));var Bf;(function(r){let e;(function(a){a.PUT_VALUE="PUT_VALUE",a.GET_VALUE="GET_VALUE",a.ADD_PROVIDER="ADD_PROVIDER",a.GET_PROVIDERS="GET_PROVIDERS",a.FIND_NODE="FIND_NODE",a.PING="PING"})(e=r.MessageType||(r.MessageType={}));let t;(function(a){a[a.PUT_VALUE=0]="PUT_VALUE",a[a.GET_VALUE=1]="GET_VALUE",a[a.ADD_PROVIDER=2]="ADD_PROVIDER",a[a.GET_PROVIDERS=3]="GET_PROVIDERS",a[a.FIND_NODE=4]="FIND_NODE",a[a.PING=5]="PING"})(t||(t={})),function(a){a.codec=()=>Zp(t)}(e=r.MessageType||(r.MessageType={}));let n;(function(a){a.NOT_CONNECTED="NOT_CONNECTED",a.CONNECTED="CONNECTED",a.CAN_CONNECT="CAN_CONNECT",a.CANNOT_CONNECT="CANNOT_CONNECT"})(n=r.ConnectionType||(r.ConnectionType={}));let i;(function(a){a[a.NOT_CONNECTED=0]="NOT_CONNECTED",a[a.CONNECTED=1]="CONNECTED",a[a.CAN_CONNECT=2]="CAN_CONNECT",a[a.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(i||(i={})),function(a){a.codec=()=>Zp(i)}(n=r.ConnectionType||(r.ConnectionType={}));let s;(function(a){let c;a.codec=()=>(c==null&&(c=ar((u,f,h={})=>{if(h.lengthDelimited!==!1&&f.fork(),u.id!=null&&(f.uint32(10),f.bytes(u.id)),u.addrs!=null)for(let p of u.addrs)f.uint32(18),f.bytes(p);u.connection!=null&&(f.uint32(24),r.ConnectionType.codec().encode(u.connection,f)),h.lengthDelimited!==!1&&f.ldelim()},(u,f)=>{let h={addrs:[]},p=f==null?u.len:u.pos+f;for(;u.pos<p;){let d=u.uint32();switch(d>>>3){case 1:h.id=u.bytes();break;case 2:h.addrs.push(u.bytes());break;case 3:h.connection=r.ConnectionType.codec().decode(u);break;default:u.skipType(d&7);break}}return h})),c),a.encode=u=>or(u,a.codec()),a.decode=u=>sr(u,a.codec())})(s=r.Peer||(r.Peer={}));let o;r.codec=()=>(o==null&&(o=ar((a,c,u={})=>{if(u.lengthDelimited!==!1&&c.fork(),a.type!=null&&(c.uint32(8),r.MessageType.codec().encode(a.type,c)),a.clusterLevelRaw!=null&&(c.uint32(80),c.int32(a.clusterLevelRaw)),a.key!=null&&(c.uint32(18),c.bytes(a.key)),a.record!=null&&(c.uint32(26),c.bytes(a.record)),a.closerPeers!=null)for(let f of a.closerPeers)c.uint32(66),r.Peer.codec().encode(f,c);if(a.providerPeers!=null)for(let f of a.providerPeers)c.uint32(74),r.Peer.codec().encode(f,c);u.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{let u={closerPeers:[],providerPeers:[]},f=c==null?a.len:a.pos+c;for(;a.pos<f;){let h=a.uint32();switch(h>>>3){case 1:u.type=r.MessageType.codec().decode(a);break;case 10:u.clusterLevelRaw=a.int32();break;case 2:u.key=a.bytes();break;case 3:u.record=a.bytes();break;case 8:u.closerPeers.push(r.Peer.codec().decode(a,a.uint32()));break;case 9:u.providerPeers.push(r.Peer.codec().decode(a,a.uint32()));break;default:a.skipType(h&7);break}}return u})),o),r.encode=a=>or(a,r.codec()),r.decode=a=>sr(a,r.codec())})(Bf||(Bf={}));var cn=Bf.MessageType,xAe=Bf.ConnectionType,Kse=Object.keys(cn),Nr=class{constructor(e,t,n){if(!(t instanceof Uint8Array))throw new Error("Key must be a Uint8Array");this.type=e,this.key=t,this.clusterLevelRaw=n,this.closerPeers=[],this.providerPeers=[],this.record=void 0}get clusterLevel(){let e=this.clusterLevelRaw-1;return e<0?0:e}set clusterLevel(e){this.clusterLevelRaw=e}serialize(){return Bf.encode({key:this.key,type:this.type,clusterLevelRaw:this.clusterLevelRaw,closerPeers:this.closerPeers.map(Vse),providerPeers:this.providerPeers.map(Vse),record:this.record==null?void 0:this.record.serialize().subarray()})}static deserialize(e){let t=Bf.decode(e),n=new Nr(t.type??Bf.MessageType.PUT_VALUE,t.key??Uint8Array.from([]),t.clusterLevelRaw??0);return n.closerPeers=t.closerPeers.map(zse),n.providerPeers=t.providerPeers.map(zse),t.record?.length!=null&&(n.record=Vr.deserialize(t.record)),n}};function Vse(r){return{id:r.id.toBytes(),addrs:(r.multiaddrs??[]).map(t=>t.bytes),connection:xAe.CONNECTED}}function zse(r){if(r.id==null)throw new Error("Invalid peer in message");return{id:Br(r.id),multiaddrs:(r.addrs??[]).map(e=>se(e)),protocols:[]}}l();function fP(r){return{...r,name:"SENDING_QUERY",type:0,messageName:r.type,messageType:Kse.indexOf(r.type.toString())}}function t3(r){return{...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer!=null?r.closer:[],providers:r.providers!=null?r.providers:[]}}function r3(r){return{...r,name:"FINAL_PEER",type:2}}function Mi(r){return{...r,name:"QUERY_ERROR",type:3}}function hP(r){return{...r,name:"PROVIDER",type:4}}function n3(r){return{...r,name:"VALUE",type:5}}function dP(r){return{...r,name:"DIALING_PEER",type:7}}var IE=class extends Fe{constructor(e,t){super();let{protocol:n,lan:i}=t;this.components=e,this.log=k(`libp2p:kad-dht:${i?"lan":"wan"}:network`),this.running=!1,this.protocol=n}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(e,t,n={}){if(!this.running)return;this.log("sending %s to %p",t.type,e),yield dP({peer:e}),yield fP({to:e,type:t.type});let i;try{let o=await(await this.components.connectionManager.openConnection(e,n)).newStream(this.protocol,n),a=await this._writeReadMessage(o,t.serialize(),n);yield t3({from:e,messageType:a.type,closer:a.closerPeers,providers:a.providerPeers,record:a.record})}catch(s){yield Mi({from:e,error:s})}finally{i?.close()}}async*sendMessage(e,t,n={}){if(!this.running)return;this.log("sending %s to %p",t.type,e),yield dP({peer:e}),yield fP({to:e,type:t.type});let i;try{let o=await(await this.components.connectionManager.openConnection(e,n)).newStream(this.protocol,n);await this._writeMessage(o,t.serialize(),n),yield t3({from:e,messageType:t.type})}catch(s){yield Mi({from:e,error:s})}finally{i?.close()}}async _writeMessage(e,t,n){n.signal!=null&&(e=vi(e,n.signal)),await _e([t],xn(),e,Ct)}async _writeReadMessage(e,t,n){n.signal!=null&&(e=vi(e,n.signal));let i=await _e([t],xn(),e,on(),async o=>{let a=await hn(o);if(a!=null)return a;throw new F("No message received","ERR_NO_MESSAGE_RECEIVED")}),s=Nr.deserialize(i);return s.closerPeers.forEach(o=>{this.dispatchEvent(new ne("peer",{detail:o}))}),s.providerPeers.forEach(o=>{this.dispatchEvent(new ne("peer",{detail:o}))}),s}};l();l();async function X1(r,e){let t=e.key,i=C(t).split("/");if(i.length<3)return;let s=r[i[1].toString()];if(s==null){let o="Invalid record keytype";throw new F(o,"ERR_INVALID_RECORD_KEY_TYPE")}await s(t,e.value)}var AAe=async(r,e)=>{if(!(r instanceof Uint8Array))throw new F('"key" must be a Uint8Array',"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(r.byteLength<5)throw new F("invalid public key record","ERR_INVALID_RECORD_KEY_TOO_SHORT");if(C(r.subarray(0,4))!=="/pk/")throw new F("key was not prefixed with /pk/","ERR_INVALID_RECORD_KEY_BAD_PREFIX");let n=r.slice(4),i=await Le.digest(e);if(!be(n,i.bytes))throw new F("public key does not match passed in key","ERR_INVALID_RECORD_HASH_MISMATCH")},qse={pk:AAe};l();function $se(r,e,t){if(t.length===0){let o="No records given";throw new F(o,"ERR_NO_RECORDS_RECEIVED")}let i=C(e).split("/");if(i.length<3){let o="Record key does not have a selector function";throw new F(o,"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}let s=r[i[1].toString()];if(s==null){let o=`Unrecognized key prefix: ${i[1]}`;throw new F(o,"ERR_UNRECOGNIZED_KEY_PREFIX")}return t.length===1?0:s(e,t)}function TAe(r,e){return 0}var Hse={pk:TAe};var RE=class{constructor(e,t){let{validators:n,selectors:i,peerRouting:s,queryManager:o,routingTable:a,network:c,lan:u}=t;this.components=e,this.log=k(`libp2p:kad-dht:${u?"lan":"wan"}:content-fetching`),this.validators=n,this.selectors=i,this.peerRouting=s,this.queryManager=o,this.routingTable=a,this.network=c}async putLocal(e,t){let n=Fl(e);await this.components.datastore.put(n,t)}async getLocal(e){this.log("getLocal %b",e);let t=Fl(e);this.log("fetching record for key %k",t);let n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);let i=Vr.deserialize(n);return await X1(this.validators,i),i}async*sendCorrectionRecord(e,t,n,i={}){this.log("sendCorrection for %b",e);let s=lP(e,n);for(let{value:o,from:a}of t){if(be(o,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{let f=Fl(e);this.log(`Storing corrected record for key ${f.toString()}`),await this.components.datastore.put(f,s.subarray())}catch(f){this.log.error("Failed error correcting self",f)}continue}let c=!1,u=new Nr(cn.PUT_VALUE,e,0);u.record=Vr.deserialize(s);for await(let f of this.network.sendRequest(a,u,i))f.name==="PEER_RESPONSE"&&f.record!=null&&be(f.record.value,Vr.deserialize(s).value)&&(c=!0),yield f;c||(yield Mi({from:a,error:new F("value not put correctly","ERR_PUT_VALUE_INVALID")})),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);let i=lP(e,t),s=Fl(e);this.log(`storing record for key ${s.toString()}`),await this.components.datastore.put(s,i.subarray()),yield*_e(this.peerRouting.getClosestPeers(e,{signal:n.signal}),o=>Zt(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];let c=[],u=new Nr(cn.PUT_VALUE,e,0);u.record=Vr.deserialize(i),this.log("send put to %p",a.peer.id);for await(let f of this.network.sendRequest(a.peer.id,u,n))c.push(f),f.name==="PEER_RESPONSE"&&(f.record!=null&&be(f.record.value,Vr.deserialize(i).value)||c.push(Mi({from:a.peer.id,error:new F("value not put correctly","ERR_PUT_VALUE_INVALID")})));return c}),o=>Yc(o,{ordered:!1,concurrency:3}),async function*(o){for await(let a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);let n=[];for await(let a of this.getMany(e,t))a.name==="VALUE"&&n.push(a),yield a;if(n.length===0)return;let i=n.map(a=>a.value),s=0;try{s=$se(this.selectors,e,i)}catch(a){if(a.code!=="ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")throw a}let o=i[s];if(this.log("GetValue %b %b",e,o),o==null)throw new F("best value was not found","ERR_NOT_FOUND");yield*this.sendCorrectionRecord(e,n,o,t),yield n[s]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{let a=await this.getLocal(e);yield n3({value:a.value,from:this.components.peerId})}catch(a){this.log("error getting local value for %b",e,a)}let n=await hc(e),i=this.routingTable.closestPeers(n);this.log("found %d peers in routing table",i.length);let s=this,o=async function*({peer:a,signal:c}){for await(let u of s.peerRouting.getValueOrPeers(a,e,{signal:c}))yield u,u.name==="PEER_RESPONSE"&&u.record!=null&&(yield n3({from:a,value:u.record.value}))};yield*this.queryManager.run(e,i,o,t)}};l();var CE=class{constructor(e,t){let{network:n,peerRouting:i,queryManager:s,routingTable:o,providers:a,lan:c}=t;this.components=e,this.log=k(`libp2p:kad-dht:${c?"lan":"wan"}:content-routing`),this.network=n,this.peerRouting=i,this.queryManager=s,this.routingTable=o,this.providers=a}async*provide(e,t,n={}){this.log("provide %s",e),await this.providers.addProvider(e,this.components.peerId);let i=new Nr(cn.ADD_PROVIDER,e.multihash.bytes,0);i.providerPeers=[{id:this.components.peerId,multiaddrs:t,protocols:[]}];let s=0,o=a=>async()=>{if(a.name!=="FINAL_PEER")return[a];let c=[];this.log("putProvider %s to %p",e,a.peer.id);try{this.log("sending provider record for %s to %p",e,a.peer.id);for await(let u of this.network.sendMessage(a.peer.id,i,n))u.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,a.peer.id),s++),c.push(u)}catch(u){this.log.error("error sending provide record to peer %p",a.peer.id,u),c.push(Mi({from:a.peer.id,error:u}))}return c};yield*_e(this.peerRouting.getClosestPeers(e.multihash.bytes,n),a=>Zt(a,c=>o(c)),a=>Yc(a,{ordered:!1,concurrency:3}),async function*(a){for await(let c of a)yield*c}),this.log("sent provider records to %d peers",s)}async*findProviders(e,t){let n=this.routingTable.kBucketSize,i=e.multihash.bytes,s=await hc(i),o=this;this.log("findProviders %c",e);let a=await this.providers.getProviders(e);if(a.length>0){let f=[];for(let h of a.slice(0,n))f.push({id:h,multiaddrs:(await this.components.peerStore.addressBook.get(h)??[]).map(p=>p.multiaddr),protocols:[]});yield t3({from:this.components.peerId,messageType:cn.GET_PROVIDERS,providers:f}),yield hP({from:this.components.peerId,providers:f})}if(a.length>=n)return;let c=async function*({peer:f,signal:h}){let p=new Nr(cn.GET_PROVIDERS,i,0);yield*o.network.sendRequest(f,p,{signal:h})},u=new Set(a.map(f=>f.toString()));for await(let f of this.queryManager.run(i,this.routingTable.closestPeers(s),c,t))if(yield f,f.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",f.providers.length,e,f.closer.length);let h=[];for(let p of f.providers)u.has(p.id.toString())||(u.add(p.id.toString()),h.push(p));if(h.length>0&&(yield hP({from:f.from,providers:h})),u.size===n)return}}};l();l();var PE=class{constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peerId)}async add(e){if(this.peerDistances.find(i=>i.peerId.equals(e))!=null)return;let t=await Ns(e),n={peerId:e,distance:bl(this.originDhtKey,t)};this.peerDistances.push(n),this.peerDistances.sort((i,s)=>Lh(i.distance,s.distance)),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async anyCloser(e){if(e.length===0)return!1;if(this.length===0)return!0;let t=await Promise.all(e.map(Ns)),n=this.peerDistances[this.peerDistances.length-1].distance;for(let i of t){let s=bl(this.originDhtKey,i);if(Lh(s,n)<0)return!0}return!1}};var kE=class{constructor(e,t){let{routingTable:n,network:i,validators:s,queryManager:o,lan:a}=t;this.components=e,this.routingTable=n,this.network=i,this.validators=s,this.queryManager=o,this.log=k(`libp2p:kad-dht:${a?"lan":"wan"}:peer-routing`)}async findPeerLocal(e){let t,n=await this.routingTable.find(e);if(n!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.components.peerStore.get(n)}catch(i){if(i.code!=="ERR_NOT_FOUND")throw i}}if(t==null)try{t=await this.components.peerStore.get(e)}catch(i){if(i.code!=="ERR_NOT_FOUND")throw i}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(i=>i.multiaddr),protocols:[]}}async*_getValueSingle(e,t,n={}){let i=new Nr(cn.GET_VALUE,t,0);yield*this.network.sendRequest(e,i,n)}async*getPublicKeyFromNode(e,t={}){let n=Pse(e);for await(let i of this._getValueSingle(e,n,t))if(yield i,i.name==="PEER_RESPONSE"&&i.record!=null){let s=await Ur(Dw.marshalPublicKey({bytes:i.record.value}));if(!s.equals(e))throw new F("public key does not match id","ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(s.publicKey==null)throw new F("public key missing","ERR_PUBLIC_KEY_MISSING");yield n3({from:e,value:s.publicKey})}throw new F(`Node not responding with its public key: ${e.toString()}`,"ERR_INVALID_RECORD")}async*findPeer(e,t={}){this.log("findPeer %p",e);let n=await this.findPeerLocal(e);if(n!=null){this.log("found local"),yield r3({from:this.components.peerId,peer:n});return}let i=await Ns(e),s=this.routingTable.closestPeers(i);if(s.find(f=>f.equals(e))!=null)try{let f=await this.components.peerStore.get(e);this.log("found in peerStore"),yield r3({from:this.components.peerId,peer:{id:f.id,multiaddrs:f.addresses.map(h=>h.multiaddr),protocols:[]}});return}catch(f){if(f.code!=="ERR_NOT_FOUND")throw f}let a=this,c=async function*({peer:f,signal:h}){let p=new Nr(cn.FIND_NODE,e.toBytes(),0);for await(let d of a.network.sendRequest(f,p,{signal:h}))if(yield d,d.name==="PEER_RESPONSE"){let m=d.closer.find(g=>g.id.equals(e));m!=null&&(yield r3({from:d.from,peer:m}))}},u=!1;for await(let f of this.queryManager.run(e.toBytes(),s,c,t))f.name==="FINAL_PEER"&&(u=!0),yield f;u||(yield Mi({from:this.components.peerId,error:new F("Not found","ERR_NOT_FOUND")}))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);let n=await hc(e),i=this.routingTable.closestPeers(n),s=this,o=new PE(n,this.routingTable.kBucketSize);await Promise.all(i.map(async c=>{await o.add(c)}));let a=async function*({peer:c,signal:u}){s.log("closerPeersSingle %s from %p",C(e,"base32"),c);let f=new Nr(cn.FIND_NODE,e,0);yield*s.network.sendRequest(c,f,{signal:u})};for await(let c of this.queryManager.run(e,i,a,t))yield c,c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async u=>{await o.add(u.id)}));this.log("found %d peers close to %b",o.length,e);for(let c of o.peers)yield r3({from:this.components.peerId,peer:{id:c,multiaddrs:(await this.components.peerStore.addressBook.get(c)??[]).map(u=>u.multiaddr),protocols:[]}})}async*getValueOrPeers(e,t,n={}){for await(let i of this._getValueSingle(e,t,n)){if(i.name==="PEER_RESPONSE"&&i.record!=null)try{await this._verifyRecordOnline(i.record)}catch{let o="invalid record received, discarded";this.log(o),yield Mi({from:i.from,error:new F(o,"ERR_INVALID_RECORD")});continue}yield i}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new F("invalid record received","ERR_INVALID_RECORD");await X1(this.validators,new Vr(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){let n=await hc(e),i=this.routingTable.closestPeers(n),s=[];for(let o of i)if(!o.equals(t))try{let a=await this.components.peerStore.addressBook.get(o),c=await this.components.peerStore.protoBook.get(o);s.push({id:o,multiaddrs:a.map(u=>u.multiaddr),protocols:c})}catch(a){if(a.code!=="ERR_NOT_FOUND")throw a}return s.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",s.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p",e,t),s}};l();var Gse=S($m(),1),pP=S(ur(),1);var Vl=k("libp2p:kad-dht:providers"),OE=class{constructor(e,t={}){let{cacheSize:n,cleanupInterval:i,provideValidity:s}=t;this.components=e,this.cleanupInterval=i??36e5,this.provideValidity=s??864e5,this.cache=(0,Gse.default)(n??256),this.syncQueue=new qt({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval(()=>{this._cleanup().catch(e=>{Vl.error(e)})},this.cleanupInterval))}async stop(){this.started=!1,this.cleaner!=null&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){await this.syncQueue.add(async()=>{let e=Date.now(),t=0,n=0,i=new Map,s=this.components.datastore.batch(),o=this.components.datastore.query({prefix:cP});for await(let a of o)try{let{cid:c,peerId:u}=jse(a.key),f=Wse(a.value).getTime(),h=Date.now(),p=h-f,d=p>this.provideValidity;if(Vl("comparing: %d - %d = %d > %d %s",h,f,p,this.provideValidity,d?"(expired)":""),d){n++,s.delete(a.key);let m=i.get(c)??new Set;m.add(u),i.set(c,m)}t++}catch(c){Vl.error(c.message)}i.size>0?(Vl("deleting %d / %d entries",n,t),await s.commit()):Vl("nothing to delete");for(let[a,c]of i){let u=i3(a),f=this.cache.get(u);if(f!=null){for(let h of c)f.delete(h);f.size===0?this.cache.remove(u):this.cache.set(u,f)}}Vl("Cleanup successful (%dms)",Date.now()-e)})}async _getProvidersMap(e){let t=i3(e),n=this.cache.get(t);return n==null&&(n=await kAe(this.components.datastore,e),this.cache.set(t,n)),n}async addProvider(e,t){await this.syncQueue.add(async()=>{Vl("%p provides %s",t,e);let n=await this._getProvidersMap(e);Vl("loaded %s provs",n.size);let i=new Date;n.set(t.toString(),i);let s=i3(e);this.cache.set(s,n),await PAe(this.components.datastore,e,t,i)})}async getProviders(e){return await this.syncQueue.add(async()=>(Vl("get providers for %s",e),[...(await this._getProvidersMap(e)).keys()].map(n=>ae(n))),{throwOnTimeout:!0})}};function i3(r){let e=typeof r=="string"?r:C(r.multihash.bytes,"base32");return`${cP}/${e}`}async function PAe(r,e,t,n){let i=[i3(e),"/",t.toString()].join(""),s=new Gn(i),o=Uint8Array.from(pP.default.encode(n.getTime()));await r.put(s,o)}function jse(r){let e=r.toString().split("/");if(e.length!==5)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:e[3],peerId:e[4]}}async function kAe(r,e){let t=new Map,n=r.query({prefix:i3(e)});for await(let i of n){let{peerId:s}=jse(i.key);t.set(s,Wse(i.value))}return t}function Wse(r){return new Date(pP.default.decode(r))}l();var Zse=S(_n(),1),Jse=S(us(),1);l();var Yse=S(_n(),1),Qse=S(us(),1);var OAe=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");async function*Xse(r){let{key:e,startingPeer:t,ourPeerId:n,signal:i,query:s,alpha:o,pathIndex:a,numPaths:c,cleanUp:u,queryFuncTimeout:f,log:h,peersSeen:p}=r,d=new qt({concurrency:o}),m=await hc(e);function g(y,w){if(y==null)return;p.add(y);let b=BigInt("0x"+C(bl(w,m),"base16"));d.add(async()=>{let _,v=[i];f!=null&&(_=new Yse.TimeoutController(f),v.push(_.signal));let I=(0,Qse.anySignal)(v);try{for await(let x of s({key:e,peer:y,signal:I,pathIndex:a,numPaths:c})){if(I.aborted)return;if(x.name==="PEER_RESPONSE")for(let A of x.closer){if(p.has(A.id)){h("already seen %p in query",A.id);continue}if(n.equals(A.id)){h("not querying ourselves");continue}let R=await Ns(A.id);if(BigInt("0x"+C(bl(R,m),"base16"))>b){h("skipping %p as they are not closer to %b than %p",A.id,e,y);continue}h("querying closer peer %p",A.id),g(A.id,R)}d.emit("completed",x)}_?.clear()}catch(x){i.aborted?d.emit("error",x):d.emit("completed",Mi({from:y,error:x}))}finally{_?.clear()}},{priority:OAe-b}).catch(_=>{h.error(_)})}g(t,await Ns(t)),yield*NAe(d,i,u,h)}async function*NAe(r,e,t,n){let i=bt(),s=!0,o=[],a=()=>{s&&(n("clean up queue, results %d, queue size %d, pending tasks %d",o.length,r.size,r.pending),s=!1,r.clear(),o.splice(0,o.length))};for(r.on("completed",c=>{o.push(c),i.resolve()}),r.on("error",c=>{n("queue error",c),a(),i.reject(c)}),r.on("idle",()=>{n("queue idle"),s=!1,i.resolve()}),e.addEventListener("abort",()=>{n("abort queue");let c=s;a(),c&&i.reject(new F("Query aborted","ERR_QUERY_ABORTED"))}),t.addEventListener("cleanup",()=>{a(),i.resolve()});s;)for(await i.promise,i=bt();o.length>0;){let c=o.shift();c!=null&&(yield c)}yield*o}var s3=S(ri(),1);var DE=class{constructor(e,t){let{lan:n=!1,disjointPaths:i=20,alpha:s=3}=t;this.components=e,this.disjointPaths=i??20,this.controllers=new Set,this.running=!1,this.alpha=s??3,this.lan=n,this.queries=0}isStarted(){return this.running}async start(){this.running=!0,this.components.metrics!=null&&this.metrics==null&&(this.metrics={runningQueries:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_running_queries`),queryTime:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_query_time_seconds`)})}async stop(){this.running=!1;for(let e of this.controllers)e.abort();this.controllers.clear()}async*run(e,t,n,i={}){if(!this.running)throw new Error("QueryManager not started");let s=this.metrics?.queryTime.timer(),o;if(i.signal==null){o=new Zse.TimeoutController(Cse),i.signal=o.signal;try{s3.setMaxListeners!=null&&(0,s3.setMaxListeners)(1/0,o.signal)}catch{}}let a=new AbortController;this.controllers.add(a);let c=[a.signal];i.signal!=null&&c.push(i.signal);let u=(0,Jse.anySignal)(c);try{s3.setMaxListeners!=null&&(0,s3.setMaxListeners)(1/0,u)}catch{}let f=k(`libp2p:kad-dht:${this.lan?"lan":"wan"}:query:`+C(e,"base58btc")),h=t.slice(0,Math.min(this.disjointPaths,t.length)),p=Date.now(),d=new Fe;try{if(f("query:start"),this.queries++,this.metrics?.runningQueries.update(this.queries),t.length===0){f.error("Running query with no peers");return}let m=new ts,g=h.map((y,w)=>Xse({key:e,startingPeer:y,ourPeerId:this.components.peerId,signal:u,query:n,pathIndex:w,numPaths:h.length,alpha:this.alpha,cleanUp:d,queryFuncTimeout:i.queryFuncTimeout,log:f,peersSeen:m}));for await(let y of Fr(...g))yield y,y.name==="QUERY_ERROR"&&f("error",y.error)}catch(m){if(!(!this.running&&m.code==="ERR_QUERY_ABORTED"))throw m}finally{this.controllers.delete(a),o?.clear(),this.queries--,this.metrics?.runningQueries.update(this.queries),s?.(),d.dispatchEvent(new ne("cleanup")),f("query:done in %dms",Date.now()-p)}}};l();l();var o3=k("libp2p:kad-dht:rpc:handlers:add-provider"),LE=class{constructor(e){let{providers:t}=e;this.providers=t}async handle(e,t){if(o3("start"),t.key==null||t.key.length===0)throw new F("Missing key","ERR_MISSING_KEY");let n;try{n=T.decode(t.key)}catch{throw new F("Invalid CID","ERR_INVALID_CID")}(t.providerPeers==null||t.providerPeers.length===0)&&o3.error("no providers found in message"),await Promise.all(t.providerPeers.map(async i=>{if(!i.id.equals(e)){o3("invalid provider peer %p from %p",i.id,e);return}if(i.multiaddrs.length<1){o3("no valid addresses for provider %p. Ignore",e);return}o3("received provider %p for %s (addrs %s)",e,n,i.multiaddrs.map(s=>s.toString())),await this.providers.addProvider(n,i.id)}))}};l();var eoe=k("libp2p:kad-dht:rpc:handlers:find-node"),BE=class{constructor(e,t){let{peerRouting:n,lan:i}=t;this.components=e,this.peerRouting=n,this.lan=Boolean(i)}async handle(e,t){eoe("incoming request from %p for peers closer to %b",e,t.key);let n=[];be(this.components.peerId.toBytes(),t.key)?n=[{id:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map(s=>s.decapsulateCode(Kt("p2p").code)),protocols:[]}]:n=await this.peerRouting.getCloserPeersOffline(t.key,e),n=n.map(this.lan?Q1:Y1).filter(({multiaddrs:s})=>s.length);let i=new Nr(t.type,new Uint8Array(0),t.clusterLevel);return n.length>0?i.closerPeers=n:eoe("could not find any peers closer to %b than %p",t.key,e),i}};l();var toe=k("libp2p:kad-dht:rpc:handlers:get-providers"),UE=class{constructor(e,t){let{peerRouting:n,providers:i,lan:s}=t;this.components=e,this.peerRouting=n,this.providers=i,this.lan=Boolean(s)}async handle(e,t){let n;try{n=T.decode(t.key)}catch{throw new F("Invalid CID","ERR_INVALID_CID")}toe("%p asking for providers for %s",e,n);let[i,s]=await Promise.all([this.providers.getProviders(n),this.peerRouting.getCloserPeersOffline(t.key,e)]),o=await this._getPeers(i),a=await this._getPeers(s.map(({id:u})=>u)),c=new Nr(t.type,t.key,t.clusterLevel);return o.length>0&&(c.providerPeers=o),a.length>0&&(c.closerPeers=a),toe("got %s providers %s closerPeers",o.length,a.length),c}async _getAddresses(e){return(await this.components.peerStore.addressBook.get(e)).map(n=>n.multiaddr)}async _getPeers(e){let t=[],n=this.lan?Q1:Y1;for(let i of e){let s=n({id:i,multiaddrs:await this._getAddresses(i),protocols:[]});s.multiaddrs.length>0&&t.push(s)}return t}};l();var J1=k("libp2p:kad-dht:rpc:handlers:get-value"),ME=class{constructor(e,t){let{peerRouting:n}=t;this.components=e,this.peerRouting=n}async handle(e,t){let n=t.key;if(J1("%p asked for key %b",e,n),n==null||n.length===0)throw new F("Invalid key","ERR_INVALID_KEY");let i=new Nr(cn.GET_VALUE,n,t.clusterLevel);if(kse(n)){J1("is public key");let a=Ose(n),c;try{let u=await this.components.peerStore.keyBook.get(a);if(u==null)throw new F("No public key found in key book","ERR_NOT_FOUND");c=u}catch(u){if(u.code!=="ERR_NOT_FOUND")throw u}if(c!=null)return J1("returning found public key"),i.record=new Vr(n,c,new Date),i}let[s,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(t.key,e)]);return s!=null&&(J1("had record for %b in local datastore",n),i.record=s),o.length>0&&(J1("had %s closer peers in routing table",o.length),i.closerPeers=o),i}async _checkLocalDatastore(e){J1("checkLocalDatastore looking for %b",e);let t=Fl(e),n;try{n=await this.components.datastore.get(t)}catch(s){if(s.code==="ERR_NOT_FOUND")return;throw s}let i=Vr.deserialize(n);if(i==null)throw new F("Invalid record","ERR_INVALID_RECORD");if(i.timeReceived==null||Date.now()-i.timeReceived.getTime()>1296e5){await this.components.datastore.delete(t);return}return i}};l();var LAe=k("libp2p:kad-dht:rpc:handlers:ping"),FE=class{async handle(e,t){return LAe("ping from %p",e),t}};l();var VE=class{constructor(e,t){let{validators:n}=t;this.components=e,this.log=k("libp2p:kad-dht:rpc:handlers:put-value"),this.validators=n}async handle(e,t){let n=t.key;this.log("%p asked us to store value for key %b",e,n);let i=t.record;if(i==null){let s=`Empty record from: ${e.toString()}`;throw this.log.error(s),new F(s,"ERR_EMPTY_RECORD")}try{await X1(this.validators,i),i.timeReceived=new Date;let s=Fl(i.key);await this.components.datastore.put(s,i.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,s)}catch(s){this.log("did not put record for key %b into datastore %o",n,s)}return t}};var zE=class{constructor(e,t){let{providers:n,peerRouting:i,validators:s,lan:o}=t;this.log=k("libp2p:kad-dht:rpc"),this.routingTable=t.routingTable,this.handlers={[cn.GET_VALUE]:new ME(e,{peerRouting:i}),[cn.PUT_VALUE]:new VE(e,{validators:s}),[cn.FIND_NODE]:new BE(e,{peerRouting:i,lan:o}),[cn.ADD_PROVIDER]:new LE({providers:n}),[cn.GET_PROVIDERS]:new UE(e,{peerRouting:i,providers:n,lan:o}),[cn.PING]:new FE}}async handleMessage(e,t){try{await this.routingTable.add(e)}catch(i){this.log.error("Failed to update the kbucket store",i)}let n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}return await n.handle(e,t)}onIncomingStream(e){Promise.resolve().then(async()=>{let{stream:t,connection:n}=e,i=n.remotePeer;try{await this.routingTable.add(i)}catch(o){this.log.error(o)}let s=this;await _e(t,on(),async function*(o){for await(let a of o){let c=Nr.deserialize(a);s.log("incoming %s from %p",c.type,i);let u=await s.handleMessage(i,c);u!=null&&(yield u.serialize())}},xn(),t)}).catch(t=>{this.log.error(t)})}};l();var KE=class extends Fe{constructor(e,t){super();let{protocol:n,lan:i}=t;this.components=e,this.log=k(`libp2p:kad-dht:topology-listener:${i?"lan":"wan"}`),this.running=!1,this.protocol=n}isStarted(){return this.running}async start(){if(this.running)return;this.running=!0;let e=a1({onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new ne("peer",{detail:t}))}});this.registrarId=await this.components.registrar.register(this.protocol,e)}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}};l();var mP=S(ri(),1);var roe=S(_n(),1),noe=S(us(),1);var qE=class{constructor(e,t){let{peerRouting:n,lan:i,count:s,interval:o,queryTimeout:a}=t;this.components=e,this.log=k(`libp2p:kad-dht:${i?"lan":"wan"}:query-self`),this.running=!1,this.peerRouting=n,this.count=s??20,this.interval=o??Ase,this.queryTimeout=a??Tse}isStarted(){return this.running}async start(){this.running||(this.running=!0,this._querySelf())}async stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}_querySelf(){Promise.resolve().then(async()=>{let e=new roe.TimeoutController(this.queryTimeout);try{this.controller=new AbortController;let t=(0,noe.anySignal)([this.controller.signal,e.signal]);try{mP.setMaxListeners!=null&&(0,mP.setMaxListeners)(1/0,t)}catch{}let n=await _e(this.peerRouting.getClosestPeers(this.components.peerId.toBytes(),{signal:t}),i=>gs(i,this.count),async i=>await qo(i));this.log("query ran successfully - found %d peers",n)}catch(t){this.log("query error",t)}finally{this.timeoutId=setTimeout(this._querySelf.bind(this),this.interval),e.clear()}}).catch(e=>{this.log("query error",e)})}};var BAe=32,UAe=64,a3=class extends Fe{constructor(e,t){super();let{kBucketSize:n,clientMode:i,validators:s,selectors:o,querySelfInterval:a,lan:c,protocolPrefix:u,pingTimeout:f,pingConcurrency:h,maxInboundStreams:p,maxOutboundStreams:d,providers:m}=t;this.running=!1,this.components=e,this.lan=Boolean(c),this.log=k(`libp2p:kad-dht:${c===!0?"lan":"wan"}`),this.protocol=`${u??vse}${c===!0?_se:""}${Sse}`,this.kBucketSize=n??20,this.clientMode=i??!0,this.maxInboundStreams=p??BAe,this.maxOutboundStreams=d??UAe,this.routingTable=new xE(e,{kBucketSize:n,lan:this.lan,pingTimeout:f,pingConcurrency:h,protocol:this.protocol}),this.providers=new OE(e,m??{}),this.validators={...qse,...s},this.selectors={...Hse,...o},this.network=new IE(e,{protocol:this.protocol,lan:this.lan}),this.queryManager=new DE(e,{disjointPaths:Math.ceil(this.kBucketSize/2),lan:c}),this.peerRouting=new kE(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,lan:this.lan}),this.contentFetching=new RE(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,network:this.network,lan:this.lan}),this.contentRouting=new CE(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,lan:this.lan}),this.routingTableRefresh=new TE({peerRouting:this.peerRouting,routingTable:this.routingTable,lan:this.lan}),this.rpc=new zE(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,lan:this.lan}),this.topologyListener=new KE(e,{protocol:this.protocol,lan:this.lan}),this.querySelf=new qE(e,{peerRouting:this.peerRouting,interval:a,lan:this.lan}),this.network.addEventListener("peer",g=>{let y=g.detail;this.onPeerConnect(y).catch(w=>{this.log.error("could not add %p to routing table",y.id,w)}),this.dispatchEvent(new ne("peer",{detail:y}))}),this.topologyListener.addEventListener("peer",g=>{let y=g.detail;Promise.resolve().then(async()=>{let w=await this.components.peerStore.addressBook.get(y),b={id:y,multiaddrs:w.map(_=>_.multiaddr),protocols:[]};await this.onPeerConnect(b)}).catch(w=>{this.log.error("could not add %p to routing table",y,w)})})}get[sc](){return!0}get[Symbol.toStringTag](){return"@libp2p/kad-dht"}async onPeerConnect(e){if(this.log("peer %p connected with protocols %s",e.id,e.protocols),this.lan?e=Q1(e):e=Y1(e),e.multiaddrs.length===0){this.log("ignoring %p as they do not have any %s addresses in %s",e.id,this.lan?"private":"public",e.multiaddrs.map(t=>t.toString()));return}try{await this.routingTable.add(e.id)}catch(t){this.log.error("could not add %p to routing table",e.id,t)}}isStarted(){return this.running}async getMode(){return this.clientMode?"client":"server"}async setMode(e){await this.components.registrar.unhandle(this.protocol),e==="client"?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),await Promise.all([this.providers.start(),this.queryManager.start(),this.network.start(),this.routingTable.start(),this.topologyListener.start(),this.querySelf.start()]),await this.routingTableRefresh.start()}async stop(){this.running=!1,await Promise.all([this.providers.stop(),this.queryManager.stop(),this.network.stop(),this.routingTable.stop(),this.routingTableRefresh.stop(),this.topologyListener.stop(),this.querySelf.stop()])}async*put(e,t,n={}){yield*this.contentFetching.put(e,t,n)}async*get(e,t={}){yield*this.contentFetching.get(e,t)}async*provide(e,t={}){yield*this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t)}async*findProviders(e,t={}){yield*this.contentRouting.findProviders(e,t)}async*findPeer(e,t={}){yield*this.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t={}){yield*this.peerRouting.getClosestPeers(e,t)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}};l();var MAe=k("libp2p:kad-dht"),$E=class extends Fe{constructor(e,t,n){super(),this.components=e,this.wan=t,this.lan=n,this.wan.addEventListener("peer",i=>{this.dispatchEvent(new ne("peer",{detail:i.detail}))}),this.lan.addEventListener("peer",i=>{this.dispatchEvent(new ne("peer",{detail:i.detail}))})}get[sc](){return!0}get[Symbol.toStringTag](){return"@libp2p/dual-kad-dht"}isStarted(){return this.wan.isStarted()&&this.lan.isStarted()}async getMode(){return await this.wan.getMode()}async setMode(e){await this.wan.setMode(e)}async start(){await Promise.all([this.lan.start(),this.wan.start()])}async stop(){await Promise.all([this.lan.stop(),this.wan.stop()])}async*put(e,t,n={}){for await(let i of Fr(this.lan.put(e,t,n),this.wan.put(e,t,n)))yield i}async*get(e,t={}){let n=!1,i=!1;for await(let s of Fr(this.lan.get(e,t),this.wan.get(e,t)))yield s,s.name==="DIALING_PEER"&&(n=!0),s.name==="VALUE"&&(n=!0,s.value!=null&&(i=!0)),s.name==="SENDING_QUERY"&&(n=!0);if(!n)throw new F("No peers found in routing table!","ERR_NO_PEERS_IN_ROUTING_TABLE");i||(yield Mi({from:this.components.peerId,error:new F("Not found","ERR_NOT_FOUND")}))}async*provide(e,t={}){let n=0,i=0,s=[],o=[this.lan];await this.wan.getMode()==="server"&&o.push(this.wan);for await(let a of Fr(...o.map(c=>c.provide(e,t))))yield a,a.name==="SENDING_QUERY"&&n++,a.name==="QUERY_ERROR"&&s.push(a.error),a.name==="PEER_RESPONSE"&&a.messageName==="ADD_PROVIDER"&&(MAe("sent provider record for %s to %p",e,a.from),i++);if(i===0)throw s.length>0?new F(`Failed to provide to ${s.length} of ${n} peers`,"ERR_PROVIDES_FAILED",{errors:s}):new F("Failed to provide - no peers found","ERR_PROVIDES_FAILED")}async*findProviders(e,t={}){yield*Fr(this.lan.findProviders(e,t),this.wan.findProviders(e,t))}async*findPeer(e,t={}){let n=!1;for await(let i of Fr(this.lan.findPeer(e,t),this.wan.findPeer(e,t)))yield i,(i.name==="SENDING_QUERY"||i.name==="FINAL_PEER")&&(n=!0);if(!n)throw new F("Peer lookup failed","ERR_LOOKUP_FAILED")}async*getClosestPeers(e,t={}){yield*Fr(this.lan.getClosestPeers(e,t),this.wan.getClosestPeers(e,t))}async refreshRoutingTable(){await Promise.all([this.lan.refreshRoutingTable(),this.wan.refreshRoutingTable()])}};var gP=class extends $E{constructor(e,t){super(e,new a3(e,{protocolPrefix:"/ipfs",...t,lan:!1}),new a3(e,{protocolPrefix:"/ipfs",...t,clientMode:!1,lan:!0}))}};function ioe(r){return e=>new gP(e,r)}l();l();var TP=S(ur(),1);l();var em=S(ur(),1);l();var dc=S(ur(),1);l();var soe=cs,FAe=ls,yP=function(r){let e=0;if(r=r.toString().trim(),soe(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(FAe(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let s=soe(t[n]),o;s&&(o=yP(t[n]),t[n]=C(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,C(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}let i=new Uint8Array(e+16);for(n=0;n<t.length;n++){let s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},ooe=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){let i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};l();var c3={},wP={},zAe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];zAe.forEach(r=>{let e=KAe(...r);wP[e.code]=e,c3[e.name]=e});function KAe(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:Boolean(n),path:Boolean(i)}}function yr(r){if(typeof r=="number"){if(wP[r]!=null)return wP[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(c3[r]!=null)return c3[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var JQt=yr("ip4"),eXt=yr("ip6"),tXt=yr("ipcidr");function foe(r,e){switch(yr(r).code){case 4:case 41:return $Ae(e);case 42:return loe(e);case 6:case 273:case 33:case 132:return doe(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return loe(e);case 421:return WAe(e);case 444:return uoe(e);case 445:return uoe(e);case 466:return jAe(e);default:return C(e,"base16")}}function hoe(r,e){switch(yr(r).code){case 4:return aoe(e);case 41:return aoe(e);case 42:return coe(e);case 6:case 273:case 33:case 132:return EP(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return coe(e);case 421:return HAe(e);case 444:return YAe(e);case 445:return QAe(e);case 466:return GAe(e);default:return U(e,"base16")}}var bP=Object.values(Ar).map(r=>r.decoder),qAe=function(){let r=bP[0].or(bP[1]);return bP.slice(2).forEach(e=>r=r.or(e)),r}();function aoe(r){if(!Xt(r))throw new Error("invalid ip address");return yP(r)}function $Ae(r){let e=ooe(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Xt(e))throw new Error("invalid ip address");return e}function EP(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function doe(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function coe(r){let e=U(r),t=Uint8Array.from(dc.default.encode(e.length));return Z([t,e],t.length+e.length)}function loe(r){let e=dc.default.decode(r);if(r=r.slice(dc.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return C(r)}function HAe(r){let e;r[0]==="Q"||r[0]==="1"?e=Ze(le.decode(`z${r}`)).bytes:e=T.parse(r).multihash.bytes;let t=Uint8Array.from(dc.default.encode(e.length));return Z([t,e],t.length+e.length)}function GAe(r){let e=qAe.decode(r),t=Uint8Array.from(dc.default.encode(e.length));return Z([t,e],t.length+e.length)}function jAe(r){let e=dc.default.decode(r),t=r.slice(dc.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+C(t,"base64url")}function WAe(r){let e=dc.default.decode(r),t=r.slice(dc.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return C(t,"base58btc")}function YAe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=De.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=EP(n);return Z([t,i],t.length+i.length)}function QAe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=De.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=EP(n);return Z([t,i],t.length+i.length)}function uoe(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=C(e,"base32"),i=doe(t);return`${n}:${i}`}function XAe(r){let e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){let i=t[n],s=yr(i);if(s.size===0){e.push([i]);continue}if(n++,n>=t.length)throw moe("invalid address: "+r);if(s.path===!0){e.push([i,AP(t.slice(n).join("/"))]);break}e.push([i,t[n]])}return e}function ZAe(r){let e=[];return r.map(t=>{let n=jE(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),AP(e.join("/"))}function JAe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);let t=jE(e);return e.length>1?[t.code,hoe(t.code,e[1])]:[t.code]})}function _P(r){return r.map(e=>{let t=jE(e);return e[1]!=null?[t.code,foe(t.code,e[1])]:[t.code]})}function vP(r){return GE(Z(r.map(e=>{let t=jE(e),n=Uint8Array.from(em.default.encode(t.code));return e.length>1&&e[1]!=null&&(n=Z([n,e[1]])),n})))}function SP(r,e){return r.size>0?r.size/8:r.size===0?0:em.default.decode(e)+(em.default.decode.bytes??0)}function HE(r){let e=[],t=0;for(;t<r.length;){let n=em.default.decode(r,t),i=em.default.decode.bytes??0,s=yr(n),o=SP(s,r.slice(t+i));if(o===0){e.push([n]),t+=i;continue}let a=r.slice(t+i,t+i+o);if(t+=o+i,t>r.length)throw moe("Invalid address Uint8Array: "+C(r,"base16"));e.push([n,a])}return e}function xP(r){let e=HE(r),t=_P(e);return ZAe(t)}function eTe(r){r=AP(r);let e=XAe(r),t=JAe(e);return vP(t)}function poe(r){return eTe(r)}function GE(r){let e=tTe(r);if(e!=null)throw e;return Uint8Array.from(r)}function tTe(r){try{HE(r)}catch(e){return e}}function AP(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function moe(r){return new Error("Error parsing address: "+r)}function jE(r){return yr(r[0])}l();var nTe=Symbol.for("nodejs.util.inspect.custom"),iTe=[yr("dns").code,yr("dns4").code,yr("dns6").code,yr("dnsaddr").code],sTe=new Map,goe=Symbol.for("@multiformats/js-multiaddr/multiaddr");function oTe(r){return Boolean(r?.[goe])}var zl=class{bytes;#e;#r;#n;#t;[goe]=!0;constructor(e){if(e==null&&(e=""),e instanceof Uint8Array)this.bytes=GE(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=poe(e)}else if(oTe(e))this.bytes=GE(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return this.#e==null&&(this.#e=xP(this.bytes)),this.#e}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="",o=yr("tcp"),a=yr("udp"),c=yr("ip4"),u=yr("ip6"),f=yr("dns6"),h=yr("ip6zone");for(let[d,m]of this.stringTuples())d===h.code&&(s=`%${m??""}`),iTe.includes(d)&&(t=o.name,i=443,n=`${m??""}${s}`,e=d===f.code?6:4),(d===o.code||d===a.code)&&(t=yr(d).name,i=parseInt(m??"")),(d===c.code||d===u.code)&&(t=yr(d).name,n=`${m??""}${s}`,e=d===u.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return this.protoCodes().map(e=>Object.assign({},yr(e)))}protoCodes(){let e=[],t=this.bytes,n=0;for(;n<t.length;){let i=TP.default.decode(t,n),s=TP.default.decode.bytes??0,o=yr(i),a=SP(o,t.slice(n+s));n+=a+s,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return this.#r==null&&(this.#r=HE(this.bytes)),this.#r}stringTuples(){return this.#n==null&&(this.#n=_P(this.tuples())),this.#n}encapsulate(e){return e=new zl(e),new zl(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new zl(n.slice(0,i))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new zl(vP(t.slice(0,n)));return this}getPeerId(){try{let t=this.stringTuples().filter(n=>n[0]===c3.ipfs.code).pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?C(le.decode(`z${n}`),"base58btc"):C(T.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){if(this.#t===void 0)try{this.#t=this.stringTuples().filter(e=>yr(e[0]).path===!0)[0][1],this.#t==null&&(this.#t=null)}catch{this.#t=null}return this.#t}equals(e){return be(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(s=>s.resolvable);if(t==null)return[this];let n=sTe.get(t.name);if(n==null)throw new F(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(s=>new zl(s))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[nTe](){return`Multiaddr(${xP(this.bytes)})`}};function tm(r){return new zl(r)}l();var aTe=ge("dns4"),cTe=ge("dns6"),lTe=ge("dnsaddr"),Xd=Tn(ge("dns"),lTe,aTe,cTe),WE=Tn(ge("ip4"),ge("ip6")),rm=Tn(Ue(WE,ge("tcp")),Ue(Xd,ge("tcp"))),YE=Ue(WE,ge("udp")),uTe=Ue(YE,ge("utp")),fTe=Ue(YE,ge("quic")),hTe=Ue(YE,ge("quic-v1")),l3=Tn(Ue(rm,ge("ws")),Ue(Xd,ge("ws"))),u3=Tn(Ue(rm,ge("wss")),Ue(Xd,ge("wss")),Ue(rm,ge("tls"),ge("ws")),Ue(Xd,ge("tls"),ge("ws"))),IP=Tn(Ue(rm,ge("http")),Ue(WE,ge("http")),Ue(Xd,ge("http"))),RP=Tn(Ue(rm,ge("https")),Ue(WE,ge("https")),Ue(Xd,ge("https"))),yoe=Ue(YE,ge("webrtc-direct"),ge("certhash")),Eoe=Tn(Ue(yoe,ge("p2p")),yoe),woe=Ue(hTe,ge("webtransport"),ge("certhash"),ge("certhash")),_oe=Tn(Ue(woe,ge("p2p")),woe),voe=Tn(Ue(l3,ge("p2p-webrtc-star"),ge("p2p")),Ue(u3,ge("p2p-webrtc-star"),ge("p2p")),Ue(l3,ge("p2p-webrtc-star")),Ue(u3,ge("p2p-webrtc-star"))),AXt=Tn(Ue(l3,ge("p2p-websocket-star"),ge("p2p")),Ue(u3,ge("p2p-websocket-star"),ge("p2p")),Ue(l3,ge("p2p-websocket-star")),Ue(u3,ge("p2p-websocket-star"))),Soe=Tn(Ue(IP,ge("p2p-webrtc-direct"),ge("p2p")),Ue(RP,ge("p2p-webrtc-direct"),ge("p2p")),Ue(IP,ge("p2p-webrtc-direct")),Ue(RP,ge("p2p-webrtc-direct"))),Zd=Tn(l3,u3,IP,RP,voe,Soe,rm,uTe,fTe,Xd,Eoe,_oe),TXt=Tn(Ue(Zd,ge("p2p-stardust"),ge("p2p")),Ue(Zd,ge("p2p-stardust"))),Uf=Tn(Ue(Zd,ge("p2p")),voe,Soe,Eoe,_oe,ge("p2p")),boe=Tn(Ue(Uf,ge("p2p-circuit"),Uf),Ue(Uf,ge("p2p-circuit")),Ue(ge("p2p-circuit"),Uf),Ue(Zd,ge("p2p-circuit")),Ue(ge("p2p-circuit"),Zd),ge("p2p-circuit")),xoe=()=>Tn(Ue(boe,xoe),boe),Qd=xoe(),Aoe=Tn(Ue(Qd,Uf,Qd),Ue(Uf,Qd),Ue(Qd,Uf),Qd,Uf);var IXt=Tn(Ue(Qd,ge("webrtc"),ge("p2p")),Ue(Qd,ge("webrtc")),Ue(Zd,ge("webrtc"),ge("p2p")),Ue(Zd,ge("webrtc")),ge("webrtc"));function Toe(r){function e(t){let n;try{n=tm(t)}catch{return!1}let i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function Ue(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:Toe(e),partialMatch:e}}function Tn(...r){function e(n){let i=null;return r.some(s=>{let o=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);return o!=null?(i=o,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:Toe(e),partialMatch:e}}function ge(r){let e=r;function t(i){let s;try{s=tm(i)}catch{return!1}let o=s.protoNames();return o.length===1&&o[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}var QE=k("libp2p:bootstrap"),dTe="bootstrap",pTe=50,mTe=12e4,gTe=1e3,XE=class extends Fe{constructor(e,t={list:[]}){if(t.list==null||t.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=e,this.timeout=t.timeout??gTe,this.list=[];for(let n of t.list){if(!Aoe.matches(n)){QE.error("Invalid multiaddr");continue}let i=tm(n),s=i.getPeerId();if(s==null){QE.error("Invalid bootstrap multiaddr without peer id");continue}let o={id:ae(s),multiaddrs:[i],protocols:[]};this.list.push(o)}this._init=t}get[sc](){return!0}get[Symbol.toStringTag](){return"@libp2p/bootstrap"}isStarted(){return Boolean(this.timer)}start(){this.isStarted()||(QE("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(e=>{QE.error(e)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(let e of this.list){if(await this.components.peerStore.tagPeer(e.id,this._init.tagName??dTe,{value:this._init.tagValue??pTe,ttl:this._init.tagTTL??mTe}),this.timer==null)return;this.dispatchEvent(new ne("peer",{detail:e}))}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}};XE.tag="bootstrap";function Ioe(r){return e=>new XE(e,r)}l();l();l();var Roe=WebSocket;l();l();var Ooe=S(Poe(),1);function koe(r){return r instanceof ArrayBuffer||r?.constructor?.name==="ArrayBuffer"&&typeof r?.byteLength=="number"}var Noe=r=>{r.binaryType="arraybuffer";let e=async()=>await new Promise((s,o)=>{if(n)return s();if(i!=null)return o(i);let a=f=>{r.removeEventListener("open",c),r.removeEventListener("error",u),f()},c=()=>a(s),u=f=>{a(()=>o(f.error??new Error(`connect ECONNREFUSED ${r.url}`)))};r.addEventListener("open",c),r.addEventListener("error",u)}),t=async function*(){let s=new Ooe.EventIterator(({push:o,stop:a,fail:c})=>{let u=h=>{let p=null;typeof h.data=="string"&&(p=U(h.data)),koe(h.data)&&(p=new Uint8Array(h.data)),h.data instanceof Uint8Array&&(p=h.data),p!=null&&o(p)},f=h=>c(h.error??new Error("Socket error"));return r.addEventListener("message",u),r.addEventListener("error",f),r.addEventListener("close",a),()=>{r.removeEventListener("message",u),r.removeEventListener("error",f),r.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(let o of s)yield koe(o)?new Uint8Array(o):o}(),n=r.readyState===1,i;return r.addEventListener("open",()=>{n=!0,i=null}),r.addEventListener("close",()=>{n=!1,i=null}),r.addEventListener("error",s=>{n||(i=s.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})};l();l();var Doe=r=>{if(r.readyState>=2)throw new Error("socket closed");if(r.readyState!==1)return new Promise((e,t)=>{function n(){r.removeEventListener("open",i),r.removeEventListener("error",s)}function i(){n(),e()}function s(o){n(),t(o.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",i),r.addEventListener("error",s)})};var Loe=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async n=>{for await(let i of n){try{await Doe(r)}catch(s){if(s.message==="socket closed")break;throw s}r.send(i)}if(e.closeOnEnd!=null&&r.readyState<=1)return await new Promise((i,s)=>{r.addEventListener("close",o=>{if(o.wasClean||o.code===1006)i();else{let a=Object.assign(new Error("ws error"),{event:o});s(a)}}),setTimeout(()=>r.close())})});var Boe=(r,e)=>{e=e??{};let t=Noe(r),n=e.remoteAddress,i=e.remotePort;if(r.url!=null)try{let o=new URL(r.url);n=o.hostname,i=parseInt(o.port,10)}catch{}if(n==null||i==null)throw new Error("Remote connection did not have address and/or port");return{sink:Loe(r,e),source:t,connected:async()=>await t.connected(),close:async()=>{(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&await new Promise(o=>{r.addEventListener("close",()=>{o()}),r.close()})},destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:i,socket:r}};l();var Uoe=S(R4(),1),wTe={http:"ws",https:"wss"},bTe="ws",Moe=(r,e)=>(0,Uoe.relative)(r,e,wTe,bTe);function Foe(r,e){let t=typeof window>"u"?"":window.location;e=e??{};let n=Moe(r,t.toString()),i=new Roe(n,e.websocket);return Boe(i,e)}l();function Voe(){throw new Error("WebSocket Servers can not be created in the browser!")}l();l();var zoe=k("libp2p:websockets:socket");function Koe(r,e,t){t=t??{};let n={async sink(i){t?.signal!=null&&(i=ni(i,t.signal));try{await r.sink(i)}catch(s){s.type!=="aborted"&&zoe.error(s)}},source:t.signal!=null?ni(r.source,t.signal):r.source,remoteAddr:e,timeline:{open:Date.now()},async close(){let i=Date.now();try{await pg(r.close(),{milliseconds:2e3})}catch{let{host:o,port:a}=n.remoteAddr.toOptions();zoe("timeout closing stream to %s:%s after %dms, destroying it manually",o,a,Date.now()-i),r.destroy()}finally{n.timeline.close=Date.now()}}};return r.socket.addEventListener("close",()=>{n.timeline.close==null&&(n.timeline.close=Date.now())},{once:!0}),n}l();l();l();var VP=S(ur(),1);l();var nm=S(ur(),1);l();var pc=S(ur(),1);l();var qoe=cs,_Te=ls,kP=function(r){let e=0;if(r=r.toString().trim(),qoe(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(_Te(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let s=qoe(t[n]),o;s&&(o=kP(t[n]),t[n]=C(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,C(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}let i=new Uint8Array(e+16);for(n=0;n<t.length;n++){let s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},$oe=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){let i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};l();var h3={},OP={},STe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];STe.forEach(r=>{let e=xTe(...r);OP[e.code]=e,h3[e.name]=e});function xTe(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:Boolean(n),path:Boolean(i)}}function wr(r){if(typeof r=="number"){if(OP[r]!=null)return OP[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(h3[r]!=null)return h3[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var DZt=wr("ip4"),LZt=wr("ip6"),BZt=wr("ipcidr");function Yoe(r,e){switch(wr(r).code){case 4:case 41:return TTe(e);case 42:return joe(e);case 6:case 273:case 33:case 132:return Xoe(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return joe(e);case 421:return PTe(e);case 444:return Woe(e);case 445:return Woe(e);case 466:return CTe(e);default:return C(e,"base16")}}function Qoe(r,e){switch(wr(r).code){case 4:return Hoe(e);case 41:return Hoe(e);case 42:return Goe(e);case 6:case 273:case 33:case 132:return DP(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Goe(e);case 421:return ITe(e);case 444:return kTe(e);case 445:return OTe(e);case 466:return RTe(e);default:return U(e,"base16")}}var NP=Object.values(Ar).map(r=>r.decoder),ATe=function(){let r=NP[0].or(NP[1]);return NP.slice(2).forEach(e=>r=r.or(e)),r}();function Hoe(r){if(!Xt(r))throw new Error("invalid ip address");return kP(r)}function TTe(r){let e=$oe(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Xt(e))throw new Error("invalid ip address");return e}function DP(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function Xoe(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function Goe(r){let e=U(r),t=Uint8Array.from(pc.default.encode(e.length));return Z([t,e],t.length+e.length)}function joe(r){let e=pc.default.decode(r);if(r=r.slice(pc.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return C(r)}function ITe(r){let e;r[0]==="Q"||r[0]==="1"?e=Ze(le.decode(`z${r}`)).bytes:e=T.parse(r).multihash.bytes;let t=Uint8Array.from(pc.default.encode(e.length));return Z([t,e],t.length+e.length)}function RTe(r){let e=ATe.decode(r),t=Uint8Array.from(pc.default.encode(e.length));return Z([t,e],t.length+e.length)}function CTe(r){let e=pc.default.decode(r),t=r.slice(pc.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+C(t,"base64url")}function PTe(r){let e=pc.default.decode(r),t=r.slice(pc.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return C(t,"base58btc")}function kTe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=De.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=DP(n);return Z([t,i],t.length+i.length)}function OTe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=De.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=DP(n);return Z([t,i],t.length+i.length)}function Woe(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=C(e,"base32"),i=Xoe(t);return`${n}:${i}`}function NTe(r){let e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){let i=t[n],s=wr(i);if(s.size===0){e.push([i]);continue}if(n++,n>=t.length)throw Joe("invalid address: "+r);if(s.path===!0){e.push([i,FP(t.slice(n).join("/"))]);break}e.push([i,t[n]])}return e}function DTe(r){let e=[];return r.map(t=>{let n=r7(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),FP(e.join("/"))}function LTe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);let t=r7(e);return e.length>1?[t.code,Qoe(t.code,e[1])]:[t.code]})}function LP(r){return r.map(e=>{let t=r7(e);return e[1]!=null?[t.code,Yoe(t.code,e[1])]:[t.code]})}function BP(r){return t7(Z(r.map(e=>{let t=r7(e),n=Uint8Array.from(nm.default.encode(t.code));return e.length>1&&e[1]!=null&&(n=Z([n,e[1]])),n})))}function UP(r,e){return r.size>0?r.size/8:r.size===0?0:nm.default.decode(e)+(nm.default.decode.bytes??0)}function e7(r){let e=[],t=0;for(;t<r.length;){let n=nm.default.decode(r,t),i=nm.default.decode.bytes??0,s=wr(n),o=UP(s,r.slice(t+i));if(o===0){e.push([n]),t+=i;continue}let a=r.slice(t+i,t+i+o);if(t+=o+i,t>r.length)throw Joe("Invalid address Uint8Array: "+C(r,"base16"));e.push([n,a])}return e}function MP(r){let e=e7(r),t=LP(e);return DTe(t)}function BTe(r){r=FP(r);let e=NTe(r),t=LTe(e);return BP(t)}function Zoe(r){return BTe(r)}function t7(r){let e=UTe(r);if(e!=null)throw e;return Uint8Array.from(r)}function UTe(r){try{e7(r)}catch(e){return e}}function FP(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function Joe(r){return new Error("Error parsing address: "+r)}function r7(r){return wr(r[0])}l();var FTe=Symbol.for("nodejs.util.inspect.custom"),VTe=[wr("dns").code,wr("dns4").code,wr("dns6").code,wr("dnsaddr").code],zTe=new Map,eae=Symbol.for("@multiformats/js-multiaddr/multiaddr");function KTe(r){return Boolean(r?.[eae])}var Kl=class{bytes;#e;#r;#n;#t;[eae]=!0;constructor(e){if(e==null&&(e=""),e instanceof Uint8Array)this.bytes=t7(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=Zoe(e)}else if(KTe(e))this.bytes=t7(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return this.#e==null&&(this.#e=MP(this.bytes)),this.#e}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="",o=wr("tcp"),a=wr("udp"),c=wr("ip4"),u=wr("ip6"),f=wr("dns6"),h=wr("ip6zone");for(let[d,m]of this.stringTuples())d===h.code&&(s=`%${m??""}`),VTe.includes(d)&&(t=o.name,i=443,n=`${m??""}${s}`,e=d===f.code?6:4),(d===o.code||d===a.code)&&(t=wr(d).name,i=parseInt(m??"")),(d===c.code||d===u.code)&&(t=wr(d).name,n=`${m??""}${s}`,e=d===u.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return this.protoCodes().map(e=>Object.assign({},wr(e)))}protoCodes(){let e=[],t=this.bytes,n=0;for(;n<t.length;){let i=VP.default.decode(t,n),s=VP.default.decode.bytes??0,o=wr(i),a=UP(o,t.slice(n+s));n+=a+s,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return this.#r==null&&(this.#r=e7(this.bytes)),this.#r}stringTuples(){return this.#n==null&&(this.#n=LP(this.tuples())),this.#n}encapsulate(e){return e=new Kl(e),new Kl(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Kl(n.slice(0,i))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Kl(BP(t.slice(0,n)));return this}getPeerId(){try{let t=this.stringTuples().filter(n=>n[0]===h3.ipfs.code).pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?C(le.decode(`z${n}`),"base58btc"):C(T.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){if(this.#t===void 0)try{this.#t=this.stringTuples().filter(e=>wr(e[0]).path===!0)[0][1],this.#t==null&&(this.#t=null)}catch{this.#t=null}return this.#t}equals(e){return be(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(s=>s.resolvable);if(t==null)return[this];let n=zTe.get(t.name);if(n==null)throw new F(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(s=>new Kl(s))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[FTe](){return`Multiaddr(${MP(this.bytes)})`}};function n7(r){return new Kl(r)}var qTe=ye("dns4"),$Te=ye("dns6"),HTe=ye("dnsaddr"),Ff=In(ye("dns"),HTe,qTe,$Te),i7=In(ye("ip4"),ye("ip6")),im=In(Me(i7,ye("tcp")),Me(Ff,ye("tcp"))),s7=Me(i7,ye("udp")),GTe=Me(s7,ye("utp")),jTe=Me(s7,ye("quic")),WTe=Me(s7,ye("quic-v1")),ep=In(Me(im,ye("ws")),Me(Ff,ye("ws"))),Vf=In(Me(im,ye("wss")),Me(Ff,ye("wss")),Me(im,ye("tls"),ye("ws")),Me(Ff,ye("tls"),ye("ws"))),zP=In(Me(im,ye("http")),Me(i7,ye("http")),Me(Ff,ye("http"))),KP=In(Me(im,ye("https")),Me(i7,ye("https")),Me(Ff,ye("https"))),tae=Me(s7,ye("webrtc-direct"),ye("certhash")),iae=In(Me(tae,ye("p2p")),tae),rae=Me(WTe,ye("webtransport"),ye("certhash"),ye("certhash")),sae=In(Me(rae,ye("p2p")),rae),oae=In(Me(ep,ye("p2p-webrtc-star"),ye("p2p")),Me(Vf,ye("p2p-webrtc-star"),ye("p2p")),Me(ep,ye("p2p-webrtc-star")),Me(Vf,ye("p2p-webrtc-star"))),oJt=In(Me(ep,ye("p2p-websocket-star"),ye("p2p")),Me(Vf,ye("p2p-websocket-star"),ye("p2p")),Me(ep,ye("p2p-websocket-star")),Me(Vf,ye("p2p-websocket-star"))),aae=In(Me(zP,ye("p2p-webrtc-direct"),ye("p2p")),Me(KP,ye("p2p-webrtc-direct"),ye("p2p")),Me(zP,ye("p2p-webrtc-direct")),Me(KP,ye("p2p-webrtc-direct"))),tp=In(ep,Vf,zP,KP,oae,aae,im,GTe,jTe,Ff,iae,sae),aJt=In(Me(tp,ye("p2p-stardust"),ye("p2p")),Me(tp,ye("p2p-stardust"))),Mf=In(Me(tp,ye("p2p")),oae,aae,iae,sae,ye("p2p")),nae=In(Me(Mf,ye("p2p-circuit"),Mf),Me(Mf,ye("p2p-circuit")),Me(ye("p2p-circuit"),Mf),Me(tp,ye("p2p-circuit")),Me(ye("p2p-circuit"),tp),ye("p2p-circuit")),cae=()=>In(Me(nae,cae),nae),Jd=cae(),cJt=In(Me(Jd,Mf,Jd),Me(Mf,Jd),Me(Jd,Mf),Jd,Mf);var lJt=In(Me(Jd,ye("webrtc"),ye("p2p")),Me(Jd,ye("webrtc")),Me(tp,ye("webrtc"),ye("p2p")),Me(tp,ye("webrtc")),ye("webrtc"));function lae(r){function e(t){let n;try{n=n7(t)}catch{return!1}let i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function Me(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:lae(e),partialMatch:e}}function In(...r){function e(n){let i=null;return r.some(s=>{let o=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);return o!=null?(i=o,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:lae(e),partialMatch:e}}function ye(r){let e=r;function t(i){let s;try{s=n7(i)}catch{return!1}let o=s.protoNames();return o.length===1&&o[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}function hae(r){return r.filter(e=>{if(e.protoCodes().includes(290))return!1;let t=e.decapsulateCode(421);return ep.matches(t)||Vf.matches(t)})}function dae(r){return r.filter(e=>{if(e.protoCodes().includes(290))return!1;let t=e.decapsulateCode(421);return Vf.matches(t)})}var zf=k("libp2p:websockets"),qP=class{constructor(e){this.init=e}get[Symbol.toStringTag](){return"@libp2p/websockets"}get[I1](){return!0}async dial(e,t){zf("dialing %s",e),t=t??{};let n=await this._connect(e,t),i=Koe(n,e);zf("new outbound connection %s",i.remoteAddr);let s=await t.upgrader.upgradeOutbound(i);return zf("outbound connection %s upgraded",i.remoteAddr),s}async _connect(e,t){if(t?.signal?.aborted===!0)throw new oh;let n=e.toOptions();zf("dialing %s:%s",n.host,n.port);let i=bt(),s=u=>{zf.error("connection error:",u),i.reject(u)},o=Foe(N0(e),this.init);if(o.socket.on!=null?o.socket.on("error",s):o.socket.onerror=s,t.signal==null)return await Promise.race([o.connected(),i.promise]),zf("connected %s",e),o;let a,c=new Promise((u,f)=>{if(a=()=>{f(new oh),o.close().catch(h=>{zf.error("error closing raw socket",h)})},t?.signal?.aborted===!0){a();return}t?.signal?.addEventListener("abort",a)});try{await Promise.race([c,i.promise,o.connected()])}finally{a!=null&&t?.signal?.removeEventListener("abort",a)}return zf("connected %s",e),o}createListener(e){return Voe({...this.init,...e})}filter(e){return e=Array.isArray(e)?e:[e],this.init?.filter!=null?this.init?.filter(e):Wd||Yb?dae(e):hae(e)}};function pae(r={}){return()=>new qP(r)}l();l();l();var sm=S(ur(),1);l();function $P(r){return new Uint8Array(r)}l();var mt;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(mt||(mt={}));var d3=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),HP=Object.freeze({NEW_STREAM:mt.NEW_STREAM,MESSAGE:mt.MESSAGE_INITIATOR,CLOSE:mt.CLOSE_INITIATOR,RESET:mt.RESET_INITIATOR}),mae=Object.freeze({MESSAGE:mt.MESSAGE_RECEIVER,CLOSE:mt.CLOSE_RECEIVER,RESET:mt.RESET_RECEIVER});l();var gae=1024*1024,XTe=(r,e)=>{e.append(r)};async function*ZTe(r,e={}){let t=new ke,n=!1,i=bt(),s=Number(e.size??gae);(isNaN(s)||s===0||s<0)&&(s=gae);let o=e.yieldAfter??0,a=e.serialize??XTe;for(Promise.resolve().then(async()=>{try{let c;for await(let u of r){if(a(u,t),t.byteLength>=s){clearTimeout(c),i.resolve();continue}c=setTimeout(()=>{i.resolve()},o)}clearTimeout(c),i.resolve()}catch(c){i.reject(c)}finally{n=!0}});!n;)if(await i.promise,i=bt(),t.byteLength>0){let c=t;t=new ke,yield c.subarray()}}var yae=ZTe;var GP=10*1024,jP=class{constructor(){this._pool=$P(GP),this._poolOffset=0}write(e,t){let n=this._pool,i=this._poolOffset;sm.default.encode(e.id<<3|e.type,n,i),i+=sm.default.encode.bytes??0,(e.type===mt.NEW_STREAM||e.type===mt.MESSAGE_INITIATOR||e.type===mt.MESSAGE_RECEIVER)&&e.data!=null?sm.default.encode(e.data.length,n,i):sm.default.encode(0,n,i),i+=sm.default.encode.bytes??0;let s=n.subarray(this._poolOffset,i);GP-i<100?(this._pool=$P(GP),this._poolOffset=0):this._poolOffset=i,t.append(s),(e.type===mt.NEW_STREAM||e.type===mt.MESSAGE_INITIATOR||e.type===mt.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}},wae=new jP;async function*bae(r,e=0){if(e==null||e===0){for await(let t of r){let n=new ke;for(let i of t)wae.write(i,n);yield n.subarray()}return}yield*yae(r,{size:e,serialize:(t,n)=>{for(let i of t)wae.write(i,n)}})}l();var WP=1<<20,JTe=4<<20,o7=class{constructor(e=WP,t=JTe){this._buffer=new ke,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});let t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(u){if(u.code==="ERR_MSG_TOO_BIG")throw u;break}let{id:n,type:i,length:s,offset:o}=this._headerInfo;if(this._buffer.length-o<s)break;let c={id:n,type:i};(i===mt.NEW_STREAM||i===mt.MESSAGE_INITIATOR||i===mt.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(o,o+s)),t.push(c),this._buffer.consume(o+s),this._headerInfo=null}return t}_decodeHeader(e){let{value:t,offset:n}=_ae(e),{value:i,offset:s}=_ae(e,n),o=t&7;if(d3[o]==null)throw new Error(`Invalid type received: ${o}`);if(i>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:o,offset:n+s,length:i}}},eIe=128,Eae=127;function _ae(r,e=0){let t=0,n=0,i=e,s,o=r.length;do{if(i>=o||n>49)throw e=0,new RangeError("Could not decode varint");s=r.get(i++),t+=n<28?(s&Eae)<<n:(s&Eae)*Math.pow(2,n),n+=7}while(s>=eIe);return e=i-e,{value:t,offset:e}}l();l();function a7(r){let e=new globalThis.AbortController;function t(){e.abort();for(let s of r)s?.removeEventListener!=null&&s.removeEventListener("abort",t)}for(let s of r){if(s?.aborted===!0){t();break}s?.addEventListener!=null&&s.addEventListener("abort",t)}function n(){for(let s of r)s?.removeEventListener!=null&&s.removeEventListener("abort",t)}let i=e.signal;return i.clear=n,i}var ra=k("libp2p:mplex:stream"),YP="ERR_STREAM_RESET",tIe="ERR_STREAM_ABORT",rIe="ERR_SINK_ENDED",nIe="ERR_DOUBLE_SINK";function vae(r){let{id:e,name:t,send:n,onEnd:i,type:s="initiator",maxMsgSize:o=WP}=r,a=new AbortController,c=new AbortController,u=new AbortController,f=s==="initiator"?HP:mae,h=s==="initiator"?`i${e}`:`r${e}`,p=`${t??e}`,d=!1,m=!1,g=!1,y,w={open:Date.now()},b=x=>{d||(d=!0,ra.trace("%s stream %s source end - err: %o",s,p,x),x!=null&&y==null&&(y=x),m&&(I.stat.timeline.close=Date.now(),i?.(y)))},_=x=>{m||(m=!0,ra.trace("%s stream %s sink end - err: %o",s,p,x),x!=null&&y==null&&(y=x),d&&(w.close=Date.now(),i?.(y)))},v=dt({onEnd:b}),I={close:()=>{ra.trace("%s stream %s close",s,p),I.closeRead(),I.closeWrite()},closeRead:()=>{ra.trace("%s stream %s closeRead",s,p),!d&&v.end()},closeWrite:()=>{if(ra.trace("%s stream %s closeWrite",s,p),!m){u.abort();try{n({id:e,type:f.CLOSE})}catch(x){ra.trace("%s stream %s error sending close",s,t,x)}_()}},abort:x=>{ra.trace("%s stream %s abort",s,p,x),v.end(x),a.abort(),_(x)},reset:()=>{let x=new F("stream reset",YP);c.abort(),v.end(x),_(x)},sink:async x=>{if(g)throw new F("sink already called on stream",nIe);if(g=!0,m)throw new F("stream closed for writing",rIe);let A=a7([a.signal,c.signal,u.signal]);try{x=ni(x,A),s==="initiator"&&n({id:e,type:HP.NEW_STREAM,data:new ke(U(p))});for await(let R of x)for(;R.length>0;){if(R.length<=o){n({id:e,type:f.MESSAGE,data:R instanceof Uint8Array?new ke(R):R});break}R=R instanceof Uint8Array?new ke(R):R,n({id:e,type:f.MESSAGE,data:R.sublist(0,o)}),R.consume(o)}}catch(R){if(R.type==="aborted"&&R.message==="The operation was aborted"){if(u.signal.aborted)return;c.signal.aborted&&(R.message="stream reset",R.code=YP),a.signal.aborted&&(R.message="stream aborted",R.code=tIe)}if(R.code===YP)ra.trace("%s stream %s reset",s,t);else{ra.trace("%s stream %s error",s,t,R);try{n({id:e,type:f.RESET})}catch(O){ra.trace("%s stream %s error sending reset",s,t,O)}}v.end(R),_(R);return}finally{A.clear()}try{n({id:e,type:f.CLOSE})}catch(R){ra.trace("%s stream %s error sending close",s,t,R)}_()},source:v,sourcePush:x=>{v.push(x)},sourceReadableLength(){return v.readableLength},stat:{direction:s==="initiator"?"outbound":"inbound",timeline:w},metadata:{},id:h};return I}var xae=S(XR(),1);var na=k("libp2p:mplex"),iIe=1024,sIe=1024,oIe=1024*1024*4,aIe=5;function Sae(r){let e={...r,type:`${d3[r.type]} (${r.type})`};return r.type===mt.NEW_STREAM&&(e.data=C(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===mt.MESSAGE_INITIATOR||r.type===mt.MESSAGE_RECEIVER)&&(e.data=C(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}var c7=class{constructor(e){this.protocol="/mplex/6.7.0",e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.sink=this._createSink();let t=this._createSource();this._source=t,this.source=t,this.closeController=new AbortController,this.rateLimiter=new xae.RateLimiterMemory({points:e.disconnectThreshold??aIe,duration:1})}get streams(){let e=[];for(let t of this._streams.initiators.values())e.push(t);for(let t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");let t=this._streamId++;e=e==null?t.toString():e.toString();let n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}close(e){this.closeController.signal.aborted||(e!=null?this.streams.forEach(t=>{t.abort(e)}):this.streams.forEach(t=>{t.close()}),this.closeController.abort())}_newReceiverStream(e){let{id:t,name:n}=e,i=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:i})}_newStream(e){let{id:t,name:n,type:i,registry:s}=e;if(na("new %s stream %s",i,t),i==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??sIe))throw new F("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(s.has(t))throw new Error(`${i} stream ${t} already exists!`);let c=vae({id:t,name:n,send:u=>{na.enabled&&na.trace("%s stream %s send",i,t,Sae(u)),this._source.push(u)},type:i,onEnd:()=>{na("%s stream with id %s and protocol %s ended",i,t,c.stat.protocol),s.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize});return s.set(t,c),c}_createSink(){return async t=>{let n=a7([this.closeController.signal,this._init.signal]);try{t=ni(t,n);let i=new o7(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(let s of t)for(let o of i.write(s))await this._handleIncoming(o);this._source.end()}catch(i){na("error in sink",i),this._source.end(i)}finally{n.clear()}}}_createSource(){let t=gz({objectMode:!0,onEnd:n=>{this.close(n)}});return Object.assign(bae(t,this._init.minSendBytes),{push:t.push,end:t.end,return:t.return})}async _handleIncoming(e){let{id:t,type:n}=e;if(na.enabled&&na.trace("incoming message",Sae(e)),e.type===mt.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??iIe)){na("too many inbound streams open"),this._source.push({id:t,type:mt.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{na("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this._source.end(new Error("Too many open streams"));return}return}let a=this._newReceiverStream({id:t,name:C(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}let s=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(s==null){na("missing stream %s for message type %s",t,d3[n]);return}let o=this._init.maxStreamBufferSize??oIe;switch(n){case mt.MESSAGE_INITIATOR:case mt.MESSAGE_RECEIVER:if(s.sourceReadableLength()>o){this._source.push({id:e.id,type:n===mt.MESSAGE_INITIATOR?mt.RESET_RECEIVER:mt.RESET_INITIATOR});let a=new F("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");s.abort(a);return}s.sourcePush(e.data);break;case mt.CLOSE_INITIATOR:case mt.CLOSE_RECEIVER:s.closeRead();break;case mt.RESET_INITIATOR:case mt.RESET_RECEIVER:s.reset();break;default:na("unknown message type %s",n)}}};var QP=class{constructor(e={}){this.protocol="/mplex/6.7.0",this._init=e}createStreamMuxer(e={}){return new c7({...e,...this._init})}};function Aae(r={}){return()=>new QP(r)}l();l();l();l();l();l();function l7(r){return r[Symbol.asyncIterator]!=null}var u7=r=>{let e=xr.encodingLength(r),t=Ri(e);return xr.encode(r,t),u7.bytes=e,t};u7.bytes=0;function f7(r,e){e=e??{};let t=e.lengthEncoder??u7;function*n(i){let s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}return l7(r)?async function*(){for await(let i of r)yield*n(i)}():function*(){for(let i of r)yield*n(i)}()}f7.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??u7;return new ke(t(r.byteLength),r)};l();var om=S(W(),1);var cIe=8,lIe=1024*1024*4,rp;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(rp||(rp={}));var ZP=r=>{let e=xr.decode(r);return ZP.bytes=xr.encodingLength(e),e};ZP.bytes=0;function XP(r,e){let t=new ke,n=rp.LENGTH,i=-1,s=e?.lengthDecoder??ZP,o=e?.maxLengthLength??cIe,a=e?.maxDataLength??lIe;function*c(){for(;t.byteLength>0;){if(n===rp.LENGTH)try{if(i=s(t),i<0)throw(0,om.default)(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(i>a)throw(0,om.default)(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");let u=s.bytes;t.consume(u),e?.onLength!=null&&e.onLength(i),n=rp.DATA}catch(u){if(u instanceof RangeError){if(t.byteLength>o)throw(0,om.default)(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw u}if(n===rp.DATA){if(t.byteLength<i)break;let u=t.sublist(0,i);t.consume(i),e?.onData!=null&&e.onData(u),yield u,n=rp.LENGTH}}}return l7(r)?async function*(){for await(let u of r)t.append(u),yield*c();if(t.byteLength>0)throw(0,om.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}():function*(){for(let u of r)t.append(u),yield*c();if(t.byteLength>0)throw(0,om.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}()}XP.fromReader=(r,e)=>{let t=1,n=async function*(){for(;;)try{let{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return XP(n,{...e??{},onLength:s=>{t=s}})};var h7=S(W(),1),Tae=r=>xr.decode(r);Tae.bytes=0;function JP(r,e={}){let t=dt();r.sink(t).catch(o=>{t.end(o)}),r.sink=async o=>{for await(let a of o)t.push(a)};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let i=new ke,s={read:async o=>{if(o==null){let{done:c,value:u}=await n.next();return c===!0?new ke:u}for(;i.byteLength<o;){let{value:c,done:u}=await n.next();if(u===!0)throw(0,h7.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF");i.append(c)}let a=i.sublist(0,o);return i.consume(o),a},readLP:async()=>{let o=-1,a=new ke,c=e?.lengthDecoder??Tae;for(;;){a.append(await s.read(1));try{o=c(a)}catch(u){if(u instanceof RangeError)continue;throw u}if(o>-1)break;if(e?.maxLengthLength!=null&&a.byteLength>e.maxLengthLength)throw(0,h7.default)(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG")}if(e?.maxDataLength!=null&&o>e.maxDataLength)throw(0,h7.default)(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");return await s.read(o)},readPB:async o=>{let a=await s.readLP();if(a==null)throw new Error("Value is null");let c=a instanceof Uint8Array?a:a.subarray();return o.decode(c)},write:o=>{o instanceof Uint8Array?t.push(o):t.push(o.subarray())},writeLP:o=>{s.write(f7.single(o,e))},writePB:(o,a)=>{s.writeLP(a.encode(o))},pb:o=>({read:async()=>await s.readPB(o),write:a=>{s.writePB(a,o)},unwrap:()=>s}),unwrap:()=>{let o=r.source;return r.source=async function*(){yield*i,yield*o}(),r}};return s}l();l();function ek(){let r=bt(),e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function Iae(){let r=ek(),e=ek();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}l();var Rae=Boolean(globalThis.process?.env?.DUMP_SESSION_KEYS);l();var cce=S(Lae(),1),cm=S(Jae(),1),T7=S(tce(),1),yk=S(gk(),1),lce={hashSHA256(r){return(0,T7.hash)(r)},getHKDF(r,e){let i=new cce.HKDF(T7.SHA256,e,r).expand(96),s=i.subarray(0,32),o=i.subarray(32,64),a=i.subarray(64,96);return[s,o,a]},generateX25519KeyPair(){let r=cm.generateKeyPair();return{publicKey:r.publicKey,privateKey:r.secretKey}},generateX25519KeyPairFromSeed(r){let e=cm.generateKeyPairFromSeed(r);return{publicKey:e.publicKey,privateKey:e.secretKey}},generateX25519SharedKey(r,e){return cm.sharedKey(r,e)},chaCha20Poly1305Encrypt(r,e,t,n){return new yk.ChaCha20Poly1305(n).seal(e,r,t)},chaCha20Poly1305Decrypt(r,e,t,n,i){return new yk.ChaCha20Poly1305(n).open(e,r,t,i)}};l();var wk=S(gk(),1);l();var bRe=r=>globalThis.Buffer?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r),lm=r=>{let e=bRe(2);return new DataView(e.buffer,e.byteOffset,e.byteLength).setUint16(0,r,!1),e};lm.bytes=2;var b3=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");return r instanceof Uint8Array?new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,!1):r.getUint16(0)};b3.bytes=2;function uce(r){return Z([r.ne,r.ciphertext],r.ne.length+r.ciphertext.length)}function fce(r){return Z([r.ne,r.ns,r.ciphertext],r.ne.length+r.ns.length+r.ciphertext.length)}function hce(r){return Z([r.ns,r.ciphertext],r.ns.length+r.ciphertext.length)}function dce(r){if(r.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:r.subarray(0,32),ciphertext:r.subarray(32,r.length),ns:new Uint8Array(0)}}function pce(r){if(r.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:r.subarray(0,32),ns:r.subarray(32,80),ciphertext:r.subarray(80,r.length)}}function mce(r){if(r.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:r.subarray(0,48),ciphertext:r.subarray(48,r.length)}}function yce(r,e){return async function*(t){for await(let n of t)for(let i=0;i<n.length;i+=65519){let s=i+65519;s>n.length&&(s=n.length);let o=r.encrypt(n.subarray(i,s),r.session);e?.encryptedPackets.increment(),yield lm(o.byteLength),yield o}}}function wce(r,e){return async function*(t){for await(let n of t)for(let i=0;i<n.length;i+=65535){let s=i+65535;if(s>n.length&&(s=n.length),s-wk.TAG_LENGTH<i)throw new Error("Invalid chunk");let o=n.subarray(i,s),a=n.subarray(i,s-wk.TAG_LENGTH),{plaintext:c,valid:u}=r.decrypt(o,r.session,a);if(!u)throw e?.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");e?.decryptedPackets.increment(),yield c}}}l();l();var np=class extends Error{constructor(e="Unexpected Peer"){super(e),this.code=np.code}static get code(){return"ERR_UNEXPECTED_PEER"}},Gl=class extends Error{constructor(e="Invalid crypto exchange"){super(e),this.code=Gl.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}};l();l();l();var I7;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(let s of t.webtransportCerthashes)n.uint32(10),n.bytes(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={webtransportCerthashes:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.webtransportCerthashes.push(t.bytes());break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(I7||(I7={}));var _3;(function(r){let e;r.codec=()=>(e==null&&(e=ar((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.identityKey!=null&&t.identityKey.byteLength>0)&&(n.uint32(10),n.bytes(t.identityKey??new Uint8Array(0))),(i.writeDefaults===!0||t.identitySig!=null&&t.identitySig.byteLength>0)&&(n.uint32(18),n.bytes(t.identitySig??new Uint8Array(0))),t.extensions!=null&&(n.uint32(34),I7.codec().encode(t.extensions,n,{writeDefaults:!1})),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.identityKey=t.bytes();break;case 2:i.identitySig=t.bytes();break;case 4:i.extensions=I7.codec().decode(t,t.uint32());break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>or(t,r.codec()),r.decode=t=>sr(t,r.codec())})(_3||(_3={}));async function bce(r,e,t){let n=await _Re(r,Ece(e));if(r.publicKey==null)throw new Error("PublicKey was missing from local PeerId");return ERe(r.publicKey,n,t)}function ERe(r,e,t){return _3.encode({identityKey:r,identitySig:e,extensions:t??{webtransportCerthashes:[]}}).subarray()}async function _Re(r,e){if(r.privateKey==null)throw new Error("PrivateKey was missing from PeerId");return await(await Mn(r.privateKey)).sign(e)}async function bk(r){return await Ur(r.identityKey)}function Ek(r){return _3.decode(r)}function Ece(r){let e=U("noise-libp2p-static-key:");return Z([e,r],e.length+r.length)}async function _k(r,e,t){let n=await Ur(e.identityKey);if(!n.equals(t))throw new Error(`Payload identity key ${n.toString()} does not match expected remote peer ${t.toString()}`);let i=Ece(r);if(n.publicKey==null)throw new Error("PublicKey was missing from PeerId");if(e.identitySig==null)throw new Error("Signature was missing from message");if(!await Hi(n.publicKey).verify(i,e.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return n}function v3(r){return!(!(r instanceof Uint8Array)||r.length!==32)}l();l();var jn=k("libp2p:noise");var bo;Rae?bo=jn:bo=Object.assign(()=>{},{enabled:!1,trace:()=>{},error:()=>{}});function _ce(r){bo(`LOCAL_STATIC_PUBLIC_KEY ${C(r.publicKey,"hex")}`),bo(`LOCAL_STATIC_PRIVATE_KEY ${C(r.privateKey,"hex")}`)}function vk(r){r?(bo(`LOCAL_PUBLIC_EPHEMERAL_KEY ${C(r.publicKey,"hex")}`),bo(`LOCAL_PRIVATE_EPHEMERAL_KEY ${C(r.privateKey,"hex")}`)):bo("Missing local ephemeral keys.")}function vce(r){bo(`REMOTE_STATIC_PUBLIC_KEY ${C(r,"hex")}`)}function Sk(r){bo(`REMOTE_EPHEMERAL_PUBLIC_KEY ${C(r,"hex")}`)}function Sce(r){r.cs1&&r.cs2?(bo(`CIPHER_STATE_1 ${r.cs1.n.getUint64()} ${C(r.cs1.k,"hex")}`),bo(`CIPHER_STATE_2 ${r.cs2.n.getUint64()} ${C(r.cs2.k,"hex")}`)):bo("Missing cipher state.")}l();var vRe="Cipherstate has reached maximum n, a new handshake must be performed",R7=class{constructor(e=0){this.n=e,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error(vRe)}};var C7=class{constructor(e){this.crypto=e}encryptWithAd(e,t,n){let i=this.encrypt(e.k,e.n,t,n);return e.n.increment(),i}decryptWithAd(e,t,n,i){let{plaintext:s,valid:o}=this.decrypt(e.k,e.n,t,n,i);return o&&e.n.increment(),{plaintext:s,valid:o}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(e){let t=this.createEmptyKey();return be(t,e)}encrypt(e,t,n,i){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(i,t.getBytes(),n,e)}encryptAndHash(e,t){let n;return this.hasKey(e.cs)?n=this.encryptWithAd(e.cs,e.h,t):n=t,this.mixHash(e,n),n}decrypt(e,t,n,i,s){t.assertValue();let o=this.crypto.chaCha20Poly1305Decrypt(i,t.getBytes(),n,e,s);return o?{plaintext:o,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(e,t){let n,i=!0;return this.hasKey(e.cs)?{plaintext:n,valid:i}=this.decryptWithAd(e.cs,e.h,t):n=t,this.mixHash(e,t),{plaintext:n,valid:i}}dh(e,t){try{let n=this.crypto.generateX25519SharedKey(e,t);return n.length===32?n:n.subarray(0,32)}catch(n){let i=n;return jn.error(i),new Uint8Array(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256(Z([e,t],e.length+t.length))}mixKey(e,t){let[n,i]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(i),e.ck=n}initializeKey(e){return{k:e,n:new R7}}initializeSymmetric(e){let t=U(e,"utf-8"),n=this.hashProtocolName(t),i=n,s=this.createEmptyKey();return{cs:this.initializeKey(s),ck:i,h:n}}hashProtocolName(e){if(e.length<=32){let t=new Uint8Array(32);return t.set(e),t}else return this.getHash(e,new Uint8Array(0))}split(e){let[t,n]=this.crypto.getHKDF(e.ck,new Uint8Array(0)),i=this.initializeKey(t),s=this.initializeKey(n);return{cs1:i,cs2:s}}writeMessageRegular(e,t){let n=this.encryptWithAd(e,new Uint8Array(0),t),i=this.createEmptyKey(),s=new Uint8Array(0);return{ne:i,ns:s,ciphertext:n}}readMessageRegular(e,t){return this.decryptWithAd(e,new Uint8Array(0),t.ciphertext)}};var P7=class extends C7{initializeInitiator(e,t,n,i){let s="Noise_XX_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(s);this.mixHash(o,e);let a=new Uint8Array(32);return{ss:o,s:t,rs:n,psk:i,re:a}}initializeResponder(e,t,n,i){let s="Noise_XX_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(s);this.mixHash(o,e);let a=new Uint8Array(32);return{ss:o,s:t,rs:n,psk:i,re:a}}writeMessageA(e,t,n){let i=new Uint8Array(0);n!==void 0?e.e=n:e.e=this.crypto.generateX25519KeyPair();let s=e.e.publicKey;this.mixHash(e.ss,s);let o=this.encryptAndHash(e.ss,t);return{ne:s,ns:i,ciphertext:o}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();let n=e.e.publicKey;this.mixHash(e.ss,n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));let i=e.s.publicKey,s=this.encryptAndHash(e.ss,i);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));let o=this.encryptAndHash(e.ss,t);return{ne:n,ns:s,ciphertext:o}}writeMessageC(e,t){let n=e.s.publicKey,i=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));let s=this.encryptAndHash(e.ss,t),a={ne:this.createEmptyKey(),ns:i,ciphertext:s},{cs1:c,cs2:u}=this.split(e.ss);return{h:e.ss.h,messageBuffer:a,cs1:c,cs2:u}}readMessageA(e,t){return v3(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(v3(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));let{plaintext:n,valid:i}=this.decryptAndHash(e.ss,t.ns);i&&v3(n)&&(e.rs=n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));let{plaintext:s,valid:o}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:s,valid:i&&o}}readMessageC(e,t){let{plaintext:n,valid:i}=this.decryptAndHash(e.ss,t.ns);if(i&&v3(n)&&(e.rs=n),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));let{plaintext:s,valid:o}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:a,cs2:c}=this.split(e.ss);return{h:e.ss.h,plaintext:s,valid:i&&o,cs1:a,cs2:c}}initSession(e,t,n){let i=this.createEmptyKey(),s=new Uint8Array(32),o;return e?o=this.initializeInitiator(t,n,s,i):o=this.initializeResponder(t,n,s,i),{hs:o,i:e,mc:0}}sendMessage(e,t,n){let i;if(e.mc===0)i=this.writeMessageA(e.hs,t,n);else if(e.mc===1)i=this.writeMessageB(e.hs,t);else if(e.mc===2){let{h:s,messageBuffer:o,cs1:a,cs2:c}=this.writeMessageC(e.hs,t);i=o,e.h=s,e.cs1=a,e.cs2=c}else if(e.mc>2)if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");i=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");i=this.writeMessageRegular(e.cs2,t)}else throw new Error("Session invalid.");return e.mc++,i}recvMessage(e,t){let n=new Uint8Array(0),i=!1;if(e.mc===0)({plaintext:n,valid:i}=this.readMessageA(e.hs,t));else if(e.mc===1)({plaintext:n,valid:i}=this.readMessageB(e.hs,t));else if(e.mc===2){let{h:s,plaintext:o,valid:a,cs1:c,cs2:u}=this.readMessageC(e.hs,t);n=o,i=a,e.h=s,e.cs1=c,e.cs2=u}return e.mc++,{plaintext:n,valid:i}}};var k7=class{constructor(e,t,n,i,s,o,a,c){this.remoteExtensions={webtransportCerthashes:[]},this.isInitiator=e,this.payload=t,this.prologue=n,this.staticKeypair=s,this.connection=o,a&&(this.remotePeer=a),this.xx=c??new P7(i),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){if(_ce(this.session.hs.s),this.isInitiator){jn.trace("Stage 0 - Initiator starting to send first message.");let e=this.xx.sendMessage(this.session,new Uint8Array(0));this.connection.writeLP(uce(e)),jn.trace("Stage 0 - Initiator finished sending first message."),vk(this.session.hs.e)}else{jn.trace("Stage 0 - Responder waiting to receive first message...");let e=dce((await this.connection.readLP()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new Gl("xx handshake stage 0 validation fail");jn.trace("Stage 0 - Responder received first message."),Sk(this.session.hs.re)}}async exchange(){if(this.isInitiator){jn.trace("Stage 1 - Initiator waiting to receive first message from responder...");let e=pce((await this.connection.readLP()).subarray()),{plaintext:t,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new Gl("xx handshake stage 1 validation fail");jn.trace("Stage 1 - Initiator received the message."),Sk(this.session.hs.re),vce(this.session.hs.rs),jn.trace("Initiator going to check remote's signature...");try{let i=Ek(t);this.remotePeer=this.remotePeer||await bk(i),await _k(this.session.hs.rs,i,this.remotePeer),this.setRemoteNoiseExtension(i.extensions)}catch(i){let s=i;throw new np(`Error occurred while verifying signed payload: ${s.message}`)}jn.trace("All good with the signature!")}else{jn.trace("Stage 1 - Responder sending out first message with signed payload and static key.");let e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(fce(e)),jn.trace("Stage 1 - Responder sent the second handshake message with signed payload."),vk(this.session.hs.e)}}async finish(){if(this.isInitiator){jn.trace("Stage 2 - Initiator sending third handshake message.");let e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(hce(e)),jn.trace("Stage 2 - Initiator sent message with signed payload.")}else{jn.trace("Stage 2 - Responder waiting for third handshake message...");let e=mce((await this.connection.readLP()).subarray()),{plaintext:t,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new Gl("xx handshake stage 2 validation fail");jn.trace("Stage 2 - Responder received the message, finished handshake.");try{let i=Ek(t);this.remotePeer=this.remotePeer||await bk(i),await _k(this.session.hs.rs,i,this.remotePeer),this.setRemoteNoiseExtension(i.extensions)}catch(i){let s=i;throw new np(`Error occurred while verifying signed payload: ${s.message}`)}}Sce(this.session)}encrypt(e,t){let n=this.getCS(t);return this.xx.encryptWithAd(n,new Uint8Array(0),e)}decrypt(e,t,n){let i=this.getCS(t,!1);return this.xx.decryptWithAd(i,new Uint8Array(0),e,n)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new Gl("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}};l();function xce(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}var O7=class{constructor(e={}){this.protocol="/noise";let{staticNoiseKey:t,extensions:n,crypto:i,prologueBytes:s,metrics:o}=e;this.crypto=i??lce,this.extensions=n,this.metrics=o?xce(o):void 0,t?this.staticKeys=this.crypto.generateX25519KeyPairFromSeed(t):this.staticKeys=this.crypto.generateX25519KeyPair(),this.prologue=s??new Uint8Array(0)}async secureOutbound(e,t,n){let i=JP(t,{lengthEncoder:lm,lengthDecoder:b3,maxDataLength:65535}),s=await this.performHandshake({connection:i,isInitiator:!0,localPeer:e,remotePeer:n});return{conn:await this.createSecureConnection(i,s),remoteExtensions:s.remoteExtensions,remotePeer:s.remotePeer}}async secureInbound(e,t,n){let i=JP(t,{lengthEncoder:lm,lengthDecoder:b3,maxDataLength:65535}),s=await this.performHandshake({connection:i,isInitiator:!1,localPeer:e,remotePeer:n});return{conn:await this.createSecureConnection(i,s),remotePeer:s.remotePeer,remoteExtensions:s.remoteExtensions}}async performHandshake(e){let t=await bce(e.localPeer,this.staticKeys.publicKey,this.extensions);return await this.performXXHandshake(e,t)}async performXXHandshake(e,t){let{isInitiator:n,remotePeer:i,connection:s}=e,o=new k7(n,t,this.prologue,this.crypto,this.staticKeys,s,i);try{await o.propose(),await o.exchange(),await o.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){if(this.metrics?.xxHandshakeErrors.increment(),a instanceof Error)throw a.message=`Error occurred during XX handshake: ${a.message}`,a}return o}async createSecureConnection(e,t){let[n,i]=Iae(),s=e.unwrap();return await _e(n,yce(t,this.metrics),s,on({lengthDecoder:b3}),wce(t,this.metrics),n),i}};l();function Ace(r={}){return()=>new O7(r)}var SRe=Ve.bind({ignoreUndefined:!0,concatArrays:!0});function S3({options:r={},peerId:e,multiaddrs:t=[],repo:n,keychainConfig:i={},config:s={}}){let{datastore:o}=n,a=xRe({options:r,config:s,datastore:o,keychainConfig:i,peerId:e,multiaddrs:t});return typeof r.libp2p=="function"?r.libp2p({libp2pOptions:a,options:r,config:s,datastore:o,peerId:e}):(a.start=!1,hse(a))}function xRe({options:r,config:e,datastore:t,keychainConfig:n,peerId:i,multiaddrs:s}){let o=()=>{let d=(0,Yt.default)(e,"Pubsub.Router")||"gossipsub",m=TX();if(!m[d])throw(0,Tce.default)(new Error(`Router unavailable. Configure libp2p.modules.pubsub to use the ${d} router.`),"ERR_NOT_SUPPORTED");return m[d]},a={datastore:t,peerId:i},c={addresses:{listen:s.map(d=>d.toString()),announce:(0,Yt.default)(r,"addresses.announce",(0,Yt.default)(e,"Addresses.Announce",[])),noAnnounce:(0,Yt.default)(r,"addresses.noAnnounce",(0,Yt.default)(e,"Addresses.NoAnnounce",[]))},connectionManager:(0,Yt.default)(r,"connectionManager",{maxConnections:(0,Yt.default)(r,"config.Swarm.ConnMgr.HighWater",(0,Yt.default)(e,"Swarm.ConnMgr.HighWater")),minConnections:(0,Yt.default)(r,"config.Swarm.ConnMgr.LowWater",(0,Yt.default)(e,"Swarm.ConnMgr.LowWater"))}),keychain:n,identify:{host:{agentVersion:`js-ipfs/${$h}`}},contentRouters:[],peerRouters:[],peerDiscovery:[],transports:[],streamMuxers:[Aae({maxInboundStreams:256,maxOutboundStreams:1024})],connectionEncryption:[Ace()],relay:{enabled:(0,Yt.default)(r,"relay.enabled",(0,Yt.default)(e,"relay.enabled",!0)),hop:{enabled:(0,Yt.default)(r,"relay.hop.enabled",(0,Yt.default)(e,"relay.hop.enabled",!1)),active:(0,Yt.default)(r,"relay.hop.active",(0,Yt.default)(e,"relay.hop.active",!1))}},nat:{enabled:!(0,Yt.default)(e,"Swarm.DisableNatPortMap",!1)}};(0,Yt.default)(r,"config.Pubsub.Enabled",(0,Yt.default)(e,"Pubsub.Enabled",!0))&&(c.pubsub=o()),(0,Yt.default)(e,"Routing.Type","dhtclient")!=="none"&&(c.dht=ioe({clientMode:(0,Yt.default)(e,"Routing.Type","dht")!=="dhtserver",kBucketSize:(0,Yt.default)(r,"dht.kBucketSize",20),validators:{ipns:f0},selectors:{ipns:jw}}));let u=(0,Yt.default)(r,"config.Bootstrap",(0,Yt.default)(e,"Bootstrap",[]));u.length>0&&c.peerDiscovery?.push(Ioe({list:u}));let f=(0,Yt.default)(r,"libp2p",void 0);typeof f=="function"&&(f=void 0);let h=SRe(a,wte(),c,f),p=(0,Yt.default)(r,"config.Addresses.Delegates",(0,Yt.default)(e,"Addresses.Delegates",[]));if(p.length>0){let d=p[Math.floor(Math.random()*p.length)],m=se(d).toOptions(),g={host:m.host,protocol:parseInt(m.port)===443?"https":"http",port:m.port},y=Tee(g);h.contentRouters?.push(NX(y)),h.peerRouters?.push(PX(y))}return(0,Yt.default)(r,"config.Discovery.MDNS.Enabled",(0,Yt.default)(e,"Discovery.MDNS.Enabled",!0))||(h.peerDiscovery=h.peerDiscovery?.filter(d=>{try{if(typeof d=="function")return d({})[Symbol.toStringTag]!=="@libp2p/mdns"}catch{}return!0})),h.transports==null&&(h.transports=[]),h.transports.find(d=>{try{if(typeof d=="function")return d({})[Symbol.toStringTag]==="@libp2p/websockets"}catch{}return!1})==null&&h.transports.push(pae()),h}var xk=S(W(),1);var Rce=Ve.bind({ignoreUndefined:!0}),x3=k("ipfs:components:peer:storage"),um=class{constructor(e,t,n,i,s){this.print=i,this.peerId=e,this.keychain=t,this.repo=n,this.print=i,this.isNew=s}static async start(e,t,n){let{repoAutoMigrate:i,repo:s,onMigrationProgress:o}=n,a=typeof s=="string"||s==null?$Y(e,t,{path:s,autoMigrate:i,onMigrationProgress:o}):s,{peerId:c,keychain:u,isNew:f}=await ARe(e,a,n);return new um(c,u,a,e,f)}},ARe=async(r,e,t)=>{if(!e.closed)return{...await Ice(e,t),isNew:!1};try{return await e.open(),{...await Ice(e,t),isNew:!1}}catch(n){if(n.code!==ad)throw n;if(t.init&&t.init.allowNew===!1)throw new Po("Initialization of new repos disabled by config, pass `config.init.isNew: true` to enable it");return{...await TRe(r,e,t),isNew:!0}}},TRe=async(r,e,t)=>{let n=t.init||{},i=await e.exists();if(x3("repo exists?",i),i===!0)throw new Error("repo already exists");let s=n.privateKey?await IRe(n.privateKey):await RRe(r,n),o=CRe(s);x3("peer identity: %s",o.PeerID);let a={...Rce(Cce(Wc(),n.profiles),t.config),Identity:o};await e.init(a),await e.open(),x3("repo opened");let c={pass:t.pass};try{c.dek=await e.config.get("Keychain.DEK")}catch(f){if(f.code!=="ERR_NOT_FOUND")throw f}let u=await S3({options:void 0,multiaddrs:void 0,peerId:s,repo:e,config:a,keychainConfig:c});return await e.datastore.has(new fn("/info/self"))||await u.keychain.importPeer("self",s),await e.config.set("Keychain",{DEK:u.keychain.init.dek}),{peerId:s,keychain:u.keychain}},IRe=async r=>{if(x3("using user-supplied private-key"),Pi(r))return r;let e=U(r,"base64pad"),t=await Mn(e);return await Ur(t.public.bytes,t.bytes)},RRe=(r,{algorithm:e="Ed25519",bits:t=2048})=>{if(r("generating %s keypair...",e),e==="Ed25519")return gE();if(e==="RSA")return Gie({bits:t});throw(0,xk.default)(new Error("Unknown PeerId algorithm"),"ERR_UNKNOWN_PEER_ID_ALGORITHM")},CRe=r=>{if(r.privateKey==null)throw(0,xk.default)(new Error("Private key missing"),"ERR_MISSING_PRIVATE_KEY");return{PeerID:r.toString(),PrivKey:C(r.privateKey,"base64pad")}},Ice=async(r,e)=>{let t=e.config,n=e.init&&e.init.profiles||[],i=e.pass,s=await r.config.getAll(),o=PRe(Cce(s,n),t);if(s!==o&&await r.config.replace(o),!o.Identity||!o.Identity.PrivKey)throw new Pc("No private key was found in the config, please intialize the repo");let a=U(o.Identity.PrivKey,"base64pad"),c=await Mn(a),u=await Ur(c.public.bytes,c.bytes),f=await S3({options:void 0,multiaddrs:void 0,peerId:u,repo:r,config:o,keychainConfig:{pass:i,...o.Keychain}});return{peerId:u,keychain:f.keychain}},PRe=(r,e)=>e?Rce(r,e):r,Cce=(r,e)=>(e||[]).reduce((t,n)=>{let i=C0[n];if(!i)throw new Error(`Could not find profile with name '${n}'`);return x3("applying profile %s",n),i.transform(t)},r);l();l();l();l();l();var Sle=S(qce(),1);l();var A3=S(ur(),1);function $Re(r){let e=new Uint8Array(r.reduce((n,i)=>n+A3.default.encodingLength(i),0)),t=0;for(let n of r)e=A3.encode(n,e,t),t+=A3.default.encodingLength(n);return e}var $ce=$Re;l();l();l();l();var T3=class{constructor(e,t,n){this._refCounter=1,this.cid=e,this.priority=t||1,this.wantType=n}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toString(le)}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}};l();var sa=S(_le(),1),Ec=sa.default.Reader,P3=sa.default.Writer,zt=sa.default.util,vt=sa.default.roots["ipfs-bitswap"]||(sa.default.roots["ipfs-bitswap"]={}),Ls=vt.Message=(()=>{function r(e){if(this.blocks=[],this.payload=[],this.blockPresences=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.wantlist=null,r.prototype.blocks=zt.emptyArray,r.prototype.payload=zt.emptyArray,r.prototype.blockPresences=zt.emptyArray,r.prototype.pendingBytes=0,r.encode=function(t,n){if(n||(n=P3.create()),t.wantlist!=null&&Object.hasOwnProperty.call(t,"wantlist")&&vt.Message.Wantlist.encode(t.wantlist,n.uint32(10).fork()).ldelim(),t.blocks!=null&&t.blocks.length)for(var i=0;i<t.blocks.length;++i)n.uint32(18).bytes(t.blocks[i]);if(t.payload!=null&&t.payload.length)for(var i=0;i<t.payload.length;++i)vt.Message.Block.encode(t.payload[i],n.uint32(26).fork()).ldelim();if(t.blockPresences!=null&&t.blockPresences.length)for(var i=0;i<t.blockPresences.length;++i)vt.Message.BlockPresence.encode(t.blockPresences[i],n.uint32(34).fork()).ldelim();return t.pendingBytes!=null&&Object.hasOwnProperty.call(t,"pendingBytes")&&n.uint32(40).int32(t.pendingBytes),n},r.decode=function(t,n){t instanceof Ec||(t=Ec.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new vt.Message;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:{s.wantlist=vt.Message.Wantlist.decode(t,t.uint32());break}case 2:{s.blocks&&s.blocks.length||(s.blocks=[]),s.blocks.push(t.bytes());break}case 3:{s.payload&&s.payload.length||(s.payload=[]),s.payload.push(vt.Message.Block.decode(t,t.uint32()));break}case 4:{s.blockPresences&&s.blockPresences.length||(s.blockPresences=[]),s.blockPresences.push(vt.Message.BlockPresence.decode(t,t.uint32()));break}case 5:{s.pendingBytes=t.int32();break}default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof vt.Message)return t;var n=new vt.Message;if(t.wantlist!=null){if(typeof t.wantlist!="object")throw TypeError(".Message.wantlist: object expected");n.wantlist=vt.Message.Wantlist.fromObject(t.wantlist)}if(t.blocks){if(!Array.isArray(t.blocks))throw TypeError(".Message.blocks: array expected");n.blocks=[];for(var i=0;i<t.blocks.length;++i)typeof t.blocks[i]=="string"?zt.base64.decode(t.blocks[i],n.blocks[i]=zt.newBuffer(zt.base64.length(t.blocks[i])),0):t.blocks[i].length>=0&&(n.blocks[i]=t.blocks[i])}if(t.payload){if(!Array.isArray(t.payload))throw TypeError(".Message.payload: array expected");n.payload=[];for(var i=0;i<t.payload.length;++i){if(typeof t.payload[i]!="object")throw TypeError(".Message.payload: object expected");n.payload[i]=vt.Message.Block.fromObject(t.payload[i])}}if(t.blockPresences){if(!Array.isArray(t.blockPresences))throw TypeError(".Message.blockPresences: array expected");n.blockPresences=[];for(var i=0;i<t.blockPresences.length;++i){if(typeof t.blockPresences[i]!="object")throw TypeError(".Message.blockPresences: object expected");n.blockPresences[i]=vt.Message.BlockPresence.fromObject(t.blockPresences[i])}}return t.pendingBytes!=null&&(n.pendingBytes=t.pendingBytes|0),n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.blocks=[],i.payload=[],i.blockPresences=[]),n.defaults&&(i.wantlist=null,i.pendingBytes=0),t.wantlist!=null&&t.hasOwnProperty("wantlist")&&(i.wantlist=vt.Message.Wantlist.toObject(t.wantlist,n)),t.blocks&&t.blocks.length){i.blocks=[];for(var s=0;s<t.blocks.length;++s)i.blocks[s]=n.bytes===String?zt.base64.encode(t.blocks[s],0,t.blocks[s].length):n.bytes===Array?Array.prototype.slice.call(t.blocks[s]):t.blocks[s]}if(t.payload&&t.payload.length){i.payload=[];for(var s=0;s<t.payload.length;++s)i.payload[s]=vt.Message.Block.toObject(t.payload[s],n)}if(t.blockPresences&&t.blockPresences.length){i.blockPresences=[];for(var s=0;s<t.blockPresences.length;++s)i.blockPresences[s]=vt.Message.BlockPresence.toObject(t.blockPresences[s],n)}return t.pendingBytes!=null&&t.hasOwnProperty("pendingBytes")&&(i.pendingBytes=t.pendingBytes),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,sa.default.util.toJSONOptions)},r.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Message"},r.Wantlist=function(){function e(t){if(this.entries=[],t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.entries=zt.emptyArray,e.prototype.full=!1,e.encode=function(n,i){if(i||(i=P3.create()),n.entries!=null&&n.entries.length)for(var s=0;s<n.entries.length;++s)vt.Message.Wantlist.Entry.encode(n.entries[s],i.uint32(10).fork()).ldelim();return n.full!=null&&Object.hasOwnProperty.call(n,"full")&&i.uint32(16).bool(n.full),i},e.decode=function(n,i){n instanceof Ec||(n=Ec.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new vt.Message.Wantlist;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:{o.entries&&o.entries.length||(o.entries=[]),o.entries.push(vt.Message.Wantlist.Entry.decode(n,n.uint32()));break}case 2:{o.full=n.bool();break}default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof vt.Message.Wantlist)return n;var i=new vt.Message.Wantlist;if(n.entries){if(!Array.isArray(n.entries))throw TypeError(".Message.Wantlist.entries: array expected");i.entries=[];for(var s=0;s<n.entries.length;++s){if(typeof n.entries[s]!="object")throw TypeError(".Message.Wantlist.entries: object expected");i.entries[s]=vt.Message.Wantlist.Entry.fromObject(n.entries[s])}}return n.full!=null&&(i.full=Boolean(n.full)),i},e.toObject=function(n,i){i||(i={});var s={};if((i.arrays||i.defaults)&&(s.entries=[]),i.defaults&&(s.full=!1),n.entries&&n.entries.length){s.entries=[];for(var o=0;o<n.entries.length;++o)s.entries[o]=vt.Message.Wantlist.Entry.toObject(n.entries[o],i)}return n.full!=null&&n.hasOwnProperty("full")&&(s.full=n.full),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,sa.default.util.toJSONOptions)},e.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/Message.Wantlist"},e.WantType=function(){let t={},n=Object.create(t);return n[t[0]="Block"]=0,n[t[1]="Have"]=1,n}(),e.Entry=function(){function t(n){if(n)for(var i=Object.keys(n),s=0;s<i.length;++s)n[i[s]]!=null&&(this[i[s]]=n[i[s]])}return t.prototype.block=zt.newBuffer([]),t.prototype.priority=0,t.prototype.cancel=!1,t.prototype.wantType=0,t.prototype.sendDontHave=!1,t.encode=function(i,s){return s||(s=P3.create()),i.block!=null&&Object.hasOwnProperty.call(i,"block")&&s.uint32(10).bytes(i.block),i.priority!=null&&Object.hasOwnProperty.call(i,"priority")&&s.uint32(16).int32(i.priority),i.cancel!=null&&Object.hasOwnProperty.call(i,"cancel")&&s.uint32(24).bool(i.cancel),i.wantType!=null&&Object.hasOwnProperty.call(i,"wantType")&&s.uint32(32).int32(i.wantType),i.sendDontHave!=null&&Object.hasOwnProperty.call(i,"sendDontHave")&&s.uint32(40).bool(i.sendDontHave),s},t.decode=function(i,s){i instanceof Ec||(i=Ec.create(i));for(var o=s===void 0?i.len:i.pos+s,a=new vt.Message.Wantlist.Entry;i.pos<o;){var c=i.uint32();switch(c>>>3){case 1:{a.block=i.bytes();break}case 2:{a.priority=i.int32();break}case 3:{a.cancel=i.bool();break}case 4:{a.wantType=i.int32();break}case 5:{a.sendDontHave=i.bool();break}default:i.skipType(c&7);break}}return a},t.fromObject=function(i){if(i instanceof vt.Message.Wantlist.Entry)return i;var s=new vt.Message.Wantlist.Entry;switch(i.block!=null&&(typeof i.block=="string"?zt.base64.decode(i.block,s.block=zt.newBuffer(zt.base64.length(i.block)),0):i.block.length>=0&&(s.block=i.block)),i.priority!=null&&(s.priority=i.priority|0),i.cancel!=null&&(s.cancel=Boolean(i.cancel)),i.wantType){case"Block":case 0:s.wantType=0;break;case"Have":case 1:s.wantType=1;break}return i.sendDontHave!=null&&(s.sendDontHave=Boolean(i.sendDontHave)),s},t.toObject=function(i,s){s||(s={});var o={};return s.defaults&&(s.bytes===String?o.block="":(o.block=[],s.bytes!==Array&&(o.block=zt.newBuffer(o.block))),o.priority=0,o.cancel=!1,o.wantType=s.enums===String?"Block":0,o.sendDontHave=!1),i.block!=null&&i.hasOwnProperty("block")&&(o.block=s.bytes===String?zt.base64.encode(i.block,0,i.block.length):s.bytes===Array?Array.prototype.slice.call(i.block):i.block),i.priority!=null&&i.hasOwnProperty("priority")&&(o.priority=i.priority),i.cancel!=null&&i.hasOwnProperty("cancel")&&(o.cancel=i.cancel),i.wantType!=null&&i.hasOwnProperty("wantType")&&(o.wantType=s.enums===String?vt.Message.Wantlist.WantType[i.wantType]:i.wantType),i.sendDontHave!=null&&i.hasOwnProperty("sendDontHave")&&(o.sendDontHave=i.sendDontHave),o},t.prototype.toJSON=function(){return this.constructor.toObject(this,sa.default.util.toJSONOptions)},t.getTypeUrl=function(i){return i===void 0&&(i="type.googleapis.com"),i+"/Message.Wantlist.Entry"},t}(),e}(),r.Block=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.prefix=zt.newBuffer([]),e.prototype.data=zt.newBuffer([]),e.encode=function(n,i){return i||(i=P3.create()),n.prefix!=null&&Object.hasOwnProperty.call(n,"prefix")&&i.uint32(10).bytes(n.prefix),n.data!=null&&Object.hasOwnProperty.call(n,"data")&&i.uint32(18).bytes(n.data),i},e.decode=function(n,i){n instanceof Ec||(n=Ec.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new vt.Message.Block;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:{o.prefix=n.bytes();break}case 2:{o.data=n.bytes();break}default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof vt.Message.Block)return n;var i=new vt.Message.Block;return n.prefix!=null&&(typeof n.prefix=="string"?zt.base64.decode(n.prefix,i.prefix=zt.newBuffer(zt.base64.length(n.prefix)),0):n.prefix.length>=0&&(i.prefix=n.prefix)),n.data!=null&&(typeof n.data=="string"?zt.base64.decode(n.data,i.data=zt.newBuffer(zt.base64.length(n.data)),0):n.data.length>=0&&(i.data=n.data)),i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.prefix="":(s.prefix=[],i.bytes!==Array&&(s.prefix=zt.newBuffer(s.prefix))),i.bytes===String?s.data="":(s.data=[],i.bytes!==Array&&(s.data=zt.newBuffer(s.data)))),n.prefix!=null&&n.hasOwnProperty("prefix")&&(s.prefix=i.bytes===String?zt.base64.encode(n.prefix,0,n.prefix.length):i.bytes===Array?Array.prototype.slice.call(n.prefix):n.prefix),n.data!=null&&n.hasOwnProperty("data")&&(s.data=i.bytes===String?zt.base64.encode(n.data,0,n.data.length):i.bytes===Array?Array.prototype.slice.call(n.data):n.data),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,sa.default.util.toJSONOptions)},e.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/Message.Block"},e}(),r.BlockPresenceType=function(){let e={},t=Object.create(e);return t[e[0]="Have"]=0,t[e[1]="DontHave"]=1,t}(),r.BlockPresence=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.cid=zt.newBuffer([]),e.prototype.type=0,e.encode=function(n,i){return i||(i=P3.create()),n.cid!=null&&Object.hasOwnProperty.call(n,"cid")&&i.uint32(10).bytes(n.cid),n.type!=null&&Object.hasOwnProperty.call(n,"type")&&i.uint32(16).int32(n.type),i},e.decode=function(n,i){n instanceof Ec||(n=Ec.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new vt.Message.BlockPresence;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:{o.cid=n.bytes();break}case 2:{o.type=n.int32();break}default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof vt.Message.BlockPresence)return n;var i=new vt.Message.BlockPresence;switch(n.cid!=null&&(typeof n.cid=="string"?zt.base64.decode(n.cid,i.cid=zt.newBuffer(zt.base64.length(n.cid)),0):n.cid.length>=0&&(i.cid=n.cid)),n.type){case"Have":case 0:i.type=0;break;case"DontHave":case 1:i.type=1;break}return i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.cid="":(s.cid=[],i.bytes!==Array&&(s.cid=zt.newBuffer(s.cid))),s.type=i.enums===String?"Have":0),n.cid!=null&&n.hasOwnProperty("cid")&&(s.cid=i.bytes===String?zt.base64.encode(n.cid,0,n.cid.length):i.bytes===Array?Array.prototype.slice.call(n.cid):n.cid),n.type!=null&&n.hasOwnProperty("type")&&(s.type=i.enums===String?vt.Message.BlockPresenceType[n.type]:n.type),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,sa.default.util.toJSONOptions)},e.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/Message.BlockPresence"},e}(),r})();var vle={Block:Ls.Wantlist.WantType.Block,Have:Ls.Wantlist.WantType.Have},ZRe=(r,e)=>Array.prototype.slice.call(e,0).sort((t,n)=>{let i=r(t),s=r(n);return i<s?-1:i>s?1:0}),oa=class{constructor(e,t){this.set=t?ks({name:"ipfs_bitswap_wantlist",metrics:t.metrics}):new Map,this._stats=e}get length(){return this.set.size}add(e,t,n){let i=e.toString(le),s=this.set.get(i);s?(s.inc(),s.priority=t,s.wantType===vle.Have&&n===vle.Block&&(s.wantType=n)):(this.set.set(i,new T3(e,t,n)),this._stats&&this._stats.push(null,"wantListSize",1))}remove(e){let t=e.toString(le),n=this.set.get(t);n&&(n.dec(),!n.hasRefs()&&(this.set.delete(t),this._stats&&this._stats.push(null,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){return this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map(ZRe(e=>e[1].key,Array.from(this.set.entries())))}contains(e){let t=e.toString(le);return this.set.has(t)}get(e){let t=e.toString(le);return this.set.get(t)}};oa.Entry=T3;var JRe=oa.Entry,Gf=class{constructor(e,t,n,i,s){this.entry=new JRe(e,t,n),this.cancel=Boolean(i),this.sendDontHave=Boolean(s)}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get wantType(){return this.entry.wantType}set wantType(e){this.entry.wantType=e}get[Symbol.toStringTag](){return`BitswapMessageEntry ${this.cid.toString(le)} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}};var _o=(r,e)=>{let t=["bitswap"];return e&&t.push(e),r&&t.push(`${r.toString().slice(0,8)}`),k(t.join(":"))};var L7=(r,e)=>{if(r.size!==e.size)return!1;for(let[t,n]of r){let i=e.get(t);if(i===void 0||n instanceof Uint8Array&&i instanceof Uint8Array&&!be(n,i)||n instanceof Gf&&i instanceof Gf&&!n.equals(i))return!1}return!0};var Qt=class{constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return this.blocks.size===0&&this.wantlist.size===0&&this.blockPresences.size===0}addEntry(e,t,n,i,s){n==null&&(n=Qt.WantType.Block);let o=e.toString(le),a=this.wantlist.get(o);a?(a.wantType===n&&(a.priority=t),i&&(a.cancel=Boolean(i)),s&&(a.sendDontHave=Boolean(s)),n===Qt.WantType.Block&&a.wantType===Qt.WantType.Have&&(a.wantType=n)):this.wantlist.set(o,new Gf(e,t,n,i,s))}addBlock(e,t){let n=e.toString(le);this.blocks.set(n,t)}addHave(e){let t=e.toString(le);this.blockPresences.has(t)||this.blockPresences.set(t,Qt.BlockPresenceType.Have)}addDontHave(e){let t=e.toString(le);this.blockPresences.has(t)||this.blockPresences.set(t,Qt.BlockPresenceType.DontHave)}cancel(e){let t=e.toString(le);this.wantlist.delete(t),this.addEntry(e,0,Qt.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),cancel:Boolean(t.cancel)})),full:this.full?!0:void 0},blocks:Array.from(this.blocks.values())};return Ls.encode(e).finish()}serializeToBitswap110(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),wantType:t.wantType,cancel:Boolean(t.cancel),sendDontHave:Boolean(t.sendDontHave)})),full:this.full?!0:void 0},blockPresences:[],payload:[],pendingBytes:this.pendingBytes};for(let[t,n]of this.blocks.entries()){let i=T.parse(t),s=i.version,o=i.code,a=i.multihash.code,c=i.multihash.digest.length,u=$ce([s,o,a,c]);e.payload.push(new Ls.Block({prefix:u,data:n}))}for(let[t,n]of this.blockPresences)e.blockPresences.push(new Ls.BlockPresence({cid:T.parse(t).bytes,type:n}));return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),Ls.encode(e).finish()}equals(e){return!(this.full!==e.full||this.pendingBytes!==e.pendingBytes||!L7(this.wantlist,e.wantlist)||!L7(this.blocks,e.blocks)||!L7(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){let e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}};Qt.deserialize=async(r,e)=>{let t=Ls.decode(r),n=t.wantlist&&t.wantlist.full||!1,i=new Qt(n);return t.wantlist&&t.wantlist.entries&&t.wantlist.entries.forEach(s=>{if(!s.block)return;let o=T.decode(s.block);i.addEntry(o,s.priority||0,s.wantType,Boolean(s.cancel),Boolean(s.sendDontHave))}),t.blockPresences&&t.blockPresences.forEach(s=>{if(!s.cid)return;let o=T.decode(s.cid);s.type===Qt.BlockPresenceType.Have?i.addHave(o):i.addDontHave(o)}),t.blocks.length>0?(await Promise.all(t.blocks.map(async s=>{let o=await Le.digest(s),a=T.createV0(o);i.addBlock(a,s)})),i):(t.payload.length>0&&(await Promise.all(t.payload.map(async s=>{if(!s.prefix||!s.data)return;let o=(0,Sle.default)(s.prefix),a=o[0],c=o[1],u=o[2],f=u===Le.code?Le:e&&await e.getHasher(u);if(!f)throw new F("Unknown hash algorithm","ERR_UNKNOWN_HASH_ALG");let h=await f.digest(s.data),p=T.create(a,c,h);i.addBlock(p,s.data)})),i.setPendingBytes(t.pendingBytes)),i)};Qt.blockPresenceSize=r=>r.bytes.length+1;Qt.Entry=Gf;Qt.WantType={Block:Ls.Wantlist.WantType.Block,Have:Ls.Wantlist.WantType.Have};Qt.BlockPresenceType={Have:Ls.BlockPresenceType.Have,DontHave:Ls.BlockPresenceType.DontHave};l();var xle=Math.pow(2,31)-1,Ale=1e3,Tle=1;l();l();var Ile=eCe;function eCe(r,e,t){var n=null,i=null,s=function(){n&&(clearTimeout(n),i=null,n=null)},o=function(){var c=i;s(),c&&c()},a=function(){if(!e)return r.apply(this,arguments);var c=this,u=arguments,f=t&&!n;if(s(),i=function(){r.apply(c,u)},n=setTimeout(function(){if(n=null,!f){var h=i;return i=null,h()}},e),f)return i()};return a.cancel=s,a.flush=o,a}var B7=class{constructor(e,t,n){this.peerId=t,this.network=n,this.refcnt=1,this._entries=[],this._log=_o(e,"msgqueue"),this.sendEntries=Ile(this._sendEntries.bind(this),Tle)}addMessage(e){e.empty||this.send(e)}addEntries(e){this._entries=this._entries.concat(e),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;let e=new Qt(!1);this._entries.forEach(t=>{t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)}),this._entries=[],this.addMessage(e)}async send(e){try{await this.network.connectTo(this.peerId)}catch(t){this._log.error("cant connect to peer %s: %s",this.peerId.toString(),t.message);return}this._log("sending message to peer %s",this.peerId.toString()),this.network.sendMessage(this.peerId,e).catch(t=>{this._log.error("send error: %s",t.message)})}};var U7=class{constructor(e,t,n,i){this.peers=ks({name:"ipfs_bitswap_want_manager_peers",metrics:i.metrics}),this.wantlist=new oa(n,i),this.network=t,this._stats=n,this._peerId=e,this._log=_o(e,"want")}_addEntries(e,t,n){let i=e.map((s,o)=>new Qt.Entry(s,xle-o,Qt.WantType.Block,t));i.forEach(s=>{s.cancel?n?this.wantlist.removeForce(s.cid.toString(le)):this.wantlist.remove(s.cid):(this._log("adding to wl"),this.wantlist.add(s.cid,s.priority))});for(let s of this.peers.values())s.addEntries(i)}_startPeerHandler(e){let t=this.peers.get(e.toString());if(t){t.refcnt++;return}t=new B7(this._peerId,e,this.network);let n=new Qt(!0);for(let i of this.wantlist.entries())n.addEntry(i[1].cid,i[1].priority);return t.addMessage(n),this.peers.set(e.toString(),t),t}_stopPeerHandler(e){let t=this.peers.get(e.toString());t&&(t.refcnt--,!(t.refcnt>0)&&this.peers.delete(e.toString()))}wantBlocks(e,t={}){this._addEntries(e,!1),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.cancelWants(e)})}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach(e=>this.disconnected(e.peerId))}};l();var Rle=S(_n(),1);var Fk="/ipfs/bitswap/1.0.0",Vk="/ipfs/bitswap/1.1.0",zk="/ipfs/bitswap/1.2.0",rCe=32,nCe=128,iCe=3e4,M7=class{constructor(e,t,n,i={}){this._log=_o(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[Fk],i.b100Only||(this._protocols.unshift(Vk),this._protocols.unshift(zk)),this._stats=n,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=i.hashLoader,this._maxInboundStreams=i.maxInboundStreams??rCe,this._maxOutboundStreams=i.maxOutboundStreams??nCe,this._incomingStreamTimeout=i.incomingStreamTimeout??iCe}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection,{maxInboundStreams:this._maxInboundStreams,maxOutboundStreams:this._maxOutboundStreams});let e=a1({onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect});this._registrarIds=[];for(let t of this._protocols)this._registrarIds.push(await this._libp2p.register(t,e));this._libp2p.getConnections().forEach(t=>{this._onPeerConnect(t.remotePeer)})}async stop(){if(this._running=!1,await this._libp2p.unhandle(this._protocols),this._registrarIds!=null){for(let e of this._registrarIds)this._libp2p.unregister(e);this._registrarIds=[]}}_onConnection({stream:e,connection:t}){if(!this._running)return;let n=new Rle.TimeoutController(this._incomingStreamTimeout);Promise.resolve().then(async()=>{this._log("incoming new bitswap %s connection from %p",e.stat.protocol,t.remotePeer),await _e(ni(e.source,n.signal),on(),async i=>{for await(let s of i){try{let o=await Qt.deserialize(s.subarray(),this._hashLoader);await this._bitswap._receiveMessage(t.remotePeer,o)}catch(o){this._bitswap._receiveError(o);break}n.reset()}})}).catch(i=>{this._log(i),e.abort(i)}).finally(()=>{n.clear(),e.close()})}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e,t={}){return this._libp2p.contentRouting.findProviders(e,t)}async findAndConnect(e,t){let n=[],i=0;for await(let s of this.findProviders(e,t))if(this._log(`connecting to provider ${s.id}`),n.push(this.connectTo(s.id,t).catch(o=>{this._log.error(o)})),i++,i===3)break;await Promise.all(n)}async provide(e,t){await this._libp2p.contentRouting.provide(e,t)}async sendMessage(e,t){if(!this._running)throw new Error("network isn't running");let n=e.toString();this._log("sendMessage to %s",n,t);let s=await(await this._libp2p.dial(e)).newStream([zk,Vk,Fk]);await sCe(s,t,this._log),this._updateSentStats(e,t.blocks)}async connectTo(e,t){if(!this._running)throw new Error("network isn't running");return this._libp2p.dial(e,t)}_updateSentStats(e,t){let n=e.toString();if(this._stats){for(let i of t.values())this._stats.push(n,"dataSent",i.length);this._stats.push(n,"blocksSent",t.size)}}};async function sCe(r,e,t){try{let n;switch(r.stat.protocol){case Fk:n=e.serializeToBitswap100();break;case Vk:case zk:n=e.serializeToBitswap110();break;default:throw new Error("Unknown protocol: "+r.stat.protocol)}await _e([n],xn(),r)}catch(n){t(n)}finally{r.close()}}l();l();var F7=class{constructor(e){this.partner=e,this.wantlist=new oa,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesRecv+=e}wants(e,t,n){this.wantlist.add(e,t,n)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}};l();l();var k3=class extends Map{constructor(e,t){super(),this._cmp=t||this._defaultSort,this._keys=[];for(let[n,i]of e||[])this.set(n,i)}update(e){if(e<0||e>=this._keys.length)return;let t=this._keys[e];this._keys.splice(e,1);let n=this._find(t);this._keys.splice(n,0,t)}set(e,t){if(this.has(e)){let i=this.indexOf(e);this._keys.splice(i,1)}super.set(e,t);let n=this._find(e);return this._keys.splice(n,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;let t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;let t=this._find(e);if(this._keys[t]===e)return t;for(let n=1;n<this._keys.length;n++){if(this._keys[t+n]===e)return t+n;if(this._keys[t-n]===e)return t-n}return-1}_find(e){let t=0,n=this._keys.length;for(;t<n;){let i=t+n>>>1,s=this._kCmp(this._keys[i],e);if(s<0)t=i+1;else if(s>0)n=i;else return i}return t}*keys(){for(let e of this._keys)yield e}*values(){for(let e of this._keys)yield this.get(e)}*entries(){for(let e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e,t){if(e)for(let n of this._keys)e.apply(t,[[n,this.get(n)]])}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}};var oCe={hasNewInfo(){return!1},merge(){}},V7=class{constructor(e=oCe){this._taskMerger=e,this._byPeer=new k3([],z7.compare)}pushTasks(e,t){let n=this._byPeer.get(e.toString());n||(n=new z7(e,this._taskMerger)),n.pushTasks(t),this._byPeer.set(e.toString(),n)}popTasks(e){let t=this._head();if(t===void 0)return{tasks:[],pendingSize:0};let{tasks:n,pendingSize:i}=t.popTasks(e);if(n.length===0)return{tasks:n,pendingSize:i};let s=t.peerId;return t.isIdle()?this._byPeer.delete(s.toString()):this._byPeer.update(0),{peerId:s,tasks:n,pendingSize:i}}_head(){if(this._byPeer.size!==0)for(let[,e]of this._byPeer)return e}remove(e,t){let n=this._byPeer.get(t.toString());n&&n.remove(e)}tasksDone(e,t){let n=this._byPeer.get(e.toString());if(!n)return;let i=this._byPeer.indexOf(e.toString());for(let s of t)n.taskDone(s);this._byPeer.update(i)}},z7=class{constructor(e,t){this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new Kk,this._active=new Set}pushTasks(e){for(let t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;let t=this._pending.get(e.topic);if(t){e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),this._taskMerger.merge(e,t);return}this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){let t=[];for(let n of this._active)n.topic===e.topic&&t.push(n);return t.length===0?!0:this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0,n=[],i=this._pending.tasks();for(let s=0;s<i.length&&t<e;s++){let o=i[s];n.push(o),t+=o.size,this._pending.delete(o.topic),this._activeTotalSize+=o.size,this._active.add(o)}return{tasks:n,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return this._pending.length===0&&this._active.size===0}static compare(e,t){return e[1]._pending.length===0?1:t[1]._pending.length===0?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}},Kk=class{constructor(){this._tasks=new k3([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce((e,t)=>e+t.task.size,0)}get(e){return(this._tasks.get(e)||{}).task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map(e=>e.task)}updatePriority(e,t){let n=this._tasks.get(e);if(!n)return;let i=this._tasks.indexOf(e);n.task.priority=t,this._tasks.update(i)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}};l();var Cle={hasNewInfo(r,e){let t=!1,n=!1;for(let i of e)i.data.haveBlock&&(t=!0),i.data.isWantBlock&&(n=!0);return!!(!n&&r.data.isWantBlock||!t&&r.data.haveBlock)},merge(r,e){let t=r.data,n=e.data;!n.haveBlock&&t.haveBlock&&(n.haveBlock=t.haveBlock,n.blockSize=t.blockSize),!n.isWantBlock&&t.isWantBlock&&(n.isWantBlock=!0,(!n.haveBlock||t.haveBlock)&&(n.haveBlock=t.haveBlock,e.size=r.size)),n.isWantBlock&&n.haveBlock&&(e.size=n.blockSize)}};var Ple=Qt.WantType,aCe=16*1024,cCe=1024,K7=class{constructor(e,t,n,i,s,o={}){this._log=_o(e,"engine"),this.blockstore=t,this.network=n,this._stats=i,this._opts=this._processOpts(o),this.ledgerMap=ks({name:"ipfs_bitswap_ledger_map",metrics:s.metrics}),this._running=!1,this._requestQueue=new V7(Cle)}_processOpts(e){return{maxSizeReplaceHasWithBlock:cCe,targetMessageSize:aCe,...e}}_scheduleProcessTasks(){setTimeout(()=>{this._processTasks()})}async _processTasks(){if(!this._running)return;let{peerId:e,tasks:t,pendingSize:n}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(t.length===0)return;let i=new Qt(!1);i.setPendingBytes(n);let s=[],o=new Map;for(let c of t){let u=T.parse(c.topic);c.data.haveBlock?c.data.isWantBlock?(s.push(u),o.set(c.topic,c.data)):i.addHave(u):i.addDontHave(u)}let a=await this._getBlocks(s);for(let[c,u]of o){let f=T.parse(c),h=a.get(c);h?i.addBlock(f,h):u.sendDontHave&&i.addDontHave(f)}if(i.empty){e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks();return}try{e&&await this.network.sendMessage(e,i);for(let[c,u]of a.entries())e&&this.messageSent(e,T.parse(c),u)}catch(c){this._log.error(c)}e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){let t=e.toString(),n=this.ledgerMap.get(t);return n?n.wantlist.sortedEntries():new Map}ledgerForPeer(e){let t=e.toString(),n=this.ledgerMap.get(t);return n?{peer:n.partner,value:n.debtRatio(),sent:n.accounting.bytesSent,recv:n.accounting.bytesRecv,exchanged:n.exchangeCount}:null}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.partner)}receivedBlocks(e){if(e.length){for(let t of this.ledgerMap.values())for(let n of e){let i=t.wantlistContains(n.cid);if(!i)continue;let s=n.data.length,o=this._sendAsBlock(i.wantType,s),a=s;o||(a=Qt.blockPresenceSize(i.cid)),this._requestQueue.pushTasks(t.partner,[{topic:i.cid.toString(le),priority:i.priority,size:a,data:{blockSize:s,isWantBlock:o,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){let n=this._findOrCreate(e);if(t.empty)return;if(t.full&&(n.wantlist=new oa),this._updateBlockAccounting(t.blocks,n),t.wantlist.size===0){this._scheduleProcessTasks();return}let i=[],s=[];t.wantlist.forEach(o=>{o.cancel?(n.cancelWant(o.cid),i.push(o.cid)):(n.wants(o.cid,o.priority,o.wantType),s.push(o))}),this._cancelWants(e,i),await this._addWants(e,s),this._scheduleProcessTasks()}_cancelWants(e,t){for(let n of t)this._requestQueue.remove(n.toString(le),e)}async _addWants(e,t){let n=await this._getBlockSizes(t.map(s=>s.cid)),i=[];for(let s of t){let o=s.cid.toString(le),a=n.get(o);if(a==null)s.sendDontHave&&i.push({topic:o,priority:s.priority,size:Qt.blockPresenceSize(s.cid),data:{isWantBlock:s.wantType===Ple.Block,blockSize:0,haveBlock:!1,sendDontHave:s.sendDontHave}});else{let c=this._sendAsBlock(s.wantType,a),u=a;c||(u=Qt.blockPresenceSize(s.cid)),i.push({topic:o,priority:s.priority,size:u,data:{isWantBlock:c,blockSize:a,haveBlock:!0,sendDontHave:s.sendDontHave}})}this._requestQueue.pushTasks(e,i)}}_sendAsBlock(e,t){return e===Ple.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){let t=await this._getBlocks(e);return new Map([...t].map(([n,i])=>[n,i.length]))}async _getBlocks(e){let t=new Map;return await Promise.all(e.map(async n=>{try{let i=await this.blockstore.get(n);t.set(n.toString(le),i)}catch(i){i.code!=="ERR_NOT_FOUND"&&this._log.error("failed to query blockstore for %s: %s",n,i)}})),t}_updateBlockAccounting(e,t){for(let n of e.values())this._log("got block (%s bytes)",n.length),t.receivedBytes(n.length)}messageSent(e,t,n){let i=this._findOrCreate(e);i.sentBytes(n.length),i.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){this.ledgerMap.delete(e.toString())}_findOrCreate(e){let t=e.toString(),n=this.ledgerMap.get(t);if(n)return n;let i=new F7(e);return this.ledgerMap.set(t,i),this._stats&&this._stats.push(t,"peerCount",1),i}start(){this._running=!0}stop(){this._running=!1}};l();var Nle=S(ri(),1);var kle=r=>`unwant:${C(r.multihash.bytes,"base64")}`,Ole=r=>`block:${C(r.multihash.bytes,"base64")}`,q7=class extends Nle.EventEmitter{constructor(e){super(),this.setMaxListeners(Ale),this._log=_o(e,"notif")}hasBlock(e,t){let n=Ole(e);this._log(n),this.emit(n,t)}wantBlock(e,t={}){if(!e)throw new Error("Not a valid cid");let n=Ole(e),i=kle(e);return this._log(`wantBlock:${e}`),new Promise((s,o)=>{let a=()=>{this.removeListener(n,c),o(new Error(`Block for ${e} unwanted`))},c=u=>{this.removeListener(i,a),s(u)};this.once(i,a),this.once(n,c),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.removeListener(n,c),this.removeListener(i,a),o(new Error(`Want for ${e} aborted`))})})}unwantBlock(e){let t=kle(e);this._log(t),this.emit(t)}};l();var Fle=S(ri(),1);l();var Ule=S(ri(),1),qk=S(Ble(),1),O3=class extends Ule.EventEmitter{constructor(e,t){super(),this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach(n=>{this._stats[n]=BigInt(0),this._movingAverages[n]={},this._options.movingAverageIntervals.forEach(i=>{(this._movingAverages[n][i]=(0,qk.default)(i)).push(this._frequencyLastTime,0)})}),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){let e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;for(;this._queue.length;){let t=e=this._queue.shift();t&&this._applyOp(t)}e&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){let t=e-this._frequencyLastTime;t&&Object.keys(this._stats).forEach(n=>{this._updateFrequencyFor(n,t,e)}),this._frequencyLastTime=e}_updateFrequencyFor(e,t,n){let i=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;let s=i/t*1e3,o=this._movingAverages[e];o||(o=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach(a=>{let c=o[a];c||(c=o[a]=(0,qk.default)(a)),c.push(n,s)})}_applyOp(e){let t=e[0],n=e[1];if(typeof n!="number")throw new Error(`invalid increment number: ${n}`);Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(n),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=n}};var Mle={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3]},$7=class extends Fle.EventEmitter{constructor(e,t=[],n=Mle){super();let i=Object.assign({},Mle,n);if(typeof i.computeThrottleTimeout!="number")throw new Error("need computeThrottleTimeout");if(typeof i.computeThrottleMaxQueueSize!="number")throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=t,this._options=i,this._enabled=this._options.enabled,this._global=new O3(t,i),this._global.on("update",s=>this.emit("update",s)),this._peers=ks({name:"ipfs_bitswap_stats_peers",metrics:e.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(let e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){let t=typeof e!="string"&&e.toString?e.toString():`${e}`;return this._peers.get(t)}push(e,t,n){if(this._enabled&&(this._global.push(t,n),e)){let i=this._peers.get(e);i||(i=new O3(this._initialCounters,this._options),this._peers.set(e,i)),i.push(t,n)}}disconnected(e){let t=e.toString(),n=this._peers.get(t);n&&(n.stop(),this._peers.delete(t))}};var Vle=S(us(),1);var uCe={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},fCe=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"],H7=class extends Za{constructor(e,t,n={}){super(),this._libp2p=e,this._log=_o(this.peerId),this._options=Object.assign({},uCe,n),this._stats=new $7(e,fCe,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new M7(e,this,this._stats,{hashLoader:n.hashLoader,maxInboundStreams:n.maxInboundStreams,maxOutboundStreams:n.maxOutboundStreams,incomingStreamTimeout:n.incomingStreamTimeout}),this.blockstore=t,this.engine=new K7(this.peerId,t,this.network,this._stats,e),this.wm=new U7(this.peerId,this.network,this._stats,e),this.notifications=new q7(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch{this._log("failed to receive message",t)}if(t.blocks.size===0)return;let n=[];for(let[i,s]of t.blocks.entries()){let o=T.parse(i);n.push({wasWanted:this.wm.wantlist.contains(o),cid:o,data:s})}this.wm.cancelWants(n.filter(({wasWanted:i})=>i).map(({cid:i})=>i)),await Promise.all(n.map(({cid:i,wasWanted:s,data:o})=>this._handleReceivedBlock(e,i,o,s)))}async _handleReceivedBlock(e,t,n,i){this._log("received block");let s=await this.blockstore.has(t);this._updateReceiveCounters(e.toString(),t,n,s),i&&await this.put(t,n)}_updateReceiveCounters(e,t,n,i){this._stats.push(e,"blocksReceived",1),this._stats.push(e,"dataReceived",n.length),i&&(this._stats.push(e,"dupBlksReceived",1),this._stats.push(e,"dupDataReceived",n.length))}_receiveError(e){this._log.error("ReceiveError: %s",e.message)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async get(e,t={}){let n=(c,u)=>(this.wm.wantBlocks([c],u),this.notifications.wantBlock(c,u)),i=!1,s=async(c,u)=>{try{return await this.blockstore.get(c,u)}catch(f){if(f.code!=="ERR_NOT_FOUND")throw f;return i||(i=!0,this.network.findAndConnect(c,u).catch(h=>this._log.error(h))),n(c,u)}},o=new AbortController,a=t.signal?(0,Vle.anySignal)([t.signal,o.signal]):o.signal;try{return await Promise.race([this.notifications.wantBlock(e,{signal:a}),s(e,{signal:a})])}finally{o.abort()}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}unwant(e){let t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach(n=>this.notifications.unwantBlock(n))}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,n){await this.blockstore.put(e,t),this._sendHaveBlockNotifications(e,t)}async*putMany(e,t){for await(let{key:n,value:i}of this.blockstore.putMany(e,t))this._sendHaveBlockNotifications(n,i),yield{key:n,value:i}}_sendHaveBlockNotifications(e,t){this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,data:t}]),this.network.provide(e).catch(n=>{this._log.error("Failed to provide: %s",n.message)})}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this._stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}unwrap(){return this.blockstore}has(e){return this.blockstore.has(e)}};var zle=(r,e,t={})=>new H7(r,e,t);var qle=S(W(),1);l();l();var G7={};jt(G7,{abortedError:()=>hCe,notFoundError:()=>Kle});l();var $k=S(W(),1);function Kle(r){return r=r||new Error("Not Found"),(0,$k.default)(r,"ERR_NOT_FOUND")}function hCe(r){return r=r||new Error("Aborted"),(0,$k.default)(r,"ERR_ABORTED")}l();var Jsr={...G7};var j7=class extends Za{constructor(e,t){super(),this.child=e,this.bitswap=t}open(){return this.child.open()}close(){return this.child.close()}unwrap(){return this.child}async put(e,t,n={}){await this.has(e)||(this.bitswap.isStarted()?await this.bitswap.put(e,t,n):await this.child.put(e,t,n))}async*putMany(e,t={}){let n=ht(e,async({key:i})=>!await this.has(i));this.bitswap.isStarted()?yield*this.bitswap.putMany(n,t):yield*this.child.putMany(n,t)}async get(e,t={}){return!await this.has(e)&&this.bitswap.isStarted()?this.bitswap.get(e,t):this.child.get(e,t)}async*getMany(e,t={}){let n=dt({objectMode:!0}),i=dt({objectMode:!0});Promise.resolve().then(async()=>{for await(let s of e)!await this.has(s)&&this.bitswap.isStarted()?n.push(s):i.push(s);n.end(),i.end()}),yield*Fr(this.bitswap.getMany(n,t),this.child.getMany(i,t))}async delete(e,t){await this.child.delete(e,t)}async*deleteMany(e,t){yield*this.child.deleteMany(e,t)}async has(e,t={}){return this.child.has(e,t)}async*query(e,t={}){yield*this.child.query(e,t)}async*queryKeys(e,t={}){yield*this.child.queryKeys(e,t)}};var fm=class{constructor(e,t,n,i,s){this.peerId=e,this.libp2p=t,this.bitswap=n,this.repo=i,this.blockstore=s}static async start({peerId:e,repo:t,print:n,hashers:i,options:s}){t.closed&&await t.open();let o=await t.config.getAll(),a=await S3({options:s,repo:t,peerId:e,multiaddrs:dCe(e,o),config:o,keychainConfig:void 0});await a.start();for(let f of a.getMultiaddrs())n(`Swarm listening on ${f.toString()}`);let c=zle(a,t.blocks,{statsEnabled:!0,hashLoader:i,maxInboundStreams:1024,maxOutboundStreams:1024});await c.start();let u=new j7(t.blocks,c);return t.blocks=u,t.pins.blockstore=u,new fm(e,a,c,t,u)}static async stop(e){e.repo.blocks=e.blockstore.unwrap(),e.repo.pins.blockstore=e.blockstore.unwrap(),await e.bitswap.stop(),await e.libp2p.stop()}},dCe=(r,e)=>{let t=r.toString(),n=[],i=e.Addresses&&e.Addresses.Swarm||[];for(let s of i){let o=se(s);if(o.protoCodes().includes(pCe))throw(0,qle.default)(new Error("websocket-star swarm addresses are not supported. See https://github.com/ipfs/js-ipfs/issues/2779"),"ERR_WEBSOCKET_STAR_SWARM_ADDR_NOT_SUPPORTED");let a=o.getPeerId();a&&a!==t&&(o=o.encapsulate(`/p2p/${t}`)),n.push(o)}return n},pCe=479;l();l();function $le({network:r}){async function e(t={}){let n=[],{libp2p:i}=await r.use(t);return await i.peerStore.forEach(s=>{n.push({id:s.id,addrs:s.addresses.map(o=>o.multiaddr)})}),n}return z(e)}l();function Hle({network:r}){async function e(t,n={}){let{libp2p:i}=await r.use(n);await i.dial(t,n)}return z(e)}l();function Gle({network:r}){async function e(t,n={}){let{libp2p:i}=await r.use(n);await i.hangUp(t)}return z(e)}l();function jle({network:r}){async function e(t={}){let{libp2p:n}=await r.use(t);return n.getMultiaddrs()}return z(e)}l();function Wle({network:r}){async function e(t={}){let{libp2p:n}=await r.use(t);if(t.verbose){let s=[];for(let o of n.getConnections()){let a={addr:o.remoteAddr,peer:o.remotePeer};(t.verbose||t.direction)&&(a.direction=o.stat.direction),t.verbose&&(a.muxer=o.stat.multiplexer,a.latency="n/a",a.streams=[]),s.push(a)}return s}let i=new Map;for(let s of n.getConnections()){let o={addr:s.remoteAddr,peer:s.remotePeer};i.set(s.remotePeer.toString(),o)}return Array.from(i.values())}return z(e)}var W7=class{constructor({network:e}){this.addrs=$le({network:e}),this.connect=Hle({network:e}),this.disconnect=Gle({network:e}),this.localAddrs=jle({network:e}),this.peers=Wle({network:e})}};l();var N3={success:!0,time:0,text:""};function Yle({network:r}){async function*e(t,n={}){let{libp2p:i}=await r.use();n.count=n.count||10;let s=await i.peerStore.get(t),o=s&&s.id;if(!o){yield{...N3,text:`Looking up peer ${t}`};let u=await i.peerRouting.findPeer(t);o=u&&u.id}if(!o)throw new Error("Peer was not found");yield{...N3,text:`PING ${o.toString()}`};let a=0,c=0;for(let u=0;u<n.count;u++)try{let f=await i.ping(o);c+=f,a++,yield{...N3,time:f}}catch(f){yield{...N3,success:!1,text:f.toString()}}if(a){let u=c/a;yield{...N3,text:`Average latency: ${u}ms`}}}return z(e)}l();var jl=S(W(),1);var Hk="/ipns/";function Qle(r){r.startsWith(Hk)&&(r=r.substring(Hk.length));let e;if((r[0]==="1"||r[0]==="Q")&&(r=`z${r}`),r[0]==="z"&&(e=le.decode(r)),r[0]==="k"&&(e=Np.decode(r)),!e)throw new Error("Could not parse string");if(e[0]!==1&&e[1]!==114&&(e=Z([[1,114],e])),e.length!==40)throw new Error("Incorrect length "+e.length);return Z([U(Hk),e.subarray(2)])}function Xle({network:r,repo:e,peerId:t}){let{get:n,put:i,findProvs:s,findPeer:o,provide:a,query:c}={async*get(u,f={}){let{libp2p:h}=await hm(r,t,f),p=u instanceof Uint8Array?u:Qle(u);if(h.dht==null)throw(0,jl.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*h.dht.get(p,f)},async*put(u,f,h){let{libp2p:p}=await hm(r,t,h),d=u instanceof Uint8Array?u:Qle(u);if(p.dht==null)throw(0,jl.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*p.dht.put(d,f,h)},async*findProvs(u,f={}){let{libp2p:h}=await hm(r,t,f);if(h.dht==null)throw(0,jl.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*h.dht.findProviders(u,{signal:f.signal})},async*findPeer(u,f={}){let{libp2p:h}=await hm(r,t,f);if(h.dht==null)throw(0,jl.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*h.dht.findPeer(u,{signal:f.signal})},async*provide(u,f={recursive:!1}){let{libp2p:h}=await hm(r,t,f);if(!await e.blocks.has(u))throw(0,jl.default)(new Error("block(s) not found locally, cannot provide"),"ERR_BLOCK_NOT_FOUND");if(f.recursive)throw(0,jl.default)(new Error("not implemented yet"),"ERR_NOT_IMPLEMENTED_YET");if(h.dht==null)throw(0,jl.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*h.dht.provide(u)},async*query(u,f={}){let{libp2p:h}=await hm(r,t,f),p,d=T.asCID(u);if(d!=null?p=d.multihash.bytes:p=ae(u.toString()).toBytes(),h.dht==null)throw(0,jl.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*h.dht.getClosestPeers(p,f)}};return{get:z(n),put:z(i),findProvs:z(s),findPeer:z(o),provide:z(a),query:z(c)}}var hm=async(r,e,t)=>{let n=await r.use(t);if(n.libp2p.dht!=null)return n;{let i=async function*(){yield{from:e,name:"QUERY_ERROR",type:3,error:new Po("dht not enabled")}};return{libp2p:{dht:{get:i,put:i,findProviders:i,findPeer:i,provide:i,getClosestPeers:i}}}}};l();var Zle=S(W(),1);var Jle=S(Gw(),1);function eue({network:r,config:e}){let t=(0,Jle.default)(e||{},"Pubsub.Enabled",!0),n={},i;return{subscribe:t?z(s):D3,unsubscribe:t?z(o):D3,publish:t?z(a):D3,ls:t?z(c):D3,peers:t?z(u):D3};async function s(f,h,p={}){let{libp2p:d}=await r.use(p);d.pubsub.subscribe(f),i==null&&(i=m=>{let g=m.detail;n[g.topic]&&n[g.topic].forEach(y=>{if(typeof y=="function"){y(g);return}y!=null&&y.handleEvent!=null&&y.handleEvent(g)})},d.pubsub.addEventListener("message",i)),h!=null&&(n[f]==null&&(n[f]=[]),n[f].push(h))}async function o(f,h,p={}){let{libp2p:d}=await r.use(p);h!=null&&n[f]!=null&&(n[f]=n[f].filter(m=>m!==h),n[f].length===0&&delete n[f]),typeof h!="function"&&delete n[f],n[f]==null&&d.pubsub.unsubscribe(f),Object.keys(n).length===0&&(d.pubsub.removeEventListener("message",i),i=void 0)}async function a(f,h,p={}){let{libp2p:d}=await r.use(p);if(!h)throw(0,Zle.default)(new Error('argument "data" is required'),"ERR_ARG_REQUIRED");await d.pubsub.publish(f,h)}async function c(f={}){let{libp2p:h}=await r.use(f);return h.pubsub.getTopics()}async function u(f,h={}){let{libp2p:p}=await r.use(h);return p.pubsub.getSubscribers(f)}}var D3=async()=>{throw new Po("pubsub not enabled")};var mCe=Ve.bind({ignoreUndefined:!0}),jf=k("ipfs"),gCe=3e4,Gk=class{constructor({print:e,storage:t,codecs:n,options:i}){let{peerId:s,repo:o,keychain:a}=t,c=mi.create(fm),u=LH(i.preload),f=bU(),h=EU({network:c}),p=new e6(i),d=Object.values(h4);(i.ipld&&i.ipld.hashers?i.ipld.hashers:[]).forEach(pe=>d.push(pe)),this.hashers=new b1({hashers:d,loadHasher:i.ipld&&i.ipld.loadHasher});let m=Object.values(Ar);(i.ipld&&i.ipld.bases?i.ipld.bases:[]).forEach(pe=>m.push(pe)),this.bases=new y1({bases:m,loadBase:i.ipld&&i.ipld.loadBase});let g=new W4({repo:o,codecs:n}),y=new u6({codecs:n,hashers:this.hashers,preload:u,repo:o}),w=new n6({dns:f,ipns:p,repo:o,codecs:n,peerId:s,isOnline:h,keychain:a,options:i}),b=SU({repo:o,codecs:n,bases:this.bases,name:w}),_=new Z6({repo:o,codecs:n,hashers:this.hashers,preload:u}),v=Object.assign(Vz({repo:o,codecs:n,resolve:b,preload:u}),{local:zz({repo:t.repo})}),{add:I,addAll:x,cat:A,get:R,ls:O}=new q6({preload:u,repo:o,options:i.EXPERIMENTAL,hashers:this.hashers}),V=wG({repo:o,preload:u,hashers:this.hashers,options:i}),$=BH({files:V,preload:u,options:i.preload});this.preload=u,this.name=w,this.ipns=p,this.pin=g,this.resolve=b,this.block=y,this.refs=v,this.start=FB({network:c,peerId:s,repo:o,preload:u,ipns:p,mfsPreload:$,print:e,keychain:a,hashers:this.hashers,options:i}),this.stop=VB({network:c,preload:u,mfsPreload:$,ipns:p,repo:o}),this.dht=Xle({network:c,repo:o,peerId:s}),this.pubsub=eue({network:c,config:i.config}),this.dns=f,this.isOnline=h,this.id=j$({network:c,peerId:s}),this.version=G$({repo:o}),this.bitswap=new s6({network:c}),this.bootstrap=new a6({repo:o}),this.config=Y$({repo:o}),this.ping=Yle({network:c}),this.add=I,this.addAll=x,this.cat=A,this.get=R,this.ls=O,this.dag=_,this.files=V,this.key=new l5({keychain:a}),this.object=new f5({preload:u,codecs:n,repo:o}),this.repo=new d5({repo:o,hashers:this.hashers}),this.stats=new p5({repo:o,network:c}),this.swarm=new W7({network:c}),Object.defineProperty(this,"libp2p",{get(){let pe=c.try();return pe?pe.libp2p:void 0}});let Y=()=>Promise.reject((0,Y7.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")),Q=async function*(){throw(0,Y7.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")};this.commands=Y,this.diag={cmds:Y,net:Y,sys:Y},this.log={level:Y,ls:Y,tail:Q},this.mount=Y,this.codecs=n}async init(){throw new Co}},yCe=async r=>{let e=ze({Data:new Ke({type:"directory"}).marshal(),Links:[]}),t=await r.block.put(e,{mhtype:"sha2-256",format:"dag-pb"});return await r.pin.add(t),t},wCe=()=>({start:!0,EXPERIMENTAL:{},preload:{enabled:!tue.isTest,addresses:["/dns4/node0.preload.ipfs.io/https","/dns4/node1.preload.ipfs.io/https","/dns4/node2.preload.ipfs.io/https","/dns4/node3.preload.ipfs.io/https"]}});async function nue(r={}){r=mCe(wCe(),r);let e=r.init||{},t={name:un.name,code:un.code,encode:u=>u,decode:u=>u},n=Object.values(d4);[ut,Cc,Op,Om,t].concat(r.ipld&&r.ipld.codecs||[]).forEach(u=>n.push(u));let i=new w1({codecs:n,loadCodec:r.ipld&&r.ipld.loadCodec}),s=r.silent?jf:console.log;jf("creating repo");let o=await um.start(s,i,r);jf("getting repo config");let a=await o.repo.config.getAll(),c=new Gk({storage:o,print:s,codecs:i,options:{...r,config:a}});if(jf("starting preload"),await c.preload.start(),jf("starting storage"),c.ipns.startOffline(o),o.isNew&&!e.emptyRepo){let u=await yCe(c);if(jf("adding default assets"),await(c.addAll,void 0),jf("initializing IPNS keyspace"),o.peerId.publicKey==null)throw(0,Y7.default)(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");let f=new rue.TimeoutController(gCe);try{await c.ipns.initializeKeyspace(o.peerId,U(`/ipfs/${u}`),{signal:f.signal})}finally{f.clear()}}return r.start!==!1&&(jf("starting node"),await c.start()),c}var iue=S(hR(),1),sue=S(dR(),1),oue=nue,aue=iue.default,cue=sue.default;l();function lue(){throw new Error("Not supported in browsers")}var bCe=oue,ECe=aue,_Ce=cue,vCe=lue;return yue(SCe);})();
/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

bytes/index.js:
  (*!
   * bytes
   * Copyright(c) 2012-2014 TJ Holowaychuk
   * Copyright(c) 2015 Jed Watson
   * MIT Licensed
   *)

queue-microtask/index.js:
  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

run-parallel-limit/index.js:
  (*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

@noble/ed25519/lib/esm/index.js:
  (*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)

@noble/secp256k1/lib/esm/index.js:
  (*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
return Ipfs}));
