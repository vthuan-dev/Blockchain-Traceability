(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.AbortableIterator = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var AbortableIterator=(()=>{var p=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var R=(r,t)=>{for(var o in t)p(r,o,{get:t[o],enumerable:!0})},S=(r,t,o,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of A(t))!v.call(r,n)&&n!==o&&p(r,n,{get:()=>t[n],enumerable:!(e=E(t,n))||e.enumerable});return r};var k=r=>S(p({},"__esModule",{value:!0}),r);var L={};R(L,{AbortError:()=>i,abortableDuplex:()=>I,abortableSink:()=>y,abortableSource:()=>m,abortableTransform:()=>y});function d(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}var i=class extends Error{type;code;constructor(t,o,e){super(t??"The operation was aborted"),this.type="aborted",this.code=o??"ABORT_ERR",this.name=e??"AbortError"}};function m(r,t,o){let e=o??{},n=d(r);async function*h(){let s,f=()=>{s?.()};for(t.addEventListener("abort",f);;){let l;try{if(t.aborted){let{abortMessage:u,abortCode:a,abortName:c}=e;throw new i(u,a,c)}let b=new Promise((u,a)=>{s=()=>{let{abortMessage:c,abortCode:w,abortName:x}=e;a(new i(c,w,x))}});l=await Promise.race([b,n.next()]),s=null}catch(b){t.removeEventListener("abort",f);let u=b.type==="aborted"&&t.aborted;if(u&&e.onAbort!=null&&e.onAbort(r),typeof n.return=="function")try{let a=n.return();a instanceof Promise&&a.catch(c=>{e.onReturnError!=null&&e.onReturnError(c)})}catch(a){e.onReturnError!=null&&e.onReturnError(a)}if(u&&e.returnOnAbort===!0)return;throw b}if(l.done===!0)break;yield l.value}t.removeEventListener("abort",f)}return h()}function y(r,t,o){return e=>r(m(e,t,o))}function I(r,t,o){return{sink:y(r.sink,t,{...o,onAbort:void 0}),source:m(r.source,t,o)}}return k(L);})();
return AbortableIterator}));
