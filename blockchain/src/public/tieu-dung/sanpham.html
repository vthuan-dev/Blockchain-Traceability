<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="../hinhanh/logo_buoi.webp">
    <title>Trang sản phẩm</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/trangchu.css" />
    <link rel="stylesheet" href="../css/nav-bar.css">
    <link rel="stylesheet" href="../css/footer.css">
    <link rel="stylesheet" href="../css/sanpham.css" />
    <link rel="stylesheet" href="../css/chatbox.css" />
    <!-- <link rel="stylesheet" href="../css/trangcanhan.css" /> -->
    <link
      href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css"
      rel="stylesheet"
    />
    
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <style>
      .product-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #ffffff;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        height: 100%;
        width: 100%;
      }

      .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      .product-name {
        font-size: 1.1rem;
        font-weight: 600;
        color: #333;
        text-align: center;
        margin-bottom: 15px;
        height: auto;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .product-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 8px;
        margin-top: 10px;
      }

      .carousel-item .col-md-3 {
        padding: 15px;
      }

      #carouselProducts .carousel-inner {
        padding: 20px 0;
      }

      .carousel-container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
      }

      .card-subtitle.mb-2.mt-4.text-muted {
        font-size: 1.2rem;
        color: #4caf50 !important;
        margin-bottom: 15px !important;
      }
    </style>
  </head>
  <body>
    <nav class="navbar custom-navbar navbar-expand-lg navbar-light bg-light custom-navbar-height">
      <div class="logo-home">
        <a href="trangchu.html">
          <img src="\hinhanh\Bitcoin-Blockchain-Network-icon-on-transparent-background-PNG.png" alt="logo" class="logo" />
        </a>
      </div>
      <a class="navbar-brand" href="#">Trang chủ</a>
      <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">Trang chủ</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./allsanpham.html">Sản phẩm</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./allnongdan.html">Nhà sản xuất</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./allnhakiemduyet.html">Nhà kiểm duyệt</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Vùng sản xuất</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Tin tức</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./account/dangnhap.html">Đăng nhập</a>
          </li>
        </ul>
      </div>
    </nav>
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="./allsanpham.html">Sản phẩm</a></li>
          <li class="breadcrumb-item active" aria-current="page">
            Bưởi da xanh
          </li>
        </ol>
      </nav>
      <div class="sanpham-container">
        <div class="row justify-content-center">
          <div class="col-md-8">
            <div class="product-details">
              <div class="product-gallery">
                <div class="main-image">
                  <img
                    src="../hinhanh/buoi-dien-222.jpg"
                    alt=""
                    class="img-fluid product-img"
                    onclick="showImage(this)"
                  />
                </div>
              </div>
              
              <div class="product-info">
                <h2 class="product-name text-center"></h2>
                
                <!-- Thông tin cơ bản -->
                <div class="product-meta text-center">
                  <div class="meta-item">
                    <span class="label">Mã sản phẩm:</span>
                    <span class="value product-id"></span>
                  </div>
                  <div class="meta-item">
                    <span class="label">Giá bán:</span>
                    <span class="value product-price"></span>
                  </div>
                </div>

                <!-- Mô tả sản phẩm -->
                <div class="product-section">
                  <h3 class="section-title">Mô tả sản phẩm</h3>
                  <div class="section-content mota">
                    <p></p>
                  </div>
                </div>

                <!-- Công dụng -->
                <div class="product-section">
                  <h3 class="section-title">Công dụng</h3>
                  <div class="section-content congdung">
                    <ul></ul>
                  </div>
                </div>

                <!-- Quy trình -->
                <div class="product-section">
                  <h3 class="section-title">Quy trình sản xuất</h3>
                  <div class="section-content quytrinh">
                    <ul></ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer bg-dark text-white py-4" data-aos="fade-up">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <h3>Thông tin liên hệ</h3>
            <p>Địa chỉ: CTU, đường 3/2, Xuân Khánh, Ninh Kiều, Cần Thơ</p>
            <p>Điện thoại: 0333351725</p>
            <p>Email: vthuan.dev@gmail.com</p>
          </div>
          <div class="col-md-4 d-none d-md-block">
            <h3>Về chúng tôi</h3>
            <p>
              Sản phẩm này được dùng để truy xuất nguồn gốc sản phẩm bưởi bằng
              công nghệ Blockchain.
            </p>
          </div>
          <div class="col-md-4 d-none d-md-block">
            <h3>Theo dõi chúng tôi</h3>
            <div class="social-links">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="chat-icon" id="openChat" onclick="toggleChat()">
      <i class="fas fa-comments"></i>
      <div class="tooltip">Đặt câu hỏi cho chúng tôi</div>
    </div>

    <!-- Khung chat -->
    <div id="chatbox" class="chatbox">
      <div class="chatbox-header">
        <strong>Hỗ trợ</strong>
        <button id="closeChat" class="btn-close" onclick="toggleChat()">
          x
        </button>
      </div>
      <div class="chatbox-body">
        <ul id="messages" class="list-group">
          <li class="list-group-item system-message">
            <strong>Hệ thống: </strong> Chào bạn, hãy đặt câu hỏi của bạn.
          </li>
        </ul>
      </div>
      <div class="chatbox-footer">
        <form id="messageForm" class="d-flex">
          <input
            id="messageInput"
            type="text"
            class="form-control"
            placeholder="type message"
          />
          <button type="submit" class="btn btn-primary">Gửi</button>
        </form>
      </div>
    </div>

    <div class="overlay" id="overlay" onclick="hideImage()">
      <img id="overlay-img" src="" alt="" />
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script src="../js_giaodien/sanpham.js"></script>
    <script src="../chatbox/chatbox.js"></script>

    <script>
      function toggleChat() {
        var chatbox = document.getElementById("chatbox");
        if (chatbox.classList.contains("show")) {
          chatbox.classList.remove("show");
          chatbox.classList.add("hide");
          setTimeout(() => {
            chatbox.style.display = "none";
            chatbox.classList.remove("hide");
          }, 300); // Match this to the animation duration
        } else {
          chatbox.style.display = "block";
          // Force a reflow before adding the 'show' class
          chatbox.offsetHeight;
          chatbox.classList.add("show");
        }
      }
    </script>

    <script>
      // Hàm để cập nhật breadcrumb
        function updateBreadcrumb(productName) {
          const breadcrumbItem = document.querySelector('.breadcrumb-item.active');
          if (breadcrumbItem) {
            breadcrumbItem.textContent = productName;
          }
        }

        document.addEventListener("DOMContentLoaded", async () => {
          const urlParams = new URLSearchParams(window.location.search);
          const productId = urlParams.get("id");

          if (productId) {
            try {
              const response = await fetch(`/api/product/${productId}`);
              const product = await response.json();

              if (response.ok) {
                // Cập nhật hình ảnh sản phẩm
                const productImg = document.querySelector(".product-img");
                if (productImg && product.img) {
                  productImg.src = `${product.img}`;
                  productImg.alt = product.product_name;
                }

                // Cập nhật tên sản phẩm
                const productName = document.querySelector(".product-name");
                if (productName) {
                  productName.textContent = product.product_name;
                }

                // Cập nhật breadcrumb
                updateBreadcrumb(product.product_name);

                // Cập nhật mã sản phẩm
                const productId = document.querySelector(".product-id");
                if (productId) {
                  productId.textContent = product.product_id;
                }

                // Cập nhật giá
                const productPrice = document.querySelector(".product-price");
                if (productPrice) {
                  productPrice.textContent = `${new Intl.NumberFormat('vi-VN').format(product.price)}đ/kg`;
                }

                // Cập nhật mô tả
                const productDesc = document.querySelector(".mota p");
                if (productDesc) {
                  productDesc.textContent = product.description;
                }

                // Cập nhật công dụng
                const productUses = document.querySelector(".congdung ul");
                if (productUses && product.uses) {
                  productUses.innerHTML = product.uses
                    .split("\n")
                    .map(use => `<li>${use.trim()}</li>`)
                    .filter(use => use !== "<li></li>")
                    .join("");
                }

                // Cập nhật quy trình
                const productProcess = document.querySelector(".quytrinh ul");
                if (productProcess && product.process) {
                  productProcess.innerHTML = product.process
                    .split("\n")
                    .map(step => `<li>${step.trim()}</li>`)
                    .filter(step => step !== "<li></li>")
                    .join("");
                }

              } else {
                console.error("Lỗi khi lấy thông tin sản phẩm:", product.error);
                // Hiển thị thông báo lỗi cho người dùng
                alert("Không thể tải thông tin sản phẩm. Vui lòng thử lại sau.");
              }
            } catch (error) {
              console.error("Lỗi khi gọi API:", error);
              // Hiển thị thông báo lỗi cho người dùng
              alert("Đã xảy ra lỗi khi tải thông tin sản phẩm. Vui lòng thử lại sau.");
            }
          }
        });
    </script>
  </body>
</html>
